/****9142********/
 ALTER TABLE CIR_EDTN_MAST ADD PRINTING_PRESS_CODE varchar2(5)


create or replace procedure get_printer_name_loc
(    pcompcode in varchar2,
     puserid in varchar2,
        
     pextra1 in varchar2,
     pextra2 in varchar2,
     p_accounts      OUT Cur_Type_New1.cursor_type )
is
 begin

open p_accounts for
      SELECT  DISTINCT X.PRINTER_NAME||'--'||(Select distinct LOC_NAME from ABC_LOC_MAST where COMP_CODE=X.COMP_CODE AND X.LOC_CODE=LOC_CODE)
 AS PRINTER_NAME,PRINTER_CODE FROM ABC_GODOWN_PRINTER_MAST X WHERE  COMP_CODE= pcompcode ;



end;


create or replace  FUNCTION  cir_get_locationname
 (pcompcode in varchar2,ploccode  varchar2)  return varchar2 is
vloc_name VARCHAR(4000);
BEGIN 

begin
SELECT  PRINTER_NAME 

       ||'--'||nvl((Select distinct LOC_NAME from ABC_LOC_MAST where COMP_CODE=X.COMP_CODE AND X.LOC_CODE=LOC_CODE),'') into vloc_name

from ABC_GODOWN_PRINTER_MAST X WHERE COMP_CODE= pcompcode and PRINTER_CODE=ploccode;
     exception when others then                       
    vloc_name:=null;
  End;
RETURN vloc_name;
END;




/****9142********/


///////////////////////////add by deepika 20/11/2012/////////////////////////////



alter table preferrences add  COMMON_EDITION_FOR_UNIT VARCHAR2(1)

///////////////////////////

CREATE OR REPLACE PACKAGE Currbindpreferpgld
IS
   TYPE t_account_cursor IS REF CURSOR;

   PROCEDURE currbindpreferpgld_p (
      compcode     IN       VARCHAR2,
      p_accounts   OUT      t_account_cursor
   );
END Currbindpreferpgld;
/


/////

CREATE OR REPLACE PACKAGE BODY currbindpreferpgld
IS
   PROCEDURE currbindpreferpgld_p (
      compcode     IN       VARCHAR2,
      p_accounts   OUT      t_account_cursor
   )
   AS
   BEGIN
      OPEN p_accounts FOR
         SELECT "date_format", "autogenerated", "currency_code",
                "rate_gr_code", "solo", "breakup", "blackwhitecode",
                "rostatus", "File_name", "Tfn", "Insert_breakup", "prefix",
                "suffix", "financestatus", "voucherst", "Ad_category",
                "Ro_datetime", "Vat", "Booking_status", "Cio_id",
                "Receipt_no", "uom_code", "Bgcolor_publication",
                "chkfor_valid_pubdates", "Agency_ratecode", "audit",
                "book_insert_date", "agencycomm", "rate_audit", "bill_audit",
                "billtype", "Premium_type", "copy_booking",
                "RATE_COMPANY_AGENCY", "ADDITIONAL_AGENCY_COMM",
                "AGENCY_RETAINER_COMM", "SUBEDITIONRATE", cls_billtype,
                dis_billtype, "BILLING_FORMAT", "RATE_CHECK", "ALL_PACKAGE",
                dayrate, scheme_type, disp_clsbill, receipt_format,
                cash_receipt_bill, bill_orderwslast, floor_chk, rokeycheck,
                agencycomm_seq_com, credit_recipt, disp_cashbill,
                cla_cashbill, rate_audit_pref, barcoding_allowed,
                fmg_bill_dis, bill_disp_cashbill, bill_cla_cashbill,
                backdatereceipt, rowise_cashbooking, cutofftime,
                dockit_booking, approval, back_days, cash_discount,
                cash_discounttype, "Allowed_old_date", seprate_cashier,
                cir_many_time_posting, cir_backdays_posting,
                cir_max_return_allow, cir_return_limit_allow,
                cir_no_of_chqbounce, cir_days_chqbounce, cir_return_days,
                cir_sup_order_limit, disp_billing_criteria,
                clsd_billing_criteria, max_publishdays, billno_periodicity,
                specialdisc_trans_edit, sharing_trans,
                multipackage_sel_trans, scheme_minword, trade_splcharge,
                rate_authorization, f2_record, publishad_edit_rateaudit,
                bindrevenue_center, fa_ledger_allow, clearance_type_allow,
                repeat_day_type, premium_edit, bill_generation_prior,
                publication_ho, spldisc_allowprem, bill_scheme,
                allowed_pdc_days_receipt, ad_type_manul_bill,
                outstanding_amt_criteria AS ro_outstand, genrate_cir_agcd,
                disp_auditbkg, cir_dis_auto_posting, relauthreqon,
                cir_auto_approval_unsold, cir_auto_physical_unsold,
                cir_unsold_include_inct, cir_unsold_include_insfee,
                cir_unsold_on_received_dt, agency_unblock_approval,
                unblock_approval_outside_limit, cir_bill_publwise,
                records_on_page, records_on_print, header_on_page,
                agency_required, region_required, allow_follow_dt_boook,
                crm_supply_type_paid, crm_supply_type_free,
                currency_measurement, "Space_area", editable_agency_comm,
                cancellation_charge, taxi_entry_type, approval_with,
                tds_auto_cn, tds_auto_reason, tds_db_cdp, tds_cr_cdp,
                ser_tax_auto_cn, ser_tax_auto_reason, ser_tax_db_cdp,
                ser_tax_cr_cdp, pkk_auto_cn, pkk_auto_reason, pkk_db_cdp,
                pkk_cr_cdp, bank_chg_auto_cn, bank_chg_auto_reason,
                bank_chg_db_cdp, bank_chg_cr_cdp, cir_barcode,
                cir_wieght_calc_req, gen_rct_typ, product_brand_req, ALLOWPREM_CARD_DISC_RATE,FINANCE_CADE,EXECUTIVE_PUBLICATION_VISE,EXECUTIVECREDITLIMIT,MRV_BASED_ON ,
                CIR_POST_DIS,
    CIR_VAT_ALLOW,
    CIR_SUP_ALT_ROUTE,
    SHOW_REC_ALL_AGENCY,
    CIR_SUP_ORDER_DEC_LIMIT,
    CIR_ALLOW_HOLIDAY_SUN,
    CIR_ALLOW_HOLIDAY_MON,
    CIR_ALLOW_HOLIDAY_TUE,
    CIR_ALLOW_HOLIDAY_WED,
    CIR_ALLOW_HOLIDAY_THU,
    CIR_ALLOW_HOLIDAY_FRI,
    CIR_ALLOW_HOLIDAY_SAT,
    CRM_AUTOINFO,
    SAP_ID,
    SCHEDULING_HOURS,
    COMMON_EDITION_FOR_UNIT
           FROM preferrences
          WHERE "comp_code" = compcode;
   END currbindpreferpgld_p;
END currbindpreferpgld;
/


/////////////////////////////////////////////////////////next


CREATE OR REPLACE PACKAGE Wesp_Updatedate
IS
PROCEDURE      Wesp_Updatedate_p(
compcode IN VARCHAR2,
userid IN VARCHAR2,
dateformat IN VARCHAR2,
code IN VARCHAR2,
curr IN VARCHAR2,
RATECODE11 IN VARCHAR2,
solo  IN VARCHAR2,
breakup VARCHAR2,
bwcode IN VARCHAR2,
rostatus IN VARCHAR2,
filename IN VARCHAR2,
tfn IN NUMBER,
insertbreak IN VARCHAR2,
prem IN VARCHAR2,
dealtype IN VARCHAR2,
pre IN VARCHAR2,
suff IN VARCHAR2,
financestatus IN  VARCHAR2,
voucherst IN VARCHAR2,
adcode IN VARCHAR2,
rodatetime IN VARCHAR2,
spacearea IN VARCHAR2,
vat IN VARCHAR2,
bookstat IN VARCHAR2,
cio_id IN VARCHAR2,
receipt_no IN VARCHAR2,
uom IN VARCHAR2,
bgcolor IN VARCHAR2,
validdate IN VARCHAR2,
agencyratecode IN VARCHAR2,
AUDIT1 IN VARCHAR2,
book_insert_date IN VARCHAR2,
agencycomm IN VARCHAR2,
rateaudit IN VARCHAR2,
billaudit IN VARCHAR2,
bill_type IN VARCHAR2,
invoice_no1 IN VARCHAR2,
copybooking IN VARCHAR2,
ratecompany IN VARCHAR2,
addagenycomm IN VARCHAR2,
agencycommlinkretainer IN VARCHAR2,
subeditionr IN VARCHAR2,
displaybilltype IN VARCHAR2,
classifiedbilltype IN VARCHAR2,
billformat IN VARCHAR2,
ratechk IN VARCHAR2,
allpkg IN VARCHAR2,
dayrate1 in varchar2,
schemetype in varchar2,
PIncludeclassi in varchar2,
receiptformat IN VARCHAR2,
v_cash_receipt in varchar2,
v_bill_orderwiselast in varchar2,
v_floor_chk in varchar2,
Unsoldflag in varchar2,
Supplystopper in  number,
drpRokeychk in varchar2,
Agencycomm_seq in varchar2,
creditreciept in varchar,
cashindisplay IN VARCHAR,
cashinclassified IN VARCHAR,
v_rate_audit_pref in varchar,
v_barcoding_allow_pref in varchar2,
v_fmgbills IN VARCHAR2,
v_billed_cashdis in varchar2,
v_billed_cashcls in varchar,
v_drpbackdate in varchar,
dockitbooking in varchar2,
allowprevbooking in varchar2,
ro_wisecashbill in varchar2,
chkval in varchar2,
approval1 in varchar2,
pckstatus in varchar2,
cash_disc in varchar2,
cash_amt in varchar2,
seperate_cashier1 in varchar2,
disp_bill in varchar2,
clas_bill in varchar2,
mantimepost in varchar2,
bkdaypost in number,
maxterutn in number,
cir_return in varchar2,
noofchkbounc in number,
noofdaychkrec in number,
retday in number,
chngsuppord in number,
max_publishday in number,
p_billno_period in varchar,
spl_trans_edit in varchar2,
spl_dis_trans_editable in varchar2,
mul_pac_sel_trans in varchar2,
shmon_minword in varchar2,
tradon_spcrg in varchar2,
rateauth     in varchar2,
f2day in number,
rateauditmodify in varchar,
bindrevenuecenter in varchar,
p_led_allow in varchar,
p_clear_allow in varchar,
repeatday in varchar,
premiumedit in varchar,
P_BILL_GENERATION in varchar,
P_PUBLICATION_CENTER in varchar,
P_allow_discount_prem IN VARCHAR,
P_SCHEME_BILLING in varchar,
P_ALLOW_PDC in varchar,
PAD_TYPE_FOR_MANUL_BILL in varchar,
RO_OUTSTAND_P IN VARCHAR2,
genrate_agency_code IN VARCHAR2,
p_dispauditbk IN VARCHAR2,
p_aotosupply  IN VARCHAR2,
p_Authorization IN VARCHAR2,
p_CIR_AUTO_APPROVAL_UNSOLD IN VARCHAR2,
p_CIR_AUTO_PHYSICAL_UNSOLD IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INCT IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INSFEE IN VARCHAR2,
p_CIR_UNSOLD_ON_RECEIVED_DT IN VARCHAR2,
p_AGENCY_UNBLOCK_APROV IN VARCHAR2,
p_UNBLOCK_APROV_OUT_LMT IN VARCHAR2,
p_CIR_BILL_PUBLWISE IN VARCHAR2,
p_paging         IN VARCHAR2,
p_print          IN VARCHAR2,
p_allowpage      IN VARCHAR2,
p_agency_req     IN VARCHAR2,
p_region_req     IN VARCHAR2,
p_ALLOW_FOLLOW_DT_BOOOK     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_PAID     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_FREE     IN VARCHAR2,
p_CURRENCY_MEASUREMENT     IN VARCHAR2,

p_EDITABLE_AGENCY_COMM      IN VARCHAR2,
p_CANCELLATION_CHARGE      IN VARCHAR2,
P_taxi_entry_type          IN VARCHAR2,
P_ApprovalWith          IN VARCHAR2,
p_Auto_TDS_Credit_Note IN VARCHAR2,
p_TDS_Reason IN VARCHAR2,
p_Debit_Account_Head IN VARCHAR2,
p_credit_Account_Head IN VARCHAR2,
p_service_tax_credit_note IN VARCHAR2,
p_Tax_Reason IN VARCHAR2,
p_Debit_Account_Service_Tax IN VARCHAR2,
p_Credit_Account_Service_Tax IN VARCHAR2,
p_Auto_Patrakar_Credit_Note IN VARCHAR2,
p_Patrakar_Reason IN VARCHAR2,
p_Debit_Account_Patrakar IN VARCHAR2,
p_Credit_Account_Patrakar IN VARCHAR2,
p_Auto_Bank_Credit_Note IN VARCHAR2,
p_Bank_Reason IN VARCHAR2,
p_Debit_Account_Bank IN VARCHAR2,
p_Credit_Account_Bank IN VARCHAR2,
P_BAR_CODE IN VARCHAR2,
P_GEN_RCT_TYP IN VARCHAR2,
P_WEIGHT_CAL IN VARCHAR2:=null,
P_misdata IN VARCHAR2:=null,
P_allowpremium IN VARCHAR2:=null,
p_financecode in varchar2:=null,
p_exepub in varchar2:=null,
p_executivecreditlimit in varchar2:=null,
--new add
P_postdis in  varchar2:=null,
P_suppdecreselimit in  varchar2:=null,
P_allowvat in  varchar2:=null,
P_alterroute in  varchar2:=null,
P_showrecptag in  varchar2:=null,
P_allowhoSUN in  varchar2:=null,
P_allowhoMON in  varchar2:=null,
P_allowhoTUE in  varchar2:=null,
P_allowhoWED in  varchar2:=null,
P_allowhoTHU in  varchar2:=null,
P_allowhoFRI in  varchar2:=null,
P_allowhoSAT in  varchar2:=null,
--new add
p_autoinfo  in  varchar2:=null,
p_sapid     in  varchar2 :=null,
p_mrv in varchar2:=null,
p_schhr in varchar2:=null,
p_ret_after_bank IN varchar2:=null,
P_commedi_forunit  IN varchar2:=null
);
END      Wesp_Updatedate;
/


//////////////////////

CREATE OR REPLACE PACKAGE BODY Wesp_Updatedate IS
PROCEDURE      Wesp_Updatedate_p(
compcode IN VARCHAR2,
userid IN VARCHAR2,
dateformat IN VARCHAR2,
code IN VARCHAR2,
curr IN VARCHAR2,
RATECODE11 IN VARCHAR2,
solo  IN VARCHAR2,
breakup VARCHAR2,
bwcode IN VARCHAR2,
rostatus IN VARCHAR2,
filename IN VARCHAR2,
tfn IN NUMBER,
insertbreak IN VARCHAR2,
prem IN VARCHAR2,
dealtype IN VARCHAR2,
pre IN VARCHAR2,
suff IN VARCHAR2,
financestatus IN  VARCHAR2,
voucherst IN VARCHAR2,
adcode IN VARCHAR2,
rodatetime IN VARCHAR2,
spacearea IN VARCHAR2,
vat IN VARCHAR2,
bookstat IN VARCHAR2,
cio_id IN VARCHAR2,
receipt_no IN VARCHAR2,
uom IN VARCHAR2,
bgcolor IN VARCHAR2,
validdate IN VARCHAR2,
agencyratecode IN VARCHAR2,
AUDIT1 IN VARCHAR2,
book_insert_date IN VARCHAR2,
agencycomm IN VARCHAR2,
rateaudit IN VARCHAR2,
billaudit IN VARCHAR2,
bill_type IN VARCHAR2,
invoice_no1 IN VARCHAR2,
copybooking IN VARCHAR2,
ratecompany IN VARCHAR2,
addagenycomm IN VARCHAR2,
agencycommlinkretainer IN VARCHAR2,
subeditionr IN VARCHAR2,
displaybilltype IN VARCHAR2,
classifiedbilltype IN VARCHAR2,
billformat IN VARCHAR2,
ratechk IN VARCHAR2,
allpkg IN VARCHAR2,
dayrate1 in varchar2,
schemetype in varchar2,
PIncludeclassi in varchar2,
receiptformat IN VARCHAR2,
v_cash_receipt in varchar2,
v_bill_orderwiselast in varchar2,
v_floor_chk in varchar2,
Unsoldflag in varchar2,
Supplystopper in  number,
drpRokeychk in varchar2,
Agencycomm_seq in varchar2,
creditreciept in varchar,
cashindisplay IN VARCHAR,
cashinclassified IN VARCHAR,
v_rate_audit_pref in varchar,
v_barcoding_allow_pref in varchar2,
v_fmgbills IN VARCHAR2,
v_billed_cashdis in varchar2,
v_billed_cashcls in varchar,
v_drpbackdate in varchar,
dockitbooking in varchar2,
allowprevbooking in varchar2,
ro_wisecashbill in varchar2,
chkval in varchar2,
approval1 in varchar2,
pckstatus in varchar2,
cash_disc in varchar2,
cash_amt in varchar2,
seperate_cashier1 in varchar2,
disp_bill in varchar2,
clas_bill in varchar2,
mantimepost in varchar2,
bkdaypost in number,
maxterutn in number,
cir_return in varchar2,
noofchkbounc in number,
noofdaychkrec in number,
retday in number,
chngsuppord in number,
max_publishday in number,
p_billno_period in varchar,
spl_trans_edit in varchar2,
spl_dis_trans_editable in varchar2,
mul_pac_sel_trans in varchar2,
shmon_minword in varchar2,
tradon_spcrg in varchar2,
rateauth     in varchar2,
f2day in number,
rateauditmodify in varchar,
bindrevenuecenter in varchar,
p_led_allow in varchar,
p_clear_allow in varchar,
repeatday in varchar,
premiumedit in varchar,
P_BILL_GENERATION in varchar,
P_PUBLICATION_CENTER in varchar,
P_allow_discount_prem IN VARCHAR,
P_SCHEME_BILLING in varchar,
P_ALLOW_PDC in varchar,
PAD_TYPE_FOR_MANUL_BILL in varchar,
RO_OUTSTAND_P IN VARCHAR2,
genrate_agency_code IN VARCHAR2,
p_dispauditbk IN VARCHAR2,
p_aotosupply  IN VARCHAR2,
p_Authorization IN VARCHAR2,
p_CIR_AUTO_APPROVAL_UNSOLD IN VARCHAR2,
p_CIR_AUTO_PHYSICAL_UNSOLD IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INCT IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INSFEE IN VARCHAR2,
p_CIR_UNSOLD_ON_RECEIVED_DT IN VARCHAR2,
p_AGENCY_UNBLOCK_APROV IN VARCHAR2,
p_UNBLOCK_APROV_OUT_LMT IN VARCHAR2,
p_CIR_BILL_PUBLWISE IN VARCHAR2,
p_paging         IN VARCHAR2,
p_print          IN VARCHAR2,
p_allowpage      IN VARCHAR2,
p_agency_req     IN VARCHAR2,
p_region_req     IN VARCHAR2,
p_ALLOW_FOLLOW_DT_BOOOK     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_PAID     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_FREE     IN VARCHAR2,
p_CURRENCY_MEASUREMENT     IN VARCHAR2,

p_EDITABLE_AGENCY_COMM      IN VARCHAR2,
p_CANCELLATION_CHARGE      IN VARCHAR2,
P_taxi_entry_type          IN VARCHAR2,
P_ApprovalWith          IN VARCHAR2,

p_Auto_TDS_Credit_Note IN VARCHAR2,
p_TDS_Reason IN VARCHAR2,
p_Debit_Account_Head IN VARCHAR2,
p_credit_Account_Head IN VARCHAR2,
p_service_tax_credit_note IN VARCHAR2,
p_Tax_Reason IN VARCHAR2,
p_Debit_Account_Service_Tax IN VARCHAR2,
p_Credit_Account_Service_Tax IN VARCHAR2,
p_Auto_Patrakar_Credit_Note IN VARCHAR2,
p_Patrakar_Reason IN VARCHAR2,
p_Debit_Account_Patrakar IN VARCHAR2,
p_Credit_Account_Patrakar IN VARCHAR2,
p_Auto_Bank_Credit_Note IN VARCHAR2,
p_Bank_Reason IN VARCHAR2,
p_Debit_Account_Bank IN VARCHAR2,
p_Credit_Account_Bank IN VARCHAR2,
P_BAR_CODE IN VARCHAR2,
P_GEN_RCT_TYP IN VARCHAR2,
P_WEIGHT_CAL IN VARCHAR2:=null,
P_misdata IN VARCHAR2:=null,
P_allowpremium IN VARCHAR2:=null,
p_financecode in varchar2:=null,
p_exepub in varchar2:=null,
p_executivecreditlimit in varchar2:=null,
--new add
P_postdis in  varchar2:=null,
P_suppdecreselimit in  varchar2:=null,
P_allowvat in  varchar2:=null,
P_alterroute in  varchar2:=null,
P_showrecptag in  varchar2:=null,
P_allowhoSUN in  varchar2:=null,
P_allowhoMON in  varchar2:=null,
P_allowhoTUE in  varchar2:=null,
P_allowhoWED in  varchar2:=null,
P_allowhoTHU in  varchar2:=null,
P_allowhoFRI in  varchar2:=null,
P_allowhoSAT in  varchar2:=null,
--new add
p_autoinfo  in  varchar2:=null,
p_sapid     in  varchar2 :=null,
p_mrv in varchar2:=null,
p_schhr in varchar2:=null,
p_ret_after_bank IN varchar2:=null,
P_commedi_forunit  IN varchar2:=null

)AS
BEGIN
UPDATE LOGIN SET "date_format"=dateformat,
"Autogenerate"=code,"curr_code"=curr WHERE "COM_CODE"=compcode;
COMMIT;
       UPDATE PREFERRENCES SET  "autogenerated"=code,
"currency_code"=curr ,
"rate_gr_code"=RATECODE11,
"date_format"=dateformat,"solo"=solo,"breakup"=breakup,
"blackwhitecode"=bwcode,"rostatus"=rostatus,"File_name"=filename,"Tfn"=tfn,
"Insert_breakup"=insertbreak,"Premium_type"=prem,"Deal_type"=dealtype  ,
 "prefix"=pre, "suffix"=suff, "financestatus"=financestatus ,
"voucherst"=voucherst,
 "Ad_category"=adcode ,"Ro_datetime"=rodatetime
,"Space_area"=spacearea,"Vat"=vat,
 "Booking_status"=bookstat,"Cio_id"=cio_id,"Receipt_no"=receipt_no,"uom_code"=uom,
 "Bgcolor_publication"=bgcolor ,"chkfor_valid_pubdates"=validdate,
"Agency_ratecode"=agencyratecode,
 "audit"=AUDIT1,"book_insert_date"=book_insert_date,"agencycomm"=agencycomm,
 "rate_audit"=rateaudit,"bill_audit"=billaudit,"billtype"=bill_type,"invoice_no"=invoice_no1,
 "copy_booking"=copybooking,"RATE_COMPANY_AGENCY"=ratecompany,
"ADDITIONAL_AGENCY_COMM"=addagenycomm ,
 "AGENCY_RETAINER_COMM"=agencycommlinkretainer,"SUBEDITIONRATE"=subeditionr,
 "CLS_BILLTYPE"=classifiedbilltype,"DIS_BILLTYPE"=displaybilltype,"BILLING_FORMAT"=billformat,
 "RATE_CHECK"=ratechk,"ALL_PACKAGE"=allpkg,"DAYRATE"=dayrate1,"SCHEME_TYPE"=schemetype,"DISP_CLSBILL"=PIncludeclassi
 ,
 "CASH_RECEIPT_BILL"=v_cash_receipt,
"BILL_ORDERWSLAST"=v_bill_orderwiselast, "FLOOR_CHK"=v_floor_chk ,
 "UNSOLD_ENTRY_FLAG"=Unsoldflag
,"SUPPLY_STOP_PERCENTAGE"=Supplystopper,"ROKEYCHECK"=drpRokeychk ,
 "AGENCYCOMM_SEQ_COM"=Agencycomm_seq
,"CREDIT_RECIPT"=creditreciept,"DISP_CASHBILL"=cashindisplay,
 "CLA_CASHBILL"=cashinclassified,"RATE_AUDIT_PREF"=v_rate_audit_pref,"BARCODING_ALLOWED"=v_barcoding_allow_pref,
 "FMG_BILL_DIS" =v_fmgbills, "BILL_DISP_CASHBILL"=v_billed_cashdis ,
"BILL_CLA_CASHBILL"=v_billed_cashcls,"BACKDATERECEIPT"=v_drpbackdate,"DOCKIT_BOOKING"=dockitbooking,"Allowed_old_date"=allowprevbooking,"ROWISE_CASHBOOKING"=ro_wisecashbill,"CUTOFFTIME"=chkval,"APPROVAL"=approval1,"BACK_DAYS"=pckstatus
,CASH_DISCOUNT=cash_amt,CASH_DISCOUNTTYPE=cash_disc,SEPRATE_CASHIER=seperate_cashier1,
  CIR_MANY_TIME_POSTING=mantimepost, CIR_BACKDAYS_POSTING=bkdaypost,
CIR_MAX_RETURN_ALLOW=maxterutn, CIR_RETURN_LIMIT_ALLOW=cir_return,
CIR_NO_OF_CHQBOUNCE=noofchkbounc, CIR_DAYS_CHQBOUNCE=noofdaychkrec,
CIR_RETURN_DAYS=retday, CIR_SUP_ORDER_LIMIT=chngsuppord,
DISP_BILLING_CRITERIA=disp_bill,
CLSD_BILLING_CRITERIA=clas_bill,MAX_PUBLISHDAYS=max_publishday,BILLNO_PERIODICITY=p_billno_period,
  SPECIALDISC_TRANS_EDIT=spl_trans_edit,
SHARING_TRANS=spl_dis_trans_editable,
MULTIPACKAGE_SEL_TRANS=mul_pac_sel_trans,SCHEME_MINWORD=shmon_minword,
TRADE_SPLCHARGE=tradon_spcrg,RATE_AUTHORIZATION=rateauth
 ,F2_RECORD=f2day,PUBLISHAD_EDIT_RATEAUDIT=rateauditmodify,BINDREVENUE_CENTER=bindrevenuecenter,
 FA_LEDGER_ALLOW=p_led_allow
,CLEARANCE_TYPE_ALLOW=p_clear_allow,REPEAT_DAY_TYPE=repeatday,PREMIUM_EDIT=premiumedit,
BILL_GENERATION_PRIOR=P_BILL_GENERATION,PUBLICATION_HO=P_PUBLICATION_CENTER,SPLDISC_ALLOWPREM=P_allow_discount_prem,

BILL_SCHEME=P_SCHEME_BILLING,ALLOWED_PDC_DAYS_RECEIPT=P_ALLOW_PDC
,AD_TYPE_MANUL_BILL=PAD_TYPE_FOR_MANUL_BILL,OUTSTANDING_AMT_CRITERIA=RO_OUTSTAND_P,GENRATE_CIR_AGCD=genrate_agency_code,DISP_AUDITBKG=p_dispauditbk,CIR_DIS_AUTO_POSTING=p_aotosupply,RELAUTHREQON=p_Authorization,
CIR_AUTO_APPROVAL_UNSOLD=p_CIR_AUTO_APPROVAL_UNSOLD,CIR_AUTO_PHYSICAL_UNSOLD=p_CIR_AUTO_PHYSICAL_UNSOLD,CIR_UNSOLD_INCLUDE_INCT=p_CIR_UNSOLD_INCLUDE_INCT,
CIR_UNSOLD_INCLUDE_INSFEE=p_CIR_UNSOLD_INCLUDE_INSFEE,CIR_UNSOLD_ON_RECEIVED_DT=p_CIR_UNSOLD_ON_RECEIVED_DT,
AGENCY_UNBLOCK_APPROVAL=p_AGENCY_UNBLOCK_APROV,UNBLOCK_APPROVAL_OUTSIDE_LIMIT=p_UNBLOCK_APROV_OUT_LMT,CIR_BILL_PUBLWISE=p_CIR_BILL_PUBLWISE,
RECORDS_ON_PAGE = p_paging,RECORDS_ON_PRINT = p_print,HEADER_ON_PAGE =
p_allowpage,AGENCY_REQUIRED = p_agency_req,REGION_REQUIRED =
p_region_req,
ALLOW_FOLLOW_DT_BOOOK=p_ALLOW_FOLLOW_DT_BOOOK,CRM_SUPPLY_TYPE_PAID=p_CRM_SUPPLY_TYPE_PAID,CRM_SUPPLY_TYPE_FREE=p_CRM_SUPPLY_TYPE_FREE,
CURRENCY_MEASUREMENT=p_CURRENCY_MEASUREMENT,EDITABLE_AGENCY_COMM=p_EDITABLE_AGENCY_COMM,CANCELLATION_CHARGE=p_CANCELLATION_CHARGE,taxi_entry_type=P_taxi_entry_type,APPROVAL_WITH
=P_ApprovalWith , TDS_AUTO_CN=p_Auto_TDS_Credit_Note,
TDS_AUTO_REASON=p_TDS_Reason
,TDS_DB_CDP=p_Debit_Account_Head,TDS_CR_CDP=p_credit_Account_Head,SER_TAX_AUTO_CN=p_service_tax_credit_note,SER_TAX_AUTO_REASON=p_Tax_Reason,SER_TAX_DB_CDP=p_Debit_Account_Service_Tax,SER_TAX_CR_CDP=p_Credit_Account_Service_Tax,PKK_AUTO_CN=p_Auto_Patrakar_Credit_Note,PKK_AUTO_REASON=p_Patrakar_Reason
,PKK_DB_CDP=p_Debit_Account_Patrakar,PKK_CR_CDP=p_Credit_Account_Patrakar
,BANK_CHG_AUTO_CN=p_Auto_Bank_Credit_Note ,
BANK_CHG_AUTO_REASON=p_Bank_Reason
,BANK_CHG_DB_CDP=p_Debit_Account_Bank
,BANK_CHG_CR_CDP=p_Credit_Account_Bank ,


CIR_BARCODE=P_BAR_CODE, CIR_WIEGHT_CALC_REQ =P_WEIGHT_CAL, GEN_RCT_TYP
=P_GEN_RCT_TYP,PRODUCT_BRAND_REQ=P_misdata,ALLOWPREM_CARD_DISC_RATE=P_allowpremium,FINANCE_CADE=p_financecode,EXECUTIVE_PUBLICATION_VISE=p_exepub,
EXECUTIVECREDITLIMIT=p_executivecreditlimit,

--NEW ADD
 CIR_POST_DIS=P_postdis,
 CIR_VAT_ALLOW=P_allowvat,
 CIR_SUP_ALT_ROUTE=P_alterroute,
 SHOW_REC_ALL_AGENCY=P_showrecptag,
 CIR_SUP_ORDER_DEC_LIMIT=P_suppdecreselimit,
 CIR_ALLOW_HOLIDAY_SUN=P_allowhoSUN,
 CIR_ALLOW_HOLIDAY_MON=P_allowhoMON,       
 CIR_ALLOW_HOLIDAY_TUE=P_allowhoTUE,
 CIR_ALLOW_HOLIDAY_WED=P_allowhoWED,
 CIR_ALLOW_HOLIDAY_THU=P_allowhoTHU,
 CIR_ALLOW_HOLIDAY_FRI=P_allowhoFRI,
 CIR_ALLOW_HOLIDAY_SAT=P_allowhoSAT,


CRM_AUTOINFO=p_autoinfo,
SAP_ID=p_sapid,
MRV_BASED_ON=p_mrv,
SCHEDULING_HOURS=p_schhr,ALLOW_RET_AFTER_BANK=p_ret_after_bank,
COMMON_EDITION_FOR_UNIT=P_commedi_forunit

  WHERE "comp_code"=compcode;
COMMIT;
END      Wesp_Updatedate_p;
END      Wesp_Updatedate;
/


///////////////////////////////////////////////////////////////end/////////////////////////////////////////////////




*********************************************************issue no.- 8600*****************************************************



CREATE OR REPLACE PROCEDURE HT18JULY.cir_rep_datewise_rate_supply
   (pcompcode           in varchar2,
    punitcode           in varchar2,
    pdatefrom           in varchar2,
    pdateto             in varchar2,
    ppublcode           in varchar2,
    pmedtncode          in varchar2,
    pedtncode           in varchar2,
    pagtype             in varchar2,
    pagclass            in varchar2,
    pbill_pay           in varchar2,--Y for Paid copy,N for Unpaid Copy,Null for All copy
    puserid             in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    pextra3             in varchar2,
    pextra4             in varchar2,
    pextra5             in varchar2,
    p_accounts          OUT Cur_Type_New1.cursor_type)
IS
    v_frdt  date; 
    v_todt  date;
                
    v_query varchar2(8000);
     cursor cur_edtn is
        select distinct d.sup_rate edtn_rate
        from cir_agmast m,cir_dbksup d ,cir_edtn_mast p,cir_supply_type_mast s
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=s.comp_code and 
                m.unit=d.unit_code and m.unit=p.unit_code and d.unit_code = punitcode and
              d.supdate >= v_frdt and d.supdate <=v_todt and
              m.agcd=d.agcd and m.dpcd=d.dpcd and d.publ=p.publ and d.publ=nvl(ppublcode,d.publ) and d.publ=p.publ and 
              p.main_edtn=nvl(pmedtncode,p.main_edtn) and d.edtn=nvl(pedtncode,d.edtn) and d.edtn=p.edtn and
              (m.ag_type=pagtype or pagtype is null) and (m.ag_class=pagclass or pagclass is null) and
              d.sup_type_code=s.sup_ty_code and (s.bill_pay=pbill_pay or pbill_pay is null)
        order by edtn_rate;

     rec_edtn cur_edtn%rowtype;
     
     

     vvar       varchar2(4000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
     vquery     varchar2(8000);
    
    Begin

        v_frdt  := to_date(pdatefrom,''''||pdateformat||'''');
        v_todt  := to_date(pdateto,''''||pdateformat||'''');

        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            /*if vvar is null then
                vvar        :='sum(decode(d.edtn,'||''''||rec_edtn.edtn||''''||',sup_rate,0))"'||rec_edtn.edtn_name||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'") "'||rec_edtn.edtn_name||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',sup_rate,0))"'||rec_edtn.edtn_name||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'") "'||rec_edtn.edtn_name||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'"';
            end if;*/
            if vvar is null then
                vvar        :='case when d.sup_rate='||''''||rec_edtn.edtn_rate||''''||' then d.sup_copy else 0 end "'||rec_edtn.edtn_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_rate||'") "'||rec_edtn.edtn_rate||'"';
            else
                vvar        :=vvar||','||' case when d.sup_rate='||''''||rec_edtn.edtn_rate||''''||' then d.sup_copy else 0 end "'||rec_edtn.edtn_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_rate||'") "'||rec_edtn.edtn_rate||'"';
            end if;            
        end loop;
        close cur_edtn;

        /*if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;*/
        
          -- delete from searchtbl;
       -- insert into searchtbl(search,search1) values('check dynamic',vvar);
       -- commit;
        
        if vvar is null then
            v_query:='select distinct comp_code,unit_code,supdate, sum(supply_copy) TOTAL
            from(select d.comp_code,d.unit_code,d.agcd agcd,d.dpcd dpcd,d.supdate supdate,
            substr(m.ag_name,1,25) agency_name,d.sup_copy supply_copy from cir_dbksup d,cir_agmast m,cir_edtn_mast p,cir_supply_type_mast s
            where d.comp_code = m.comp_code and d.comp_code=p.comp_code and d.comp_code=s.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            m.unit=p.unit_code and d.unit_code = '||''''||punitcode||''''||' and d.publ=p.publ and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and  
            d.supdate >= '||''''||v_frdt||''''||' and d.supdate <='||''''||v_todt||''''||' and
            p.main_edtn=nvl('||''''||pmedtncode||''''||',p.main_edtn) and d.edtn=nvl('||''''||pedtncode||''''||',d.edtn) and d.edtn=p.edtn and 
            d.sup_type_code=s.sup_ty_code and (s.bill_pay='''||pbill_pay||''' or '''||pbill_pay||''' is null))
            group by comp_code,unit_code,supdate
            order by comp_code,unit_code,supdate';
        else
            v_query:='select distinct comp_code,unit_code,supdate,
            '||vvar_sum||', sum(supply_copy) TOTAL from(select d.comp_code,d.unit_code,d.supdate supdate,d.agcd agcd,d.dpcd dpcd,
            substr(m.ag_name,1,25) agency_name,d.sup_copy supply_copy, '||vvar||' from cir_dbksup d,cir_agmast m,cir_edtn_mast p,cir_supply_type_mast s
            where d.comp_code = m.comp_code and d.comp_code=p.comp_code and d.comp_code=s.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ=p.publ and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            m.unit=p.unit_code and d.agcd = m.agcd and d.dpcd = m.dpcd and  
            d.supdate >= '||''''||v_frdt||''''||' and d.supdate <= '||''''||v_todt||''''||' and 
            p.main_edtn=nvl('||''''||pmedtncode||''''||',p.main_edtn) and d.edtn=nvl('||''''||pedtncode||''''||',d.edtn) and 
            d.edtn=p.edtn and d.sup_type_code=s.sup_ty_code and (s.bill_pay='''||pbill_pay||''' or '''||pbill_pay||''' is null))
            group by comp_code,unit_code,supdate
            order by comp_code,unit_code,supdate';
        end if;

        delete from test1;
        insert into test1(vstring,vstring2) values('cir_rep_datewise_rate_supply v_query',v_query);
        commit;

        open p_accounts for v_query;
                
End cir_rep_datewise_rate_supply;
/









CREATE OR REPLACE PROCEDURE HT18JULY.cir_rep_comm_edtnrate_supply
    (pcompcode          in varchar2,
    punitcode           in varchar2,
    pdatefrom           in varchar2,
    pdateto             in varchar2,
    ppublcode           in varchar2,
    pmedtncode          in varchar2,
    pedtncode           in varchar2,
    pagtype             in varchar2,
    pagclass            in varchar2,
    pbill_pay           in varchar2,--Y for Paid copy,N for Unpaid Copy,Null for All copy
    puserid             in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    pextra3             in varchar2,
    pextra4             in varchar2,
    pextra5             in varchar2,
    p_accounts          OUT Cur_Type_New1.cursor_type,
    p_accounts1         OUT Cur_Type_New1.cursor_type)
  As
       v_frdt    date;
       v_todt    date;
       v_query1     varchar2(32000);
      cursor cur_edtn is
        select distinct x.comm_rate,substr(x.comm_rate,1,1) comm_type,substr(x.comm_rate,2,length(x.comm_rate)) comm_act_rate,x.edtn_rate edtn_rate
        from
        (select distinct d.comp_code,d.unit_code,d.publ,d.edtn,d.sup_rate edtn_rate,d.comm_code, d.comm_fix_auto_spl,
        cir_get_commission(d.comp_code ,d.unit_code ,d.publ,d.edtn,d.comm_fix_auto_spl,d.comm_code,to_char(supdate,''||pdateformat||''),pdateformat,0,null,null) comm_rate
        from cir_agmast m,cir_dbksup d ,cir_edtn_mast p,cir_supply_type_mast s
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=s.comp_code and 
                m.unit=d.unit_code and m.unit=p.unit_code and d.unit_code = punitcode and
              d.supdate >= v_frdt and d.supdate <=v_todt and
              m.agcd=d.agcd and m.dpcd=d.dpcd and d.publ=p.publ and d.publ=nvl(ppublcode,d.publ) and d.publ=p.publ and 
              p.main_edtn=nvl(pmedtncode,p.main_edtn) and d.edtn=nvl(pedtncode,d.edtn) and d.edtn=p.edtn and
              (m.ag_type=pagtype or pagtype is null) and (m.ag_class=pagclass or pagclass is null) and
              d.sup_type_code=s.sup_ty_code and (s.bill_pay=pbill_pay or pbill_pay is null))x
        order by comm_act_rate desc ,edtn_rate asc;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(10000);
     tot_vvar   varchar2(10000);
     vtot_publ  varchar2(8000);
     v_cnt      number:=0;
  Begin
       v_frdt   :=to_date(pdatefrom,''''||pdateformat||'''');
       v_todt   :=to_date(pdateto,''''||pdateformat||'''');
       delete from test1;
       --insert into test1(vstring,vstring2) values('pcomp_code '||pcomp_code||' punit_code '||punit_code||' pdoc_type '||pdoc_type||'  ppubl '||ppubl||'  pmainedtn '||pmainedtn,
     --'pedtn '||pedtn||' pagcode '||pagcode||' pdepocode  '||pdepocode ||' pstatecode '||pstatecode||' pdistcode  '||pdistcode ||'  ptalukacode  '||ptalukacode ||' pfromdate '|| pfromdate||' ptilldate  '||ptilldate||' papproved_flag '||papproved_flag||' preptype '||preptype||' pdateformat '||pdateformat||' pextra1 '||pextra1||' pextra2 '||pextra2);commit;

    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
          v_cnt :=nvl(v_cnt,0)+1;
          if vvar is null then
              vvar      :='case when x.comm_rate||x.edtn_rate='||''''||rec_edtn.comm_rate||rec_edtn.edtn_rate||''''||' then sum(x.sup_copy) else 0 end "'||rec_edtn.comm_rate||'#'||rec_edtn.edtn_rate||'"';
              tot_vvar  :=tot_vvar||',sum("'||rec_edtn.comm_rate||'#'||rec_edtn.edtn_rate||'") "'||rec_edtn.comm_rate||'#'||rec_edtn.edtn_rate||'"';
          else
              vvar      :=vvar||',case when x.comm_rate||x.edtn_rate='||''''||rec_edtn.comm_rate||rec_edtn.edtn_rate||''''||' then sum(x.sup_copy) else 0 end "'||rec_edtn.comm_rate||'#'||rec_edtn.edtn_rate||'"';
              tot_vvar  :=tot_vvar||',sum("'||rec_edtn.comm_rate||'#'||rec_edtn.edtn_rate||'") "'||rec_edtn.comm_rate||'#'||rec_edtn.edtn_rate||'"';
          end if;
    end loop;
    close cur_edtn;

    --insert into test1(vstring,vstring2) values('unsold edtn vvar ',vvar);COMMIT;
    --insert into test1(vstring,vstring2) values('unsold edtn TOT_vvar ',tot_vvar);COMMIT;
    if vvar is not null then
            v_query1:='select distinct u.comp_code,u.unit_code,u.publ,u.main_edtn,cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,
            u.edtn,u.edtn_name '||tot_vvar||',sum(u.sup_copy) tot_copy
                    from(select distinct x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.comm_rate,x.edtn_rate edtn_rate,
            sum(x.sup_copy) sup_copy ,'||vvar||'
                    from(select distinct d.comp_code,d.unit_code,d.publ,p.main_edtn,d.edtn,p.edtn_name,d.sup_rate edtn_rate,d.comm_code, d.comm_fix_auto_spl,
        cir_get_commission(d.comp_code ,d.unit_code ,d.publ,d.edtn,d.comm_fix_auto_spl,d.comm_code,to_char(supdate,'''||pdateformat||'''),'''||pdateformat||''',0,null,null) comm_rate,d.sup_copy
        from cir_agmast m,cir_dbksup d ,cir_edtn_mast p,cir_supply_type_mast s
        where m.comp_code='''||pcompcode||''' and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=s.comp_code and 
                m.unit=d.unit_code and m.unit=p.unit_code and d.unit_code = '''||punitcode||''' and
              d.supdate >='''|| v_frdt||''' and d.supdate <='''||v_todt||''' and
              m.agcd=d.agcd and m.dpcd=d.dpcd and d.publ=p.publ and d.publ=nvl('''||ppublcode||''',d.publ) and d.publ=p.publ and 
              p.main_edtn=nvl('''||pmedtncode||''',p.main_edtn) and d.edtn=nvl('''||pedtncode||''',d.edtn) and d.edtn=p.edtn and
              (m.ag_type='''||pagtype||''' or '''||pagtype||''' is null) and (m.ag_class='''||pagclass||''' or '''||pagclass||''' is null) and
              d.sup_type_code=s.sup_ty_code and (s.bill_pay='''||pbill_pay||''' or '''||pbill_pay||''' is null))x
              group by x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.comm_rate,x.edtn_rate)u
              group by u.comp_code,u.unit_code,u.publ,u.main_edtn,u.edtn,u.edtn_name
        order by publ,main_edtn_name,edtn_name';

               insert into test1(vstring,vstring2) values('cir_rep_comm_edtnrate_supply p_accounts ',v_query1);COMMIT;
               open p_accounts for v_query1;

                   v_query1:='select distinct u.comp_code,u.unit_code,u.publ,u.main_edtn,cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name
                     '||tot_vvar||',sum(u.sup_copy) tot_copy
                    from(select distinct x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.comm_rate,x.edtn_rate edtn_rate,
            sum(x.sup_copy) sup_copy ,'||vvar||'
                    from(select distinct d.comp_code,d.unit_code,d.publ,p.main_edtn,d.edtn,p.edtn_name,d.sup_rate edtn_rate,d.comm_code, d.comm_fix_auto_spl,
        cir_get_commission(d.comp_code ,d.unit_code ,d.publ,d.edtn,d.comm_fix_auto_spl,d.comm_code,to_char(supdate,'''||pdateformat||'''),'''||pdateformat||''',0,null,null) comm_rate,d.sup_copy
        from cir_agmast m,cir_dbksup d ,cir_edtn_mast p,cir_supply_type_mast s
        where m.comp_code='''||pcompcode||''' and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=s.comp_code and 
                m.unit=d.unit_code and m.unit=p.unit_code and d.unit_code = '''||punitcode||''' and
              d.supdate >='''|| v_frdt||''' and d.supdate <='''||v_todt||''' and
              m.agcd=d.agcd and m.dpcd=d.dpcd and d.publ=p.publ and d.publ=nvl('''||ppublcode||''',d.publ) and d.publ=p.publ and 
              p.main_edtn=nvl('''||pmedtncode||''',p.main_edtn) and d.edtn=nvl('''||pedtncode||''',d.edtn) and d.edtn=p.edtn and
              (m.ag_type='''||pagtype||''' or '''||pagtype||''' is null) and (m.ag_class='''||pagclass||''' or '''||pagclass||''' is null) and
              d.sup_type_code=s.sup_ty_code and (s.bill_pay='''||pbill_pay||''' or '''||pbill_pay||''' is null))x
              group by x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.comm_rate,x.edtn_rate)u
              group by u.comp_code,u.unit_code,u.publ,u.main_edtn
                order by publ,main_edtn_name';
               insert into test1(vstring,vstring2) values('cir_rep_comm_edtnrate_supply p_accounts1 ',v_query1);COMMIT;
                open p_accounts1 for v_query1;

        Else
            v_query1:='select distinct u.comp_code,u.unit_code,u.publ,u.main_edtn,cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,
            u.edtn,u.edtn_name ,sum(u.sup_copy) tot_copy
                    from(select distinct x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.comm_rate,x.edtn_rate edtn_rate,
            sum(x.sup_copy) sup_copy 
                    from(select distinct d.comp_code,d.unit_code,d.publ,p.main_edtn,d.edtn,p.edtn_name,d.sup_rate edtn_rate,d.comm_code, d.comm_fix_auto_spl,
        cir_get_commission(d.comp_code ,d.unit_code ,d.publ,d.edtn,d.comm_fix_auto_spl,d.comm_code,to_char(supdate,'''||pdateformat||'''),'''||pdateformat||''',0,null,null) comm_rate,d.sup_copy
        from cir_agmast m,cir_dbksup d ,cir_edtn_mast p,cir_supply_type_mast s
        where m.comp_code='''||pcompcode||''' and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=s.comp_code and 
                m.unit=d.unit_code and m.unit=p.unit_code and d.unit_code = '''||punitcode||''' and
              d.supdate >='''|| v_frdt||''' and d.supdate <='''||v_todt||''' and
              m.agcd=d.agcd and m.dpcd=d.dpcd and d.publ=p.publ and d.publ=nvl('''||ppublcode||''',d.publ) and d.publ=p.publ and 
              p.main_edtn=nvl('''||pmedtncode||''',p.main_edtn) and d.edtn=nvl('''||pedtncode||''',d.edtn) and d.edtn=p.edtn and
              (m.ag_type='''||pagtype||''' or '''||pagtype||''' is null) and (m.ag_class='''||pagclass||''' or '''||pagclass||''' is null) and
              d.sup_type_code=s.sup_ty_code and (s.bill_pay='''||pbill_pay||''' or '''||pbill_pay||''' is null))x
              group by x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.comm_rate,x.edtn_rate)u
              group by u.comp_code,u.unit_code,u.publ,u.main_edtn,u.edtn,u.edtn_name
        order by publ,main_edtn_name,edtn_name';

               insert into test1(vstring,vstring2) values('cir_rep_comm_edtnrate_supply p_accounts ',v_query1);COMMIT;
               open p_accounts for v_query1;

                   v_query1:='select distinct u.comp_code,u.unit_code,u.publ,u.main_edtn,cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,
                     sum(u.sup_copy) tot_copy
                    from(select distinct x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.comm_rate,x.edtn_rate edtn_rate,
            sum(x.sup_copy) sup_copy 
                    from(select distinct d.comp_code,d.unit_code,d.publ,p.main_edtn,d.edtn,p.edtn_name,d.sup_rate edtn_rate,d.comm_code, d.comm_fix_auto_spl,
        cir_get_commission(d.comp_code ,d.unit_code ,d.publ,d.edtn,d.comm_fix_auto_spl,d.comm_code,to_char(supdate,'''||pdateformat||'''),'''||pdateformat||''',0,null,null) comm_rate,d.sup_copy
        from cir_agmast m,cir_dbksup d ,cir_edtn_mast p,cir_supply_type_mast s
        where m.comp_code='''||pcompcode||''' and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=s.comp_code and 
                m.unit=d.unit_code and m.unit=p.unit_code and d.unit_code = '''||punitcode||''' and
              d.supdate >='''|| v_frdt||''' and d.supdate <='''||v_todt||''' and
              m.agcd=d.agcd and m.dpcd=d.dpcd and d.publ=p.publ and d.publ=nvl('''||ppublcode||''',d.publ) and d.publ=p.publ and 
              p.main_edtn=nvl('''||pmedtncode||''',p.main_edtn) and d.edtn=nvl('''||pedtncode||''',d.edtn) and d.edtn=p.edtn and
              (m.ag_type='''||pagtype||''' or '''||pagtype||''' is null) and (m.ag_class='''||pagclass||''' or '''||pagclass||''' is null) and
              d.sup_type_code=s.sup_ty_code and (s.bill_pay='''||pbill_pay||''' or '''||pbill_pay||''' is null))x
              group by x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.comm_rate,x.edtn_rate)u
              group by u.comp_code,u.unit_code,u.publ,u.main_edtn
                order by publ,main_edtn_name';
                insert into test1(vstring,vstring2) values('cir_rep_comm_edtnrate_supply p_accounts1 ',v_query1);COMMIT;
                open p_accounts1 for v_query1;

        End if;
        --delete from test1;commit;
  End cir_rep_comm_edtnrate_supply;
/




*********************************************************issue no.- 8600 end********************************************


****************add by deepika 27-nov-2012*********

alter table preferrences add MIN_MAX_VALIDATE_IN_CORRECTION VARCHAR2(1)
alter table preferrences add CIR_BASE_SUP_ENBL_SUPALTER VARCHAR2(1)
alter table preferrences add CIR_UCN_POCESS_IN_GROUP  VARCHAR2(1)


/////////////////////////////////next

CREATE OR REPLACE PACKAGE Currbindpreferpgld
IS
   TYPE t_account_cursor IS REF CURSOR;

   PROCEDURE currbindpreferpgld_p (
      compcode     IN       VARCHAR2,
      p_accounts   OUT      t_account_cursor
   );
END Currbindpreferpgld;
/

/////////////////


CREATE OR REPLACE PACKAGE BODY currbindpreferpgld
IS
   PROCEDURE currbindpreferpgld_p (
      compcode     IN       VARCHAR2,
      p_accounts   OUT      t_account_cursor
   )
   AS
   BEGIN
      OPEN p_accounts FOR
         SELECT "date_format", "autogenerated", "currency_code",
                "rate_gr_code", "solo", "breakup", "blackwhitecode",
                "rostatus", "File_name", "Tfn", "Insert_breakup", "prefix",
                "suffix", "financestatus", "voucherst", "Ad_category",
                "Ro_datetime", "Vat", "Booking_status", "Cio_id",
                "Receipt_no", "uom_code", "Bgcolor_publication",
                "chkfor_valid_pubdates", "Agency_ratecode", "audit",
                "book_insert_date", "agencycomm", "rate_audit", "bill_audit",
                "billtype", "Premium_type", "copy_booking",
                "RATE_COMPANY_AGENCY", "ADDITIONAL_AGENCY_COMM",
                "AGENCY_RETAINER_COMM", "SUBEDITIONRATE", cls_billtype,
                dis_billtype, "BILLING_FORMAT", "RATE_CHECK", "ALL_PACKAGE",
                dayrate, scheme_type, disp_clsbill, receipt_format,
                cash_receipt_bill, bill_orderwslast, floor_chk, rokeycheck,
                agencycomm_seq_com, credit_recipt, disp_cashbill,
                cla_cashbill, rate_audit_pref, barcoding_allowed,
                fmg_bill_dis, bill_disp_cashbill, bill_cla_cashbill,
                backdatereceipt, rowise_cashbooking, cutofftime,
                dockit_booking, approval, back_days, cash_discount,
                cash_discounttype, "Allowed_old_date", seprate_cashier,
                cir_many_time_posting, cir_backdays_posting,
                cir_max_return_allow, cir_return_limit_allow,
                cir_no_of_chqbounce, cir_days_chqbounce, cir_return_days,
                cir_sup_order_limit, disp_billing_criteria,
                clsd_billing_criteria, max_publishdays, billno_periodicity,
                specialdisc_trans_edit, sharing_trans,
                multipackage_sel_trans, scheme_minword, trade_splcharge,
                rate_authorization, f2_record, publishad_edit_rateaudit,
                bindrevenue_center, fa_ledger_allow, clearance_type_allow,
                repeat_day_type, premium_edit, bill_generation_prior,
                publication_ho, spldisc_allowprem, bill_scheme,
                allowed_pdc_days_receipt, ad_type_manul_bill,
                outstanding_amt_criteria AS ro_outstand, genrate_cir_agcd,
                disp_auditbkg, cir_dis_auto_posting, relauthreqon,
                cir_auto_approval_unsold, cir_auto_physical_unsold,
                cir_unsold_include_inct, cir_unsold_include_insfee,
                cir_unsold_on_received_dt, agency_unblock_approval,
                unblock_approval_outside_limit, cir_bill_publwise,
                records_on_page, records_on_print, header_on_page,
                agency_required, region_required, allow_follow_dt_boook,
                crm_supply_type_paid, crm_supply_type_free,
                currency_measurement, "Space_area", editable_agency_comm,
                cancellation_charge, taxi_entry_type, approval_with,
                tds_auto_cn, tds_auto_reason, tds_db_cdp, tds_cr_cdp,
                ser_tax_auto_cn, ser_tax_auto_reason, ser_tax_db_cdp,
                ser_tax_cr_cdp, pkk_auto_cn, pkk_auto_reason, pkk_db_cdp,
                pkk_cr_cdp, bank_chg_auto_cn, bank_chg_auto_reason,
                bank_chg_db_cdp, bank_chg_cr_cdp, cir_barcode,
                cir_wieght_calc_req, gen_rct_typ, product_brand_req, ALLOWPREM_CARD_DISC_RATE,FINANCE_CADE,EXECUTIVE_PUBLICATION_VISE,EXECUTIVECREDITLIMIT,MRV_BASED_ON ,
                CIR_POST_DIS,
    CIR_VAT_ALLOW,
    CIR_SUP_ALT_ROUTE,
    SHOW_REC_ALL_AGENCY,
    CIR_SUP_ORDER_DEC_LIMIT,
    CIR_ALLOW_HOLIDAY_SUN,
    CIR_ALLOW_HOLIDAY_MON,
    CIR_ALLOW_HOLIDAY_TUE,
    CIR_ALLOW_HOLIDAY_WED,
    CIR_ALLOW_HOLIDAY_THU,
    CIR_ALLOW_HOLIDAY_FRI,
    CIR_ALLOW_HOLIDAY_SAT,
    CRM_AUTOINFO,
    SAP_ID,
    SCHEDULING_HOURS,
    COMMON_EDITION_FOR_UNIT,
    MIN_MAX_VALIDATE_IN_CORRECTION,
	CIR_BASE_SUP_ENBL_SUPALTER,
    CIR_UCN_POCESS_IN_GROUP
    
           FROM preferrences
          WHERE "comp_code" = compcode;
   END currbindpreferpgld_p;
END currbindpreferpgld;
/


/////////////////////////////////////////////next

CREATE OR REPLACE PACKAGE Wesp_Updatedate
IS
PROCEDURE      Wesp_Updatedate_p(
compcode IN VARCHAR2,
userid IN VARCHAR2,
dateformat IN VARCHAR2,
code IN VARCHAR2,
curr IN VARCHAR2,
RATECODE11 IN VARCHAR2,
solo  IN VARCHAR2,
breakup VARCHAR2,
bwcode IN VARCHAR2,
rostatus IN VARCHAR2,
filename IN VARCHAR2,
tfn IN NUMBER,
insertbreak IN VARCHAR2,
prem IN VARCHAR2,
dealtype IN VARCHAR2,
pre IN VARCHAR2,
suff IN VARCHAR2,
financestatus IN  VARCHAR2,
voucherst IN VARCHAR2,
adcode IN VARCHAR2,
rodatetime IN VARCHAR2,
spacearea IN VARCHAR2,
vat IN VARCHAR2,
bookstat IN VARCHAR2,
cio_id IN VARCHAR2,
receipt_no IN VARCHAR2,
uom IN VARCHAR2,
bgcolor IN VARCHAR2,
validdate IN VARCHAR2,
agencyratecode IN VARCHAR2,
AUDIT1 IN VARCHAR2,
book_insert_date IN VARCHAR2,
agencycomm IN VARCHAR2,
rateaudit IN VARCHAR2,
billaudit IN VARCHAR2,
bill_type IN VARCHAR2,
invoice_no1 IN VARCHAR2,
copybooking IN VARCHAR2,
ratecompany IN VARCHAR2,
addagenycomm IN VARCHAR2,
agencycommlinkretainer IN VARCHAR2,
subeditionr IN VARCHAR2,
displaybilltype IN VARCHAR2,
classifiedbilltype IN VARCHAR2,
billformat IN VARCHAR2,
ratechk IN VARCHAR2,
allpkg IN VARCHAR2,
dayrate1 in varchar2,
schemetype in varchar2,
PIncludeclassi in varchar2,
receiptformat IN VARCHAR2,
v_cash_receipt in varchar2,
v_bill_orderwiselast in varchar2,
v_floor_chk in varchar2,
Unsoldflag in varchar2,
Supplystopper in  number,
drpRokeychk in varchar2,
Agencycomm_seq in varchar2,
creditreciept in varchar,
cashindisplay IN VARCHAR,
cashinclassified IN VARCHAR,
v_rate_audit_pref in varchar,
v_barcoding_allow_pref in varchar2,
v_fmgbills IN VARCHAR2,
v_billed_cashdis in varchar2,
v_billed_cashcls in varchar,
v_drpbackdate in varchar,
dockitbooking in varchar2,
allowprevbooking in varchar2,
ro_wisecashbill in varchar2,
chkval in varchar2,
approval1 in varchar2,
pckstatus in varchar2,
cash_disc in varchar2,
cash_amt in varchar2,
seperate_cashier1 in varchar2,
disp_bill in varchar2,
clas_bill in varchar2,
mantimepost in varchar2,
bkdaypost in number,
maxterutn in number,
cir_return in varchar2,
noofchkbounc in number,
noofdaychkrec in number,
retday in number,
chngsuppord in number,
max_publishday in number,
p_billno_period in varchar,
spl_trans_edit in varchar2,
spl_dis_trans_editable in varchar2,
mul_pac_sel_trans in varchar2,
shmon_minword in varchar2,
tradon_spcrg in varchar2,
rateauth     in varchar2,
f2day in number,
rateauditmodify in varchar,
bindrevenuecenter in varchar,
p_led_allow in varchar,
p_clear_allow in varchar,
repeatday in varchar,
premiumedit in varchar,
P_BILL_GENERATION in varchar,
P_PUBLICATION_CENTER in varchar,
P_allow_discount_prem IN VARCHAR,
P_SCHEME_BILLING in varchar,
P_ALLOW_PDC in varchar,
PAD_TYPE_FOR_MANUL_BILL in varchar,
RO_OUTSTAND_P IN VARCHAR2,
genrate_agency_code IN VARCHAR2,
p_dispauditbk IN VARCHAR2,
p_aotosupply  IN VARCHAR2,
p_Authorization IN VARCHAR2,
p_CIR_AUTO_APPROVAL_UNSOLD IN VARCHAR2,
p_CIR_AUTO_PHYSICAL_UNSOLD IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INCT IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INSFEE IN VARCHAR2,
p_CIR_UNSOLD_ON_RECEIVED_DT IN VARCHAR2,
p_AGENCY_UNBLOCK_APROV IN VARCHAR2,
p_UNBLOCK_APROV_OUT_LMT IN VARCHAR2,
p_CIR_BILL_PUBLWISE IN VARCHAR2,
p_paging         IN VARCHAR2,
p_print          IN VARCHAR2,
p_allowpage      IN VARCHAR2,
p_agency_req     IN VARCHAR2,
p_region_req     IN VARCHAR2,
p_ALLOW_FOLLOW_DT_BOOOK     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_PAID     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_FREE     IN VARCHAR2,
p_CURRENCY_MEASUREMENT     IN VARCHAR2,

p_EDITABLE_AGENCY_COMM      IN VARCHAR2,
p_CANCELLATION_CHARGE      IN VARCHAR2,
P_taxi_entry_type          IN VARCHAR2,
P_ApprovalWith          IN VARCHAR2,
p_Auto_TDS_Credit_Note IN VARCHAR2,
p_TDS_Reason IN VARCHAR2,
p_Debit_Account_Head IN VARCHAR2,
p_credit_Account_Head IN VARCHAR2,
p_service_tax_credit_note IN VARCHAR2,
p_Tax_Reason IN VARCHAR2,
p_Debit_Account_Service_Tax IN VARCHAR2,
p_Credit_Account_Service_Tax IN VARCHAR2,
p_Auto_Patrakar_Credit_Note IN VARCHAR2,
p_Patrakar_Reason IN VARCHAR2,
p_Debit_Account_Patrakar IN VARCHAR2,
p_Credit_Account_Patrakar IN VARCHAR2,
p_Auto_Bank_Credit_Note IN VARCHAR2,
p_Bank_Reason IN VARCHAR2,
p_Debit_Account_Bank IN VARCHAR2,
p_Credit_Account_Bank IN VARCHAR2,
P_BAR_CODE IN VARCHAR2,
P_GEN_RCT_TYP IN VARCHAR2,
P_WEIGHT_CAL IN VARCHAR2:=null,
P_misdata IN VARCHAR2:=null,
P_allowpremium IN VARCHAR2:=null,
p_financecode in varchar2:=null,
p_exepub in varchar2:=null,
p_executivecreditlimit in varchar2:=null,
--new add
P_postdis in  varchar2:=null,
P_suppdecreselimit in  varchar2:=null,
P_allowvat in  varchar2:=null,
P_alterroute in  varchar2:=null,
P_showrecptag in  varchar2:=null,
P_allowhoSUN in  varchar2:=null,
P_allowhoMON in  varchar2:=null,
P_allowhoTUE in  varchar2:=null,
P_allowhoWED in  varchar2:=null,
P_allowhoTHU in  varchar2:=null,
P_allowhoFRI in  varchar2:=null,
P_allowhoSAT in  varchar2:=null,
--new add
p_autoinfo  in  varchar2:=null,
p_sapid     in  varchar2 :=null,
p_mrv in varchar2:=null,
p_schhr in varchar2:=null,
p_ret_after_bank IN varchar2:=null,
P_commedi_forunit  IN varchar2:=null,
P_min_max_validate_correction IN varchar2:=null,
P_basesupply_enablealteration  IN varchar2:=null,
P_UCN_PROCESS IN varchar2:=null
);
END      Wesp_Updatedate;
/


///////////



CREATE OR REPLACE PACKAGE BODY HT18JULY.Wesp_Updatedate IS
PROCEDURE      Wesp_Updatedate_p(
compcode IN VARCHAR2,
userid IN VARCHAR2,
dateformat IN VARCHAR2,
code IN VARCHAR2,
curr IN VARCHAR2,
RATECODE11 IN VARCHAR2,
solo  IN VARCHAR2,
breakup VARCHAR2,
bwcode IN VARCHAR2,
rostatus IN VARCHAR2,
filename IN VARCHAR2,
tfn IN NUMBER,
insertbreak IN VARCHAR2,
prem IN VARCHAR2,
dealtype IN VARCHAR2,
pre IN VARCHAR2,
suff IN VARCHAR2,
financestatus IN  VARCHAR2,
voucherst IN VARCHAR2,
adcode IN VARCHAR2,
rodatetime IN VARCHAR2,
spacearea IN VARCHAR2,
vat IN VARCHAR2,
bookstat IN VARCHAR2,
cio_id IN VARCHAR2,
receipt_no IN VARCHAR2,
uom IN VARCHAR2,
bgcolor IN VARCHAR2,
validdate IN VARCHAR2,
agencyratecode IN VARCHAR2,
AUDIT1 IN VARCHAR2,
book_insert_date IN VARCHAR2,
agencycomm IN VARCHAR2,
rateaudit IN VARCHAR2,
billaudit IN VARCHAR2,
bill_type IN VARCHAR2,
invoice_no1 IN VARCHAR2,
copybooking IN VARCHAR2,
ratecompany IN VARCHAR2,
addagenycomm IN VARCHAR2,
agencycommlinkretainer IN VARCHAR2,
subeditionr IN VARCHAR2,
displaybilltype IN VARCHAR2,
classifiedbilltype IN VARCHAR2,
billformat IN VARCHAR2,
ratechk IN VARCHAR2,
allpkg IN VARCHAR2,
dayrate1 in varchar2,
schemetype in varchar2,
PIncludeclassi in varchar2,
receiptformat IN VARCHAR2,
v_cash_receipt in varchar2,
v_bill_orderwiselast in varchar2,
v_floor_chk in varchar2,
Unsoldflag in varchar2,
Supplystopper in  number,
drpRokeychk in varchar2,
Agencycomm_seq in varchar2,
creditreciept in varchar,
cashindisplay IN VARCHAR,
cashinclassified IN VARCHAR,
v_rate_audit_pref in varchar,
v_barcoding_allow_pref in varchar2,
v_fmgbills IN VARCHAR2,
v_billed_cashdis in varchar2,
v_billed_cashcls in varchar,
v_drpbackdate in varchar,
dockitbooking in varchar2,
allowprevbooking in varchar2,
ro_wisecashbill in varchar2,
chkval in varchar2,
approval1 in varchar2,
pckstatus in varchar2,
cash_disc in varchar2,
cash_amt in varchar2,
seperate_cashier1 in varchar2,
disp_bill in varchar2,
clas_bill in varchar2,
mantimepost in varchar2,
bkdaypost in number,
maxterutn in number,
cir_return in varchar2,
noofchkbounc in number,
noofdaychkrec in number,
retday in number,
chngsuppord in number,
max_publishday in number,
p_billno_period in varchar,
spl_trans_edit in varchar2,
spl_dis_trans_editable in varchar2,
mul_pac_sel_trans in varchar2,
shmon_minword in varchar2,
tradon_spcrg in varchar2,
rateauth     in varchar2,
f2day in number,
rateauditmodify in varchar,
bindrevenuecenter in varchar,
p_led_allow in varchar,
p_clear_allow in varchar,
repeatday in varchar,
premiumedit in varchar,
P_BILL_GENERATION in varchar,
P_PUBLICATION_CENTER in varchar,
P_allow_discount_prem IN VARCHAR,
P_SCHEME_BILLING in varchar,
P_ALLOW_PDC in varchar,
PAD_TYPE_FOR_MANUL_BILL in varchar,
RO_OUTSTAND_P IN VARCHAR2,
genrate_agency_code IN VARCHAR2,
p_dispauditbk IN VARCHAR2,
p_aotosupply  IN VARCHAR2,
p_Authorization IN VARCHAR2,
p_CIR_AUTO_APPROVAL_UNSOLD IN VARCHAR2,
p_CIR_AUTO_PHYSICAL_UNSOLD IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INCT IN VARCHAR2,
p_CIR_UNSOLD_INCLUDE_INSFEE IN VARCHAR2,
p_CIR_UNSOLD_ON_RECEIVED_DT IN VARCHAR2,
p_AGENCY_UNBLOCK_APROV IN VARCHAR2,
p_UNBLOCK_APROV_OUT_LMT IN VARCHAR2,
p_CIR_BILL_PUBLWISE IN VARCHAR2,
p_paging         IN VARCHAR2,
p_print          IN VARCHAR2,
p_allowpage      IN VARCHAR2,
p_agency_req     IN VARCHAR2,
p_region_req     IN VARCHAR2,
p_ALLOW_FOLLOW_DT_BOOOK     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_PAID     IN VARCHAR2,
p_CRM_SUPPLY_TYPE_FREE     IN VARCHAR2,
p_CURRENCY_MEASUREMENT     IN VARCHAR2,

p_EDITABLE_AGENCY_COMM      IN VARCHAR2,
p_CANCELLATION_CHARGE      IN VARCHAR2,
P_taxi_entry_type          IN VARCHAR2,
P_ApprovalWith          IN VARCHAR2,

p_Auto_TDS_Credit_Note IN VARCHAR2,
p_TDS_Reason IN VARCHAR2,
p_Debit_Account_Head IN VARCHAR2,
p_credit_Account_Head IN VARCHAR2,
p_service_tax_credit_note IN VARCHAR2,
p_Tax_Reason IN VARCHAR2,
p_Debit_Account_Service_Tax IN VARCHAR2,
p_Credit_Account_Service_Tax IN VARCHAR2,
p_Auto_Patrakar_Credit_Note IN VARCHAR2,
p_Patrakar_Reason IN VARCHAR2,
p_Debit_Account_Patrakar IN VARCHAR2,
p_Credit_Account_Patrakar IN VARCHAR2,
p_Auto_Bank_Credit_Note IN VARCHAR2,
p_Bank_Reason IN VARCHAR2,
p_Debit_Account_Bank IN VARCHAR2,
p_Credit_Account_Bank IN VARCHAR2,
P_BAR_CODE IN VARCHAR2,
P_GEN_RCT_TYP IN VARCHAR2,
P_WEIGHT_CAL IN VARCHAR2:=null,
P_misdata IN VARCHAR2:=null,
P_allowpremium IN VARCHAR2:=null,
p_financecode in varchar2:=null,
p_exepub in varchar2:=null,
p_executivecreditlimit in varchar2:=null,
--new add
P_postdis in  varchar2:=null,
P_suppdecreselimit in  varchar2:=null,
P_allowvat in  varchar2:=null,
P_alterroute in  varchar2:=null,
P_showrecptag in  varchar2:=null,
P_allowhoSUN in  varchar2:=null,
P_allowhoMON in  varchar2:=null,
P_allowhoTUE in  varchar2:=null,
P_allowhoWED in  varchar2:=null,
P_allowhoTHU in  varchar2:=null,
P_allowhoFRI in  varchar2:=null,
P_allowhoSAT in  varchar2:=null,
--new add
p_autoinfo  in  varchar2:=null,
p_sapid     in  varchar2 :=null,
p_mrv in varchar2:=null,
p_schhr in varchar2:=null,
p_ret_after_bank IN varchar2:=null,
P_commedi_forunit  IN varchar2:=null,
P_min_max_validate_correction IN varchar2:=null,
P_basesupply_enablealteration  IN varchar2:=null,
P_UCN_PROCESS IN varchar2:=null

)AS
BEGIN
UPDATE LOGIN SET "date_format"=dateformat,
"Autogenerate"=code,"curr_code"=curr WHERE "COM_CODE"=compcode;
COMMIT;
       UPDATE PREFERRENCES SET  "autogenerated"=code,
"currency_code"=curr ,
"rate_gr_code"=RATECODE11,
"date_format"=dateformat,"solo"=solo,"breakup"=breakup,
"blackwhitecode"=bwcode,"rostatus"=rostatus,"File_name"=filename,"Tfn"=tfn,
"Insert_breakup"=insertbreak,"Premium_type"=prem,"Deal_type"=dealtype  ,
 "prefix"=pre, "suffix"=suff, "financestatus"=financestatus ,
"voucherst"=voucherst,
 "Ad_category"=adcode ,"Ro_datetime"=rodatetime
,"Space_area"=spacearea,"Vat"=vat,
 "Booking_status"=bookstat,"Cio_id"=cio_id,"Receipt_no"=receipt_no,"uom_code"=uom,
 "Bgcolor_publication"=bgcolor ,"chkfor_valid_pubdates"=validdate,
"Agency_ratecode"=agencyratecode,
 "audit"=AUDIT1,"book_insert_date"=book_insert_date,"agencycomm"=agencycomm,
 "rate_audit"=rateaudit,"bill_audit"=billaudit,"billtype"=bill_type,"invoice_no"=invoice_no1,
 "copy_booking"=copybooking,"RATE_COMPANY_AGENCY"=ratecompany,
"ADDITIONAL_AGENCY_COMM"=addagenycomm ,
 "AGENCY_RETAINER_COMM"=agencycommlinkretainer,"SUBEDITIONRATE"=subeditionr,
 "CLS_BILLTYPE"=classifiedbilltype,"DIS_BILLTYPE"=displaybilltype,"BILLING_FORMAT"=billformat,
 "RATE_CHECK"=ratechk,"ALL_PACKAGE"=allpkg,"DAYRATE"=dayrate1,"SCHEME_TYPE"=schemetype,"DISP_CLSBILL"=PIncludeclassi
 ,
 "CASH_RECEIPT_BILL"=v_cash_receipt,
"BILL_ORDERWSLAST"=v_bill_orderwiselast, "FLOOR_CHK"=v_floor_chk ,
 "UNSOLD_ENTRY_FLAG"=Unsoldflag
,"SUPPLY_STOP_PERCENTAGE"=Supplystopper,"ROKEYCHECK"=drpRokeychk ,
 "AGENCYCOMM_SEQ_COM"=Agencycomm_seq
,"CREDIT_RECIPT"=creditreciept,"DISP_CASHBILL"=cashindisplay,
 "CLA_CASHBILL"=cashinclassified,"RATE_AUDIT_PREF"=v_rate_audit_pref,"BARCODING_ALLOWED"=v_barcoding_allow_pref,
 "FMG_BILL_DIS" =v_fmgbills, "BILL_DISP_CASHBILL"=v_billed_cashdis ,
"BILL_CLA_CASHBILL"=v_billed_cashcls,"BACKDATERECEIPT"=v_drpbackdate,"DOCKIT_BOOKING"=dockitbooking,"Allowed_old_date"=allowprevbooking,"ROWISE_CASHBOOKING"=ro_wisecashbill,"CUTOFFTIME"=chkval,"APPROVAL"=approval1,"BACK_DAYS"=pckstatus
,CASH_DISCOUNT=cash_amt,CASH_DISCOUNTTYPE=cash_disc,SEPRATE_CASHIER=seperate_cashier1,
  CIR_MANY_TIME_POSTING=mantimepost, CIR_BACKDAYS_POSTING=bkdaypost,
CIR_MAX_RETURN_ALLOW=maxterutn, CIR_RETURN_LIMIT_ALLOW=cir_return,
CIR_NO_OF_CHQBOUNCE=noofchkbounc, CIR_DAYS_CHQBOUNCE=noofdaychkrec,
CIR_RETURN_DAYS=retday, CIR_SUP_ORDER_LIMIT=chngsuppord,
DISP_BILLING_CRITERIA=disp_bill,
CLSD_BILLING_CRITERIA=clas_bill,MAX_PUBLISHDAYS=max_publishday,BILLNO_PERIODICITY=p_billno_period,
  SPECIALDISC_TRANS_EDIT=spl_trans_edit,
SHARING_TRANS=spl_dis_trans_editable,
MULTIPACKAGE_SEL_TRANS=mul_pac_sel_trans,SCHEME_MINWORD=shmon_minword,
TRADE_SPLCHARGE=tradon_spcrg,RATE_AUTHORIZATION=rateauth
 ,F2_RECORD=f2day,PUBLISHAD_EDIT_RATEAUDIT=rateauditmodify,BINDREVENUE_CENTER=bindrevenuecenter,
 FA_LEDGER_ALLOW=p_led_allow
,CLEARANCE_TYPE_ALLOW=p_clear_allow,REPEAT_DAY_TYPE=repeatday,PREMIUM_EDIT=premiumedit,
BILL_GENERATION_PRIOR=P_BILL_GENERATION,PUBLICATION_HO=P_PUBLICATION_CENTER,SPLDISC_ALLOWPREM=P_allow_discount_prem,

BILL_SCHEME=P_SCHEME_BILLING,ALLOWED_PDC_DAYS_RECEIPT=P_ALLOW_PDC
,AD_TYPE_MANUL_BILL=PAD_TYPE_FOR_MANUL_BILL,OUTSTANDING_AMT_CRITERIA=RO_OUTSTAND_P,GENRATE_CIR_AGCD=genrate_agency_code,DISP_AUDITBKG=p_dispauditbk,CIR_DIS_AUTO_POSTING=p_aotosupply,RELAUTHREQON=p_Authorization,
CIR_AUTO_APPROVAL_UNSOLD=p_CIR_AUTO_APPROVAL_UNSOLD,CIR_AUTO_PHYSICAL_UNSOLD=p_CIR_AUTO_PHYSICAL_UNSOLD,CIR_UNSOLD_INCLUDE_INCT=p_CIR_UNSOLD_INCLUDE_INCT,
CIR_UNSOLD_INCLUDE_INSFEE=p_CIR_UNSOLD_INCLUDE_INSFEE,CIR_UNSOLD_ON_RECEIVED_DT=p_CIR_UNSOLD_ON_RECEIVED_DT,
AGENCY_UNBLOCK_APPROVAL=p_AGENCY_UNBLOCK_APROV,UNBLOCK_APPROVAL_OUTSIDE_LIMIT=p_UNBLOCK_APROV_OUT_LMT,CIR_BILL_PUBLWISE=p_CIR_BILL_PUBLWISE,
RECORDS_ON_PAGE = p_paging,RECORDS_ON_PRINT = p_print,HEADER_ON_PAGE =
p_allowpage,AGENCY_REQUIRED = p_agency_req,REGION_REQUIRED =
p_region_req,
ALLOW_FOLLOW_DT_BOOOK=p_ALLOW_FOLLOW_DT_BOOOK,CRM_SUPPLY_TYPE_PAID=p_CRM_SUPPLY_TYPE_PAID,CRM_SUPPLY_TYPE_FREE=p_CRM_SUPPLY_TYPE_FREE,
CURRENCY_MEASUREMENT=p_CURRENCY_MEASUREMENT,EDITABLE_AGENCY_COMM=p_EDITABLE_AGENCY_COMM,CANCELLATION_CHARGE=p_CANCELLATION_CHARGE,taxi_entry_type=P_taxi_entry_type,APPROVAL_WITH
=P_ApprovalWith , TDS_AUTO_CN=p_Auto_TDS_Credit_Note,
TDS_AUTO_REASON=p_TDS_Reason
,TDS_DB_CDP=p_Debit_Account_Head,TDS_CR_CDP=p_credit_Account_Head,SER_TAX_AUTO_CN=p_service_tax_credit_note,SER_TAX_AUTO_REASON=p_Tax_Reason,SER_TAX_DB_CDP=p_Debit_Account_Service_Tax,SER_TAX_CR_CDP=p_Credit_Account_Service_Tax,PKK_AUTO_CN=p_Auto_Patrakar_Credit_Note,PKK_AUTO_REASON=p_Patrakar_Reason
,PKK_DB_CDP=p_Debit_Account_Patrakar,PKK_CR_CDP=p_Credit_Account_Patrakar
,BANK_CHG_AUTO_CN=p_Auto_Bank_Credit_Note ,
BANK_CHG_AUTO_REASON=p_Bank_Reason
,BANK_CHG_DB_CDP=p_Debit_Account_Bank
,BANK_CHG_CR_CDP=p_Credit_Account_Bank ,


CIR_BARCODE=P_BAR_CODE, CIR_WIEGHT_CALC_REQ =P_WEIGHT_CAL, GEN_RCT_TYP
=P_GEN_RCT_TYP,PRODUCT_BRAND_REQ=P_misdata,ALLOWPREM_CARD_DISC_RATE=P_allowpremium,FINANCE_CADE=p_financecode,EXECUTIVE_PUBLICATION_VISE=p_exepub,
EXECUTIVECREDITLIMIT=p_executivecreditlimit,

--NEW ADD
 CIR_POST_DIS=P_postdis,
 CIR_VAT_ALLOW=P_allowvat,
 CIR_SUP_ALT_ROUTE=P_alterroute,
 SHOW_REC_ALL_AGENCY=P_showrecptag,
 CIR_SUP_ORDER_DEC_LIMIT=P_suppdecreselimit,
 CIR_ALLOW_HOLIDAY_SUN=P_allowhoSUN,
 CIR_ALLOW_HOLIDAY_MON=P_allowhoMON,       
 CIR_ALLOW_HOLIDAY_TUE=P_allowhoTUE,
 CIR_ALLOW_HOLIDAY_WED=P_allowhoWED,
 CIR_ALLOW_HOLIDAY_THU=P_allowhoTHU,
 CIR_ALLOW_HOLIDAY_FRI=P_allowhoFRI,
 CIR_ALLOW_HOLIDAY_SAT=P_allowhoSAT,


CRM_AUTOINFO=p_autoinfo,
SAP_ID=p_sapid,
MRV_BASED_ON=p_mrv,
SCHEDULING_HOURS=p_schhr,ALLOW_RET_AFTER_BANK=p_ret_after_bank,
COMMON_EDITION_FOR_UNIT=P_commedi_forunit,
MIN_MAX_VALIDATE_IN_CORRECTION=P_min_max_validate_correction,
CIR_BASE_SUP_ENBL_SUPALTER=P_basesupply_enablealteration,
CIR_UCN_POCESS_IN_GROUP=P_UCN_PROCESS 
  WHERE "comp_code"=compcode;
COMMIT;
END      Wesp_Updatedate_p;
END      Wesp_Updatedate;
/



////////////////////////////////////////////////end///////////////////////////////



********************************************************Daily Supply Day Book ***********************************************



CREATE OR REPLACE procedure cir_rep_daybook_supply(
    pcompcode       in varchar2,
    punitcode       in varchar2,
    ppublcode       in varchar2,
    pmedtncode      in varchar2,
    pedtncode       in varchar2,
    pagtype         in varchar2,
    pagclass        in varchar2,
    pfromdate       in varchar2,
    ptilldate       in varchar2,
    pdateformat     in varchar2,
    puserid         in varchar2,
    preptype        in varchar2,--D for detail S for Summary
    preg_extra      in varchar2,--R for Regular,E for Extra
    pextra1         in varchar2,--for E for Edition wise R for Route Wise
    pextra2         in varchar2,
    pextra3         in varchar2,
    pextra4         in varchar2,
    pextra5         in varchar2,
    pextra6         in varchar2,
    pextra7         in varchar2,
    pextra8         in varchar2,
    pextra9         in varchar2,
    pextra10        in varchar2,            
    p_accounts      OUT Cur_Type_New1.cursor_type,
    p_accounts1     OUT Cur_Type_New1.cursor_type,
    p_accounts2     OUT Cur_Type_New1.cursor_type)
As
    v_frdt  date;
    v_todt  date;
Begin

    v_frdt := to_date(pfromdate,''''||pdateformat||'''');
    v_todt := to_date(ptilldate,''''||pdateformat||'''');
    
    if pextra1='E' then--for edition wise
        if preptype='D' then --for detail
            if preg_extra='E' then
                open p_accounts for
                select x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.main_edtn,x.edtn,x.edtn_name,x.edition_nick,x.edtn_seq_no,
                x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,cir_get_city(x.comp_code,x.city_code) city_name,
                x.station_code,cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) drop_point_name,
                x.lbl_printno,sum(x.paid_copy) paid_copy,sum(x.unpaid_copy) unpaid_copy,
                sum(x.pday_copy) pday_copy,sum(x.uday_copy) uday_copy,
                x.route_code,cir_get_name.cir_route(x.comp_code,x.unit_code,x.route_code,'1',null,null,null) route_name, 
                x.subroute_code,cir_get_name.cir_subroute(x.comp_code,x.unit_code,x.route_code,x.subroute_code,'1',null,null,null) subrt_name,
                x.subsubroute_code,cir_get_name.cir_subsubroute(x.comp_code,x.unit_code,x.route_code,x.subroute_code,x.subsubroute_code,'1',null,null,null) subsubrt_name,
                cir_get_route_seqno(x.comp_code,x.unit_code,x.route_code) route_seqno
                from
                (select d.comp_code,d.unit_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=d.unit_code) unit_name, 
                d.publ,p.publ_name,e.main_edtn,d.edtn,e.edtn_name,e.edition_nick,e.edtn_seq_no,
                d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,s.lbl_printno,
                case when nvl(t.bill_pay,'N')='Y' then d.sup_copy else 0 end paid_copy,
                case when nvl(t.bill_pay,'N')='N' then d.sup_copy else 0 end unpaid_copy,
                case when nvl(t.bill_pay,'N')='Y' then d.day_copy else 0 end pday_copy,
                case when nvl(t.bill_pay,'N')='N' then d.day_copy else 0 end uday_copy,
                d.route_code, d.subroute_code, d.subsubroute_code
                from cir_agmast m,cir_supply s ,cir_dbksup d,cir_publ_mast p,cir_edtn_mast e,cir_supply_type_mast t
                where m.comp_code=d.comp_code and m.comp_code=p.comp_code and m.comp_code=s.comp_code and m.comp_code=e.comp_code and 
                m.comp_code=t.comp_code and m.comp_code=pcompcode and m.unit=d.unit_code and m.unit=s.unit and d.unit_code=punitcode and 
                d.publ = p.publ and p.publ = e.publ and d.publ = ppublcode and d.edtn=e.edtn and d.edtn=s.edtn and d.edtn=nvl(pedtncode,d.edtn) and e.main_edtn=nvl(pmedtncode,e.main_edtn) and 
                d.sup_type_code=t.sup_ty_code and d.sup_type_code=s.supply_type_code and m.agcd=d.agcd and m.agcd=s.agcd and m.dpcd=d.dpcd and m.dpcd=s.dpcd and
                d.supdate between v_frdt and v_todt and (m.ag_type=pagtype or pagtype is null)
                and (m.ag_class=pagclass or pagclass is null) and nvl(d.day_copy,0)>0) x
                group by x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.main_edtn,x.edtn,x.edtn_name,x.edition_nick,x.edtn_seq_no,
                x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.station_code,x.lbl_printno,x.route_code,x.subroute_code,x.subsubroute_code
                having sum(x.pday_copy)>0
                order by x.comp_code,x.unit_code,x.unit_name,x.publ_name,x.publ,x.edtn_seq_no,x.edtn_name,x.lbl_printno,x.ag_name,x.agcd,x.dpcd; 
            else
                open p_accounts for
                select x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.main_edtn,x.edtn,x.edtn_name,x.edition_nick,x.edtn_seq_no,
                x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,cir_get_city(x.comp_code,x.city_code) city_name,
                x.station_code,cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) drop_point_name,
                x.lbl_printno,sum(x.paid_copy) paid_copy,sum(x.unpaid_copy) unpaid_copy,
                sum(x.pday_copy) pday_copy,sum(x.uday_copy) uday_copy,
                x.route_code,cir_get_name.cir_route(x.comp_code,x.unit_code,x.route_code,'1',null,null,null) route_name, 
                x.subroute_code,cir_get_name.cir_subroute(x.comp_code,x.unit_code,x.route_code,x.subroute_code,'1',null,null,null) subrt_name,
                x.subsubroute_code,cir_get_name.cir_subsubroute(x.comp_code,x.unit_code,x.route_code,x.subroute_code,x.subsubroute_code,'1',null,null,null) subsubrt_name,
                cir_get_route_seqno(x.comp_code,x.unit_code,x.route_code) route_seqno
                from
                (select d.comp_code,d.unit_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=d.unit_code) unit_name, 
                d.publ,p.publ_name,e.main_edtn,d.edtn,e.edtn_name,e.edition_nick,e.edtn_seq_no,
                d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,s.lbl_printno,
                case when nvl(t.bill_pay,'N')='Y' then d.sup_copy else 0 end paid_copy,
                case when nvl(t.bill_pay,'N')='N' then d.sup_copy else 0 end unpaid_copy,
                case when nvl(t.bill_pay,'N')='Y' then d.day_copy else 0 end pday_copy,
                case when nvl(t.bill_pay,'N')='N' then d.day_copy else 0 end uday_copy,
                d.route_code, d.subroute_code, d.subsubroute_code
                from cir_agmast m,cir_supply s ,cir_dbksup d,cir_publ_mast p,cir_edtn_mast e,cir_supply_type_mast t
                where m.comp_code=d.comp_code and m.comp_code=p.comp_code and m.comp_code=s.comp_code and m.comp_code=e.comp_code and 
                m.comp_code=t.comp_code and m.comp_code=pcompcode and m.unit=d.unit_code and m.unit=s.unit and d.unit_code=punitcode and 
                d.publ = p.publ and p.publ = e.publ and d.publ = ppublcode and d.edtn=e.edtn and d.edtn=s.edtn and d.edtn=nvl(pedtncode,d.edtn) and e.main_edtn=nvl(pmedtncode,e.main_edtn) and 
                d.sup_type_code=t.sup_ty_code and d.sup_type_code=s.supply_type_code and m.agcd=d.agcd and m.agcd=s.agcd and m.dpcd=d.dpcd and m.dpcd=s.dpcd and
                d.supdate between v_frdt and v_todt and (m.ag_type=pagtype or pagtype is null)
                and (m.ag_class=pagclass or pagclass is null) ) x
                group by x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.main_edtn,x.edtn,x.edtn_name,x.edition_nick,x.edtn_seq_no,
                x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.station_code,x.lbl_printno,x.route_code,x.subroute_code,x.subsubroute_code
                order by x.comp_code,x.unit_code,x.unit_name,x.publ_name,x.publ,x.edtn_seq_no,x.edtn_name,x.lbl_printno,x.ag_name,x.agcd,x.dpcd;
            end if;        
        else--for summary
            if preg_extra='E' then
                open p_accounts for
                select x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.main_edtn,x.edtn,x.edtn_name,x.edition_nick,x.edtn_seq_no,
                sum(x.paid_copy) paid_copy,sum(x.unpaid_copy) unpaid_copy,
                sum(x.pday_copy) pday_copy,sum(x.uday_copy) uday_copy
                from
                (select d.comp_code,d.unit_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=d.unit_code) unit_name, 
                d.publ,p.publ_name,e.main_edtn,d.edtn,e.edtn_name,e.edition_nick,e.edtn_seq_no,
                d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,s.lbl_printno,
                case when nvl(t.bill_pay,'N')='Y' then d.sup_copy else 0 end paid_copy,
                case when nvl(t.bill_pay,'N')='N' then d.sup_copy else 0 end unpaid_copy,
                case when nvl(t.bill_pay,'N')='Y' then d.day_copy else 0 end pday_copy,
                case when nvl(t.bill_pay,'N')='N' then d.day_copy else 0 end uday_copy,        
                d.route_code,  d.subroute_code,d.subsubroute_code
                from cir_agmast m,cir_supply s ,cir_dbksup d,cir_publ_mast p,cir_edtn_mast e,cir_supply_type_mast t
                where m.comp_code=d.comp_code and m.comp_code=p.comp_code and m.comp_code=s.comp_code and m.comp_code=e.comp_code and 
                m.comp_code=t.comp_code and m.comp_code=pcompcode and m.unit=d.unit_code and m.unit=s.unit and d.unit_code=punitcode and 
                d.publ = p.publ and p.publ = e.publ and d.publ = ppublcode and d.edtn=e.edtn and d.edtn=s.edtn and d.edtn=nvl(pedtncode,d.edtn) and e.main_edtn=nvl(pmedtncode,e.main_edtn) and 
                d.sup_type_code=t.sup_ty_code and d.sup_type_code=s.supply_type_code and m.agcd=d.agcd and m.agcd=s.agcd and m.dpcd=d.dpcd and m.dpcd=s.dpcd and
                d.supdate between v_frdt and v_todt and (m.ag_type=pagtype or pagtype is null)
                and (m.ag_class=pagclass or pagclass is null) and nvl(d.day_copy,0)>0) x
                group by x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.main_edtn,x.edtn,x.edtn_name,x.edition_nick,x.edtn_seq_no
                having sum(x.pday_copy)>0
                order by x.comp_code,x.unit_code,x.unit_name,x.publ_name,x.publ,x.edtn_seq_no,x.edtn_name; 
            else
                open p_accounts for
                select x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.main_edtn,x.edtn,x.edtn_name,x.edition_nick,x.edtn_seq_no,
                sum(x.paid_copy) paid_copy,sum(x.unpaid_copy) unpaid_copy,
                sum(x.pday_copy) pday_copy,sum(x.uday_copy) uday_copy
                from
                (select d.comp_code,d.unit_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=d.unit_code) unit_name, 
                d.publ,p.publ_name,e.main_edtn,d.edtn,e.edtn_name,e.edition_nick,e.edtn_seq_no,
                d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,s.lbl_printno,
                case when nvl(t.bill_pay,'N')='Y' then d.sup_copy else 0 end paid_copy,
                case when nvl(t.bill_pay,'N')='N' then d.sup_copy else 0 end unpaid_copy,
                case when nvl(t.bill_pay,'N')='Y' then d.day_copy else 0 end pday_copy,
                case when nvl(t.bill_pay,'N')='N' then d.day_copy else 0 end uday_copy,        
                d.route_code, d.subroute_code,d.subsubroute_code
                from cir_agmast m,cir_supply s ,cir_dbksup d,cir_publ_mast p,cir_edtn_mast e,cir_supply_type_mast t
                where m.comp_code=d.comp_code and m.comp_code=p.comp_code and m.comp_code=s.comp_code and m.comp_code=e.comp_code and 
                m.comp_code=t.comp_code and m.comp_code=pcompcode and m.unit=d.unit_code and m.unit=s.unit and d.unit_code=punitcode and 
                d.publ = p.publ and p.publ = e.publ and d.publ = ppublcode and d.edtn=e.edtn and d.edtn=s.edtn and d.edtn=nvl(pedtncode,d.edtn) and e.main_edtn=nvl(pmedtncode,e.main_edtn) and 
                d.sup_type_code=t.sup_ty_code and d.sup_type_code=s.supply_type_code and m.agcd=d.agcd and m.agcd=s.agcd and m.dpcd=d.dpcd and m.dpcd=s.dpcd and
                d.supdate between v_frdt and v_todt and (m.ag_type=pagtype or pagtype is null)
                and (m.ag_class=pagclass or pagclass is null)) x
                group by x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.main_edtn,x.edtn,x.edtn_name,x.edition_nick,x.edtn_seq_no
                order by x.comp_code,x.unit_code,x.unit_name,x.publ_name,x.publ,x.edtn_seq_no,x.edtn_name;        
            end if;
        end if;
    else--for route wise
        if preptype='D' then --for detail
            if preg_extra='E' then
                open p_accounts for
                select x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,
                x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,cir_get_city(x.comp_code,x.city_code) city_name,
                x.station_code,cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) drop_point_name,
                x.lbl_printno,sum(x.paid_copy) paid_copy,sum(x.unpaid_copy) unpaid_copy,
                sum(x.pday_copy) pday_copy,sum(x.uday_copy) uday_copy,
                x.route_code,cir_get_name.cir_route(x.comp_code,x.unit_code,x.route_code,'1',null,null,null) route_name,
                cir_get_route_seqno(x.comp_code,x.unit_code,x.route_code) route_seqno
                from
                (select d.comp_code,d.unit_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=d.unit_code) unit_name, 
                d.publ,p.publ_name,
                d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,s.lbl_printno,
                case when nvl(t.bill_pay,'N')='Y' then d.sup_copy else 0 end paid_copy,
                case when nvl(t.bill_pay,'N')='N' then d.sup_copy else 0 end unpaid_copy,
                case when nvl(t.bill_pay,'N')='Y' then d.day_copy else 0 end pday_copy,
                case when nvl(t.bill_pay,'N')='N' then d.day_copy else 0 end uday_copy,
                d.route_code, d.subroute_code, d.subsubroute_code
                from cir_agmast m,cir_supply s ,cir_dbksup d,cir_publ_mast p,cir_edtn_mast e,cir_supply_type_mast t
                where m.comp_code=d.comp_code and m.comp_code=p.comp_code and m.comp_code=s.comp_code and m.comp_code=e.comp_code and 
                m.comp_code=t.comp_code and m.comp_code=pcompcode and m.unit=d.unit_code and m.unit=s.unit and d.unit_code=punitcode and 
                d.publ = p.publ and p.publ = e.publ and d.publ = ppublcode and d.edtn=e.edtn and d.edtn=s.edtn and d.edtn=nvl(pedtncode,d.edtn) and e.main_edtn=nvl(pmedtncode,e.main_edtn) and 
                d.sup_type_code=t.sup_ty_code and d.sup_type_code=s.supply_type_code and m.agcd=d.agcd and m.agcd=s.agcd and m.dpcd=d.dpcd and m.dpcd=s.dpcd and
                d.supdate between v_frdt and v_todt and (m.ag_type=pagtype or pagtype is null)
                and (m.ag_class=pagclass or pagclass is null) and nvl(d.day_copy,0)>0) x
                group by x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,
                x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.station_code,x.lbl_printno,x.route_code
                having sum(x.pday_copy)>0
                order by x.comp_code,x.unit_code,x.unit_name,route_seqno,route_name,x.publ_name,x.publ,x.lbl_printno,x.ag_name,x.agcd,x.dpcd; 
            else
                open p_accounts for
                select x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,
                x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,cir_get_city(x.comp_code,x.city_code) city_name,
                x.station_code,cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) drop_point_name,
                x.lbl_printno,sum(x.paid_copy) paid_copy,sum(x.unpaid_copy) unpaid_copy,
                sum(x.pday_copy) pday_copy,sum(x.uday_copy) uday_copy,
                x.route_code,cir_get_name.cir_route(x.comp_code,x.unit_code,x.route_code,'1',null,null,null) route_name,
                cir_get_route_seqno(x.comp_code,x.unit_code,x.route_code) route_seqno
                from
                (select d.comp_code,d.unit_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=d.unit_code) unit_name, 
                d.publ,p.publ_name,e.main_edtn,d.edtn,e.edtn_name,e.edition_nick,e.edtn_seq_no,
                d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,s.lbl_printno,
                case when nvl(t.bill_pay,'N')='Y' then d.sup_copy else 0 end paid_copy,
                case when nvl(t.bill_pay,'N')='N' then d.sup_copy else 0 end unpaid_copy,
                case when nvl(t.bill_pay,'N')='Y' then d.day_copy else 0 end pday_copy,
                case when nvl(t.bill_pay,'N')='N' then d.day_copy else 0 end uday_copy,
                d.route_code, d.subroute_code, d.subsubroute_code
                from cir_agmast m,cir_supply s ,cir_dbksup d,cir_publ_mast p,cir_edtn_mast e,cir_supply_type_mast t
                where m.comp_code=d.comp_code and m.comp_code=p.comp_code and m.comp_code=s.comp_code and m.comp_code=e.comp_code and 
                m.comp_code=t.comp_code and m.comp_code=pcompcode and m.unit=d.unit_code and m.unit=s.unit and d.unit_code=punitcode and 
                d.publ = p.publ and p.publ = e.publ and d.publ = ppublcode and d.edtn=e.edtn and d.edtn=s.edtn and d.edtn=nvl(pedtncode,d.edtn) and e.main_edtn=nvl(pmedtncode,e.main_edtn) and 
                d.sup_type_code=t.sup_ty_code and d.sup_type_code=s.supply_type_code and m.agcd=d.agcd and m.agcd=s.agcd and m.dpcd=d.dpcd and m.dpcd=s.dpcd and
                d.supdate between v_frdt and v_todt and (m.ag_type=pagtype or pagtype is null)
                and (m.ag_class=pagclass or pagclass is null) ) x
                group by x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,
                x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.station_code,x.lbl_printno,x.route_code
                order by x.comp_code,x.unit_code,x.unit_name,route_seqno,route_name,x.publ_name,x.publ,x.lbl_printno,x.ag_name,x.agcd,x.dpcd;
            end if;        
        else--for summary
            if preg_extra='E' then
                open p_accounts for
                select x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,
                sum(x.paid_copy) paid_copy,sum(x.unpaid_copy) unpaid_copy,
                sum(x.pday_copy) pday_copy,sum(x.uday_copy) uday_copy,
                x.route_code,cir_get_name.cir_route(x.comp_code,x.unit_code,x.route_code,'1',null,null,null) route_name,
                cir_get_route_seqno(x.comp_code,x.unit_code,x.route_code) route_seqno
                from
                (select d.comp_code,d.unit_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=d.unit_code) unit_name, 
                d.publ,p.publ_name,e.main_edtn,d.edtn,e.edtn_name,e.edition_nick,e.edtn_seq_no,
                d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,s.lbl_printno,
                case when nvl(t.bill_pay,'N')='Y' then d.sup_copy else 0 end paid_copy,
                case when nvl(t.bill_pay,'N')='N' then d.sup_copy else 0 end unpaid_copy,
                case when nvl(t.bill_pay,'N')='Y' then d.day_copy else 0 end pday_copy,
                case when nvl(t.bill_pay,'N')='N' then d.day_copy else 0 end uday_copy,        
                d.route_code,  d.subroute_code,d.subsubroute_code
                from cir_agmast m,cir_supply s ,cir_dbksup d,cir_publ_mast p,cir_edtn_mast e,cir_supply_type_mast t
                where m.comp_code=d.comp_code and m.comp_code=p.comp_code and m.comp_code=s.comp_code and m.comp_code=e.comp_code and 
                m.comp_code=t.comp_code and m.comp_code=pcompcode and m.unit=d.unit_code and m.unit=s.unit and d.unit_code=punitcode and 
                d.publ = p.publ and p.publ = e.publ and d.publ = ppublcode and d.edtn=e.edtn and d.edtn=s.edtn and d.edtn=nvl(pedtncode,d.edtn) and e.main_edtn=nvl(pmedtncode,e.main_edtn) and 
                d.sup_type_code=t.sup_ty_code and d.sup_type_code=s.supply_type_code and m.agcd=d.agcd and m.agcd=s.agcd and m.dpcd=d.dpcd and m.dpcd=s.dpcd and
                d.supdate between v_frdt and v_todt and (m.ag_type=pagtype or pagtype is null)
                and (m.ag_class=pagclass or pagclass is null) and nvl(d.day_copy,0)>0) x
                group by x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.route_code
                having sum(x.pday_copy)>0
                order by x.comp_code,x.unit_code,x.unit_name,route_seqno,route_name,x.publ_name,x.publ; 
            else
                open p_accounts for
                select x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,
                sum(x.paid_copy) paid_copy,sum(x.unpaid_copy) unpaid_copy,
                sum(x.pday_copy) pday_copy,sum(x.uday_copy) uday_copy,
                x.route_code,cir_get_name.cir_route(x.comp_code,x.unit_code,x.route_code,'1',null,null,null) route_name,
                cir_get_route_seqno(x.comp_code,x.unit_code,x.route_code) route_seqno
                from
                (select d.comp_code,d.unit_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=d.unit_code) unit_name, 
                d.publ,p.publ_name,e.main_edtn,d.edtn,e.edtn_name,e.edition_nick,e.edtn_seq_no,
                d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,s.lbl_printno,
                case when nvl(t.bill_pay,'N')='Y' then d.sup_copy else 0 end paid_copy,
                case when nvl(t.bill_pay,'N')='N' then d.sup_copy else 0 end unpaid_copy,
                case when nvl(t.bill_pay,'N')='Y' then d.day_copy else 0 end pday_copy,
                case when nvl(t.bill_pay,'N')='N' then d.day_copy else 0 end uday_copy,        
                d.route_code, d.subroute_code,d.subsubroute_code
                from cir_agmast m,cir_supply s ,cir_dbksup d,cir_publ_mast p,cir_edtn_mast e,cir_supply_type_mast t
                where m.comp_code=d.comp_code and m.comp_code=p.comp_code and m.comp_code=s.comp_code and m.comp_code=e.comp_code and 
                m.comp_code=t.comp_code and m.comp_code=pcompcode and m.unit=d.unit_code and m.unit=s.unit and d.unit_code=punitcode and 
                d.publ = p.publ and p.publ = e.publ and d.publ = ppublcode and d.edtn=e.edtn and d.edtn=s.edtn and d.edtn=nvl(pedtncode,d.edtn) and e.main_edtn=nvl(pmedtncode,e.main_edtn) and 
                d.sup_type_code=t.sup_ty_code and d.sup_type_code=s.supply_type_code and m.agcd=d.agcd and m.agcd=s.agcd and m.dpcd=d.dpcd and m.dpcd=s.dpcd and
                d.supdate between v_frdt and v_todt and (m.ag_type=pagtype or pagtype is null)
                and (m.ag_class=pagclass or pagclass is null)) x
                group by x.comp_code,x.unit_code,x.unit_name,x.publ,x.publ_name,x.route_code
                order by x.comp_code,x.unit_code,x.unit_name,route_seqno,route_name,x.publ_name,x.publ;        
            end if;
        end if;        
    end if;
    open p_accounts1 for
    select sysdate as "CUR_DATE" from dual;
        
    open p_accounts2 for
    select sysdate as "CUR_DATE" from dual;

End cir_rep_daybook_supply;
/



********************************************************Daily Supply Day Book end********************************************

/***by laxman sir 17 dec*/
 ALTER TABLE CIR_BILL_PRINT ADD(SECPER_RATE NUMBER(12,2))