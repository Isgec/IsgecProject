/**********************prachi  *******************************************/
CREATE OR REPLACE PACKAGE cir_supply_alteration IS
  TYPE T_Circul_Cursor is Ref Cursor;
  procedure cir_supply_alteration_p(
      pcomp_code        in varchar2,
      punit_code        in varchar2,
      ppubl_code        in varchar2,
      pmedtn_code       in varchar2,
      pedtn_code        in varchar2,
      psup_type         in varchar2,
      pstate            in varchar2,
      pdistcode         in varchar2,
      ptaluka           in varchar2,
      pcitycode         in varchar2,
      pbrancode         in varchar2,
      proutecode        in varchar2,
      pagcd_code        in varchar2,
      pdpcd_code        in varchar2,
      psorted_by        in varchar2,---1 for  edition route wise,2 for edition district wise
      pdateformat       in varchar2,
      pextra1           in varchar2,
      pextra2           in varchar2,
      pextra3           in varchar2,
      pextra4           in varchar2,
      pextra5           in varchar2,      
      p_circuls         out T_Circul_Cursor);
  procedure cir_supply_unsold_return_p(
      pcomp_code        in varchar2,
      punit_code        in varchar2,
      ppubl_code        in varchar2,
      pedtn_code        in varchar2,
      pagcd_code        in varchar2,
      pdpcd_code        in varchar2,
      pfromdate         in varchar2,
      ptilldate         in varchar2,
      preturn_type      in varchar2,
      pdateformat       in varchar2,
      pextra1           in varchar2,
      pextra2           in varchar2,
      pextra3           in varchar2,
      pextra4           in varchar2,
      pextra5           in varchar2,      
      p_circuls         out T_Circul_Cursor);      
END cir_supply_alteration;


CREATE OR REPLACE PACKAGE BODY cir_supply_alteration IS
  procedure cir_supply_alteration_p(
      pcomp_code        in varchar2,
      punit_code        in varchar2,
      ppubl_code        in varchar2,
      pmedtn_code       in varchar2,
      pedtn_code        in varchar2,
      psup_type         in varchar2,
      pstate            in varchar2,
      pdistcode         in varchar2,
      ptaluka           in varchar2,
      pcitycode         in varchar2,
      pbrancode         in varchar2,
      proutecode        in varchar2,
      pagcd_code        in varchar2,
      pdpcd_code        in varchar2,
      psorted_by        in varchar2,--1 for  edition route wise,2 for edition district wise
      pdateformat       in varchar2,
      pextra1           in varchar2,--agency type
      pextra2           in varchar2,--for agency--A and distribution--D
      pextra3           in varchar2,--agency class
      pextra4           in varchar2,
      pextra5           in varchar2,      
      p_circuls         out T_Circul_Cursor)
 As

 Begin
  if upper(pextra2)='D' then
      if psorted_by=2 then---for edition district and agency wise
          open p_circuls for
            select a.comp_code comp_code,a.unit unit,a.agcd agcd,a.dpcd dpcd,a.ag_name agency_name,a.ag_name_oth_lang agency_name_other_lang,a.city_code city_code,
            cir_get_city(a.comp_code,a.city_code) city_name,a.station_code drop_point_code,cir_get_drop_point_name(a.comp_code,a.unit,a.station_code,'1') drop_point_name,
            nvl(c.base_supply,0) base_supply,nvl(c.supply_sun,0) supply_sun,nvl(c.supply_mon,0) supply_mon,nvl(c.supply_tue,0) supply_tue,nvl(c.supply_wed,0) supply_wed,
            nvl(c.supply_thu,0) supply_thu,nvl(c.supply_fri,0) supply_fri,nvl(c.supply_sat,0) supply_sat,nvl(c.supply_spl1,0) supply_spl1,nvl(c.supply_spl2,0) supply_spl2,
            c.lbl_printno supply_seq,cir_get_route_seqno(c.comp_code,c.unit,c.route_code) route_seq,
            c.route_code,cir_get_name.cir_route(a.comp_code,a.unit,c.route_code,1,pdateformat,'','') route_name, 
            c.subroute_code,cir_get_name.cir_subroute(a.comp_code,a.unit,c.route_code,c.subroute_code,1,pdateformat,'','') subroute_name,
            c.sub_subroute_code,cir_get_name.cir_subsubroute(a.comp_code,a.unit,c.route_code,c.subroute_code,c.sub_subroute_code,1,pdateformat,'','') subsubroute_name,
            d.dist_name dist_name,nvl(p.CIR_SUP_ORDER_LIMIT,0) CIR_SUP_ORDER_LIMIT,c.supply_type_code supply_type_code,b.sup_ty_name supply_type_name,c.edtn edtn,e.edtn_name edtn_name
            from cir_agmast_dis a left outer join cir_dist_mast d on a.comp_code=d.comp_code and a.dist_code=d.dist_code,cir_supply_type_mast b,cir_supply c,cir_edtn_mast e,preferrences p
            where a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=e.comp_code and  a.comp_code=pcomp_code and p."comp_code"=pcomp_code and
            a.unit=c.unit and a.unit=e.unit_code and a.unit=punit_code and b.sup_ty_code=c.supply_type_code and
            c.publ=e.publ and c.publ=ppubl_code and c.edtn=e.edtn and c.edtn = nvl(pedtn_code,c.edtn) and e.main_edtn = nvl(pmedtn_code,e.main_edtn) and 
            a.agcd=c.agcd and a.agcd=nvl(pagcd_code,a.agcd) and a.dpcd=c.dpcd and a.dpcd=nvl(pdpcd_code,a.dpcd) and c.supply_type_code=nvl(psup_type,c.supply_type_code) and 
            (a.state_code=pstate or pstate is null) and
            (a.dist_code=pdistcode or pdistcode is null ) and (a.tehsil_taluka = ptaluka or ptaluka is null) and
            (a.city_code=pcitycode or pcitycode is null) and (a.branch_code = pbrancode or pbrancode is null) and
            (c.route_code=proutecode or proutecode is null) and nvl(c.supply_flag,'N') ='Y' and nvl(a.suspend,'N')='N' and
            (a.ag_type=pextra1 or pextra1 is null) and (a.ag_class=pextra3 or pextra3 is null) 
            order by dist_name,agency_name,edtn_name,supply_type_name,supply_seq;
      else
          open p_circuls for
          select a.comp_code comp_code,a.unit unit,a.agcd agcd,a.dpcd dpcd,a.ag_name agency_name,a.ag_name_oth_lang agency_name_other_lang,a.city_code city_code,
            cir_get_city(a.comp_code,a.city_code) city_name,a.station_code drop_point_code,cir_get_drop_point_name(a.comp_code,a.unit,a.station_code,'1') drop_point_name,
            nvl(c.base_supply,0) base_supply,nvl(c.supply_sun,0) supply_sun,nvl(c.supply_mon,0) supply_mon,nvl(c.supply_tue,0) supply_tue,nvl(c.supply_wed,0) supply_wed,
            nvl(c.supply_thu,0) supply_thu,nvl(c.supply_fri,0) supply_fri,nvl(c.supply_sat,0) supply_sat,nvl(c.supply_spl1,0) supply_spl1,nvl(c.supply_spl2,0) supply_spl2,
            c.lbl_printno supply_seq,cir_get_route_seqno(c.comp_code,c.unit,c.route_code) route_seq,
            c.route_code,cir_get_name.cir_route(a.comp_code,a.unit,c.route_code,1,pdateformat,'','') route_name, 
            c.subroute_code,cir_get_name.cir_subroute(a.comp_code,a.unit,c.route_code,c.subroute_code,1,pdateformat,'','') subroute_name,
            c.sub_subroute_code,cir_get_name.cir_subsubroute(a.comp_code,a.unit,c.route_code,c.subroute_code,c.sub_subroute_code,1,pdateformat,'','') subsubroute_name,
            d.dist_name dist_name,nvl(p.CIR_SUP_ORDER_LIMIT,0) CIR_SUP_ORDER_LIMIT,c.supply_type_code supply_type_code,b.sup_ty_name supply_type_name,c.edtn edtn,e.edtn_name edtn_name
            from cir_agmast_dis a left outer join cir_dist_mast d on a.comp_code=d.comp_code and a.dist_code=d.dist_code,cir_supply_type_mast b,cir_supply c,cir_edtn_mast e,preferrences p
            where a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=e.comp_code and  a.comp_code=pcomp_code and p."comp_code"=pcomp_code and
            a.unit=c.unit and a.unit=e.unit_code and a.unit=punit_code and b.sup_ty_code=c.supply_type_code and
            c.publ=e.publ and c.publ=ppubl_code and c.edtn=e.edtn and c.edtn = nvl(pedtn_code,c.edtn) and e.main_edtn = nvl(pmedtn_code,e.main_edtn) and 
            a.agcd=c.agcd and a.agcd=nvl(pagcd_code,a.agcd) and a.dpcd=c.dpcd and a.dpcd=nvl(pdpcd_code,a.dpcd) and c.supply_type_code=nvl(psup_type,c.supply_type_code) and 
            (a.state_code=pstate or pstate is null) and
            (a.dist_code=pdistcode or pdistcode is null ) and (a.tehsil_taluka = ptaluka or ptaluka is null) and
            (a.city_code=pcitycode or pcitycode is null) and (a.branch_code = pbrancode or pbrancode is null) and
            (c.route_code=proutecode or proutecode is null)  and nvl(c.supply_flag,'N') ='Y' and nvl(a.suspend,'N')='N' and
            (a.ag_type=pextra1 or pextra1 is null) and (a.ag_class=pextra3 or pextra3 is null)
             order by route_seq,supply_seq,agency_name,edtn_name,supply_type_name;
      end if;
  else
      if psorted_by=2 then---for edition district and agency wise
          open p_circuls for
            select a.comp_code comp_code,a.unit unit,a.agcd agcd,a.dpcd dpcd,a.ag_name agency_name,a.ag_name_oth_lang agency_name_other_lang,a.city_code city_code,
            cir_get_city(a.comp_code,a.city_code) city_name,a.station_code drop_point_code,cir_get_drop_point_name(a.comp_code,a.unit,a.station_code,'1') drop_point_name,
            nvl(c.base_supply,0) base_supply,nvl(c.supply_sun,0) supply_sun,nvl(c.supply_mon,0) supply_mon,nvl(c.supply_tue,0) supply_tue,nvl(c.supply_wed,0) supply_wed,
            nvl(c.supply_thu,0) supply_thu,nvl(c.supply_fri,0) supply_fri,nvl(c.supply_sat,0) supply_sat,nvl(c.supply_spl1,0) supply_spl1,nvl(c.supply_spl2,0) supply_spl2,
            c.lbl_printno supply_seq,cir_get_route_seqno(c.comp_code,c.unit,c.route_code) route_seq,
            c.route_code,cir_get_name.cir_route(a.comp_code,a.unit,c.route_code,1,pdateformat,'','') route_name, 
            c.subroute_code,cir_get_name.cir_subroute(a.comp_code,a.unit,c.route_code,c.subroute_code,1,pdateformat,'','') subroute_name,
            c.sub_subroute_code,cir_get_name.cir_subsubroute(a.comp_code,a.unit,c.route_code,c.subroute_code,c.sub_subroute_code,1,pdateformat,'','') subsubroute_name,
            d.dist_name dist_name,nvl(p.CIR_SUP_ORDER_LIMIT,0) CIR_SUP_ORDER_LIMIT,c.supply_type_code supply_type_code,b.sup_ty_name supply_type_name,c.edtn edtn,e.edtn_name edtn_name
            from cir_agmast a left outer join cir_dist_mast d on a.comp_code=d.comp_code and a.dist_code=d.dist_code,
            cir_supply_type_mast b,cir_supply c,cir_edtn_mast e,preferrences p
            where a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=e.comp_code and  a.comp_code=pcomp_code and p."comp_code"=pcomp_code and
            a.unit=c.unit and a.unit=e.unit_code and a.unit=punit_code and b.sup_ty_code=c.supply_type_code and
            c.publ=e.publ and c.publ=ppubl_code and c.edtn=e.edtn and c.edtn = nvl(pedtn_code,c.edtn) and e.main_edtn = nvl(pmedtn_code,e.main_edtn) and 
            a.agcd=c.agcd and a.agcd=nvl(pagcd_code,a.agcd) and a.dpcd=c.dpcd and a.dpcd=nvl(pdpcd_code,a.dpcd) and c.supply_type_code=nvl(psup_type,c.supply_type_code) and 
            (a.state_code=pstate or pstate is null) and
            (a.dist_code=pdistcode or pdistcode is null ) and (a.tehsil_taluka = ptaluka or ptaluka is null) and
            (a.city_code=pcitycode or pcitycode is null) and (a.branch_code = pbrancode or pbrancode is null) and
            (c.route_code=proutecode or proutecode is null) and nvl(c.supply_flag,'N') ='Y' and nvl(a.suspend,'N')='N' and
            (a.ag_type=pextra1 or pextra1 is null) and (a.ag_class=pextra3 or pextra3 is null)
            order by dist_name,agency_name,edtn_name,supply_type_name,supply_seq;
      else
          open p_circuls for
          select a.comp_code comp_code,a.unit unit,a.agcd agcd,a.dpcd dpcd,a.ag_name agency_name,a.ag_name_oth_lang agency_name_other_lang,a.city_code city_code,
            cir_get_city(a.comp_code,a.city_code) city_name,a.station_code drop_point_code,cir_get_drop_point_name(a.comp_code,a.unit,a.station_code,'1') drop_point_name,
            nvl(c.base_supply,0) base_supply,nvl(c.supply_sun,0) supply_sun,nvl(c.supply_mon,0) supply_mon,nvl(c.supply_tue,0) supply_tue,nvl(c.supply_wed,0) supply_wed,
            nvl(c.supply_thu,0) supply_thu,nvl(c.supply_fri,0) supply_fri,nvl(c.supply_sat,0) supply_sat,nvl(c.supply_spl1,0) supply_spl1,nvl(c.supply_spl2,0) supply_spl2,
            c.lbl_printno supply_seq,cir_get_route_seqno(c.comp_code,c.unit,c.route_code) route_seq,
            c.route_code,cir_get_name.cir_route(a.comp_code,a.unit,c.route_code,1,pdateformat,'','') route_name, 
            c.subroute_code,cir_get_name.cir_subroute(a.comp_code,a.unit,c.route_code,c.subroute_code,1,pdateformat,'','') subroute_name,
            c.sub_subroute_code,cir_get_name.cir_subsubroute(a.comp_code,a.unit,c.route_code,c.subroute_code,c.sub_subroute_code,1,pdateformat,'','') subsubroute_name,
            d.dist_name dist_name,nvl(p.CIR_SUP_ORDER_LIMIT,0) CIR_SUP_ORDER_LIMIT,c.supply_type_code supply_type_code,b.sup_ty_name supply_type_name,c.edtn edtn,e.edtn_name edtn_name
            from cir_agmast a left outer join cir_dist_mast d on a.comp_code=d.comp_code and a.dist_code=d.dist_code,cir_supply_type_mast b,cir_supply c,cir_edtn_mast e,preferrences p
            where a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=e.comp_code and  a.comp_code=pcomp_code and p."comp_code"=pcomp_code and
            a.unit=c.unit and a.unit=e.unit_code and a.unit=punit_code and b.sup_ty_code=c.supply_type_code and
            c.publ=e.publ and c.publ=ppubl_code and c.edtn=e.edtn and c.edtn = nvl(pedtn_code,c.edtn) and e.main_edtn = nvl(pmedtn_code,e.main_edtn) and 
            a.agcd=c.agcd and a.agcd=nvl(pagcd_code,a.agcd) and a.dpcd=c.dpcd and a.dpcd=nvl(pdpcd_code,a.dpcd) and c.supply_type_code=nvl(psup_type,c.supply_type_code) and 
            (a.state_code=pstate or pstate is null) and
            (a.dist_code=pdistcode or pdistcode is null) and (a.tehsil_taluka = ptaluka or ptaluka is null) and
            (a.city_code=pcitycode or pcitycode is null) and (a.branch_code = pbrancode or pbrancode is null) and
            (c.route_code=proutecode or proutecode is null)  and nvl(c.supply_flag,'N') ='Y' and nvl(a.suspend,'N')='N' and
            (a.ag_type=pextra1 or pextra1 is null) and (a.ag_class=pextra3 or pextra3 is null)
             order by route_seq,supply_seq,agency_name,edtn_name,supply_type_name;
      end if;
   end if;
 End cir_supply_alteration_p;
procedure cir_supply_unsold_return_p(
      pcomp_code        in varchar2,
      punit_code        in varchar2,
      ppubl_code        in varchar2,
      pedtn_code        in varchar2,
      pagcd_code        in varchar2,
      pdpcd_code        in varchar2,
      pfromdate         in varchar2,
      ptilldate         in varchar2,
      preturn_type      in varchar2,--it is for on return date received or supply date
      pdateformat       in varchar2,
      pextra1           in varchar2,
      pextra2           in varchar2,
      pextra3           in varchar2,
      pextra4           in varchar2,
      pextra5           in varchar2,      
      p_circuls         out T_Circul_Cursor)
As
    v_frdt date;
    v_todt date;
Begin
    v_frdt :=to_date(pfromdate,''''||pdateformat||'''');
    v_todt :=to_date(ptilldate,''''||pdateformat||'''');
    
    if preturn_type='R' then
        open p_circuls for
        select u.supdate supdate,nvl(u.supply_copy,0) supply_copy,
        (nvl(u.apr_bnr,0)+nvl(u.apr_late_recpt,0)+nvl(u.apr_short_recpt,0)+nvl(u.apr_unsold,0)) return_copy 
        from cir_agmast m,cir_unsold_dtl u 
        where m.comp_code=u.comp_code and m.comp_code=pcomp_code and m.unit=punit_code and m.unit=u.unit_code and 
        doctype='UCN' and recptdt >= v_frdt and recptdt <=v_todt and m.bill_agcd=u.agcd and m.bill_dpcd=u.dpcd and 
        m.agcd=nvl(pagcd_code,m.agcd) and m.dpcd=nvl(pdpcd_code,m.dpcd) and u.publ=ppubl_code and u.edtn=pedtn_code and
        (nvl(u.apr_bnr,0)+nvl(u.apr_late_recpt,0)+nvl(u.apr_short_recpt,0)+nvl(u.apr_unsold,0))>0
        union
        select u.supdate supdate,nvl(u.supply_copy,0) supply_copy,
        (nvl(u.bnr,0)+nvl(u.late_recpt,0)+nvl(u.short_recpt,0)+nvl(u.unsold,0)) return_copy 
        from cir_agmast m,cir_unsold_dtl u 
        where m.comp_code=u.comp_code and m.comp_code=pcomp_code and m.unit=punit_code and m.unit=u.unit_code and 
        doctype='UCN' and recptdt >= v_frdt and recptdt <=v_todt and m.bill_agcd=u.agcd and m.bill_dpcd=u.dpcd and 
        m.agcd=nvl(pagcd_code,m.agcd) and m.dpcd=nvl(pdpcd_code,m.dpcd) and u.publ=ppubl_code and u.edtn=pedtn_code and
        (nvl(u.apr_bnr,0)+nvl(u.apr_late_recpt,0)+nvl(u.apr_short_recpt,0)+nvl(u.apr_unsold,0))=0
        order by supdate;
    else
        open p_circuls for
        select u.supdate supdate,nvl(u.supply_copy,0) supply_copy,
        (nvl(u.apr_bnr,0)+nvl(u.apr_late_recpt,0)+nvl(u.apr_short_recpt,0)+nvl(u.apr_unsold,0)) return_copy 
        from cir_agmast m,cir_unsold_dtl u 
        where m.comp_code=u.comp_code and m.comp_code=pcomp_code and m.unit=punit_code and m.unit=u.unit_code and 
        doctype='UCN' and supdate >= v_frdt and supdate <=v_todt and m.bill_agcd=u.agcd and m.bill_dpcd=u.dpcd and 
        m.agcd=nvl(pagcd_code,m.agcd) and m.dpcd=nvl(pdpcd_code,m.dpcd) and u.publ=ppubl_code and u.edtn=pedtn_code and 
        (nvl(u.apr_bnr,0)+nvl(u.apr_late_recpt,0)+nvl(u.apr_short_recpt,0)+nvl(u.apr_unsold,0))>0
        union
        select u.supdate supdate,nvl(u.supply_copy,0) supply_copy,
        (nvl(u.bnr,0)+nvl(u.late_recpt,0)+nvl(u.short_recpt,0)+nvl(u.unsold,0)) return_copy 
        from cir_agmast m,cir_unsold_dtl u 
        where m.comp_code=u.comp_code and m.comp_code=pcomp_code and m.unit=punit_code and m.unit=u.unit_code and 
        doctype='UCN' and supdate >= v_frdt and supdate <=v_todt and m.bill_agcd=u.agcd and m.bill_dpcd=u.dpcd and 
        m.agcd=nvl(pagcd_code,m.agcd) and m.dpcd=nvl(pdpcd_code,m.dpcd) and u.publ=ppubl_code and u.edtn=pedtn_code and
        (nvl(u.apr_bnr,0)+nvl(u.apr_late_recpt,0)+nvl(u.apr_short_recpt,0)+nvl(u.apr_unsold,0))=0        
        order by supdate;    
    end if;    

End cir_supply_unsold_return_p; 
END cir_supply_alteration;
/

/**********************prachi  *******************************************/




/******************laxman sir  16-sept*****************************************/
                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE FUNCTION cir_get_edtn_name(pcomp_code in varchar2,pedtn in varchar2) RETURN varchar2 IS
vedtn_name varchar2(500);
BEGIN
   Begin
      select edtn_name into vedtn_name from cir_edtn_mast where comp_code=pcomp_code and edtn=pedtn;
           exception when others then
            vedtn_name:=null;
  End;
    return nvl(vedtn_name,'');
END;
/
                                                                     
                                                                     
      /********************4689******************/                                                               
                                             
CREATE OR REPLACE PROCEDURE rpt_publwise_billing_summ
   (pcompcode           in varchar2,
    pcenter             in varchar2,
    pbranchcode         in varchar2,
    ppublcode           in varchar2,
    padtype             in varchar2,
    pcatgcode           in varchar2,
    pdatefrom           in varchar2,
    pdateto             in varchar2,
    puserid             in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    pextra3             in varchar2,
    pextra4             in varchar2,
    pextra5             in varchar2,
    p_accounts          OUT Cur_Type_New1.cursor_type,
    p_accounts1         OUT Cur_Type_New1.cursor_type)
IS
    v_frdt      date; 
    v_todt      date;
        
    v_query             varchar2(20000);
    rec_v1_comp_code    varchar2(20);
    rec_v1_bill_date    date;
    rec_v1_publ_code    varchar2(20);
    rec_v1_publ_name    varchar2(200);
    rec_v1_edtn_code    varchar2(20);
    rec_v1_edtn_name    varchar2(200);
    rec_v1_amount       number(18,2);

    
     cursor c1 is
        select x.comp_code comp_code,x.bill_date bill_date,x.publ_code publ_code,x.publ_name publ_name,
        x.edtn_code edtn_code,x.edtn_name edtn_name,nvl(x.amount,0) amount from
        (select m."Comp_code" comp_code,i.bill_date bill_date,
        i."Publication_Code" publ_code,(select pub_mast."Pub_Name" from pub_mast where 
        pub_mast."Pub_Code"=i."Publication_Code") publ_name,i."Edition_Code" edtn_code,
        (select distinct "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=e."City_Code")  edtn_name,
        round(Sum(i."Bill_Amt"),2) amount
        from agency_mast a,tbl_booking_mast m,tbl_booking_insert i,branch_mst b,adv_cat_mast c,edition_mast e
        where m."Comp_code"=i."Comp_Code" and m."Comp_code"=pcompcode and c."Comp_Code"=m."Comp_code" and e."Comp_Code"=m."Comp_code" and 
        c."Adv_Cat_Code"=i."Ad_Cat" and 
        m."cio_booking_id"=i."Cio_Booking_Id" and a."Agency_Code"||a."SUB_Agency_Code"=m."Agency_sub_code" and 
        i.bill_date between v_frdt and v_todt and (m."Ad_type_code"=padtype or padtype is null) and
        (i."Ad_Cat"=pcatgcode or pcatgcode is null) and 
        --new version
        --m."branch"=b."Branch_Code" and
        --old version 
        m."branch"=b."Branch_Name" and
        (b."Branch_Code"=pbranchcode or pbranchcode is null) and (b."pub_center"=pcenter or pcenter is null) and
        (i."Publication_Code"=ppublcode or ppublcode is null) and e."Edition_Code"=i."Edition_Code"
        group by m."Comp_code",i.bill_date,i."Publication_Code",i."Edition_Code",e."City_Code") x        
        order by comp_code,publ_name,edtn_name,bill_date;

    v_rec_seqno number(10);         
    
    cursor c11 is
            select distinct exe_code publ_code, ad_main_category publ_name,ad_sub_category edtn_name 
            from temp_ad_receipt_report  
                where sess_id=userenv('sessionid') order by publ_name,edtn_name;
    v_var       varchar2(8000);
    v_var_sum   varchar2(8000);
Begin
    v_frdt      := to_date(pdatefrom,''''||pdateformat||'''');
    v_todt      := to_date(pdateto,''''||pdateformat||'''');

    delete from temp_ad_receipt_report where sess_id=userenv('sessionid');
    open c1;
    loop
        fetch c1 into rec_v1_comp_code,rec_v1_bill_date,rec_v1_publ_code,rec_v1_publ_name,rec_v1_edtn_code,rec_v1_edtn_name,rec_v1_amount;
        exit when c1%notfound;
        v_rec_seqno:=nvl(v_rec_seqno,0)+1;
        
        insert into temp_ad_receipt_report
        (comp_code,unit_code,pcentre_code,recptdt,exe_code, ad_main_category,ret_code,ad_sub_category,amount,rec_seqno)
        values(rec_v1_comp_code,pbranchcode,pcenter,rec_v1_bill_date,rec_v1_publ_code,rec_v1_publ_name,rec_v1_edtn_code,rec_v1_edtn_name,
        rec_v1_amount,v_rec_seqno);
    end loop;
    close c1;
    commit;
    
    rec_v1_publ_code:=null;rec_v1_publ_name:=null;rec_v1_edtn_code:=null;rec_v1_edtn_name:=null;
    
    open c11;
    loop
        fetch c11 into rec_v1_publ_code,rec_v1_publ_name,rec_v1_edtn_name;
        exit when c11%notfound;
            if v_var is null then
                v_var       :='case when d.exe_code||''#''||d.ad_sub_category='||''''||rec_v1_publ_code||'#'||rec_v1_edtn_name||''''||' then d.amount else 0 end "'||rec_v1_publ_code||'#'||rec_v1_edtn_name||'"';
                v_var_sum   :='round(sum("'||rec_v1_publ_code||'#'||rec_v1_edtn_name||'"),2)'||' "'||rec_v1_publ_code||'#'||rec_v1_edtn_name||'"';
            else
               v_var        :=v_var||','||'case when d.exe_code||''#''||d.ad_sub_category='||''''||rec_v1_publ_code||'#'||rec_v1_edtn_name||''''||' then d.amount else 0 end "'||rec_v1_publ_code||'#'||rec_v1_edtn_name||'"';
               v_var_sum    :=v_var_sum||','||'round(sum("'||rec_v1_publ_code||'#'||rec_v1_edtn_name||'"),2)'||' "'||rec_v1_publ_code||'#'||rec_v1_edtn_name||'"';
            end if;
    end loop;
    close c11;

    if v_var is null then
       v_query:='select x.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=x.comp_code) COMP_NAME,x.bill_date as "BILL_DATE", x.publ_code AS "PUBL_CODE",x.publ_name AS "PUBL_NAME",
        x.edtn_name as EDTN_NAME",round(sum("AMOUNT"),2) as "TOTOL" from
        (select d.comp_code,d.recptdt bill_date,d.exe_code publ_code,d.ad_main_category publ_name, 
        d.ad_sub_category edtn_name,nvl(d.amount,0) amount from temp_ad_receipt_report d where 
        sess_id='||userenv('sessionid')||') x 
        group by x.comp_code,x.publ_code,x.publ_name,x.edtn_name,x.bill_date order by x.comp_code,x.publ_name,x.publ_code,x.edtn_name,x.bill_date';
    else
       v_query:='select x.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=x.comp_code) COMP_NAME,x.bill_date as "BILL_DATE", 
        '||v_var_sum||' ,round(sum("AMOUNT"),2) as "TOTOL" from
        (select d.comp_code,d.recptdt bill_date,d.exe_code publ_code,d.ad_main_category publ_name,d.ad_sub_category edtn_name,
       '||v_var||',nvl(d.amount,0) amount from temp_ad_receipt_report d where 
        sess_id='||userenv('sessionid')||') x 
       group by x.comp_code,x.bill_date order by x.comp_code,x.bill_date';
    end if;
        
    --delete test1;insert into test1(vstring,vstring2) values('rpt_publwise_billing_summ1',v_query);commit;
        
    open p_accounts for v_query;
        
    if v_var is null then
       v_query:='select x.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=x.comp_code) COMP_NAME,round(sum("AMOUNT"),2) as "TOTOL" from
        (select d.comp_code,d.recptdt bill_date,d.exe_code publ_code,d.ad_main_category publ_name,d.ad_sub_category edtn_name,
        nvl(d.amount,0) amount from temp_ad_receipt_report d where 
        sess_id='||userenv('sessionid')||') x 
        group by x.comp_code order by x.comp_code';
    else
       v_query:='select x.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=x.comp_code) COMP_NAME,
        '||v_var_sum||' ,round(sum("AMOUNT"),2) as "TOTOL" from
        (select d.comp_code,d.recptdt bill_date,d.exe_code publ_code,d.ad_main_category publ_name,d.ret_code edtn_code,d.ad_sub_category edtn_name,
       '||v_var||',nvl(d.amount,0) amount from temp_ad_receipt_report d where 
        sess_id='||userenv('sessionid')||') x 
        group by x.comp_code order by x.comp_code';
    end if;    

    --insert into test1(vstring,vstring2) values('rpt_publwise_billing_summ2',v_query);commit;

    open p_accounts1 for v_query;
    --delete from temp_ad_receipt_report where sess_id=userenv('sessionid');commit;
End rpt_publwise_billing_summ;
/
      /********************4689******************/                                                               
/******************laxman sir  16-sept*****************************************/

/*****************Suresh Sir 4649 19/9/11***************************/

CREATE OR REPLACE procedure HT18JULY.CIR_OPENING_BIND_ORDER_BY(
    pcomp_code  in varchar2,
    punit_code  in varchar2,
    pdateformat in varchar2,
    pcolname in varchar2,
    porder 		in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    p_accounts  OUT Cur_Type_New1.cursor_type) as
    str varchar2(4000);
  Begin
        str := 'select * from (select a.comp_code comp_code,a.unit_code unit_code,a.publ publ,a.agcd agcd,a.dpcd dpcd,a.for_month for_month,a.opbal opbal,
        a.sec_opbal sec_opbal,a.creation_date creation_date,a.creation_userid creation_userid,a.last_updated_date last_updated_date,
        a.last_updated_userid last_updated_userid,cir_get_agency(a.comp_code,a.unit_code,a.agcd,a.dpcd) agency_name,cir_get_city(a.comp_code,b.city_code) city_name 
        from cir_agomast a,cir_agmast b
        where a.comp_code = '''||pcomp_code||''' and a.comp_code=b.comp_code and
              a.unit_code = '''||punit_code||''' and a.unit_code=b.unit and a.agcd=b.agcd and a.dpcd=b.dpcd)
            order by ' ||pcolname||' '||porder;

--delete from searchtbl;
--insert into searchtbl values(str);commit;
    --dbg('Str:'||str||'/'||porder);
    open p_accounts for str;
  End ;
/
 /*****************Suresh Sir 4649 19/9/11***************************/

/*********************Laxman Sir 4760 20/9/2011********************************/

                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE PACKAGE cir_rep_collection IS
TYPE T_Accounts_Cursor is Ref Cursor;
PROCEDURE cir_rep_collection_det_p(
	pcompcode 			in varchar2,
	punitcode 			in varchar2,
    pbrachcode			in varchar2,
	pdoctype 			in varchar2,
	ppaymode 			in varchar2,
	pactype 			in varchar2,
	pfromdate 			in varchar2,
	ptodate 			in varchar2,
	pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
	P_Accounts          out T_Accounts_Cursor,
	P_Accounts1         out T_Accounts_Cursor);
PROCEDURE cir_rep_datewise_monthwise_p(
	pcompcode 			in varchar2,
	punitcode 			in varchar2,
	pdoctype 			in varchar2,
	ppaymode_reason 	in varchar2,
	pactype 			in varchar2,
    pagency_type		in varchar2,
	pfromdate 			in varchar2,
	ptodate 			in varchar2,
	pdateformat         in varchar2,
	prep				in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
	P_Accounts          out T_Accounts_Cursor,
	P_Accounts1         out T_Accounts_Cursor);
PROCEDURE cir_rep_unitwise_monthwise_p(
	pcompcode 			in varchar2,
	punitcode 			in varchar2,
	pdoctype 			in varchar2,
	ppaymode_reason 	in varchar2,
	pactype 			in varchar2,
	pfromdate 			in varchar2,
	ptodate 			in varchar2,
	pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
	P_Accounts          out T_Accounts_Cursor,
	P_Accounts1         out T_Accounts_Cursor);
END cir_rep_collection;
/
CREATE OR REPLACE PACKAGE BODY cir_rep_collection IS
/*
var v1 refcursor;
var v2 refcursor;
exec cir_rep_collection.cir_rep_collection_det_p('SP002','AUR','','DN,CN','','NM','01-feb-2011','17-mar-2011','dd/mm/yyyy','','',:v1,:v2);*/
    PROCEDURE cir_rep_collection_det_p(
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pbrachcode            in varchar2,
    pdoctype            in varchar2,
    ppaymode            in varchar2,
    pactype             in varchar2,
    pfromdate           in varchar2,
    ptodate             in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    P_Accounts          out T_Accounts_Cursor,
    P_Accounts1         out T_Accounts_Cursor)
    As
        v_frdt date;
        v_todt date;
        a number;
    Begin
        v_frdt :=to_date(pfromdate,''''||pdateformat||'''');
        v_todt :=to_date(ptodate,''''||pdateformat||'''');
        --insert into test1(vstring,vstring2) values('pdoctype ',pdoctype); commit;
        if pdoctype is not null then
            a:=FN_SPLITFIELD(pdoctype ,',');
        end if;
        open P_Accounts for
        select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,a.recptno recptno,a.doctype doctyp,a.agcd agcd,
        a.dpcd dpcd,b.ag_name as AGENCY_NAME,b.ag_name_oth_lang agname_oth_lang,b.city_code,cir_get_city(b.comp_code,b.city_code) city_name,
        b.tehsil_taluka taluka_code,cir_get_taluka(b.comp_code,b.tehsil_taluka) taluka_name,a.voucherno voucherno,a.chno chno,a.chdt chdt,
        substr(nvl((select bankname as "bankname" from cir_bank_mast where comp_code=pcompcode and bankcode=a.chbank),a.chbank),1,15) as BANK,abs(a.amount) amount,
        initcap(a.remark) remark,a.achd achd,
        case when a.doctype='RCR' then (select "Payment_Mode_Name" from payment_mode_mast where "Pay_Mode_Code"=a.reason)
        else (select reason_name from cir_reason_mst where comp_code=a.comp_code and reason_code=a.reason) end as reason,
        a.branch_code branch_code,(select distinct "Branch_Name" from branch_mst where "Branch_Code"=a.branch_code) branch_name,
        substr(fa_get_account_name(a.comp_code,a.rcdp),1,15) debit_head,(select distinct case when dsign=-1 then 'C' else 'D' end dsign from cir_docmst where doc_type=a.doctype) dsign,
        a.userid,(select nvl(FIRSTNAME,"username")||' '||LASTNAME from login where "userid"=a.userid) created_by, a.creation_date creation_date, a.prov_rec_no prov_rec_no, a.prov_rec_dt prov_rec_date,
        a.REMARK_OTH REMARK_OTH 
        from cir_rcphdr a,cir_agmast b
        where a.comp_code=b.comp_code and a.comp_code=pcompcode  and a.unit_code=b.unit and a.unit_code =punitcode and
              a.agcd=b.agcd and a.dpcd=b.dpcd and a.agcd=nvl(pextra1,a.agcd) and a.dpcd=nvl(pextra2,a.dpcd) and
              a.recptdt between v_frdt and v_todt and (a.doctype  in(select EDITION_NAME from result) or pdoctype is null) and
              (a.reason =ppaymode or ppaymode is null) and (nvl(a.achd,'NM')=pactype or pactype is null) and
              (a.branch_code =pbrachcode or pbrachcode is null)
        order by comp_code,recptdt,doctype,recptno;

        open P_Accounts1 for
        select comp_code,doctype,reason,sum(db_amount) db_amount,sum(cr_amount) cr_amount from(select comp_code,doctype,reason,decode(debit,'D',sum(amount)) db_amount,decode(credit,'C',sum(amount)) cr_amount from
        (select a.comp_code comp_code,a.doctype doctype,
        case when a.doctype='RCR' then (select "Payment_Mode_Name" from payment_mode_mast where "Pay_Mode_Code"=a.reason)
        else (select reason_name from cir_reason_mst where comp_code=a.comp_code and reason_code=a.reason) end as reason,
        decode(sign(a.amount),1,'D') as debit,
        decode(sign(a.amount),-1,'C') as credit,abs(a.amount) as amount
        from cir_rcphdr a,cir_agmast b
        where a.comp_code=b.comp_code and a.comp_code=pcompcode  and a.unit_code=b.unit and a.unit_code =punitcode and
        a.agcd=b.agcd and a.dpcd=b.dpcd and  a.agcd=nvl(pextra1,a.agcd) and a.dpcd=nvl(pextra2,a.dpcd) and
        a.recptdt between v_frdt and v_todt and (a.doctype  in(select EDITION_NAME from result) or pdoctype is null) and
        (a.reason =ppaymode or ppaymode is null) and (nvl(a.achd,'NM')=pactype or pactype is null) and
        (a.branch_code =pbrachcode or pbrachcode is null))
        group by comp_code,doctype,reason,debit,credit)
        group by comp_code,doctype,reason
        order by comp_code,doctype,reason;

    End cir_rep_collection_det_p;

 PROCEDURE cir_rep_datewise_monthwise_p(
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pdoctype            in varchar2,
    ppaymode_reason     in varchar2,
    pactype             in varchar2,
    pagency_type        in varchar2,
    pfromdate           in varchar2,
    ptodate             in varchar2,
    pdateformat         in varchar2,
    prep                in varchar2,--this is used for datewise(D) or monthwise(M)
    pextra1             in varchar2,
    pextra2             in varchar2,
    P_Accounts          out T_Accounts_Cursor,
    P_Accounts1         out T_Accounts_Cursor)
    As
    v_frdt date;
        v_todt date;
    cursor cur_reason is
        select distinct 'sum(decode(a.reason,'||''''||a.reason||''''||',a.amount,0)) "'||reason||'"' vreason,a.reason reason
        from cir_rcphdr a,cir_agmast b
        where a.comp_code=pcompcode and a.comp_code=b.comp_code and a.unit_code=b.unit and
                 (a.unit_code=punitcode or punitcode is null) and a.agcd=b.agcd and a.dpcd=b.dpcd and
                 (b.ag_type=pagency_type or pagency_type is null) and (a.doctype=pdoctype or pdoctype is null) and
                  a.recptdt between v_frdt and v_todt and
             (a.reason=ppaymode_reason or ppaymode_reason is null) and (a.achd=pactype or pactype is null)
            order by a.reason;
     rec_reason cur_reason%rowtype;
     vvar         varchar2(4000);
     vvar_sum    varchar2(4000);
     vquery     varchar2(4000);
    Begin
        v_frdt :=to_date(pfromdate,''''||pdateformat||'''');
        v_todt :=to_date(ptodate,''''||pdateformat||'''');
        --delete from test1;
      open cur_reason;
        loop
            fetch cur_reason into rec_reason;
            exit when cur_reason%notfound;
          if vvar is null then
            vvar        :=rec_reason.vreason;
            vvar_sum:='sum("'||rec_reason.reason||'") "'||rec_reason.reason||'"';
        else
            vvar        :=vvar||','||rec_reason.vreason;
            vvar_sum:=vvar_sum||',sum("'||rec_reason.reason||'") "'||rec_reason.reason||'"';
        end if;
        end loop;
        close cur_reason;
    --insert into test1(vstring,vstring2) values('date collection',vvar);commit;
        if vvar is not null and prep in('D','M') then
            if prep='D' then
                vquery:='select comp_code,unit_code,recptdt,'||vvar_sum||' from
                        (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a,cir_agmast b
                        where a.comp_code=b.comp_code and a.comp_code='||''''||pcompcode||''''||' and a.unit_code=b.unit and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                              a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type='||''''||pagency_type||''''||' or '||''''||pagency_type||''''||' is null) and
                              (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                                (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null)
                            group by a.comp_code,a.unit_code,a.recptdt,a.reason)
                            group by comp_code,unit_code,recptdt
                            order by comp_code,unit_code,recptdt';
                --insert into test1(vstring,vstring2) values('date collection vquery',vquery);commit;
                open P_Accounts for vquery;
                vquery:='select comp_code,unit_code,'||vvar_sum||' from
                        (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a,cir_agmast b
                        where a.comp_code=b.comp_code and a.comp_code='||''''||pcompcode||''''||' and a.unit_code=b.unit and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                               a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type='||''''||pagency_type||''''||' or '||''''||pagency_type||''''||' is null) and
                               (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                                (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null)
                            group by a.comp_code,a.unit_code,a.recptdt,a.reason)
                            group by comp_code,unit_code
                            order by comp_code,unit_code';
                --insert into test1(vstring,vstring2) values('date collection vquery2',vquery);commit;
                open P_Accounts1 for vquery;
            else
                vquery:='select comp_code,unit_code,trunc(recptdt,''mm'') dt,to_char(trunc(recptdt,''mm''),''MON-YYYY'') recptdt,'||vvar_sum||' from
                        (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a,cir_agmast b
                        where a.comp_code=b.comp_code and a.comp_code='||''''||pcompcode||''''||' and a.unit_code=b.unit and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                              a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type='||''''||pagency_type||''''||' or '||''''||pagency_type||''''||' is null) and
                              (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                              (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null)
                            group by a.comp_code,a.unit_code,a.recptdt,a.reason)
                            group by comp_code,unit_code,trunc(recptdt,''mm''),to_char(trunc(recptdt,''mm''),''MON-YYYY'')
                            order by comp_code,unit_code,3';
                --insert into test1(vstring,vstring2) values('date collection vquery',vquery);commit;
                open P_Accounts for vquery;
                vquery:='select comp_code,unit_code,'||vvar_sum||' from
                        (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a,cir_agmast b
                        where a.comp_code='||''''||pcompcode||''''||' and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                              a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type='||''''||pagency_type||''''||' or '||''''||pagency_type||''''||' is null) and
                              (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                              (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null)
                            group by a.comp_code,a.unit_code,a.recptdt,a.reason)
                            group by comp_code,unit_code
                            order by comp_code,unit_code';
                --insert into test1(vstring,vstring2) values('date collection vquery2',vquery);commit;
                open P_Accounts1 for vquery;
            end if;
        else
            vquery:='select '||''''||pcompcode||''''||' "comp_code",'||''''||punitcode||''''||' "unit_code",'||''''||trunc(sysdate)||''''||' "recptdt" from dual where 1=2';
            open P_Accounts for vquery;
            vquery:='select '||''''||pcompcode||''''||' "comp_code",'||''''||punitcode||''''||' "unit_code" from dual  where 1=2';
            open P_Accounts1 for vquery;
        end if;
End cir_rep_datewise_monthwise_p;

--var v1 refcursor;
--var v2 refcursor;
--exec cir_rep_collection.cir_rep_unitwise_monthwise_p('SP002','','RCR','','NM','01-apr-2010','31-dec-2010','dd/mm/yyyy','','',:v1,:v2);

PROCEDURE cir_rep_unitwise_monthwise_p(
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pdoctype            in varchar2,
    ppaymode_reason     in varchar2,
    pactype             in varchar2,
    pfromdate           in varchar2,
    ptodate             in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    P_Accounts          out T_Accounts_Cursor,
    P_Accounts1         out T_Accounts_Cursor)
    As
    v_frdt      date;
    v_todt      date;
    v_months    number:=0;
    v_cnt       number:=0;
    v_dt        date;
    vvar        varchar2(4000);
    vvar_sum    varchar2(4000);
    vquery      varchar2(4000);
    Begin
        v_frdt     :=to_date(pfromdate,''''||pdateformat||'''');
        v_todt     :=to_date(ptodate,''''||pdateformat||'''');
        select round(months_between(trunc(v_todt,'mm'),trunc(v_frdt,'mm'))),trunc(v_frdt,'mm') into v_months,v_dt from dual;
        if v_months=0 then
            v_months:=0;
        end if;
        --delete from test1;commit;
        loop
            if v_cnt>v_months then
                exit;
            end if;
          if vvar is null then
            vvar        :='sum(decode(trunc(a.recptdt,''mm''),'||''''||v_dt||''''||',a.amount,0)) "'||v_dt||'"';
            vvar_sum:='sum("'||v_dt||'") "'||v_dt||'"';
        else
            vvar    :=vvar||',sum(decode(trunc(a.recptdt,''mm''),'||''''||v_dt||''''||',a.amount,0)) "'||v_dt||'"';
            vvar_sum:=vvar_sum||',sum("'||v_dt||'") "'||v_dt||'"';
        end if;
        v_dt        :=add_months(v_dt,1);
        v_cnt   :=v_cnt+1;
        end loop;
        --insert into test1(vstring,vstring2) values('unit monthwise vvar '||v_months,vvar);commit;
        if vvar is not null then
                vquery:='select comp_code,unit_code,(select min("Pub_Cent_name") from pub_cent_mast where "Pub_cent_Code"=unit_code) unit_name,'||vvar_sum||' from
                        (select a.comp_code comp_code,a.unit_code unit_code,trunc(a.recptdt,''mm'') recptdt,'||vvar||' from cir_rcphdr a
                        where a.comp_code='||''''||pcompcode||''''||' and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                               (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                                (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null)
                            group by a.comp_code,a.unit_code,trunc(a.recptdt,''mm''))
                            group by comp_code,unit_code
                            order by comp_code,unit_code';
                --insert into test1(vstring,vstring2) values('date collection vquery',vquery);commit;
                open P_Accounts for vquery;
                vquery:='select comp_code,'||vvar_sum||' from
                        (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a
                        where a.comp_code='||''''||pcompcode||''''||' and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                               (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                                (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null)
                            group by a.comp_code,a.unit_code,a.recptdt,a.reason)
                            group by comp_code
                            order by comp_code';
                --insert into test1(vstring,vstring2) values('date collection vquery2',vquery);commit;
                open P_Accounts1 for vquery;
        else
            vquery:='select '||''''||pcompcode||''''||' "comp_code",'||''''||punitcode||''''||' "unit_code" from dual where 1=2';
            open P_Accounts for vquery;
            vquery:='select '||''''||pcompcode||''''||' "comp_code" from dual  where 1=2';
            open P_Accounts1 for vquery;
        end if;
    End    cir_rep_unitwise_monthwise_p;
End cir_rep_collection;
/


/*********************Laxman Sir 4760 20/9/2011********************************/



//-----------------------------issue no. 4867-------------------------------

 procedure cir_taxi_bind_p (
   	pcompcode in varchar2,
    punit in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
	  p_accounts out t_accounts_cursor) as
	  Begin
	  	open p_accounts for SELECT * FROM (select cir_taxi_mast.*,cir_route_mast.arr_time,cir_route_mast.dep_time,cir_route_mast.route_dist,cir_route_mast.route_name nm from cir_taxi_mast,cir_route_mast 
             where cir_taxi_mast.comp_code=cir_route_mast.comp_code and
                   cir_taxi_mast.unit_code=cir_route_mast.unit and
                   cir_taxi_mast.rt_code=cir_route_mast.route_code and
                   cir_taxi_mast.subrt_code is null and
                   cir_taxi_mast.sub_subrt_code is null and
                   cir_taxi_mast.comp_code=pcompcode and 
                   cir_taxi_mast.unit_code=punit and
                   ((upper(cir_taxi_mast.vehicle_name) like UPPER(pextra1) || '%') or (pextra1 is null))
union
select cir_taxi_mast.*,cir_sub_route_mast.arr_time,cir_sub_route_mast.dep_time,cir_sub_route_mast.subrt_dist,cir_sub_route_mast.subrt_name nm from cir_taxi_mast,cir_sub_route_mast 
             where cir_taxi_mast.comp_code=cir_sub_route_mast.comp_code and
                   cir_taxi_mast.unit_code=cir_sub_route_mast.unit and
                   cir_taxi_mast.rt_code=cir_sub_route_mast.route_code and
                   cir_taxi_mast.subrt_code=cir_sub_route_mast.subrt_code and
                   cir_taxi_mast.sub_subrt_code is null and
                   cir_taxi_mast.comp_code=pcompcode and 
                   cir_taxi_mast.unit_code=punit and
                   ((upper(cir_taxi_mast.vehicle_name) like UPPER(pextra1)|| '%') or (pextra1 is null))  
union
select cir_taxi_mast.*,cir_sub_subroute_mast.arr_time,cir_sub_subroute_mast.dep_time,cir_sub_subroute_mast.sub_subrt_dist,
cir_sub_subroute_mast.sub_subrt_name nm from cir_taxi_mast,cir_sub_subroute_mast 
             where cir_taxi_mast.comp_code=cir_sub_subroute_mast.comp_code and
                   cir_taxi_mast.unit_code=cir_sub_subroute_mast.unit and
                   cir_taxi_mast.rt_code=cir_sub_subroute_mast.route_code and
                   cir_taxi_mast.subrt_code=cir_sub_subroute_mast.subrt_code and
                   cir_taxi_mast.sub_subrt_code=cir_sub_subroute_mast.sub_subrt_code and 
                   cir_taxi_mast.comp_code=pcompcode and 
                   cir_taxi_mast.unit_code=punit and
                   ((upper(cir_taxi_mast.vehicle_name) like UPPER(pextra1)|| '%') or (pextra1 is null))
                   )
                ORDER BY VEHICLE_NAME ;
                
	  End cir_taxi_bind_p;

//-----------------------------------------------------------------------------------------
/***************************laxman sir 4768 21/09/2011 ***************************************/
                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE PACKAGE cir_rep_supply IS
  type t_accounts is ref cursor;
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl                 in varchar2,
     pmainedtn             in varchar2,
     pedtn                 in varchar2,
     proute                in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts);

   procedure cir_rep_supply_po(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

  procedure cir_rep_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

  procedure cir_rep_dist_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);  
  
  procedure cir_rep_taluka_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);  
     
  procedure cir_rep_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

  procedure cir_rep_dist_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);     

  procedure cir_rep_taluka_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);
     
  procedure cir_rep_route_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

    procedure cir_rep_dist_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
     
    procedure cir_rep_taluka_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

     procedure cir_route_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);
     
     procedure cir_dist_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

     procedure cir_taluka_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

     procedure cir_dist_taluka_wise_sup(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts);
     
    procedure cir_supply_comp(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     psupdate           in varchar2,
     psupdate1          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

    procedure cir_route_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_dist_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pdist              in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_taluka_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     ptaluka            in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_edition_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

     procedure cir_dist_taluka_publ_wise(
     pcompcode          in varchar2,
     punitcode          in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pmainedtn          in varchar2,
     pedtncode          in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pagtypecode        in varchar2,
     pagclasscode       in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
        
procedure cir_datewise_resale(
     pcompcode          in varchar2,
     punitcode          in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pmainedtn          in varchar2,
     pedtncode          in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pagtypecode        in varchar2,
     pagclasscode       in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);              
END;
/
CREATE OR REPLACE PACKAGE BODY cir_rep_supply IS
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts)
     As

     vfrom_supdate    date;
     vtill_supdate    date;
     cursor cur_sup_type is
         select 'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) "'||sup_ty_name||'",' vty,
         'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) +' vty_sum
      from cir_supply_type_mast
      where comp_code=pcomp_code /*and sup_ty_code in(select distinct sup_type_code from cir_dbksup
      where comp_code=pcomp_code and unit_code=punit_code and
                  ((publ=ppubl) or (ppubl is null)) and ((edtn=pedtn) or (pedtn is null)) and
                  supdate between vfrom_supdate and vtill_supdate)*/
      order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar         varchar2(4000);
     vvar_sum    varchar2(4000);
     vquery     varchar2(4000);
     vquery1     varchar2(4000);
     vquery2     varchar2(4000);
     vquery3     varchar2(4000);
     vquery4     varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);commit;

    vquery:=' select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,cir_get_edtn_name(comp_code,edtn) edtn_name,route_code,cir_get_route_name(comp_code,unit_code,route_code) route_name,agcd "AGENCY CODE",dpcd "AGENCY SUBCODE",
    substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",(select cir_get_city(m.comp_code,m.city_code) city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY NAME",
    (select nvl(CIR_GET_NAME.CIR_CITY(m.comp_code,m.city_code,2,'||''''||pdateformat||''''||','''',''''),''NA'') city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY ONAME",/*supdate,*/'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||') and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
               edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/ order by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/';
     ---insert into test1(vstring) values ('1'||vquery);commit;
      open p_accounts for vquery;

      vquery2:=' select comp_code,unit_code,publ,edtn,route_code, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
                edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code
                order by comp_code,unit_code,publ,edtn,route_code';
        --insert into test1(vstring) values ('22'||vquery2);commit;
      open p_accounts2 for vquery2;

      vquery3:=' select comp_code,unit_code,publ,edtn, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn
                order by comp_code,unit_code,publ,edtn';
      open p_accounts3 for vquery3;

      vquery4:=' select comp_code,unit_code,publ, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ
                order by comp_code,unit_code,publ';
      open p_accounts4 for vquery4;

      vquery1:=' select comp_code,unit_code,'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code';
        --insert into test1(vstring) values ('2'||vquery);commit;

     open p_accounts1 for vquery1;
  End cir_rep_supply1;

procedure cir_rep_supply_po(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is use for finalised or unfinalised
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts) as
     v_date             date;
     cursor cur_sup_type is
         select 'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) "'||sup_ty_name||'",' vty,
             'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) +' vty_sum,sup_seq_no
             from cir_supply_type_mast
             where comp_code=pcomp_code and (upper(pextra1)!='U' or pextra1 is null)
         union
         select 
            case when to_char(v_date,'DY')='SUN' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sun,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='MON' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_mon,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='TUE' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_tue,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='WED' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_wed,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='THU' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_thu,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='FRI' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_fri,0),0)) "'||sup_ty_name||'",'
            else
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sat,0),0)) "'||sup_ty_name||'",'
            end vty,
            
            case when to_char(v_date,'DY')='SUN' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sun,0),0)) +'
            when to_char(v_date,'DY')='MON' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_mon,0),0)) +'
            when to_char(v_date,'DY')='TUE' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_tue,0),0)) +'
            when to_char(v_date,'DY')='WED' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_wed,0),0)) +'
            when to_char(v_date,'DY')='THU' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_thu,0),0)) +'
            when to_char(v_date,'DY')='FRI' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_fri,0),0)) +'
            else
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sat,0),0)) +'
            end  vty_sum,
            --'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',d.base_supply,0)) "'||sup_ty_name||'",' vty,
             --'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',d.base_supply,0)) +' vty_sum,
             sup_seq_no
             from cir_supply_type_mast
             where comp_code=pcomp_code and upper(pextra1)='U'
             order by sup_seq_no;
     rec_sup_type cur_sup_type%rowtype;

cursor cur_dbk is
            select x.comp_code comp_code,x.unit_code unit_code,x.supdate supdate,x.publ_name publ_name,x.mainedtn_name mainedtn_name,
            x.main_edtn_seqno main_edtn_seqno,x.edtn_name edtn_name,x.edtn_seq_no edtn_seq_no,x.sup_ty_name sup_ty_name,
            x.sup_seq_no sup_seq_no,x.sup_rate sup_rate,x.supply_copy supply_copy,x.supl_name supl_name,x.pgno pgno from
            (select d.comp_code comp_code,d.unit_code unit_code,d.supdate supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seq_no,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seq_no,d.sup_rate sup_rate, sum(d.sup_copy) supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit_code,e.edtn,d.supdate,pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(d.supdate,'DY')='SUN' then min(e.pgno_sun)
                when to_char(d.supdate,'DY')='MON' then min(e.pgno_mon)
                when to_char(d.supdate,'DY')='TUE' then min(e.pgno_tue)
                when to_char(d.supdate,'DY')='WED' then min(e.pgno_wed)
                when to_char(d.supdate,'DY')='THU' then min(e.pgno_thu)
                when to_char(d.supdate,'DY')='FRI' then min(e.pgno_fri) else min(e.pgno_sat) end pgno
            from cir_dbksup d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit_code=e.unit_code and (d.unit_code=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supdate =v_date and d.sup_type_code=t.sup_ty_code and upper(pextra1)!='U'
            group by d.comp_code,d.unit_code,d.supdate,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no,d.sup_rate
            union
            select d.comp_code comp_code,d.unit unit_code,v_date supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seq_no,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seq_no,
            cir_get_edtn_rate(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),'dd/mm/yyyy') sup_rate, 
            case when to_char(v_date,'DY')='SUN' then sum(nvl(d.base_supply,0)+nvl(d.supply_sun,0))
                 when to_char(v_date,'DY')='MON' then sum(nvl(d.base_supply,0)+nvl(d.supply_mon,0))
                 when to_char(v_date,'DY')='TUE' then sum(nvl(d.base_supply,0)+nvl(d.supply_tue,0))
                 when to_char(v_date,'DY')='WED' then sum(nvl(d.base_supply,0)+nvl(d.supply_wed,0))
                 when to_char(v_date,'DY')='THU' then sum(nvl(d.base_supply,0)+nvl(d.supply_thu,0))
                 when to_char(v_date,'DY')='FRI' then sum(nvl(d.base_supply,0)+nvl(d.supply_fri,0))
            else sum(nvl(d.base_supply,0)+nvl(d.supply_sat,0)) end supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(v_date,'DY')='SUN' then min(e.pgno_sun)
                when to_char(v_date,'DY')='MON' then min(e.pgno_mon)
                when to_char(v_date,'DY')='TUE' then min(e.pgno_tue)
                when to_char(v_date,'DY')='WED' then min(e.pgno_wed)
                when to_char(v_date,'DY')='THU' then min(e.pgno_thu)
                when to_char(v_date,'DY')='FRI' then min(e.pgno_fri) else min(e.pgno_sat) end pgno
            from cir_supply d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit=e.unit_code and (d.unit=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supply_flag='Y' and d.supply_type_code=t.sup_ty_code and upper(pextra1)='U'
            group by d.comp_code,d.unit,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no) x
            order by comp_code,unit_code,supdate,publ_name,main_edtn_seqno,mainedtn_name,edtn_seq_no,edtn_name,sup_seq_no,sup_ty_name;
        
        rec_dbk cur_dbk%rowtype;
                                            
    vvar        varchar2(4000);
    vvar_sum    varchar2(4000);
    vquery      varchar2(4000);
    vquery1     varchar2(4000);
    v_count     number(5);
    vlength     number(7);
    vrunval     varchar2(8000);
    v_val       varchar2(800);
    v_name      varchar2(8000);
    vno         number:=0;
  Begin
    if upper(pextra1)='U' then  
        v_date:=to_date(trunc(sysdate),''''||pdateformat||'''');
    else
        v_date:=to_date(psupdate,''''||pdateformat||'''');
    end if;    
    
    delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
    delete from cir_ledger_report where sess_id=userenv('sessionid');commit;
    delete from test1;commit;
    open cur_dbk;
    loop
        fetch cur_dbk into rec_dbk;
        exit when cur_dbk%notfound;
        
        v_count:=nvl(v_count,0)+1;
        if rec_dbk.pgno=0 then
            rec_dbk.pgno:=null;
        end if;
        
        vlength :=null; v_val :=null; vrunval :=null; vno:=null;

        v_val   :=replace(rec_dbk.supl_name||'+','+',',');
        vlength :=length(v_val);
        vno:=1;

        for i in 1.. vlength loop
        vrunval:=substr(v_val,i,1);
        if vrunval!=',' then
            v_name:=v_name||vrunval;
        else
            insert into cir_ledger_report(comp_code, unit_code, recptdt,agcd, dpcd, recptno, chq_bank, rec_seqno,sess_id)
                    values (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,v_name,rec_dbk.supply_copy,userenv('sessionid'));
            vno:=vno+1;
            v_name:='';
        end if;
        end loop;
        
        insert into cir_temp_bill_collection
        (comp_code, unit_code, billdt, publ_code, agcd, dpcd, supply_copy, gross_amt, 
        cur_sessionid, agname,return_copy,sec_opbal,remarks)
        values
        (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,rec_dbk.supply_copy,rec_dbk.sup_rate,
        userenv('sessionid'),rec_dbk.sup_ty_name,rec_dbk.pgno,v_count,replace(rec_dbk.supl_name||'+','+',' = '||rec_dbk.supply_copy));
    end loop;
    close cur_dbk;
         
    --delete from test1;commit;
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
                vvar:=vvar||rec_sup_type.vty;
                vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (pextra1||' '||vquery);
    if upper(pextra1)='U' then  
        vquery:=' select d.comp_code comp_code,d.unit unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,e.edtn_name "EDITION NAME",
                to_char(sysdate'||','||''''||pdateformat||''''||') supdate,'||vvar||','||vvar_sum||' TOTAL,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,e.edtn_seq_no edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,cir_get_edtn_supl(d.comp_code,d.unit_code,d.edtn,to_date(sysdate),'||''''||pdateformat||''''||',1,null,null,null,null,null) supl_name from cir_agmast m,cir_supply d,cir_edtn_mast e
                where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.comp_code=m.comp_code and d.unit='||''''||punit_code||''''||' and d.unit=e.unit_code and d.unit=m.unit and d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.publ=e.publ and
                d.supply_flag='||'''Y'''||' and nvl(m.suspend_type,''N'')='||'''N'''||' and d.edtn=e.edtn and d.agcd=m.agcd and d.dpcd=m.dpcd
                group by d.comp_code,d.unit,d.publ,e.main_edtn,d.edtn,sysdate,e.edtn_name,e.edtn_seq_no order by d.comp_code,d.unit,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn';
    else
        vquery:=' select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,e.edtn_name "EDITION NAME",
                to_char(d.supdate'||','||''''||pdateformat||''''||') supdate,'||vvar||','||vvar_sum||' TOTAL,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,e.edtn_seq_no edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,cir_get_edtn_supl(d.comp_code,d.unit_code,d.edtn,d.supdate,'||''''||pdateformat||''''||',1,null,null,null,null,null) supl_name from cir_dbksup d,cir_edtn_mast e
                where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.unit_code='||''''||punit_code||''''||' and d.unit_code=e.unit_code and d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.publ=e.publ /*and ((e.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null))*/ and
                d.supdate='||''''||v_date||''''||' and d.edtn=e.edtn
                group by d.comp_code,d.unit_code,d.publ,e.main_edtn,d.edtn,d.supdate,e.edtn_name,e.edtn_seq_no order by d.comp_code,d.unit_code,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn';
    end if;                    
    --insert into test1(vstring) values ('1 pextra1 '||vquery);commit;

    open p_accounts for vquery;
    if upper(pextra1)='U' then
    vquery1:=' select d.comp_code comp_code,d.unit unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,'||vvar||','||vvar_sum||'TOTAL from cir_agmast m,cir_supply d where d.comp_code=m.comp_code and d.comp_code='||''''||pcomp_code||''''||' and d.unit=m.unit and d.unit='||''''||punit_code||''''||' and
            d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supply_flag='||'''Y'''||' and nvl(m.suspend_type,''N'')='||'''N'''||'
            group by d.comp_code,d.unit,d.publ order by d.comp_code,d.unit,d.publ';
    else
    vquery1:=' select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,'||vvar||','||vvar_sum||'TOTAL from cir_dbksup d where d.comp_code='||''''||pcomp_code||''''||' and d.unit_code='||''''||punit_code||''''||' and
            d.publ=nvl('||''''||ppubl||''''||',d.publ) and supdate='||''''||v_date||''''||'
            group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ';
    end if;
    --insert into test1(vstring) values ('2 pextra1 '||vquery1);commit;

    open p_accounts1 for vquery1;
  End cir_rep_supply_po;

  procedure cir_rep_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",
       nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
            nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND
        A.PUBL=PPUBL AND A.EDTN=NVL(PEDTN,A.EDTN) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND 
        A.SUPDATE >= VFRDT AND A.SUPDATE <=VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,/*A.EDTN,*/B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<=VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_daybook;

  procedure cir_rep_dist_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt            date;
     vtodt            date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(DIST_CODE,'NA') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",
       STATE_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,'NA') DIST_CODE,nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",
       nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",STATE_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT  AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_dist_daybook;

  procedure cir_rep_taluka_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",
       STATE_CODE "STATE CODE",
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",
       nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",STATE_CODE "STATE CODE",
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_taluka_daybook;

  procedure cir_rep_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(12000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE';
insert into test1(vstring,vstring2) values('3 '||vquery3,VQUERY2);commit;
       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
        
insert into test1(vstring,vstring2) values('4 '||vquery3,VQUERY2);commit;        
       open p_accounts2 for vquery3||vquery2;

  End cir_rep_day_daybook;

  procedure cir_rep_dist_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
    substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",
       COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='  FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_dist_day_daybook;

  procedure cir_rep_taluka_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_taluka_day_daybook;

  Procedure cir_rep_route_challan(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     pperiod        in number,
     prmode         in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts)
  As
      vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vquery     varchar2(4000);
  Begin
    --insert into test1(vstring,vstring2) values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');
    --insert into test1(vstring,vstring2) values('2222 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
    --vvar:=substr(vvar,1,length(vvar)-1);
    --insert into test1(vstring,vstring2) values('1 '||vvar,' vsupdate '||vsupdate);commit;

        if vvar is null then
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        else
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('2 '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_route_challan;

procedure cir_rep_dist_challan(
   pcomp_code       in varchar2,
   punit_code       in varchar2,
   pperiod          in number,
   prmode           in varchar2,
   psupdate         in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2,
   p_accounts       out t_accounts)
   As
     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn_1--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
Begin
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');

    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
        if vvar is null then
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        else
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('DIST '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_dist_challan;

    procedure cir_rep_taluka_challan(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        pperiod        in number,
        prmode         in varchar2,
        psupdate       in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     As

     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
    Begin
        vsupdate:=to_date(psupdate,''''||pdateformat||'''');

        open cur_edtn;
        loop
            fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
                    if vvar is null then
                  vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    else
                        vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    end if;
        end loop;
        close cur_edtn;
        if vvar is null then
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        else
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        end if;
        --insert into tes t1(vstring,vstring2) values('TALUKA '||vquery,null);commit;
        open p_accounts for vquery;

    End cir_rep_taluka_challan;

    procedure cir_route_wise_supply(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        ppubl          in varchar2,
        pmainedtn      in varchar2,
        pedtn          in varchar2,
        proute         in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts,
        p_accounts1    out t_accounts,
        p_accounts2    out t_accounts,
        p_accounts3    out t_accounts)
     As
        vfrom_supdate    date;
        vtill_supdate    date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno,
               cir_get_supply_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,ppubl,pedtn,cir_dbksup.agcd,cir_dbksup.dpcd) supply_seqno
               from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,
                           cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code,supply_seqno ,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               sum(sup_copy),cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                       order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
    End cir_route_wise_supply;

    procedure cir_dist_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vfrom_supdate  date;
     vtill_supdate  date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.dist_code,cir_agmast.state_code,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_agmast.state_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
  End cir_dist_wise_supply;

    procedure cir_taluka_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vsupdate date;
     vsupdate1 date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.tehsil_taluka
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_taluka_wise_supply;


    procedure cir_dist_taluka_wise_sup(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts,
     p_accounts4    out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
        cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
        sum(sup_copy) from cir_dbksup,cir_agmast
        where cir_dbksup.comp_code = cir_agmast.comp_code and
        cir_dbksup.unit_code = cir_agmast.unit and
        cir_dbksup.agcd = cir_agmast.agcd and
        cir_dbksup.dpcd = cir_agmast.dpcd and
        cir_dbksup.comp_code = pcomp_code and
        cir_dbksup.unit_code = punit_code and
        cir_dbksup.publ = ppubl and
        ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
        cir_dbksup.supdate between vsupdate and vsupdate1 and
        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
        group by cir_dbksup.comp_code,cir_dbksup.unit_code,
        cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka
        order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
               cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.state_code,cir_agmast.dist_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts3 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts4 for
        select cir_dbksup.comp_code comp_code, sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_dist_taluka_wise_sup;

     procedure cir_supply_comp(
         pcomp_code     in varchar2,
         punit_code     in varchar2,
         ppublication   in varchar2,
         psupdate       in varchar2,
         psupdate1      in varchar2,
         pdateformat    in varchar2,
         pextra1        in varchar2,
         pextra2        in varchar2,
         p_accounts     out t_accounts,
         p_accounts1    out t_accounts,
         p_accounts2    out t_accounts,
         p_accounts3    out t_accounts)
     as
        vsupdate     date;
        vsupdate1    date;
     begin
        vsupdate    :=to_date(psupdate,''''||pdateformat||'''');
        vsupdate1   :=to_date(psupdate1,''''||pdateformat||'''');
        --insert into test1(vstring,vstring2) values(pcomp_code||','||punit_code||','||ppublication,psupdate||','||pdateformat||','||pextra1||','||','||pextra2); commit;
        open p_accounts for
             select comp_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"= unit_code) unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,edtn_name,edtn_name_oth_lang,
             main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             prev_sup,curr_sup,nvl(curr_sup,0)-nvl(prev_sup,0) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno,cir_get_edtn_seqno(comp_code,edtn) edtn_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               order by unit_code,publ_seqno,publ_name,mainedtn_seqno,main_edtn_name,edtn_seqno,edtn_name;

        open p_accounts1 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno
             from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code,main_edtn
                               order by unit_code,publ_seqno,publ_name,mainedtn_seqno,main_edtn_name;
        open p_accounts2 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code
                               order by unit_code,publ_seqno,publ_name;

             open p_accounts3 for
             select comp_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code=cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ
                               order by publ_seqno,publ_name;

     End cir_supply_comp;

    procedure cir_route_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    proute              in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,--it is use for finalised or unfinalised
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate     date;
     vseconddate    date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(base_supply),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        else
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and cir_supply.unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd                 =   a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn                     =      a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        else
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code                =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')                =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit     =   b.unit and cir_supply.agcd          =     a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          =     a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
                open p_accounts2 for----comp wise total
                     select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                     decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                     (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   pcomp_code and unit_code =   punit_code and
                                             publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                             supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                             (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and unit_code =    punit_code and
                                             publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                             supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                                 where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code;
        end if;

   End cir_route_supply_variance_p;

    procedure cir_dist_supply_variance_p(
        pcomp_code          in varchar2,
        punit_code          in varchar2,
        ppublication        in varchar2,
        pmainedtn           in varchar2,
        pedtn               in varchar2,
        pdist               in varchar2,
        pfirstdate          in varchar2,
        pseconddate         in varchar2,
        pdateformat         in varchar2,
        pextra1             in varchar2,--it is use for finalised or unfinalised
        pextra2             in varchar2,--it is used for supply type
        p_accounts          out t_accounts,
        p_accounts1         out t_accounts,
        p_accounts2         out t_accounts)
   As
     vfirstdate             date;
     vseconddate            date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                     cir_supply.agcd  =    a.agcd and
                                     cir_supply.dpcd  =    a.dpcd and
                                     cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                     (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         supdate      =    vseconddate and
                                     cir_dbksup.agcd  =    a.agcd and
                                     cir_dbksup.dpcd  =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                   order by comp_code,dist_code,ag_name;
        else
                open p_accounts for
                     select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                     cir_get_city(comp_code,city_code) "CITY NAME",
                     dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                            (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                       order by comp_code,dist_code,ag_name;            
        end if;
        
        if upper(pextra1)='U' then
        open p_accounts1 for----district wise total
             select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                          (select nvl(sum(sup_copy),0) from cir_supply
                               where comp_code    =    pcomp_code and
                                     unit    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     nvl(supply_flag,'N')=    'Y' and
                             cir_supply.agcd =    a.agcd and
                             cir_supply.dpcd =    a.dpcd and
                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     supdate        =    vseconddate and
                                 cir_dbksup.agcd                 =    a.agcd and
                                 cir_dbksup.dpcd                 =    a.dpcd and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                 (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_dist_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,dist_code,dist_name,dist_oname
                               order by comp_code,dist_code;
             else
                open p_accounts1 for----district wise total
                     select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ         =    ppublication and
                                             (edtn        =    pedtn or pedtn is null) and
                                             supdate      =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 
                                         where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,dist_code,dist_name,dist_oname
                                       order by comp_code,dist_code;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')      =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                         (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                         cir_dbksup.agcd                 =    a.agcd and
                         cir_dbksup.dpcd                 =    a.dpcd and
                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
            else
                open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                        cir_dbksup.agcd =    a.agcd and
                                        cir_dbksup.dpcd =    a.dpcd and
                                        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                        (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;

            end if;
   End cir_dist_supply_variance_p;

    procedure cir_taluka_supply_variance_p(
    pcomp_code       in varchar2,
    punit_code       in varchar2,
    ppublication     in varchar2,
    pmainedtn        in varchar2,
    pedtn            in varchar2,
    ptaluka          in varchar2,
    pfirstdate       in varchar2,
    pseconddate      in varchar2,
    pdateformat      in varchar2,
    pextra1          in varchar2,--it is use for finalised or unfinalised
    pextra2          in varchar2,--it is used for supply type
    p_accounts       out t_accounts,
    p_accounts1      out t_accounts,
    p_accounts2      out t_accounts)
   As
     vfirstdate      date;
     vseconddate     date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit    =    punit_code and
                                         cir_supply.publ    =    ppublication and
                                         (cir_supply.edtn   =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;
             else
                open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                            cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;             
             
             end if;
        if upper(pextra1)='U' then
            open p_accounts1 for----taluka wise total
                 select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit         =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                   order by comp_code,tehsil_taluka;
              else
                open p_accounts1 for----taluka wise total
                     select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                       order by comp_code,tehsil_taluka;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit        =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn         =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =    'Y' and
                                             cir_supply.agcd =    a.agcd and
                                             cir_supply.dpcd =    a.dpcd and
                                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
            open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
            (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ    =    ppublication and
                                     (edtn   =    pedtn or pedtn is null) and
                                     supdate =    vfirstdate and
                             cir_dbksup.agcd =    a.agcd and
                             cir_dbksup.dpcd =    a.dpcd and
                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn        =    pedtn or pedtn is null) and
                                     supdate      =    vseconddate and
                                     cir_dbksup.agcd                 =    a.agcd and
                                     cir_dbksup.dpcd                 =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;
        end if;
   End cir_taluka_supply_variance_p;

    procedure cir_edition_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate         date;
     vseconddate        date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate   :=to_date(pseconddate,''''||pdateformat||'''');
        open p_accounts for
             select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
             cir_get_city(comp_code,city_code) "CITY NAME",
             edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                         cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME",unit_code "UNIT CODE" from
                    (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                     c.station_code station_code,c.branch_code branch_code,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                    cir_dbksup.agcd =  a.agcd and
                                    cir_dbksup.dpcd =  a.dpcd and
                                    cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                 (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,edtn,edtn_name,edtn_name_oth_lang,station_code,branch_code
                               order by comp_code,unit_code,edtn_name,ag_name;

        open p_accounts1 for----Edition wise total
             select comp_code "COMP CODE",edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,edtn,edtn_name,edtn_name_oth_lang
                               order by comp_code,edtn_name;

        open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    d.edtn in(select distinct edtn from cir_edtn_mast where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;

   End cir_edition_supply_variance_p;

   procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts)
    as
     vfrom_supdate      date;
     vtill_supdate      date;
     cursor cur_sup_type is
         select 'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) "'||sup_ty_name||'",' vty,
         'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) +' vty_sum
      from cir_supply_type_mast
      where comp_code=pcomp_code /*and sup_ty_code in(select distinct sup_type_code from cir_dbksup
      where comp_code=pcomp_code and unit_code=punit_code and
                  ((publ=ppubl) or (ppubl is null)) and ((edtn=pedtn) or (pedtn is null)) and
                  supdate between vfrom_supdate and vtill_supdate)*/
      order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar           varchar2(4000);
     vvar_sum       varchar2(4000);
     vquery         varchar2(4000);
     vquery1        varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar        :=substr(vvar,1,length(vvar)-1);
    vvar_sum    :=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);

    vquery:=' select comp_code AS "COMP_CODE",unit_code AS "UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS "PUBL_NAME",sup_rate as "SUP_RATE", supdate AS "SUPDATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by comp_code,unit_code,publ_name,supdate,sup_rate';
      --          insert into test1(vstring) values ('11'||vquery);commit;
      open p_accounts for vquery;

      vquery1:=' select comp_code AS "COMP_CODE",sup_rate as "SUP_RATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    --insert into test1(vstring) values ('22'||vquery1);commit;
      open p_accounts1 for vquery1;
  End cir_rep_supply_unit;

procedure cir_dist_taluka_publ_wise(
     pcompcode      in varchar2,
     punitcode      in varchar2,
     pbrancode      in varchar2,
     ppublcode      in varchar2,
     pmainedtn      in varchar2,
     pedtncode      in varchar2,
     pdistcode      in varchar2,
     ptalukacode    in varchar2,
     pagtypecode    in varchar2,
     pagclasscode   in varchar2,
     pagcd          in varchar2,
     pdpcd          in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     plangtype      in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is used for agency supply type
     pextra2        in varchar2,--it is used for break on district/taluka wise or datewise(1/2)
     p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(32000);
      v_query1    varchar2(32000);
      
     cursor cur_edtn is
        select distinct d.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (m.agcd=pagcd or pagcd is null) and (m.dpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='S'
        union
        select p.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (d.billagcd=pagcd or pagcd is null) and (d.billdpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='B'
        order by publ_seqno,publ,edtn_seqno,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(8000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        delete test1;insert into test1(vstring,vstring2)
        values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;

        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            /*if vvar is null then
                vvar        :='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',sup_copy,0))"'||rec_edtn.edtn||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn||'") "'||rec_edtn.edtn||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',sup_copy,0))"'||rec_edtn.edtn||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn||'") "'||rec_edtn.edtn||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn||'"';
            end if;*/
            
            if vvar is null then
                vvar        :='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
                        
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
       -- insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise ',vvar||' , '||vvar_sum1);commit;
        if pextra2='2' then--for datewise
            if vvar is null then
                v_query:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,d.supdate,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                union ';
                v_query1:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
            else
                v_query:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                union ';
                --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;
                v_query1:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,supdate,agency_name';
            end if;
        else--- for district/taluka wise
            if vvar is null then
                v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                union ';
                v_query1:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,dist_name,taluka_name,agcd,dpcd,agency_name';
            else
                v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                union ';
                --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;
                v_query1:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,dist_name,taluka_name,agency_name';
            end if;


        end if;

        --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;

        open p_accounts for v_query||v_query1;

    End cir_dist_taluka_publ_wise;

    procedure cir_datewise_resale(
        pcompcode      in varchar2,
        punitcode      in varchar2,
        pbrancode      in varchar2,
        ppublcode      in varchar2,
        pmainedtn      in varchar2,
        pedtncode      in varchar2,
        pdistcode      in varchar2,
        ptalukacode    in varchar2,
        pagtypecode    in varchar2,
        pagclasscode   in varchar2,
        pagcd          in varchar2,
        pdpcd          in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        plangtype      in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(8000);
     cursor cur_edtn is
        select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
         case when plangtype='1' then
          substr(p.edition_nick,1,15)
         else
          substr(p.edtn_name_oth_lang,1,20)
         end edtn_name,d.sup_rate sup_rate,p.main_edtn main_edtn
        from cir_agmast m,cir_dbksup_resale d ,cir_edtn_mast p
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and m.unit=d.unit_code and 
              m.unit=p.unit_code and d.unit_code = punitcode and
              d.supdate >= vsupdate and d.supdate <=vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and m.agcd=nvl(pagcd,m.agcd) and m.dpcd=nvl(pdpcd,m.dpcd) and d.publ=nvl(ppublcode,d.publ) and
              d.publ=p.publ and d.edtn=p.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
              (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (d.resale_branch=pbrancode or pbrancode is null)
        order by publ,main_edtn,edtn_seqno,edtn,sup_rate;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
     vquery     varchar2(8000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        --delete test1;insert into test1(vstring,vstring2)
        --values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;
        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            if vvar is null then
                --vvar    :='decode(u.edtn||u.copy_rate,'||''''||rec_edtn.edtn||rec_edtn.copy_rate||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                --tot_vvar:=',sum("'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'") "'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                
                vvar        :='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
        --insert into test1(vstring,vstring2) values('cir_datewise_resale ',vvar||' , '||vvar_sum1);commit;

        if vvar is null then
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.agcd agcd,d.dpcd dpcd,d.supdate supdate,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
        else
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate supdate,d.agcd agcd,d.dpcd dpcd,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name,'||vvar||' from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agency_name';
        end if;

        --insert into test1(vstring,vstring2) values('cir_datewise_resale v_query',v_query);commit;

        open p_accounts for v_query;

    End cir_datewise_resale;
END cir_rep_supply;
/

                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE PACKAGE Cir_SupplyEdtn_Bind IS
  TYPE T_Circul_Cursor is Ref Cursor;
  procedure cir_supply_edtnbind_p(
  	pcompcode in varchar2,
  	punitcode in varchar2,
  	ppublcode in varchar2,
  	pagencycode in varchar2,
  	pagencysubcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
  	p_circuls out T_Circul_Cursor);
END Cir_SupplyEdtn_bind;
/
CREATE OR REPLACE PACKAGE BODY Cir_SupplyEdtn_Bind IS
  procedure cir_supply_edtnbind_p(
  	pcompcode in varchar2,
  	punitcode in varchar2,
  	ppublcode in varchar2,
  	pagencycode in varchar2,
  	pagencysubcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
  	p_circuls out T_Circul_Cursor)
  	As
  Begin
  	if upper(pextra2)='D' then
    open p_circuls for
  	   select distinct a.publ publ,b.publ_name publ_name,c.edtn edtn,c.edtn_name edtn_name
  		     from cir_supply_dis a,cir_publ_mast b ,cir_edtn_mast c
  		          where a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=pcompcode and
  					    a.unit=c.unit_code and a.unit=punitcode and 
                        a.publ=b.publ and a.publ=c.publ and (a.publ=ppublcode or ppublcode is null) and
                        a.edtn=c.edtn and 
  					    a.agcd=pagencycode and a.dpcd=pagencysubcode and
                        nvl(b.freeze_flag,'N')='N' and nvl(c.freeze_flag,'N')='N';
     else
    open p_circuls for
  	   select distinct a.publ publ,b.publ_name publ_name,c.edtn edtn,c.edtn_name edtn_name
  		     from cir_supply a,cir_publ_mast b ,cir_edtn_mast c
  		          where a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=pcompcode and
  					    a.unit=c.unit_code and a.unit=punitcode and 
                        a.publ=b.publ and a.publ=c.publ and (a.publ=ppublcode or ppublcode is null) and
                        a.edtn=c.edtn and 
  					    a.agcd=pagencycode and a.dpcd=pagencysubcode and
                        nvl(b.freeze_flag,'N')='N' and nvl(c.freeze_flag,'N')='N';     
     end if;
  End cir_supply_edtnbind_p;
END Cir_SupplyEdtn_bind;
/


/***************************laxman sir 4768 21/09/2011 ***************************************/
                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE Function cir_get_waste_rate(
    pcomp_code    in varchar2,
    punit_code    in varchar2,
    pedtn_code    in varchar2,
    psup_date     in varchar2,
    pdateformat   in varchar2) return number is

    vsup_date  date;
    v_publ varchar2(10);

    cursor cur_rate is
        select sun_rate,mon_rate,tue_rate,wed_rate,thu_rate,fri_rate,sat_rate from cir_waste_rate_mast
        where comp_code=pcomp_code and unit_code=punit_code and publ=v_publ and edtn=pedtn_code and
            valid_from=(select max(valid_from) from cir_waste_rate_mast where comp_code=pcomp_code and
            unit_code=punit_code and publ=v_publ and edtn=pedtn_code and valid_from<=vsup_date);
    cur_rate_rec cur_rate%rowtype;

    v_edtn_rate number(15,4);
begin
    vsup_date:=to_date(psup_date,''''||pdateformat||'''');

    select distinct publ into v_publ from cir_edtn_mast
        where comp_code=pcomp_code and edtn=pedtn_code;

    open cur_rate;--cursor open for regular rate
    fetch cur_rate into cur_rate_rec;
    close cur_rate;

    if to_char(vsup_date,'DY') = 'SUN' then   ---for sunday edition rate
      v_edtn_rate  := cur_rate_rec.sun_rate;
    elsif to_char(vsup_date,'DY') = 'MON' then ---for monday edition rate
        v_edtn_rate  := cur_rate_rec.mon_rate;
    elsif to_char(vsup_date,'DY') = 'TUE' then ---for tueday edition rate
        v_edtn_rate  := cur_rate_rec.tue_rate;
    elsif to_char(vsup_date,'DY') = 'WED' then ---for wednesday edition rate
        v_edtn_rate  := cur_rate_rec.wed_rate;
    elsif to_char(vsup_date,'DY') = 'THU' then ---for Thursday edition rate
        v_edtn_rate  := cur_rate_rec.thu_rate;
    elsif to_char(vsup_date,'DY') = 'FRI' then ---for friday edition rate
        v_edtn_rate  := cur_rate_rec.fri_rate;
    elsif to_char(vsup_date,'DY') = 'SAT' then ---for saturday edition rate
        v_edtn_rate  := cur_rate_rec.sat_rate;
    else
        v_edtn_rate  := 0;
    end if;

    return v_edtn_rate;
END cir_get_waste_rate;
/
/********************************************laxman sir*************************************/

/****************************************issue no. 4653 21/9/11***************************/
CREATE OR REPLACE PACKAGE Wesp_Updatedate
IS
PROCEDURE      Wesp_Updatedate_p(
compcode IN VARCHAR2,
userid IN VARCHAR2,
dateformat IN VARCHAR2,
code IN VARCHAR2,
curr IN VARCHAR2,
RATECODE11 IN VARCHAR2,
solo  IN VARCHAR2,
breakup VARCHAR2,
bwcode IN VARCHAR2,
rostatus IN VARCHAR2,
filename IN VARCHAR2,
tfn IN NUMBER,
insertbreak IN VARCHAR2,
prem IN VARCHAR2,
dealtype IN VARCHAR2,
pre IN VARCHAR2,
suff IN VARCHAR2,
financestatus IN  VARCHAR2,
voucherst IN VARCHAR2,
adcode IN VARCHAR2,
rodatetime IN VARCHAR2,
spacearea IN VARCHAR2,
vat IN VARCHAR2,
bookstat IN VARCHAR2,
cio_id IN VARCHAR2,
receipt_no IN VARCHAR2,
uom IN VARCHAR2,
bgcolor IN VARCHAR2,
validdate IN VARCHAR2,
agencyratecode IN VARCHAR2,
AUDIT1 IN VARCHAR2,
book_insert_date IN VARCHAR2,
agencycomm IN VARCHAR2,
rateaudit IN VARCHAR2,
billaudit IN VARCHAR2,
bill_type IN VARCHAR2,
invoice_no1 IN VARCHAR2,
copybooking IN VARCHAR2,
ratecompany IN VARCHAR2,
addagenycomm IN VARCHAR2,
agencycommlinkretainer IN VARCHAR2,
subeditionr IN VARCHAR2,
displaybilltype IN VARCHAR2,
classifiedbilltype IN VARCHAR2,
billformat IN VARCHAR2,
ratechk IN VARCHAR2,
allpkg IN VARCHAR2,
dayrate1 in varchar2,
schemetype in varchar2,
PIncludeclassi in varchar2,
receiptformat IN VARCHAR2,
v_cash_receipt in varchar2,
v_bill_orderwiselast in varchar2,
v_floor_chk in varchar2,
Unsoldflag in varchar2,
Supplystopper in  number,
drpRokeychk in varchar2,
Agencycomm_seq in varchar2,
creditreciept in varchar,
cashindisplay IN VARCHAR,
cashinclassified IN VARCHAR,
v_rate_audit_pref in varchar,
v_barcoding_allow_pref in varchar2,
v_fmgbills IN VARCHAR2,
v_billed_cashdis in varchar2,
v_billed_cashcls in varchar,
v_drpbackdate in varchar,
dockitbooking in varchar2,
allowprevbooking in varchar2,
ro_wisecashbill in varchar2,
chkval in varchar2,
approval1 in varchar2,
pckstatus in varchar2,
cash_disc in varchar2,
cash_amt in varchar2,
seperate_cashier1 in varchar2,
disp_bill in varchar2,
clas_bill in varchar2,
mantimepost in varchar2,
bkdaypost in number,
maxterutn in number,
cir_return in varchar2,
noofchkbounc in number,
noofdaychkrec in number,
retday in number,
chngsuppord in number,
max_publishday in number,
p_billno_period in varchar,
spl_trans_edit in varchar2,
spl_dis_trans_editable in varchar2,
mul_pac_sel_trans in varchar2,
shmon_minword in varchar2,
tradon_spcrg in varchar2,
rateauth     in varchar2,
f2day in number,
rateauditmodify in varchar,
bindrevenuecenter in varchar,
p_led_allow in varchar,
p_clear_allow in varchar,
repeatday in varchar,
premiumedit in varchar,
P_BILL_GENERATION in varchar,
P_PUBLICATION_CENTER in varchar,
P_allow_discount_prem IN VARCHAR,
P_SCHEME_BILLING in varchar,
P_ALLOW_PDC in varchar,
PAD_TYPE_FOR_MANUL_BILL in varchar,
RO_OUTSTAND_P IN VARCHAR2


);
END      Wesp_Updatedate;
/





CREATE OR REPLACE PACKAGE BODY Wesp_Updatedate IS
PROCEDURE      Wesp_Updatedate_p(
compcode IN VARCHAR2,
userid IN VARCHAR2,
dateformat IN VARCHAR2,
code IN VARCHAR2,
curr IN VARCHAR2,
RATECODE11 IN VARCHAR2,
solo  IN VARCHAR2,
breakup VARCHAR2,
bwcode IN VARCHAR2,
rostatus IN VARCHAR2,
filename IN VARCHAR2,
tfn IN NUMBER,
insertbreak IN VARCHAR2,
prem IN VARCHAR2,
dealtype IN VARCHAR2,
pre IN VARCHAR2,
suff IN VARCHAR2,
financestatus IN  VARCHAR2,
voucherst IN VARCHAR2,
adcode IN VARCHAR2,
rodatetime IN VARCHAR2,
spacearea IN VARCHAR2,
vat IN VARCHAR2,
bookstat IN VARCHAR2,
cio_id IN VARCHAR2,
receipt_no IN VARCHAR2,
uom IN VARCHAR2,
bgcolor IN VARCHAR2,
validdate IN VARCHAR2,
agencyratecode IN VARCHAR2,
AUDIT1 IN VARCHAR2,
book_insert_date IN VARCHAR2,
agencycomm IN VARCHAR2,
rateaudit IN VARCHAR2,
billaudit IN VARCHAR2,
bill_type IN VARCHAR2,
invoice_no1 IN VARCHAR2,
copybooking IN VARCHAR2,
ratecompany IN VARCHAR2,
addagenycomm IN VARCHAR2,
agencycommlinkretainer IN VARCHAR2,
subeditionr IN VARCHAR2,
displaybilltype IN VARCHAR2,
classifiedbilltype IN VARCHAR2,
billformat IN VARCHAR2,
ratechk IN VARCHAR2,
allpkg IN VARCHAR2,
dayrate1 in varchar2,
schemetype in varchar2,
PIncludeclassi in varchar2,
receiptformat IN VARCHAR2,
v_cash_receipt in varchar2,
v_bill_orderwiselast in varchar2,
v_floor_chk in varchar2,
Unsoldflag in varchar2,
Supplystopper in  number,
drpRokeychk in varchar2,
Agencycomm_seq in varchar2,
creditreciept in varchar,
cashindisplay IN VARCHAR,
cashinclassified IN VARCHAR,
v_rate_audit_pref in varchar,
v_barcoding_allow_pref in varchar2,
v_fmgbills IN VARCHAR2,
v_billed_cashdis in varchar2,
v_billed_cashcls in varchar,
v_drpbackdate in varchar,
dockitbooking in varchar2,
allowprevbooking in varchar2,
ro_wisecashbill in varchar2,
chkval in varchar2,
approval1 in varchar2,
pckstatus in varchar2,
cash_disc in varchar2,
cash_amt in varchar2,
seperate_cashier1 in varchar2,
disp_bill in varchar2,
clas_bill in varchar2,
mantimepost in varchar2,
bkdaypost in number,
maxterutn in number,
cir_return in varchar2,
noofchkbounc in number,
noofdaychkrec in number,
retday in number,
chngsuppord in number,
max_publishday in number,
p_billno_period in varchar,
spl_trans_edit in varchar2,
spl_dis_trans_editable in varchar2,
mul_pac_sel_trans in varchar2,
shmon_minword in varchar2,
tradon_spcrg in varchar2,
rateauth     in varchar2,
f2day in number,
rateauditmodify in varchar,
bindrevenuecenter in varchar,
p_led_allow in varchar,
p_clear_allow in varchar,
repeatday in varchar,
premiumedit in varchar,
P_BILL_GENERATION in varchar,
P_PUBLICATION_CENTER in varchar,
P_allow_discount_prem IN VARCHAR,
P_SCHEME_BILLING in varchar,
P_ALLOW_PDC in varchar,
PAD_TYPE_FOR_MANUL_BILL in varchar,
RO_OUTSTAND_P IN VARCHAR2



)AS
BEGIN
UPDATE LOGIN SET "date_format"=dateformat, "Autogenerate"=code,"curr_code"=curr WHERE "COM_CODE"=compcode;
COMMIT;
        UPDATE PREFERRENCES SET  "autogenerated"=code,
"currency_code"=curr ,
"rate_gr_code"=RATECODE11,
"date_format"=dateformat,"solo"=solo,"breakup"=breakup,
"blackwhitecode"=bwcode,"rostatus"=rostatus,"File_name"=filename,"Tfn"=tfn,
"Insert_breakup"=insertbreak,"Premium_type"=prem,"Deal_type"=dealtype  ,
 "prefix"=pre, "suffix"=suff, "financestatus"=financestatus , "voucherst"=voucherst,
 "Ad_category"=adcode ,"Ro_datetime"=rodatetime ,"Space_area"=spacearea,"Vat"=vat,
 "Booking_status"=bookstat,"Cio_id"=cio_id,"Receipt_no"=receipt_no,"uom_code"=uom,
 "Bgcolor_publication"=bgcolor ,"chkfor_valid_pubdates"=validdate, "Agency_ratecode"=agencyratecode,
  "audit"=AUDIT1,"book_insert_date"=book_insert_date,"agencycomm"=agencycomm,
  "rate_audit"=rateaudit,"bill_audit"=billaudit,"billtype"=bill_type,"invoice_no"=invoice_no1,
  "copy_booking"=copybooking,"RATE_COMPANY_AGENCY"=ratecompany, "ADDITIONAL_AGENCY_COMM"=addagenycomm ,
  "AGENCY_RETAINER_COMM"=agencycommlinkretainer,"SUBEDITIONRATE"=subeditionr,
  "CLS_BILLTYPE"=classifiedbilltype,"DIS_BILLTYPE"=displaybilltype,"BILLING_FORMAT"=billformat,
  "RATE_CHECK"=ratechk,"ALL_PACKAGE"=allpkg,"DAYRATE"=dayrate1,"SCHEME_TYPE"=schemetype,"DISP_CLSBILL"=PIncludeclassi   ,
  "CASH_RECEIPT_BILL"=v_cash_receipt, "BILL_ORDERWSLAST"=v_bill_orderwiselast, "FLOOR_CHK"=v_floor_chk ,
  "UNSOLD_ENTRY_FLAG"=Unsoldflag ,"SUPPLY_STOP_PERCENTAGE"=Supplystopper,"ROKEYCHECK"=drpRokeychk ,
  "AGENCYCOMM_SEQ_COM"=Agencycomm_seq ,"CREDIT_RECIPT"=creditreciept,"DISP_CASHBILL"=cashindisplay,
  "CLA_CASHBILL"=cashinclassified,"RATE_AUDIT_PREF"=v_rate_audit_pref,"BARCODING_ALLOWED"=v_barcoding_allow_pref,
  "FMG_BILL_DIS" =v_fmgbills, "BILL_DISP_CASHBILL"=v_billed_cashdis , "BILL_CLA_CASHBILL"=v_billed_cashcls,"BACKDATERECEIPT"=v_drpbackdate,"DOCKIT_BOOKING"=dockitbooking,"Allowed_old_date"=allowprevbooking,"ROWISE_CASHBOOKING"=ro_wisecashbill,"CUTOFFTIME"=chkval,"APPROVAL"=approval1,"BACK_DAYS"=pckstatus ,CASH_DISCOUNT=cash_amt,CASH_DISCOUNTTYPE=cash_disc,SEPRATE_CASHIER=seperate_cashier1,
   CIR_MANY_TIME_POSTING=mantimepost, CIR_BACKDAYS_POSTING=bkdaypost, CIR_MAX_RETURN_ALLOW=maxterutn, CIR_RETURN_LIMIT_ALLOW=cir_return, CIR_NO_OF_CHQBOUNCE=noofchkbounc, CIR_DAYS_CHQBOUNCE=noofdaychkrec, CIR_RETURN_DAYS=retday, CIR_SUP_ORDER_LIMIT=chngsuppord, DISP_BILLING_CRITERIA=disp_bill, CLSD_BILLING_CRITERIA=clas_bill,MAX_PUBLISHDAYS=max_publishday,BILLNO_PERIODICITY=p_billno_period,
   SPECIALDISC_TRANS_EDIT=spl_trans_edit, SHARING_TRANS=spl_dis_trans_editable, MULTIPACKAGE_SEL_TRANS=mul_pac_sel_trans,SCHEME_MINWORD=shmon_minword, TRADE_SPLCHARGE=tradon_spcrg,RATE_AUTHORIZATION=rateauth
  ,F2_RECORD=f2day,PUBLISHAD_EDIT_RATEAUDIT=rateauditmodify,BINDREVENUE_CENTER=bindrevenuecenter,  
  FA_LEDGER_ALLOW=p_led_allow ,CLEARANCE_TYPE_ALLOW=p_clear_allow,REPEAT_DAY_TYPE=repeatday,PREMIUM_EDIT=premiumedit,
BILL_GENERATION_PRIOR=P_BILL_GENERATION,PUBLICATION_HO=P_PUBLICATION_CENTER,SPLDISC_ALLOWPREM=P_allow_discount_prem,

BILL_SCHEME=P_SCHEME_BILLING,ALLOWED_PDC_DAYS_RECEIPT=P_ALLOW_PDC ,AD_TYPE_MANUL_BILL=PAD_TYPE_FOR_MANUL_BILL,OUTSTANDING_AMT_CRITERIA=RO_OUTSTAND_P
  
   WHERE "comp_code"=compcode;
COMMIT;
END      Wesp_Updatedate_p;
END      Wesp_Updatedate;
/

/****************************************issue no. 4653 21/9/11***************************/


/****************************************issue no. 4768 21/9/11***************************/

CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_rep_supply IS
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts)
     As

     vfrom_supdate    date;
     vtill_supdate    date;
     cursor cur_sup_type is
         select 'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) "'||sup_ty_name||'",' vty,
         'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) +' vty_sum
      from cir_supply_type_mast
      where comp_code=pcomp_code /*and sup_ty_code in(select distinct sup_type_code from cir_dbksup
      where comp_code=pcomp_code and unit_code=punit_code and
                  ((publ=ppubl) or (ppubl is null)) and ((edtn=pedtn) or (pedtn is null)) and
                  supdate between vfrom_supdate and vtill_supdate)*/
      order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar         varchar2(4000);
     vvar_sum    varchar2(4000);
     vquery     varchar2(4000);
     vquery1     varchar2(4000);
     vquery2     varchar2(4000);
     vquery3     varchar2(4000);
     vquery4     varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);commit;

    vquery:=' select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,cir_get_edtn_name(comp_code,edtn) edtn_name,route_code,cir_get_route_name(comp_code,unit_code,route_code) route_name,agcd "AGENCY CODE",dpcd "AGENCY SUBCODE",
    substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",(select cir_get_city(m.comp_code,m.city_code) city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY NAME",
    (select nvl(CIR_GET_NAME.CIR_CITY(m.comp_code,m.city_code,2,'||''''||pdateformat||''''||','''',''''),''NA'') city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY ONAME",/*supdate,*/'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||') and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
               edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/ order by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/';
     ---insert into test1(vstring) values ('1'||vquery);commit;
      open p_accounts for vquery;

      vquery2:=' select comp_code,unit_code,publ,edtn,route_code, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
                edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code
                order by comp_code,unit_code,publ,edtn,route_code';
        --insert into test1(vstring) values ('22'||vquery2);commit;
      open p_accounts2 for vquery2;

      vquery3:=' select comp_code,unit_code,publ,edtn, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn
                order by comp_code,unit_code,publ,edtn';
      open p_accounts3 for vquery3;

      vquery4:=' select comp_code,unit_code,publ, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ
                order by comp_code,unit_code,publ';
      open p_accounts4 for vquery4;

      vquery1:=' select comp_code,unit_code,'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code';
        --insert into test1(vstring) values ('2'||vquery);commit;

     open p_accounts1 for vquery1;
  End cir_rep_supply1;

procedure cir_rep_supply_po(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is use for finalised or unfinalised
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts) as
     v_date             date;
     cursor cur_sup_type is
         select 'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) "'||sup_ty_name||'",' vty,
             'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) +' vty_sum,sup_seq_no
             from cir_supply_type_mast
             where comp_code=pcomp_code and (upper(pextra1)!='U' or pextra1 is null)
         union
         select 
            case when to_char(v_date,'DY')='SUN' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sun,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='MON' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_mon,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='TUE' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_tue,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='WED' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_wed,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='THU' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_thu,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='FRI' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_fri,0),0)) "'||sup_ty_name||'",'
            else
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sat,0),0)) "'||sup_ty_name||'",'
            end vty,
            
            case when to_char(v_date,'DY')='SUN' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sun,0),0)) +'
            when to_char(v_date,'DY')='MON' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_mon,0),0)) +'
            when to_char(v_date,'DY')='TUE' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_tue,0),0)) +'
            when to_char(v_date,'DY')='WED' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_wed,0),0)) +'
            when to_char(v_date,'DY')='THU' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_thu,0),0)) +'
            when to_char(v_date,'DY')='FRI' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_fri,0),0)) +'
            else
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sat,0),0)) +'
            end  vty_sum,
            --'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',d.base_supply,0)) "'||sup_ty_name||'",' vty,
             --'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',d.base_supply,0)) +' vty_sum,
             sup_seq_no
             from cir_supply_type_mast
             where comp_code=pcomp_code and upper(pextra1)='U'
             order by sup_seq_no;
     rec_sup_type cur_sup_type%rowtype;

cursor cur_dbk is
            select x.comp_code comp_code,x.unit_code unit_code,x.supdate supdate,x.publ_name publ_name,x.mainedtn_name mainedtn_name,
            x.main_edtn_seqno main_edtn_seqno,x.edtn_name edtn_name,x.edtn_seq_no edtn_seq_no,x.sup_ty_name sup_ty_name,
            x.sup_seq_no sup_seq_no,x.sup_rate sup_rate,x.supply_copy supply_copy,x.supl_name supl_name,x.pgno pgno from
            (select d.comp_code comp_code,d.unit_code unit_code,d.supdate supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seq_no,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seq_no,d.sup_rate sup_rate, sum(d.sup_copy) supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit_code,e.edtn,d.supdate,pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(d.supdate,'DY')='SUN' then min(e.pgno_sun)
                when to_char(d.supdate,'DY')='MON' then min(e.pgno_mon)
                when to_char(d.supdate,'DY')='TUE' then min(e.pgno_tue)
                when to_char(d.supdate,'DY')='WED' then min(e.pgno_wed)
                when to_char(d.supdate,'DY')='THU' then min(e.pgno_thu)
                when to_char(d.supdate,'DY')='FRI' then min(e.pgno_fri) else min(e.pgno_sat) end pgno
            from cir_dbksup d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit_code=e.unit_code and (d.unit_code=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supdate =v_date and d.sup_type_code=t.sup_ty_code and upper(pextra1)!='U'
            group by d.comp_code,d.unit_code,d.supdate,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no,d.sup_rate
            union
            select d.comp_code comp_code,d.unit unit_code,v_date supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seq_no,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seq_no,
            cir_get_edtn_rate(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),'dd/mm/yyyy') sup_rate, 
            case when to_char(v_date,'DY')='SUN' then sum(nvl(d.base_supply,0)+nvl(d.supply_sun,0))
                 when to_char(v_date,'DY')='MON' then sum(nvl(d.base_supply,0)+nvl(d.supply_mon,0))
                 when to_char(v_date,'DY')='TUE' then sum(nvl(d.base_supply,0)+nvl(d.supply_tue,0))
                 when to_char(v_date,'DY')='WED' then sum(nvl(d.base_supply,0)+nvl(d.supply_wed,0))
                 when to_char(v_date,'DY')='THU' then sum(nvl(d.base_supply,0)+nvl(d.supply_thu,0))
                 when to_char(v_date,'DY')='FRI' then sum(nvl(d.base_supply,0)+nvl(d.supply_fri,0))
            else sum(nvl(d.base_supply,0)+nvl(d.supply_sat,0)) end supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(v_date,'DY')='SUN' then min(e.pgno_sun)
                when to_char(v_date,'DY')='MON' then min(e.pgno_mon)
                when to_char(v_date,'DY')='TUE' then min(e.pgno_tue)
                when to_char(v_date,'DY')='WED' then min(e.pgno_wed)
                when to_char(v_date,'DY')='THU' then min(e.pgno_thu)
                when to_char(v_date,'DY')='FRI' then min(e.pgno_fri) else min(e.pgno_sat) end pgno
            from cir_supply d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit=e.unit_code and (d.unit=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supply_flag='Y' and d.supply_type_code=t.sup_ty_code and upper(pextra1)='U'
            group by d.comp_code,d.unit,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no) x
            order by comp_code,unit_code,supdate,publ_name,main_edtn_seqno,mainedtn_name,edtn_seq_no,edtn_name,sup_seq_no,sup_ty_name;
        
        rec_dbk cur_dbk%rowtype;
                                            
    vvar        varchar2(4000);
    vvar_sum    varchar2(4000);
    vquery      varchar2(4000);
    vquery1     varchar2(4000);
    v_count     number(5);
    vlength     number(7);
    vrunval     varchar2(8000);
    v_val       varchar2(800);
    v_name      varchar2(8000);
    vno         number:=0;
  Begin
    if upper(pextra1)='U' then  
        v_date:=to_date(trunc(sysdate),''''||pdateformat||'''');
    else
        v_date:=to_date(psupdate,''''||pdateformat||'''');
    end if;    
    
    delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
    delete from cir_ledger_report where sess_id=userenv('sessionid');commit;
    delete from test1;commit;
    open cur_dbk;
    loop
        fetch cur_dbk into rec_dbk;
        exit when cur_dbk%notfound;
        
        v_count:=nvl(v_count,0)+1;
        if rec_dbk.pgno=0 then
            rec_dbk.pgno:=null;
        end if;
        
        vlength :=null; v_val :=null; vrunval :=null; vno:=null;

        v_val   :=replace(rec_dbk.supl_name||'+','+',',');
        vlength :=length(v_val);
        vno:=1;

        for i in 1.. vlength loop
        vrunval:=substr(v_val,i,1);
        if vrunval!=',' then
            v_name:=v_name||vrunval;
        else
            insert into cir_ledger_report(comp_code, unit_code, recptdt,agcd, dpcd, recptno, chq_bank, rec_seqno,sess_id)
                    values (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,v_name,rec_dbk.supply_copy,userenv('sessionid'));
            vno:=vno+1;
            v_name:='';
        end if;
        end loop;
        
        insert into cir_temp_bill_collection
        (comp_code, unit_code, billdt, publ_code, agcd, dpcd, supply_copy, gross_amt, 
        cur_sessionid, agname,return_copy,sec_opbal,remarks)
        values
        (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,rec_dbk.supply_copy,rec_dbk.sup_rate,
        userenv('sessionid'),rec_dbk.sup_ty_name,rec_dbk.pgno,v_count,replace(rec_dbk.supl_name||'+','+',' = '||rec_dbk.supply_copy));
    end loop;
    close cur_dbk;
         
    --delete from test1;commit;
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
                vvar:=vvar||rec_sup_type.vty;
                vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (pextra1||' '||vquery);
    if upper(pextra1)='U' then  
        vquery:=' select d.comp_code comp_code,d.unit unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,e.edtn_name "EDITION NAME",
                to_char(sysdate'||','||''''||pdateformat||''''||') supdate,'||vvar||','||vvar_sum||' TOTAL,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,e.edtn_seq_no edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,cir_get_edtn_supl(d.comp_code,d.unit_code,d.edtn,to_date(sysdate),'||''''||pdateformat||''''||',1,null,null,null,null,null) supl_name from cir_agmast m,cir_supply d,cir_edtn_mast e
                where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.comp_code=m.comp_code and d.unit='||''''||punit_code||''''||' and d.unit=e.unit_code and d.unit=m.unit and d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.publ=e.publ and
                d.supply_flag='||'''Y'''||' and nvl(m.suspend_type,''N'')='||'''N'''||' and d.edtn=e.edtn and d.agcd=m.agcd and d.dpcd=m.dpcd
                group by d.comp_code,d.unit,d.publ,e.main_edtn,d.edtn,sysdate,e.edtn_name,e.edtn_seq_no order by d.comp_code,d.unit,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn';
    else
        vquery:=' select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,e.edtn_name "EDITION NAME",
                to_char(d.supdate'||','||''''||pdateformat||''''||') supdate,'||vvar||','||vvar_sum||' TOTAL,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,e.edtn_seq_no edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,cir_get_edtn_supl(d.comp_code,d.unit_code,d.edtn,d.supdate,'||''''||pdateformat||''''||',1,null,null,null,null,null) supl_name from cir_dbksup d,cir_edtn_mast e
                where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.unit_code='||''''||punit_code||''''||' and d.unit_code=e.unit_code and d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.publ=e.publ /*and ((e.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null))*/ and
                d.supdate='||''''||v_date||''''||' and d.edtn=e.edtn
                group by d.comp_code,d.unit_code,d.publ,e.main_edtn,d.edtn,d.supdate,e.edtn_name,e.edtn_seq_no order by d.comp_code,d.unit_code,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn';
    end if;                    
    --insert into test1(vstring) values ('1 pextra1 '||vquery);commit;

    open p_accounts for vquery;
    if upper(pextra1)='U' then
    vquery1:=' select d.comp_code comp_code,d.unit unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,'||vvar||','||vvar_sum||'TOTAL from cir_agmast m,cir_supply d where d.comp_code=m.comp_code and d.comp_code='||''''||pcomp_code||''''||' and d.unit=m.unit and d.unit='||''''||punit_code||''''||' and
            d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supply_flag='||'''Y'''||' and nvl(m.suspend_type,''N'')='||'''N'''||'
            group by d.comp_code,d.unit,d.publ order by d.comp_code,d.unit,d.publ';
    else
    vquery1:=' select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,'||vvar||','||vvar_sum||'TOTAL from cir_dbksup d where d.comp_code='||''''||pcomp_code||''''||' and d.unit_code='||''''||punit_code||''''||' and
            d.publ=nvl('||''''||ppubl||''''||',d.publ) and supdate='||''''||v_date||''''||'
            group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ';
    end if;
    --insert into test1(vstring) values ('2 pextra1 '||vquery1);commit;

    open p_accounts1 for vquery1;
  End cir_rep_supply_po;

  procedure cir_rep_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",
       nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
            nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND
        A.PUBL=PPUBL AND A.EDTN=NVL(PEDTN,A.EDTN) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND 
        A.SUPDATE >= VFRDT AND A.SUPDATE <=VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,/*A.EDTN,*/B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<=VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_daybook;

  procedure cir_rep_dist_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt            date;
     vtodt            date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(DIST_CODE,'NA') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",
       STATE_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,'NA') DIST_CODE,nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",
       nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",STATE_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT  AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_dist_daybook;

  procedure cir_rep_taluka_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",
       STATE_CODE "STATE CODE",
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",
       nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",STATE_CODE "STATE CODE",
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_taluka_daybook;

  procedure cir_rep_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(12000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE';
insert into test1(vstring,vstring2) values('3 '||vquery3,VQUERY2);commit;
       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
        
insert into test1(vstring,vstring2) values('4 '||vquery3,VQUERY2);commit;        
       open p_accounts2 for vquery3||vquery2;

  End cir_rep_day_daybook;

  procedure cir_rep_dist_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
    substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",
       COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='  FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_dist_day_daybook;

  procedure cir_rep_taluka_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_taluka_day_daybook;

  Procedure cir_rep_route_challan(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     pperiod        in number,
     prmode         in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts)
  As
      vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vquery     varchar2(4000);
  Begin
    --insert into test1(vstring,vstring2) values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');
    --insert into test1(vstring,vstring2) values('2222 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
    --vvar:=substr(vvar,1,length(vvar)-1);
    --insert into test1(vstring,vstring2) values('1 '||vvar,' vsupdate '||vsupdate);commit;

        if vvar is null then
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        else
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('2 '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_route_challan;

procedure cir_rep_dist_challan(
   pcomp_code       in varchar2,
   punit_code       in varchar2,
   pperiod          in number,
   prmode           in varchar2,
   psupdate         in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2,
   p_accounts       out t_accounts)
   As
     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn_1--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
Begin
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');

    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
        if vvar is null then
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        else
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('DIST '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_dist_challan;

    procedure cir_rep_taluka_challan(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        pperiod        in number,
        prmode         in varchar2,
        psupdate       in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     As

     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
    Begin
        vsupdate:=to_date(psupdate,''''||pdateformat||'''');

        open cur_edtn;
        loop
            fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
                    if vvar is null then
                  vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    else
                        vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    end if;
        end loop;
        close cur_edtn;
        if vvar is null then
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        else
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        end if;
        --insert into tes t1(vstring,vstring2) values('TALUKA '||vquery,null);commit;
        open p_accounts for vquery;

    End cir_rep_taluka_challan;

    procedure cir_route_wise_supply(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        ppubl          in varchar2,
        pmainedtn      in varchar2,
        pedtn          in varchar2,
        proute         in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts,
        p_accounts1    out t_accounts,
        p_accounts2    out t_accounts,
        p_accounts3    out t_accounts)
     As
        vfrom_supdate    date;
        vtill_supdate    date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno,
               cir_get_supply_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,ppubl,pedtn,cir_dbksup.agcd,cir_dbksup.dpcd) supply_seqno
               from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,
                           cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code,supply_seqno ,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               sum(sup_copy),cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                       order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
    End cir_route_wise_supply;

    procedure cir_dist_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vfrom_supdate  date;
     vtill_supdate  date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.dist_code,cir_agmast.state_code,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_agmast.state_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
  End cir_dist_wise_supply;

    procedure cir_taluka_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vsupdate date;
     vsupdate1 date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.tehsil_taluka
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_taluka_wise_supply;


    procedure cir_dist_taluka_wise_sup(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts,
     p_accounts4    out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
        cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
        sum(sup_copy) from cir_dbksup,cir_agmast
        where cir_dbksup.comp_code = cir_agmast.comp_code and
        cir_dbksup.unit_code = cir_agmast.unit and
        cir_dbksup.agcd = cir_agmast.agcd and
        cir_dbksup.dpcd = cir_agmast.dpcd and
        cir_dbksup.comp_code = pcomp_code and
        cir_dbksup.unit_code = punit_code and
        cir_dbksup.publ = ppubl and
        ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
        cir_dbksup.supdate between vsupdate and vsupdate1 and
        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
        group by cir_dbksup.comp_code,cir_dbksup.unit_code,
        cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka
        order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
               cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.state_code,cir_agmast.dist_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts3 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts4 for
        select cir_dbksup.comp_code comp_code, sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_dist_taluka_wise_sup;

     procedure cir_supply_comp(
         pcomp_code     in varchar2,
         punit_code     in varchar2,
         ppublication   in varchar2,
         psupdate       in varchar2,
         psupdate1      in varchar2,
         pdateformat    in varchar2,
         pextra1        in varchar2,
         pextra2        in varchar2,
         p_accounts     out t_accounts,
         p_accounts1    out t_accounts,
         p_accounts2    out t_accounts,
         p_accounts3    out t_accounts)
     as
        vsupdate     date;
        vsupdate1    date;
     begin
        vsupdate    :=to_date(psupdate,''''||pdateformat||'''');
        vsupdate1   :=to_date(psupdate1,''''||pdateformat||'''');
        --insert into test1(vstring,vstring2) values(pcomp_code||','||punit_code||','||ppublication,psupdate||','||pdateformat||','||pextra1||','||','||pextra2); commit;
        open p_accounts for
             select comp_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"= unit_code) unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,edtn_name,edtn_name_oth_lang,
             main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             prev_sup,curr_sup,nvl(curr_sup,0)-nvl(prev_sup,0) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno,cir_get_edtn_seqno(comp_code,edtn) edtn_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               order by unit_code,publ_seqno,publ_name,mainedtn_seqno,main_edtn_name,edtn_seqno,edtn_name;

        open p_accounts1 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno
             from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code,main_edtn
                               order by unit_code,publ_seqno,publ_name,mainedtn_seqno,main_edtn_name;
        open p_accounts2 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code
                               order by unit_code,publ_seqno,publ_name;

             open p_accounts3 for
             select comp_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code=cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ
                               order by publ_seqno,publ_name;

     End cir_supply_comp;

    procedure cir_route_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    proute              in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,--it is use for finalised or unfinalised
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate     date;
     vseconddate    date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(base_supply),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        else
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and cir_supply.unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd                 =   a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn                     =      a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        else
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code                =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')                =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit     =   b.unit and cir_supply.agcd          =     a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          =     a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
                open p_accounts2 for----comp wise total
                     select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                     decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                     (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   pcomp_code and unit_code =   punit_code and
                                             publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                             supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                             (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and unit_code =    punit_code and
                                             publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                             supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                                 where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code;
        end if;

   End cir_route_supply_variance_p;

    procedure cir_dist_supply_variance_p(
        pcomp_code          in varchar2,
        punit_code          in varchar2,
        ppublication        in varchar2,
        pmainedtn           in varchar2,
        pedtn               in varchar2,
        pdist               in varchar2,
        pfirstdate          in varchar2,
        pseconddate         in varchar2,
        pdateformat         in varchar2,
        pextra1             in varchar2,--it is use for finalised or unfinalised
        pextra2             in varchar2,--it is used for supply type
        p_accounts          out t_accounts,
        p_accounts1         out t_accounts,
        p_accounts2         out t_accounts)
   As
     vfirstdate             date;
     vseconddate            date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                     cir_supply.agcd  =    a.agcd and
                                     cir_supply.dpcd  =    a.dpcd and
                                     cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                     (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         supdate      =    vseconddate and
                                     cir_dbksup.agcd  =    a.agcd and
                                     cir_dbksup.dpcd  =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                   order by comp_code,dist_code,ag_name;
        else
                open p_accounts for
                     select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                     cir_get_city(comp_code,city_code) "CITY NAME",
                     dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                            (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                       order by comp_code,dist_code,ag_name;            
        end if;
        
        if upper(pextra1)='U' then
        open p_accounts1 for----district wise total
             select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                          (select nvl(sum(sup_copy),0) from cir_supply
                               where comp_code    =    pcomp_code and
                                     unit    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     nvl(supply_flag,'N')=    'Y' and
                             cir_supply.agcd =    a.agcd and
                             cir_supply.dpcd =    a.dpcd and
                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     supdate        =    vseconddate and
                                 cir_dbksup.agcd                 =    a.agcd and
                                 cir_dbksup.dpcd                 =    a.dpcd and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                 (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_dist_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,dist_code,dist_name,dist_oname
                               order by comp_code,dist_code;
             else
                open p_accounts1 for----district wise total
                     select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ         =    ppublication and
                                             (edtn        =    pedtn or pedtn is null) and
                                             supdate      =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 
                                         where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,dist_code,dist_name,dist_oname
                                       order by comp_code,dist_code;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')      =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                         (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                         cir_dbksup.agcd                 =    a.agcd and
                         cir_dbksup.dpcd                 =    a.dpcd and
                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
            else
                open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                        cir_dbksup.agcd =    a.agcd and
                                        cir_dbksup.dpcd =    a.dpcd and
                                        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                        (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;

            end if;
   End cir_dist_supply_variance_p;

    procedure cir_taluka_supply_variance_p(
    pcomp_code       in varchar2,
    punit_code       in varchar2,
    ppublication     in varchar2,
    pmainedtn        in varchar2,
    pedtn            in varchar2,
    ptaluka          in varchar2,
    pfirstdate       in varchar2,
    pseconddate      in varchar2,
    pdateformat      in varchar2,
    pextra1          in varchar2,--it is use for finalised or unfinalised
    pextra2          in varchar2,--it is used for supply type
    p_accounts       out t_accounts,
    p_accounts1      out t_accounts,
    p_accounts2      out t_accounts)
   As
     vfirstdate      date;
     vseconddate     date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit    =    punit_code and
                                         cir_supply.publ    =    ppublication and
                                         (cir_supply.edtn   =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;
             else
                open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                            cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;             
             
             end if;
        if upper(pextra1)='U' then
            open p_accounts1 for----taluka wise total
                 select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit         =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                   order by comp_code,tehsil_taluka;
              else
                open p_accounts1 for----taluka wise total
                     select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                       order by comp_code,tehsil_taluka;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit        =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn         =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =    'Y' and
                                             cir_supply.agcd =    a.agcd and
                                             cir_supply.dpcd =    a.dpcd and
                                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
            open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
            (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ    =    ppublication and
                                     (edtn   =    pedtn or pedtn is null) and
                                     supdate =    vfirstdate and
                             cir_dbksup.agcd =    a.agcd and
                             cir_dbksup.dpcd =    a.dpcd and
                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn        =    pedtn or pedtn is null) and
                                     supdate      =    vseconddate and
                                     cir_dbksup.agcd                 =    a.agcd and
                                     cir_dbksup.dpcd                 =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;
        end if;
   End cir_taluka_supply_variance_p;

    procedure cir_edition_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate         date;
     vseconddate        date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate   :=to_date(pseconddate,''''||pdateformat||'''');
        open p_accounts for
             select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
             cir_get_city(comp_code,city_code) "CITY NAME",
             edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                         cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME",unit_code "UNIT CODE" from
                    (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                     c.station_code station_code,c.branch_code branch_code,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                    cir_dbksup.agcd =  a.agcd and
                                    cir_dbksup.dpcd =  a.dpcd and
                                    cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                 (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,edtn,edtn_name,edtn_name_oth_lang,station_code,branch_code
                               order by comp_code,unit_code,edtn_name,ag_name;

        open p_accounts1 for----Edition wise total
             select comp_code "COMP CODE",edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,edtn,edtn_name,edtn_name_oth_lang
                               order by comp_code,edtn_name;

        open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    d.edtn in(select distinct edtn from cir_edtn_mast where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;

   End cir_edition_supply_variance_p;

   procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts)
    as
     vfrom_supdate      date;
     vtill_supdate      date;
     cursor cur_sup_type is
         select 'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) "'||sup_ty_name||'",' vty,
         'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) +' vty_sum
      from cir_supply_type_mast
      where comp_code=pcomp_code /*and sup_ty_code in(select distinct sup_type_code from cir_dbksup
      where comp_code=pcomp_code and unit_code=punit_code and
                  ((publ=ppubl) or (ppubl is null)) and ((edtn=pedtn) or (pedtn is null)) and
                  supdate between vfrom_supdate and vtill_supdate)*/
      order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar           varchar2(4000);
     vvar_sum       varchar2(4000);
     vquery         varchar2(4000);
     vquery1        varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar        :=substr(vvar,1,length(vvar)-1);
    vvar_sum    :=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);

    vquery:=' select comp_code AS "COMP_CODE",unit_code AS "UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS "PUBL_NAME",sup_rate as "SUP_RATE", supdate AS "SUPDATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by comp_code,unit_code,publ_name,supdate,sup_rate';
      --          insert into test1(vstring) values ('11'||vquery);commit;
      open p_accounts for vquery;

      vquery1:=' select comp_code AS "COMP_CODE",sup_rate as "SUP_RATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    --insert into test1(vstring) values ('22'||vquery1);commit;
      open p_accounts1 for vquery1;
  End cir_rep_supply_unit;

procedure cir_dist_taluka_publ_wise(
     pcompcode      in varchar2,
     punitcode      in varchar2,
     pbrancode      in varchar2,
     ppublcode      in varchar2,
     pmainedtn      in varchar2,
     pedtncode      in varchar2,
     pdistcode      in varchar2,
     ptalukacode    in varchar2,
     pagtypecode    in varchar2,
     pagclasscode   in varchar2,
     pagcd          in varchar2,
     pdpcd          in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     plangtype      in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is used for agency supply type
     pextra2        in varchar2,--it is used for break on district/taluka wise or datewise(1/2)
     p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(32000);
      v_query1    varchar2(32000);
      
     cursor cur_edtn is
        select distinct d.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (m.agcd=pagcd or pagcd is null) and (m.dpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='S'
        union
        select p.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (d.billagcd=pagcd or pagcd is null) and (d.billdpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='B'
        order by publ_seqno,publ,edtn_seqno,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(8000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        delete test1;insert into test1(vstring,vstring2)
        values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;

        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            /*if vvar is null then
                vvar        :='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',sup_copy,0))"'||rec_edtn.edtn||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn||'") "'||rec_edtn.edtn||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',sup_copy,0))"'||rec_edtn.edtn||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn||'") "'||rec_edtn.edtn||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn||'"';
            end if;*/
            
            if vvar is null then
                vvar        :='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
                        
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
       -- insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise ',vvar||' , '||vvar_sum1);commit;
        if pextra2='2' then--for datewise
            if vvar is null then
                v_query:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,d.supdate,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                union ';
                v_query1:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
            else
                v_query:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                union ';
                --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;
                v_query1:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,supdate,agency_name';
            end if;
        else--- for district/taluka wise
            if vvar is null then
                v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                union ';
                v_query1:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,dist_name,taluka_name,agcd,dpcd,agency_name';
            else
                v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                union ';
                --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;
                v_query1:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,dist_name,taluka_name,agency_name';
            end if;


        end if;

        --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;

        open p_accounts for v_query||v_query1;

    End cir_dist_taluka_publ_wise;

    procedure cir_datewise_resale(
        pcompcode      in varchar2,
        punitcode      in varchar2,
        pbrancode      in varchar2,
        ppublcode      in varchar2,
        pmainedtn      in varchar2,
        pedtncode      in varchar2,
        pdistcode      in varchar2,
        ptalukacode    in varchar2,
        pagtypecode    in varchar2,
        pagclasscode   in varchar2,
        pagcd          in varchar2,
        pdpcd          in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        plangtype      in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(8000);
     cursor cur_edtn is
        select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
         case when plangtype='1' then
          substr(p.edition_nick,1,15)
         else
          substr(p.edtn_name_oth_lang,1,20)
         end edtn_name,d.sup_rate sup_rate,p.main_edtn main_edtn
        from cir_agmast m,cir_dbksup_resale d ,cir_edtn_mast p
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and m.unit=d.unit_code and 
              m.unit=p.unit_code and d.unit_code = punitcode and
              d.supdate >= vsupdate and d.supdate <=vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and m.agcd=nvl(pagcd,m.agcd) and m.dpcd=nvl(pdpcd,m.dpcd) and d.publ=nvl(ppublcode,d.publ) and
              d.publ=p.publ and d.edtn=p.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
              (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (d.resale_branch=pbrancode or pbrancode is null)
        order by publ,main_edtn,edtn_seqno,edtn,sup_rate;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
     vquery     varchar2(8000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        --delete test1;insert into test1(vstring,vstring2)
        --values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;
        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            if vvar is null then
                --vvar    :='decode(u.edtn||u.copy_rate,'||''''||rec_edtn.edtn||rec_edtn.copy_rate||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                --tot_vvar:=',sum("'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'") "'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                
                vvar        :='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
        --insert into test1(vstring,vstring2) values('cir_datewise_resale ',vvar||' , '||vvar_sum1);commit;

        if vvar is null then
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.agcd agcd,d.dpcd dpcd,d.supdate supdate,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
        else
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate supdate,d.agcd agcd,d.dpcd dpcd,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name,'||vvar||' from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agency_name';
        end if;

        --insert into test1(vstring,vstring2) values('cir_datewise_resale v_query',v_query);commit;

        open p_accounts for v_query;

    End cir_datewise_resale;
END cir_rep_supply;
/
//================================================================4768=================================

/*****************************************issue no 4653 22/9/11*************************************/

CREATE OR REPLACE PACKAGE HT18JULY.Currbindpreferpgld
IS
   TYPE t_account_cursor IS REF CURSOR;

   PROCEDURE currbindpreferpgld_p (
      compcode     IN       VARCHAR2,
      p_accounts   OUT      t_account_cursor
   );
END Currbindpreferpgld;
/

CREATE OR REPLACE PACKAGE BODY HT18JULY.Currbindpreferpgld
IS
   PROCEDURE currbindpreferpgld_p (
      compcode     IN       VARCHAR2,
      p_accounts   OUT      t_account_cursor
   )
   AS
   BEGIN
      OPEN p_accounts FOR
         SELECT "date_format", "autogenerated", "currency_code",
                "rate_gr_code", "solo", "breakup", "blackwhitecode",
                "rostatus", "File_name", "Tfn", "Insert_breakup", "prefix",
                "suffix", "financestatus", "voucherst", "Ad_category",
                "Ro_datetime", "Vat", "Booking_status", "Cio_id",
                "Receipt_no","uom_code","Bgcolor_publication","chkfor_valid_pubdates","Agency_ratecode","audit","book_insert_date","agencycomm",
                "rate_audit","bill_audit","billtype","Premium_type","copy_booking","RATE_COMPANY_AGENCY","ADDITIONAL_AGENCY_COMM","AGENCY_RETAINER_COMM","SUBEDITIONRATE",CLS_BILLTYPE,DIS_BILLTYPE,
                "BILLING_FORMAT","RATE_CHECK","ALL_PACKAGE",dayrate,SCHEME_TYPE,DISP_CLSBILL,RECEIPT_FORMAT,CASH_RECEIPT_BILL, BILL_ORDERWSLAST, FLOOR_CHK,
                ROKEYCHECK, AGENCYCOMM_SEQ_COM, CREDIT_RECIPT,  DISP_CASHBILL, CLA_CASHBILL,
                RATE_AUDIT_PREF,BARCODING_ALLOWED, FMG_BILL_DIS,BILL_DISP_CASHBILL, BILL_CLA_CASHBILL,BACKDATERECEIPT,ROWISE_CASHBOOKING,CUTOFFTIME,DOCKIT_BOOKING,APPROVAL,BACK_DAYS,CASH_DISCOUNT,CASH_DISCOUNTTYPE,"Allowed_old_date",SEPRATE_CASHIER,
                CIR_MANY_TIME_POSTING, CIR_BACKDAYS_POSTING, CIR_MAX_RETURN_ALLOW, CIR_RETURN_LIMIT_ALLOW, CIR_NO_OF_CHQBOUNCE, CIR_DAYS_CHQBOUNCE, CIR_RETURN_DAYS, CIR_SUP_ORDER_LIMIT, DISP_BILLING_CRITERIA, CLSD_BILLING_CRITERIA,MAX_PUBLISHDAYS,
                BILLNO_PERIODICITY, SPECIALDISC_TRANS_EDIT, SHARING_TRANS, MULTIPACKAGE_SEL_TRANS,SCHEME_MINWORD, TRADE_SPLCHARGE,RATE_AUTHORIZATION,
           F2_RECORD,PUBLISHAD_EDIT_RATEAUDIT,BINDREVENUE_CENTER, FA_LEDGER_ALLOW,CLEARANCE_TYPE_ALLOW,REPEAT_DAY_TYPE,PREMIUM_EDIT,
           
           BILL_GENERATION_PRIOR,PUBLICATION_HO,SPLDISC_ALLOWPREM,BILL_SCHEME,ALLOWED_PDC_DAYS_RECEIPT,
           AD_TYPE_MANUL_BILL,OUTSTANDING_AMT_CRITERIA as RO_OUTSTAND
           
            FROM PREFERRENCES
          WHERE "comp_code" = compcode;
          
         
   END currbindpreferpgld_p;
END Currbindpreferpgld;
/


/*****************************************issue no 4653 22/9/11*************************************/




----------------------------------------------------issue no.4660-----------------------------------------------------

//-----------------------------------specification-------------------------------------------------

CREATE OR REPLACE PACKAGE HT18JULY.cir_agency_bind is
   type t_accounts_cursor is ref cursor;
   procedure cir_agency_bind_p (
       pcompcode   in varchar2,
    punit       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    p_accounts  out t_accounts_cursor);
   
   procedure cir_branch_billagency_p (
       pcompcode   in varchar2,
    punit       in varchar2,
    pbranchcode in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    p_accounts  out t_accounts_cursor);
    
  

   procedure cir_agency_bind_p (
       pcompcode   in varchar2,
    punit       in varchar2,
    pagcd       in varchar2,
    pdpcd       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,    
    p_accounts  out t_accounts_cursor);
    
    procedure cir_agency_listing_p (
    pcompcode   in varchar2,
    punit       in varchar2,
    pagty       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,    
    p_accounts  out t_accounts_cursor);
      
    procedure cir_agency_area_p (
        pcompcode   in varchar2,
        punit       in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,    
        p_accounts  out t_accounts_cursor);
        
        procedure cir_agency_extraLabel_p(
        pcompcode     in varchar2,
        punit         in varchar2,
        pdateformat   in varchar2,
        pextra1       in varchar2,
        pextra2       in varchar2,
        p_accounts    out t_accounts_cursor);
         procedure cir_agency_bind_pd (
       pcompcode in varchar2,
    punit in varchar2,
    pname in varchar2,
    pdateformat in varchar2,
   -- pextra1 in varchar2,
    pextra2 in varchar2,
    p_accounts out t_accounts_cursor);
        
        procedure cir_agency_bind_pgoogle (
       pcompcode   in varchar2,
    punit       in varchar2,
    pagcd       in varchar2,
    pdpcd       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,    
    p_accounts  out t_accounts_cursor);
End cir_agency_bind;
/

//------------------------------------------------body--------------------------------------------------------------------------
CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_agency_bind is
    procedure cir_agency_bind_p (
        pcompcode         in varchar2,
        punit             in varchar2,
        pdateformat     in varchar2,
        pextra1         in varchar2,
        pextra2         in varchar2,
        p_accounts         out t_accounts_cursor)
        As
  Begin
      if upper(pextra2)='D' then
        open p_accounts for
        select cir_agmast_dis.*,cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
            where comp_code = pcompcode and unit = punit and
            ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and nvl(freeze_flag,'N')='N'
        order by ag_name;
      else
        open p_accounts for
        select cir_agmast.*,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
          where comp_code = pcompcode and
                    unit = punit and
                    ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and
              nvl(freeze_flag,'N')='N'
        order by ag_name;
      end if;
  End cir_agency_bind_p;

  procedure cir_branch_billagency_p (
        pcompcode         in varchar2,
        punit             in varchar2,
        pbranchcode     in varchar2,
        pdateformat     in varchar2,
        pextra1         in varchar2,
        pextra2         in varchar2,
        p_accounts         out t_accounts_cursor)
        As
  Begin
      if upper(pextra2)='D' then
          open p_accounts for
            select cir_agmast_dis.* ,cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
              where comp_code = pcompcode and
                        unit = punit and
                        (branch_code=pbranchcode or pbranchcode is null) and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and
                  nvl(freeze_flag,'N')='N'
            order by ag_name;
       else
          open p_accounts for
            select cir_agmast.* ,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
              where comp_code = pcompcode and
                        unit = punit and
                        (branch_code=pbranchcode or pbranchcode is null) and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and
                  nvl(freeze_flag,'N')='N'
            order by ag_name;
       end if;
  End cir_branch_billagency_p;

  
procedure cir_agency_bind_pd (
     pcompcode in varchar2,
    punit in varchar2,
    pname in varchar2,
    pdateformat in varchar2,
   -- pextra1 in varchar2,
    pextra2 in varchar2,
    p_accounts out t_accounts_cursor) as
  Begin
      open p_accounts for
        select * from cir_agmast
           where comp_code = pcompcode and
                    unit = punit and
              ((upper(ag_name)=upper(pname)) or (upper(ag_name) like upper(pname||'%'))) and
              nvl(freeze_flag,'N')='N'
         order by ag_name;
  End cir_agency_bind_pd;
  
  
    procedure cir_agency_bind_p (
       pcompcode         in varchar2,
        punit                 in varchar2,
        pagcd                 in varchar2,
        pdpcd                 in varchar2,
        pdateformat     in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
        p_accounts         out t_accounts_cursor) as
  Begin
    if upper(pextra2)='D' then
        open p_accounts for
            select * from cir_agmast_dis
             where comp_code = pcompcode and
                   unit = punit and
                   agcd=pagcd and
                   dpcd=pdpcd and
                   nvl(freeze_flag,'N')='N'
             order by ag_name;
     else
        open p_accounts for
            select * from cir_agmast
             where comp_code = pcompcode and
                   unit = punit and
                   agcd=pagcd and
                   dpcd=pdpcd and
                   nvl(freeze_flag,'N')='N'
             order by ag_name;
     end if;
  End cir_agency_bind_p;

  procedure cir_agency_listing_p (--Agency Master Listing
        pcompcode         in varchar2,
    punit                 in varchar2,
    pagty                 in varchar2,
    pdateformat     in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
      p_accounts         out t_accounts_cursor) as
     Begin
          open p_accounts for
             select cir_agmast.*,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY NAME",cir_get_agency_type(cir_agmast.comp_code,cir_agmast.ag_type) "AGENCY TYPE NAME" from cir_agmast
                where comp_code = pcompcode and
                      unit      = punit and
                      ((ag_type = pagty) or (pagty is null)) order by cir_agmast.ag_type,cir_agmast.ag_name;
     End cir_agency_listing_p;


procedure cir_agency_area_p (
    pcompcode       in varchar2,
    punit           in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    p_accounts      out t_accounts_cursor) as
Begin
    if upper(pextra2)='D' then
        open p_accounts for
            select cir_agmast_dis.*,cir_get_area(cir_agmast_dis.comp_code,cir_agmast_dis.area_code) "AREA_NAME",cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
                where comp_code = pcompcode and
                        unit      = punit and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null))
                           order by cir_agmast_dis.ag_type,cir_agmast_dis.ag_name;
    else
        open p_accounts for
            select cir_agmast.*,cir_get_area(cir_agmast.comp_code,cir_agmast.area_code) "AREA_NAME",cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
                where comp_code = pcompcode and
                          unit      = punit and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null))
                           order by cir_agmast.ag_type,cir_agmast.ag_name;
    end if;
End cir_agency_area_p;

     procedure cir_agency_extraLabel_p(
        pcompcode     in varchar2,
        punit         in varchar2,
        pdateformat   in varchar2,
        pextra1       in varchar2,
        pextra2       in varchar2,
        p_accounts    out t_accounts_cursor) as
        Begin

         open p_accounts for
         select cir_agmast.*,cir_get_area(cir_agmast.comp_code,cir_agmast.area_code) "AREA_NAME",cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
                where comp_code = pcompcode and
                      unit      = punit and
                      (PRINT_LABEL= 'N' or PRINT_LABEL is null ) and
                      (SUSPEND_TYPE='N' or SUSPEND_TYPE is null) and
                    ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null))
                       order by cir_agmast.ag_type,cir_agmast.ag_name;
        End cir_agency_extraLabel_p;


         procedure cir_agency_bind_pgoogle (
       pcompcode   in varchar2,
    punit       in varchar2,
    pagcd       in varchar2,
    pdpcd       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,    
    p_accounts  out t_accounts_cursor)
        As
  Begin
      if upper(pextra2)='D' then
        open p_accounts for
        select cir_agmast_dis.*,cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
            where comp_code = pcompcode and unit = punit and
            ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and nvl(freeze_flag,'N')='N' AND ROWNUM<=10
        order by ag_name;
      else
        open p_accounts for
        select cir_agmast.*,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
          where comp_code = pcompcode and
                    unit = punit and
                    ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and
              nvl(freeze_flag,'N')='N' AND ROWNUM<=10
        order by ag_name;
      end if;
  End cir_agency_bind_pgoogle;

End cir_agency_bind;
/



//-------------------------------------------next procedure----------------------

CREATE OR REPLACE procedure HT18JULY.cir_pending_unsold_supply(
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pbrancode       in varchar2,
    pagcd           in varchar2,
    pdpcd           in varchar2,
    pfromdate       in varchar2, 
    ptilldate       in varchar2,
    puserid         in varchar2, 
    pdateformate    in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,--it is used for agency or distribution
    pextra3         in varchar2,
    pextra4         in varchar2,
    pextra5         in varchar2,
    p_accounts      OUT Cur_Type_New1.cursor_type)
is
    v_from_date     date;
    v_till_date     date;
    v_recno number;
begin
    v_from_date:=to_date(pfromdate,''''||pdateformate||'''');
    v_till_date:=to_date(ptilldate,''''||pdateformate||'''');
    if upper(nvl(pextra2,'/'))='D' then
        open p_accounts for
        select h.comp_code comp_code,h.unit_code unit_code,h.agcd agcd,h.dpcd dpcd,m.ag_name agency_name,m.city_code city_code,
        cir_get_city(h.comp_code,m.city_code) city_name,h.doctype doctype,h.recptno recptno,h.recptdt recptdt,
        sum(d.copy_amt) net_amt,sum(nvl(d.short_recpt,0)+nvl(d.late_recpt,0)+nvl(d.bnr,0)+nvl(d.unsold,0)) net_unsold
        from cir_unsold_hdr_dis h,cir_unsold_dtl_dis d,cir_agmast_dis m
        where h.comp_code=d.comp_code and h.comp_code=m.comp_code and h.comp_code=pcompcode and 
            h.unit_code=d.unit_code and h.unit_code=m.unit and h.unit_code=punitcode and h.doctype=d.doctype and h.agcd=d.agcd and h.agcd=m.agcd and 
            h.dpcd=d.dpcd and h.dpcd=m.dpcd and (h.agcd=pagcd or pagcd is null) and (h.dpcd=pdpcd or pdpcd is null) and
            h.recptdt=d.recptdt and h.recptdt>=v_from_date and h.recptdt<=v_till_date and h.recptno=d.recptno and (d.branch_code=pbrancode or pbrancode is null) and
            d.app_userid is null and (nvl(d.apr_short_recpt,0)+nvl(d.apr_late_recpt,0)+nvl(d.apr_bnr,0)+nvl(d.apr_unsold,0))=0
        group by h.comp_code,h.unit_code,h.agcd,h.dpcd,m.ag_name,m.city_code,h.doctype,h.recptno,h.recptdt
        order by h.recptdt,h.recptno,agency_name;
    else
        open p_accounts for
        select h.comp_code comp_code,h.unit_code unit_code,h.agcd agcd,h.dpcd dpcd,m.ag_name agency_name,m.city_code city_code,
        cir_get_city(h.comp_code,m.city_code) city_name,h.doctype doctype,h.recptno recptno,h.recptdt recptdt,
        sum(d.copy_amt) net_amt,sum(nvl(d.short_recpt,0)+nvl(d.late_recpt,0)+nvl(d.bnr,0)+nvl(d.unsold,0)) net_unsold
        from cir_unsold_hdr h,cir_unsold_dtl d,cir_agmast m
        where h.comp_code=d.comp_code and h.comp_code=m.comp_code and h.comp_code=pcompcode and 
            h.unit_code=d.unit_code and h.unit_code=m.unit and h.unit_code=punitcode and h.doctype=d.doctype and h.agcd=d.agcd and h.agcd=m.agcd and 
            h.dpcd=d.dpcd and h.dpcd=m.dpcd and (h.agcd=pagcd or pagcd is null) and (h.dpcd=pdpcd or pdpcd is null) and
            h.recptdt=d.recptdt and h.recptdt>=v_from_date and h.recptdt<=v_till_date and h.recptno=d.recptno and (d.branch_code=pbrancode or pbrancode is null) and
            d.app_userid is null and (nvl(d.apr_short_recpt,0)+nvl(d.apr_late_recpt,0)+nvl(d.apr_bnr,0)+nvl(d.apr_unsold,0))=0
        group by h.comp_code,h.unit_code,h.agcd,h.dpcd,m.ag_name,m.city_code,h.doctype,h.recptno,h.recptdt
        order by h.recptdt,h.recptno,agency_name;
    end if;

end;
/

/////////////////////////////////////next procedure//////////////////////


CREATE OR REPLACE procedure HT18JULY.cir_pending_unsold_approval(
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pbrancode       in varchar2,
    pagcd           in varchar2,
    pdpcd           in varchar2,
    precptno        in varchar2, 
    precptdt        in varchar2,
    puserid         in varchar2, 
    pdateformate    in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,--it is used for agency or distribution
    pextra3         in varchar2,
    pextra4         in varchar2,
    pextra5         in varchar2)
is
    v_recpt_date     date;
    cursor c1 is
        select x.supdate supdate,x.publ publ,x.edtn edtn,x.copy_rate copy_rate,x.comm_rate comm_rate,x.comm_type comm_type,
        x.waste_alw waste_alw,x.waste_rate waste_rate,x.short_recpt short_recpt,x.late_recpt late_recpt,x.bnr bnr,x.unsold unsold 
        from(select supdate,publ,edtn,copy_rate,comm_rate,comm_catg_type comm_type,waste_alw,waste_rate,short_recpt,late_recpt,bnr,unsold 
        from cir_unsold_dtl_dis
        where comp_code=pcompcode and unit_code=punitcode and doctype='UCN' and agcd=pagcd and dpcd=pdpcd and recptno=precptno and
        recptdt=v_recpt_date and app_userid is null and (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))=0 and 
        upper(nvl(pextra2,'/'))='D'
        union
        select supdate,publ,edtn,copy_rate,comm_rate,comm_catg_type comm_type,waste_alw,waste_rate,short_recpt,late_recpt,bnr,unsold 
        from cir_unsold_dtl 
        where comp_code=pcompcode and unit_code=punitcode and doctype='UCN' and agcd=pagcd and dpcd=pdpcd and recptno=precptno and
        recptdt=v_recpt_date and app_userid is null and (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))=0 and
        upper(nvl(pextra2,'/'))!='D') x
        order by supdate,publ,edtn,copy_rate;
    v1 c1%rowtype;
    v_cnt       number(5);      
    v_tot_copy  number;
    v_waste_amt number;
    v_gross_amt number;
    v_comm_amt  number;
    v_total_amt number;
begin
    v_recpt_date:=to_date(precptdt,''''||pdateformate||'''');
    open c1;
    loop
        fetch c1 into v1;
        exit when c1%notfound;
        v_cnt:=nvl(v_cnt,0)+1;

        if nvl(v1.waste_alw,'N')='Y' then
            v_waste_amt:=round((nvl(v1.unsold,0)*nvl(v1.waste_rate,0)),2);
        else
            v_waste_amt:=0;
        end if;
        
        v_tot_copy:=nvl(v1.short_recpt,0)+nvl(v1.late_recpt,0)+nvl(v1.bnr,0)+nvl(v1.unsold,0);
        
        v_gross_amt :=nvl(v_tot_copy,0)*nvl(v1.copy_rate,0);
        
        if v1.comm_type='C' then--for per copy rate
            v_comm_amt  :=round((v_tot_copy*nvl(v1.comm_rate,0)),2);
        else
            v_comm_amt  :=round((v_gross_amt*nvl(v1.comm_rate,0)/100),2);
        end if;    
        v_total_amt :=round((v_gross_amt-v_comm_amt-v_waste_amt),2);
        if upper(nvl(pextra2,'/'))='D' then
            update cir_unsold_dtl_dis set apr_short_recpt=nvl(v1.short_recpt,0), apr_late_recpt=nvl(v1.late_recpt,0), apr_bnr=nvl(v1.bnr,0), apr_unsold=nvl(v1.unsold,0), 
                app_userid=puserid,app_dt=v_recpt_date,comm_amt=v_comm_amt,waste_amt=v_waste_amt,copy_amt=v_total_amt
            where comp_code=pcompcode and unit_code=punitcode and doctype='UCN' and agcd=pagcd and dpcd=pdpcd and recptno=precptno and
            recptdt=v_recpt_date and supdate=v1.supdate and publ=v1.publ and edtn=v1.edtn and copy_rate=v1.copy_rate and 
            app_userid is null and (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))=0;
        else
            update cir_unsold_dtl set apr_short_recpt=nvl(v1.short_recpt,0), apr_late_recpt=nvl(v1.late_recpt,0), apr_bnr=nvl(v1.bnr,0), apr_unsold=nvl(v1.unsold,0), 
                app_userid=puserid,app_dt=v_recpt_date,comm_amt=v_comm_amt,waste_amt=v_waste_amt,copy_amt=v_total_amt
            where comp_code=pcompcode and unit_code=punitcode and doctype='UCN' and agcd=pagcd and dpcd=pdpcd and recptno=precptno and
            recptdt=v_recpt_date and supdate=v1.supdate and publ=v1.publ and edtn=v1.edtn and copy_rate=v1.copy_rate and 
            app_userid is null and (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))=0;
        end if;    

    end loop;
    close c1;                
    if nvl(v_cnt,0)>0 then
        if upper(nvl(pextra2,'/'))='D' then
            update cir_unsold_hdr_dis set app_userid=puserid,app_dt=v_recpt_date
                where comp_code=pcompcode and unit_code=punitcode and doctype='UCN' and agcd=pagcd and dpcd=pdpcd and recptno=precptno and
                recptdt=v_recpt_date and app_userid is null;
        else
            update cir_unsold_hdr set app_userid=puserid,app_dt=v_recpt_date
                where comp_code=pcompcode and unit_code=punitcode and doctype='UCN' and agcd=pagcd and dpcd=pdpcd and recptno=precptno and
                recptdt=v_recpt_date and app_userid is null;
        end if;                    
        commit;
    end if;                 
end;
/
//========================================================end of issue no. 4660-------------------------------------------

/****************************************************Laxman Sir issue no 4761 26/sep/11*********************************/

                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE PACKAGE cir_rep_collection IS
TYPE T_Accounts_Cursor is Ref Cursor;
PROCEDURE cir_rep_collection_det_p(
	pcompcode 			in varchar2,
	punitcode 			in varchar2,
    pbrachcode			in varchar2,
	pdoctype 			in varchar2,
	ppaymode 			in varchar2,
	pactype 			in varchar2,
	pfromdate 			in varchar2,
	ptodate 			in varchar2,
	pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
	P_Accounts          out T_Accounts_Cursor,
	P_Accounts1         out T_Accounts_Cursor);
PROCEDURE cir_rep_datewise_monthwise_p(
	pcompcode 			in varchar2,
	punitcode 			in varchar2,
	pdoctype 			in varchar2,
	ppaymode_reason 	in varchar2,
	pactype 			in varchar2,
    pagency_type		in varchar2,
	pfromdate 			in varchar2,
	ptodate 			in varchar2,
	pdateformat         in varchar2,
	prep				in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
	P_Accounts          out T_Accounts_Cursor,
	P_Accounts1         out T_Accounts_Cursor);
PROCEDURE cir_rep_unitwise_monthwise_p(
	pcompcode 			in varchar2,
	punitcode 			in varchar2,
	pdoctype 			in varchar2,
	ppaymode_reason 	in varchar2,
	pactype 			in varchar2,
	pfromdate 			in varchar2,
	ptodate 			in varchar2,
	pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
	P_Accounts          out T_Accounts_Cursor,
	P_Accounts1         out T_Accounts_Cursor);
END cir_rep_collection;
/
CREATE OR REPLACE PACKAGE BODY cir_rep_collection IS
/*
var v1 refcursor;
var v2 refcursor;
exec cir_rep_collection.cir_rep_collection_det_p('SP002','AUR','','DN,CN','','NM','01-feb-2011','17-mar-2011','dd/mm/yyyy','','',:v1,:v2);*/
    PROCEDURE cir_rep_collection_det_p(
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pbrachcode            in varchar2,
    pdoctype            in varchar2,
    ppaymode            in varchar2,
    pactype             in varchar2,
    pfromdate           in varchar2,
    ptodate             in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    P_Accounts          out T_Accounts_Cursor,
    P_Accounts1         out T_Accounts_Cursor)
    As
        v_frdt date;
        v_todt date;
        a number;
    Begin
        v_frdt :=to_date(pfromdate,''''||pdateformat||'''');
        v_todt :=to_date(ptodate,''''||pdateformat||'''');
        --insert into test1(vstring,vstring2) values('pdoctype ',pdoctype); commit;
        if pdoctype is not null then
            a:=FN_SPLITFIELD(pdoctype ,',');
        end if;
        open P_Accounts for
        select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,a.recptno recptno,a.doctype doctyp,a.agcd agcd,
        a.dpcd dpcd,b.ag_name as AGENCY_NAME,b.ag_name_oth_lang agname_oth_lang,b.city_code,cir_get_city(b.comp_code,b.city_code) city_name,
        b.tehsil_taluka taluka_code,cir_get_taluka(b.comp_code,b.tehsil_taluka) taluka_name,a.voucherno voucherno,a.chno chno,a.chdt chdt,
        substr(nvl((select bankname as "bankname" from cir_bank_mast where comp_code=pcompcode and bankcode=a.chbank),a.chbank),1,15) as BANK,abs(a.amount) amount,
        initcap(a.remark) remark,a.achd achd,
        case when a.doctype='RCR' then (select "Payment_Mode_Name" from payment_mode_mast where "Pay_Mode_Code"=a.reason)
        else (select reason_name from cir_reason_mst where comp_code=a.comp_code and reason_code=a.reason) end as reason,
        a.branch_code branch_code,(select distinct "Branch_Name" from branch_mst where "Branch_Code"=a.branch_code) branch_name,
        substr(fa_get_account_name(a.comp_code,a.rcdp),1,15) debit_head,(select distinct case when dsign=-1 then 'C' else 'D' end dsign from cir_docmst where doc_type=a.doctype) dsign,
        a.userid,(select nvl(FIRSTNAME,"username")||' '||LASTNAME from login where "userid"=a.userid) created_by, a.creation_date creation_date, a.prov_rec_no prov_rec_no, a.prov_rec_dt prov_rec_date,
        a.REMARK_OTH REMARK_OTH 
        from cir_rcphdr a,cir_agmast b
        where a.comp_code=b.comp_code and a.comp_code=pcompcode  and a.unit_code=b.unit and a.unit_code =punitcode and
              a.agcd=b.agcd and a.dpcd=b.dpcd and a.agcd=nvl(pextra1,a.agcd) and a.dpcd=nvl(pextra2,a.dpcd) and
              a.recptdt between v_frdt and v_todt and (a.doctype  in(select EDITION_NAME from result) or pdoctype is null) and
              (a.reason =ppaymode or ppaymode is null) and (nvl(a.achd,'NM')=pactype or pactype is null) and
              (a.branch_code =pbrachcode or pbrachcode is null)
        order by comp_code,recptdt,doctype,recptno;

        open P_Accounts1 for
        select comp_code,doctype,reason,sum(db_amount) db_amount,sum(cr_amount) cr_amount from(select comp_code,doctype,reason,decode(debit,'D',sum(amount)) db_amount,decode(credit,'C',sum(amount)) cr_amount from
        (select a.comp_code comp_code,a.doctype doctype,
        case when a.doctype='RCR' then (select "Payment_Mode_Name" from payment_mode_mast where "Pay_Mode_Code"=a.reason)
        else (select reason_name from cir_reason_mst where comp_code=a.comp_code and reason_code=a.reason) end as reason,
        decode(sign(a.amount),1,'D') as debit,
        decode(sign(a.amount),-1,'C') as credit,abs(a.amount) as amount
        from cir_rcphdr a,cir_agmast b
        where a.comp_code=b.comp_code and a.comp_code=pcompcode  and a.unit_code=b.unit and a.unit_code =punitcode and
        a.agcd=b.agcd and a.dpcd=b.dpcd and  a.agcd=nvl(pextra1,a.agcd) and a.dpcd=nvl(pextra2,a.dpcd) and
        a.recptdt between v_frdt and v_todt and (a.doctype  in(select EDITION_NAME from result) or pdoctype is null) and
        (a.reason =ppaymode or ppaymode is null) and (nvl(a.achd,'NM')=pactype or pactype is null) and
        (a.branch_code =pbrachcode or pbrachcode is null))
        group by comp_code,doctype,reason,debit,credit)
        group by comp_code,doctype,reason
        order by comp_code,doctype,reason;

    End cir_rep_collection_det_p;

/*
var v1 refcursor;
var v2 refcursor;
exec cir_rep_collection.cir_rep_datewise_monthwise_p('SP002','AUR','RCR','','NM','','01/01/2011','31/01/2011','dd/mm/yyyy','D','','',:v1,:v2)
*/
PROCEDURE cir_rep_datewise_monthwise_p(
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pdoctype            in varchar2,
    ppaymode_reason     in varchar2,
    pactype             in varchar2,
    pagency_type        in varchar2,
    pfromdate           in varchar2,
    ptodate             in varchar2,
    pdateformat         in varchar2,
    prep                in varchar2,--this is used for datewise(D) or monthwise(M)
    pextra1             in varchar2,--for Branch
    pextra2             in varchar2,--for District
    P_Accounts          out T_Accounts_Cursor,
    P_Accounts1         out T_Accounts_Cursor)
    As
    v_frdt date;
        v_todt date;
    cursor cur_reason is
        select distinct --'sum(decode(a.doctype||''#''||a.reason,'||''''||a.doctype||'#'||a.reason||''''||',a.amount,0)) "'||a.doctype||'#'||reason||'"' vreason,
        'CASE WHEN A.DOCTYPE||''#''||A.REASON='||''''||A.DOCTYPE||'#'||A.REASON||''''||' THEN ABS(SUM(A.AMOUNT)) ELSE 0 END "'||a.doctype||'#'||reason||'"' vreason,
        a.doctype||'#'||a.reason reason
        from cir_rcphdr a,cir_agmast b
        where a.comp_code=pcompcode and a.comp_code=b.comp_code and a.unit_code=b.unit and
                 (a.unit_code=punitcode or punitcode is null) and a.agcd=b.agcd and a.dpcd=b.dpcd and
                 (b.ag_type=pagency_type or pagency_type is null) and (a.doctype=pdoctype or pdoctype is null) and
                  a.recptdt between v_frdt and v_todt and
                (a.reason=ppaymode_reason or ppaymode_reason is null) and (a.achd=pactype or pactype is null) and
                (a.branch_code=pextra1 or pextra1 is null) and (b.dist_code=pextra2 or pextra2 is null)
            order by reason;
     rec_reason cur_reason%rowtype;
     vvar       varchar2(4000);
     vvar_sum   varchar2(4000);
     vquery     varchar2(4000);
Begin
    v_frdt :=to_date(pfromdate,''''||pdateformat||'''');
    v_todt :=to_date(ptodate,''''||pdateformat||'''');
    --delete from test1;
    open cur_reason;
    loop
        fetch cur_reason into rec_reason;
        exit when cur_reason%notfound;
        if vvar is null then
            vvar        :=rec_reason.vreason;
            vvar_sum    :='sum("'||rec_reason.reason||'") "'||rec_reason.reason||'"';
        else
            vvar        :=vvar||','||rec_reason.vreason;
            vvar_sum    :=vvar_sum||',sum("'||rec_reason.reason||'") "'||rec_reason.reason||'"';
        end if;
    end loop;
    close cur_reason;
        --insert into test1(vstring,vstring2) values('date collection',vvar);commit;
    if vvar is not null and prep in('D','M') then
        if prep='D' then
            vquery:='select comp_code as "COMP_CODE",unit_code AS "UNIT_CODE",recptdt AS "RECPTDT",'||vvar_sum||' from
                (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a,cir_agmast b
                where a.comp_code=b.comp_code and a.comp_code='||''''||pcompcode||''''||' and a.unit_code=b.unit and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type='||''''||pagency_type||''''||' or '||''''||pagency_type||''''||' is null) and
                (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null) and
                (a.branch_code='||''''||pextra1||''''||' or '||''''||pextra1||''''||' is null) and (b.dist_code='||''''||pextra2||''''||' or '||''''||pextra2||''''||' is null)
                group by a.comp_code,a.unit_code,a.recptdt,a.doctype,a.reason)
                group by comp_code,unit_code,recptdt
                order by comp_code,unit_code,recptdt';
                --insert into test1(vstring,vstring2) values('date collection vquery',vquery);commit;
                
            open P_Accounts for vquery;
            vquery:='select comp_code as "COMP_CODE",unit_code AS "UNIT_CODE",'||vvar_sum||' from
                    (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a,cir_agmast b
                    where a.comp_code=b.comp_code and a.comp_code='||''''||pcompcode||''''||' and a.unit_code=b.unit and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                           a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type='||''''||pagency_type||''''||' or '||''''||pagency_type||''''||' is null) and
                           (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                            (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null) and
                            (a.branch_code='||''''||pextra1||''''||' or '||''''||pextra1||''''||' is null) and (b.dist_code='||''''||pextra2||''''||' or '||''''||pextra2||''''||' is null)
                        group by a.comp_code,a.unit_code,a.recptdt,a.doctype,a.reason)
                        group by comp_code,unit_code
                        order by comp_code,unit_code';
            --insert into test1(vstring,vstring2) values('date collection vquery2',vquery);commit;
            open P_Accounts1 for vquery;
        else
            vquery:='select comp_code as "COMP_CODE",unit_code AS "UNIT_CODE",trunc(recptdt,''mm'') AS DT,to_char(trunc(recptdt,''mm''),''MON-YYYY'') AS "RECPTDT",'||vvar_sum||' from
                    (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a,cir_agmast b
                    where a.comp_code=b.comp_code and a.comp_code='||''''||pcompcode||''''||' and a.unit_code=b.unit and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                          a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type='||''''||pagency_type||''''||' or '||''''||pagency_type||''''||' is null) and
                          (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                          (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null) and
                          (a.branch_code='||''''||pextra1||''''||' or '||''''||pextra1||''''||' is null) and (b.dist_code='||''''||pextra2||''''||' or '||''''||pextra2||''''||' is null)
                        group by a.comp_code,a.unit_code,a.recptdt,a.doctype,a.reason)
                        group by comp_code,unit_code,trunc(recptdt,''mm''),to_char(trunc(recptdt,''mm''),''MON-YYYY'')
                        order by comp_code,unit_code,3';
            --insert into test1(vstring,vstring2) values('date collection vquery',vquery);commit;
            open P_Accounts for vquery;
            vquery:='select comp_code as "COMP_CODE",unit_code AS "UNIT_CODE",'||vvar_sum||' from
                    (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a,cir_agmast b
                    where a.comp_code='||''''||pcompcode||''''||' and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                          a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type='||''''||pagency_type||''''||' or '||''''||pagency_type||''''||' is null) and
                          (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                          (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null) and
                          (a.branch_code='||''''||pextra1||''''||' or '||''''||pextra1||''''||' is null) and (b.dist_code='||''''||pextra2||''''||' or '||''''||pextra2||''''||' is null)
                        group by a.comp_code,a.unit_code,a.recptdt,a.doctype,a.reason)
                        group by comp_code,unit_code
                        order by comp_code,unit_code';
            --insert into test1(vstring,vstring2) values('date collection vquery2',vquery);commit;
            open P_Accounts1 for vquery;
        end if;
    else
        vquery:='select '||''''||pcompcode||''''||' "comp_code",'||''''||punitcode||''''||' "unit_code",'||''''||trunc(sysdate)||''''||' "recptdt" from dual where 1=2';
        open P_Accounts for vquery;
        vquery:='select '||''''||pcompcode||''''||' "comp_code",'||''''||punitcode||''''||' "unit_code" from dual  where 1=2';
        open P_Accounts1 for vquery;
    end if;
End cir_rep_datewise_monthwise_p;

--var v1 refcursor;
--var v2 refcursor;
--exec cir_rep_collection.cir_rep_unitwise_monthwise_p('SP002','','RCR','','NM','01-apr-2010','31-dec-2010','dd/mm/yyyy','','',:v1,:v2);

PROCEDURE cir_rep_unitwise_monthwise_p(
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pdoctype            in varchar2,
    ppaymode_reason     in varchar2,
    pactype             in varchar2,
    pfromdate           in varchar2,
    ptodate             in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    P_Accounts          out T_Accounts_Cursor,
    P_Accounts1         out T_Accounts_Cursor)
    As
    v_frdt      date;
    v_todt      date;
    v_months    number:=0;
    v_cnt       number:=0;
    v_dt        date;
    vvar        varchar2(4000);
    vvar_sum    varchar2(4000);
    vquery      varchar2(4000);
    Begin
        v_frdt     :=to_date(pfromdate,''''||pdateformat||'''');
        v_todt     :=to_date(ptodate,''''||pdateformat||'''');
        select round(months_between(trunc(v_todt,'mm'),trunc(v_frdt,'mm'))),trunc(v_frdt,'mm') into v_months,v_dt from dual;
        if v_months=0 then
            v_months:=0;
        end if;
        --delete from test1;commit;
        loop
            if v_cnt>v_months then
                exit;
            end if;
          if vvar is null then
            vvar        :='sum(decode(trunc(a.recptdt,''mm''),'||''''||v_dt||''''||',a.amount,0)) "'||v_dt||'"';
            vvar_sum:='sum("'||v_dt||'") "'||v_dt||'"';
        else
            vvar    :=vvar||',sum(decode(trunc(a.recptdt,''mm''),'||''''||v_dt||''''||',a.amount,0)) "'||v_dt||'"';
            vvar_sum:=vvar_sum||',sum("'||v_dt||'") "'||v_dt||'"';
        end if;
        v_dt        :=add_months(v_dt,1);
        v_cnt   :=v_cnt+1;
        end loop;
        --insert into test1(vstring,vstring2) values('unit monthwise vvar '||v_months,vvar);commit;
        if vvar is not null then
                vquery:='select comp_code,unit_code,(select min("Pub_Cent_name") from pub_cent_mast where "Pub_cent_Code"=unit_code) unit_name,'||vvar_sum||' from
                        (select a.comp_code comp_code,a.unit_code unit_code,trunc(a.recptdt,''mm'') recptdt,'||vvar||' from cir_rcphdr a
                        where a.comp_code='||''''||pcompcode||''''||' and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                               (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                                (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null)
                            group by a.comp_code,a.unit_code,trunc(a.recptdt,''mm''))
                            group by comp_code,unit_code
                            order by comp_code,unit_code';
                --insert into test1(vstring,vstring2) values('date collection vquery',vquery);commit;
                open P_Accounts for vquery;
                vquery:='select comp_code,'||vvar_sum||' from
                        (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,'||vvar||' from cir_rcphdr a
                        where a.comp_code='||''''||pcompcode||''''||' and (a.unit_code='||''''||punitcode||''''||' or '||''''||punitcode||''''||' is null) and
                               (a.doctype='||''''||pdoctype||''''||' or '||''''||pdoctype||''''||' is null) and a.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
                                (a.reason='||''''||ppaymode_reason||''''||' or '||''''||ppaymode_reason||''''||' is null) and (a.achd='||''''||pactype||''''||' or '||''''||pactype||''''||' is null)
                            group by a.comp_code,a.unit_code,a.recptdt,a.reason)
                            group by comp_code
                            order by comp_code';
                --insert into test1(vstring,vstring2) values('date collection vquery2',vquery);commit;
                open P_Accounts1 for vquery;
        else
            vquery:='select '||''''||pcompcode||''''||' "comp_code",'||''''||punitcode||''''||' "unit_code" from dual where 1=2';
            open P_Accounts for vquery;
            vquery:='select '||''''||pcompcode||''''||' "comp_code" from dual  where 1=2';
            open P_Accounts1 for vquery;
        end if;
    End    cir_rep_unitwise_monthwise_p;
End cir_rep_collection;
/

/****************************************************Laxman Sir end of issue no 4761 26/sep/11*********************************/
/********laxman sir       28-sept*****************/
                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE PACKAGE cir_rep_supply IS
  type t_accounts is ref cursor;
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl                 in varchar2,
     pmainedtn             in varchar2,
     pedtn                 in varchar2,
     proute                in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts);

   procedure cir_rep_supply_po(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

  procedure cir_rep_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

  procedure cir_rep_dist_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);  
  
  procedure cir_rep_taluka_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);  
     
  procedure cir_rep_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

  procedure cir_rep_dist_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);     

  procedure cir_rep_taluka_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);
     
  procedure cir_rep_route_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

    procedure cir_rep_dist_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
     
    procedure cir_rep_taluka_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

     procedure cir_route_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);
     
     procedure cir_dist_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

     procedure cir_taluka_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

     procedure cir_dist_taluka_wise_sup(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts);
     
    procedure cir_supply_comp(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     psupdate           in varchar2,
     psupdate1          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

    procedure cir_route_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_dist_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pdist              in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_taluka_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     ptaluka            in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_edition_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

     procedure cir_dist_taluka_publ_wise(
     pcompcode          in varchar2,
     punitcode          in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pmainedtn          in varchar2,
     pedtncode          in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pagtypecode        in varchar2,
     pagclasscode       in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
        
procedure cir_datewise_resale(
     pcompcode          in varchar2,
     punitcode          in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pmainedtn          in varchar2,
     pedtncode          in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pagtypecode        in varchar2,
     pagclasscode       in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);              
END;
/
CREATE OR REPLACE PACKAGE BODY cir_rep_supply IS
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts)
     As

     vfrom_supdate    date;
     vtill_supdate    date;
     cursor cur_sup_type is
         select 

'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) 

"'||sup_ty_name||'",' vty,
         'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) 

+' vty_sum
      from cir_supply_type_mast
      where comp_code=pcomp_code /*and sup_ty_code in(select distinct 

sup_type_code from cir_dbksup
      where comp_code=pcomp_code and unit_code=punit_code and
                  ((publ=ppubl) or (ppubl is null)) and ((edtn=pedtn) or (pedtn 

is null)) and
                  supdate between vfrom_supdate and vtill_supdate)*/
      order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar         varchar2(4000);
     vvar_sum    varchar2(4000);
     vquery     varchar2(4000);
     vquery1     varchar2(4000);
     vquery2     varchar2(4000);
     vquery3     varchar2(4000);
     vquery4     varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);commit;

    vquery:=' select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) 

publ_name,edtn,cir_get_edtn_name(comp_code,edtn) 

edtn_name,route_code,cir_get_route_name(comp_code,unit_code,route_code) 

route_name,agcd "AGENCY CODE",dpcd "AGENCY SUBCODE",
    substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY 

NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||p

dateformat||''''||','''',''''),1,50) "AGENCY ONAME",(select 

cir_get_city(m.comp_code,m.city_code) city_name from cir_agmast m where 

m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and 

m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY NAME",
    (select 

nvl(CIR_GET_NAME.CIR_CITY(m.comp_code,m.city_code,2,'||''''||pdateformat||''''|

|','''',''''),''NA'') city_name from cir_agmast m where 

m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and 

m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY 

ONAME",/*supdate,*/'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where 

comp_code='||
                ''''||pcomp_code||''''||' and 

unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and 

((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between 

'||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and 

to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||') and 

((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) 

and
               edtn in(select distinct edtn from cir_edtn_mast where 

comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or 

('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' 

or '||''''||pmainedtn||''''||' is null))
                group by 

comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/ order by 

comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/';
     ---insert into test1(vstring) values ('1'||vquery);commit;
      open p_accounts for vquery;

      vquery2:=' select comp_code,unit_code,publ,edtn,route_code, 

'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and 

unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and 

((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between 

'||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and 

to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or 

('||''''||proute||''''||' is null)) and
                edtn in(select distinct edtn from cir_edtn_mast where 

comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or 

('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' 

or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code
                order by comp_code,unit_code,publ,edtn,route_code';
        --insert into test1(vstring) values ('22'||vquery2);commit;
      open p_accounts2 for vquery2;

      vquery3:=' select comp_code,unit_code,publ,edtn, 

'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and 

unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and 

((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between 

'||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and 

to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or 

('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from 

cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = 

'||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 

(main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn
                order by comp_code,unit_code,publ,edtn';
      open p_accounts3 for vquery3;

      vquery4:=' select comp_code,unit_code,publ, '||vvar||','||vvar_sum||' 

TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and 

unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and 

((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between 

'||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and 

to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or 

('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from 

cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = 

'||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 

(main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ
                order by comp_code,unit_code,publ';
      open p_accounts4 for vquery4;

      vquery1:=' select comp_code,unit_code,'||vvar||','||vvar_sum||' TOTAL 

from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and 

unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and 

((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between 

'||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and 

to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or 

('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from 

cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = 

'||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 

(main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code';
        --insert into test1(vstring) values ('2'||vquery);commit;

     open p_accounts1 for vquery1;
  End cir_rep_supply1;

procedure cir_rep_supply_po(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is use for finalised or unfinalised
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts) as
     v_date             date;
     cursor cur_sup_type is
         select 

'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) 

"'||sup_ty_name||'",' vty,
             

'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) +' 

vty_sum,sup_seq_no
             from cir_supply_type_mast
             where comp_code=pcomp_code and (upper(pextra1)!='U' or pextra1 is 

null)
         union
         select 
            case when to_char(v_date,'DY')='SUN' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_sun,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='MON' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_mon,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='TUE' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_tue,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='WED' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_wed,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='THU' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_thu,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='FRI' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_fri,0),0)) "'||sup_ty_name||'",'
            else
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_sat,0),0)) "'||sup_ty_name||'",'
            end vty,
            
            case when to_char(v_date,'DY')='SUN' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_sun,0),0)) +'
            when to_char(v_date,'DY')='MON' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_mon,0),0)) +'
            when to_char(v_date,'DY')='TUE' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_tue,0),0)) +'
            when to_char(v_date,'DY')='WED' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_wed,0),0)) +'
            when to_char(v_date,'DY')='THU' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_thu,0),0)) +'
            when to_char(v_date,'DY')='FRI' then
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_fri,0),0)) +'
            else
                

'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,

0)+nvl(d.supply_sat,0),0)) +'
            end  vty_sum,
            

--'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',d.base_supply,0)

) "'||sup_ty_name||'",' vty,
             

--'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',d.base_supply,0)

) +' vty_sum,
             sup_seq_no
             from cir_supply_type_mast
             where comp_code=pcomp_code and upper(pextra1)='U'
             order by sup_seq_no;
     rec_sup_type cur_sup_type%rowtype;

cursor cur_dbk is
            select x.comp_code comp_code,x.unit_code unit_code,x.supdate 

supdate,x.publ_name publ_name,x.mainedtn_name mainedtn_name,
            x.main_edtn_seqno main_edtn_seqno,x.edtn_name 

edtn_name,x.edtn_seq_no edtn_seq_no,x.sup_ty_name sup_ty_name,
            x.sup_seq_no sup_seq_no,x.sup_rate sup_rate,x.supply_copy 

supply_copy,x.supl_name supl_name,x.pgno pgno from
            (select d.comp_code comp_code,d.unit_code unit_code,d.supdate 

supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) 

mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no 

edtn_seq_no,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seq_no,d.sup_rate 

sup_rate, sum(d.sup_copy) supply_copy,
            

cir_get_edtn_supl(d.comp_code,d.unit_code,e.edtn,d.supdate,pdateformat,1,null,n

ull,null,null,null) supl_name,
            case when to_char(d.supdate,'DY')='SUN' then min(e.pgno_sun)
                when to_char(d.supdate,'DY')='MON' then min(e.pgno_mon)
                when to_char(d.supdate,'DY')='TUE' then min(e.pgno_tue)
                when to_char(d.supdate,'DY')='WED' then min(e.pgno_wed)
                when to_char(d.supdate,'DY')='THU' then min(e.pgno_thu)
                when to_char(d.supdate,'DY')='FRI' then min(e.pgno_fri) else 

min(e.pgno_sat) end pgno
            from cir_dbksup d,cir_edtn_mast e,cir_publ_mast 

p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and 

d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit_code=e.unit_code and (d.unit_code=punit_code or punit_code 

is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is 

null) and 
            d.edtn=e.edtn and d.supdate =v_date and 

d.sup_type_code=t.sup_ty_code and upper(pextra1)!='U'
            group by 

d.comp_code,d.unit_code,d.supdate,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.

edtn_seq_no,t.sup_ty_name,t.sup_seq_no,d.sup_rate
            union
            select d.comp_code comp_code,d.unit unit_code,v_date 

supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) 

mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no 

edtn_seq_no,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seq_no,
            

cir_get_edtn_rate(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),'dd/mm

/yyyy') sup_rate, 
            case when to_char(v_date,'DY')='SUN' then 

sum(nvl(d.base_supply,0)+nvl(d.supply_sun,0))
                 when to_char(v_date,'DY')='MON' then 

sum(nvl(d.base_supply,0)+nvl(d.supply_mon,0))
                 when to_char(v_date,'DY')='TUE' then 

sum(nvl(d.base_supply,0)+nvl(d.supply_tue,0))
                 when to_char(v_date,'DY')='WED' then 

sum(nvl(d.base_supply,0)+nvl(d.supply_wed,0))
                 when to_char(v_date,'DY')='THU' then 

sum(nvl(d.base_supply,0)+nvl(d.supply_thu,0))
                 when to_char(v_date,'DY')='FRI' then 

sum(nvl(d.base_supply,0)+nvl(d.supply_fri,0))
            else sum(nvl(d.base_supply,0)+nvl(d.supply_sat,0)) end supply_copy,
            

cir_get_edtn_supl(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),pdatef

ormat,1,null,null,null,null,null) supl_name,
            case when to_char(v_date,'DY')='SUN' then min(e.pgno_sun)
                when to_char(v_date,'DY')='MON' then min(e.pgno_mon)
                when to_char(v_date,'DY')='TUE' then min(e.pgno_tue)
                when to_char(v_date,'DY')='WED' then min(e.pgno_wed)
                when to_char(v_date,'DY')='THU' then min(e.pgno_thu)
                when to_char(v_date,'DY')='FRI' then min(e.pgno_fri) else 

min(e.pgno_sat) end pgno
            from cir_supply d,cir_edtn_mast e,cir_publ_mast 

p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and 

d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit=e.unit_code and (d.unit=punit_code or punit_code is null) 

and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supply_flag='Y' and 

d.supply_type_code=t.sup_ty_code and upper(pextra1)='U'
            group by 

d.comp_code,d.unit,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.s

up_ty_name,t.sup_seq_no) x
            order by 

comp_code,unit_code,supdate,publ_name,main_edtn_seqno,mainedtn_name,edtn_seq_no

,edtn_name,sup_seq_no,sup_ty_name;
        
        rec_dbk cur_dbk%rowtype;
                                            
    vvar        varchar2(4000);
    vvar_sum    varchar2(4000);
    vquery      varchar2(4000);
    vquery1     varchar2(4000);
    v_count     number(5);
    vlength     number(7);
    vrunval     varchar2(8000);
    v_val       varchar2(800);
    v_name      varchar2(8000);
    vno         number:=0;
  Begin
    if upper(pextra1)='U' then  
        v_date:=to_date(trunc(sysdate),''''||pdateformat||'''');
    else
        v_date:=to_date(psupdate,''''||pdateformat||'''');
    end if;    
    
    delete from cir_temp_bill_collection where 

cur_sessionid=userenv('sessionid');
    delete from cir_ledger_report where sess_id=userenv('sessionid');commit;
    delete from test1;commit;
    open cur_dbk;
    loop
        fetch cur_dbk into rec_dbk;
        exit when cur_dbk%notfound;
        
        v_count:=nvl(v_count,0)+1;
        if rec_dbk.pgno=0 then
            rec_dbk.pgno:=null;
        end if;
        
        vlength :=null; v_val :=null; vrunval :=null; vno:=null;

        v_val   :=replace(rec_dbk.supl_name||'+','+',',');
        vlength :=length(v_val);
        vno:=1;

        for i in 1.. vlength loop
        vrunval:=substr(v_val,i,1);
        if vrunval!=',' then
            v_name:=v_name||vrunval;
        else
            insert into cir_ledger_report(comp_code, unit_code, recptdt,agcd, 

dpcd, recptno, chq_bank, rec_seqno,sess_id)
                    values 

(rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_

name,rec_dbk.edtn_name,v_name,rec_dbk.supply_copy,userenv('sessionid'));
            vno:=vno+1;
            v_name:='';
        end if;
        end loop;
        
        insert into cir_temp_bill_collection
        (comp_code, unit_code, billdt, publ_code, agcd, dpcd, supply_copy, 

gross_amt, 
        cur_sessionid, agname,return_copy,sec_opbal,remarks)
        values
        

(rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_

name,rec_dbk.edtn_name,rec_dbk.supply_copy,rec_dbk.sup_rate,
        

userenv('sessionid'),rec_dbk.sup_ty_name,rec_dbk.pgno,v_count,replace(rec_dbk.s

upl_name||'+','+',' = '||rec_dbk.supply_copy));
    end loop;
    close cur_dbk;
         
    --delete from test1;commit;
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
                vvar:=vvar||rec_sup_type.vty;
                vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (pextra1||' '||vquery);
    if upper(pextra1)='U' then  
        vquery:=' select d.comp_code comp_code,d.unit unit_code,d.publ 

publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,e.edtn_name 

"EDITION NAME",
                to_char(sysdate'||','||''''||pdateformat||''''||') 

supdate,'||vvar||','||vvar_sum||' 

TOTAL,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,e.edtn_seq_no 

edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) 

main_edtn_seqno,cir_get_edtn_supl(d.comp_code,d.unit_code,d.edtn,to_date(sysdat

e),'||''''||pdateformat||''''||',1,null,null,null,null,null) supl_name from 

cir_agmast m,cir_supply d,cir_edtn_mast e
                where d.comp_code='||''''||pcomp_code||''''||' and 

d.comp_code=e.comp_code and d.comp_code=m.comp_code and 

d.unit='||''''||punit_code||''''||' and d.unit=e.unit_code and d.unit=m.unit 

and d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.publ=e.publ and
                d.supply_flag='||'''Y'''||' and 

nvl(m.suspend_type,''N'')='||'''N'''||' and d.edtn=e.edtn and d.agcd=m.agcd and 

d.dpcd=m.dpcd
                group by 

d.comp_code,d.unit,d.publ,e.main_edtn,d.edtn,sysdate,e.edtn_name,e.edtn_seq_no 

order by 

d.comp_code,d.unit,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn';
    else
        vquery:=' select d.comp_code comp_code,d.unit_code unit_code,d.publ 

publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,e.edtn_name 

"EDITION NAME",
                to_char(d.supdate'||','||''''||pdateformat||''''||') 

supdate,'||vvar||','||vvar_sum||' 

TOTAL,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,e.edtn_seq_no 

edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) 

main_edtn_seqno,cir_get_edtn_supl(d.comp_code,d.unit_code,d.edtn,d.supdate,'||'

'''||pdateformat||''''||',1,null,null,null,null,null) supl_name from cir_dbksup 

d,cir_edtn_mast e
                where d.comp_code='||''''||pcomp_code||''''||' and 

d.comp_code=e.comp_code and d.unit_code='||''''||punit_code||''''||' and 

d.unit_code=e.unit_code and d.publ=nvl('||''''||ppubl||''''||',d.publ) and 

d.publ=e.publ /*and ((e.edtn='||''''||pedtn||''''||') or 

('||''''||pedtn||''''||' is null))*/ and
                d.supdate='||''''||v_date||''''||' and d.edtn=e.edtn
                group by 

d.comp_code,d.unit_code,d.publ,e.main_edtn,d.edtn,d.supdate,e.edtn_name,e.edtn_

seq_no order by 

d.comp_code,d.unit_code,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn'

;
    end if;                    
    --insert into test1(vstring) values ('1 pextra1 '||vquery);commit;

    open p_accounts for vquery;
    if upper(pextra1)='U' then
    vquery1:=' select d.comp_code comp_code,d.unit unit_code,d.publ 

publ,cir_get_publ_name(d.comp_code,d.publ) 

publ_name,'||vvar||','||vvar_sum||'TOTAL from cir_agmast m,cir_supply d where 

d.comp_code=m.comp_code and d.comp_code='||''''||pcomp_code||''''||' and 

d.unit=m.unit and d.unit='||''''||punit_code||''''||' and
            d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.agcd=m.agcd and 

d.dpcd=m.dpcd and d.supply_flag='||'''Y'''||' and 

nvl(m.suspend_type,''N'')='||'''N'''||'
            group by d.comp_code,d.unit,d.publ order by 

d.comp_code,d.unit,d.publ';
    else
    vquery1:=' select d.comp_code comp_code,d.unit_code unit_code,d.publ 

publ,cir_get_publ_name(d.comp_code,d.publ) 

publ_name,'||vvar||','||vvar_sum||'TOTAL from cir_dbksup d where 

d.comp_code='||''''||pcomp_code||''''||' and 

d.unit_code='||''''||punit_code||''''||' and
            d.publ=nvl('||''''||ppubl||''''||',d.publ) and 

supdate='||''''||v_date||''''||'
            group by d.comp_code,d.unit_code,d.publ order by 

d.comp_code,d.unit_code,d.publ';
    end if;
    --insert into test1(vstring) values ('2 pextra1 '||vquery1);commit;

    open p_accounts1 for vquery1;
  End cir_rep_supply_po;

  procedure cir_rep_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY 

SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY 

NAME",
       

substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'','

'),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION 

NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') 

"EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY 

CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",
       nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') 

"CITY ONAME",
       nvl(STATE_CODE,'NA') "STATE 

CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE 

NAME",COUNTRY_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) 

AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS 

"09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS 

"14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS 

"19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS 

"24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS 

"29",SUM(p30) AS "30",SUM(p31) AS "31",
        

SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0

)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            

nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nv

l(p18,0)+nvl(p19,0)+nvl(p20,0)+
            

nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nv

l(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD 

AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE 

STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) 

p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND 

A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND
        A.PUBL=PPUBL AND A.EDTN=NVL(PEDTN,A.EDTN) AND (B.CITY_CODE=PCITYCD OR 

PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE 

OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR 

PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 

IS NULL) AND 
        A.SUPDATE >= VFRDT AND A.SUPDATE <=VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY 

A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,/*A.EDTN,*/B.CITY_CODE,B.STATE_

CODE,B.COUNTRY_CODE)
        GROUP BY 

COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,'NA') "STATE 

CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE 

NAME",COUNTRY_CODE,
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS 

"04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS 

"09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS 

"14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS 

"19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS 

"24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS 

"29",SUM(p30) AS "30",SUM(p31) AS "31",
        

SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0

)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        

nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nv

l(p18,0)+nvl(p19,0)+nvl(p20,0)+
        

nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nv

l(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE 

UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) 

p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND 

A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND 

(B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE 

OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR 

PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 

IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<= VTODT    AND 

NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS 

"03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS 

"09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS 

"14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS 

"19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS 

"24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS 

"29",SUM(p30) AS "30",SUM(p31) AS "31",
        

SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0

)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        

nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nv

l(p18,0)+nvl(p19,0)+nvl(p20,0)+
        

nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nv

l(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) 

p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND 

A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND 

(B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE 

OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR 

PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 

IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<=VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_daybook;

  procedure cir_rep_dist_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt            date;
     vtodt            date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY 

SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY 

NAME",
       

substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'','

'),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION 

NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') 

"EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY 

CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY 

NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') 

"CITY ONAME",
       nvl(DIST_CODE,'NA') "DIST 

CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT 

NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'N

A') "DISTRICT ONAME",
       STATE_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) 

AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS 

"09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS 

"14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS 

"19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS 

"24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS 

"29",SUM(p30) AS "30",SUM(p31) AS "31",
        

SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0

)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            

nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nv

l(p18,0)+nvl(p19,0)+nvl(p20,0)+
        

nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nv

l(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD 

AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.DIST_CODE 

DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) 

p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND 

A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND 

(B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE 

OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR 

PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 

IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT    AND 

NVL(A.SUP_COPY,0)>0
        GROUP BY 

A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.STATE

_CODE)
        GROUP BY 

COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,DIST_CODE,STATE_CODE
        ORDER BY 

COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,'NA') 

DIST_CODE,nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT 

NAME",
       

nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') 

"DISTRICT ONAME",STATE_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS 

"04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS 

"09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS 

"14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS 

"19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS 

"24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS 

"29",SUM(p30) AS "30",SUM(p31) AS "31",
        

SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0

)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        

nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nv

l(p18,0)+nvl(p19,0)+nvl(p20,0)+
        

nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nv

l(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE 

UNIT_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) 

p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND 

A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND 

(B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE 

OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR 

PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 

IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT  AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS 

"04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS 

"09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS 

"14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS 

"19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS 

"24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS 

"29",SUM(p30) AS "30",SUM(p31) AS "31",
        

SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0

)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        

nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nv

l(p18,0)+nvl(p19,0)+nvl(p20,0)+
        

nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nv

l(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) 

p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND 

A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND 

(B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE 

OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR 

PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 

IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_dist_daybook;

  procedure cir_rep_taluka_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY 

SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY 

NAME",
       

substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'','

'),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION 

NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') 

"EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY 

CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY 

NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') 

"CITY ONAME",
       nvl(TEHSIL_TALUKA,'NA') "TALUKA 

CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA 

NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),

'NA') "TALUKA ONAME",
       STATE_CODE "STATE CODE",
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS 

"04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS 

"09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS 

"14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS 

"19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS 

"24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS 

"29",SUM(p30) AS "30",SUM(p31) AS "31",
        

SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0

)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            

nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nv

l(p18,0)+nvl(p19,0)+nvl(p20,0)+
        

nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nv

l(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD 

AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA 

TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) 

p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND 

A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND 

(B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE 

OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR 

PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 

IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY 

A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.TEHSIL_TALUKA,B.S

TATE_CODE)
        GROUP BY 

COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY 

COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,'NA') "TALUKA 

CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",
       

nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') 

"TALUKA ONAME",STATE_CODE "STATE CODE",
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS 

"04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS 

"09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS 

"14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS 

"19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS 

"24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS 

"29",SUM(p30) AS "30",SUM(p31) AS "31",
        

SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0

)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        

nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nv

l(p18,0)+nvl(p19,0)+nvl(p20,0)+
        

nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nv

l(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE 

UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) 

p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND 

A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND 

(B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE 

OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR 

PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 

IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY 

A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS 

"04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS 

"09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS 

"14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS 

"19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS 

"24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS 

"29",SUM(p30) AS "30",SUM(p31) AS "31",
        

SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0

)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        

nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nv

l(p18,0)+nvl(p19,0)+nvl(p20,0)+
        

nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nv

l(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) 

p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, 

DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND 

A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND 

(B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE 

OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR 

PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 

IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_taluka_daybook;

  procedure cir_rep_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(12000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order 

by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            

vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl

(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS 

'||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            

vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd'

)||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS 

'||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    insert into test1(vstring,vstring2) values('1 

'||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY 

SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY 

NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||p

dateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION 

NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||'''

'||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY 

CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY 

NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||'''

'||','''',''''),''NA'') "CITY ONAME",
       nvl(STATE_CODE,''NA'') "STATE 

CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE 

NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD 

AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE 

STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND 

A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND 

A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' 

IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND 

(B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND 

(B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND 

(B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND A.SUPDATE >= '''||VFRDT||''' AND 

A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND 

upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY 

A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUN

TRY_CODE)
        GROUP BY 

COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       insert into test1(vstring,vstring2) values('2 

'||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,''NA'') "STATE 

CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE 

NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE 

UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND 

A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND 

A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' 

IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND 

(B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND 

(B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND 

(B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR 

'''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= 

'''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND 

upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE';
insert into test1(vstring,vstring2) values('3 '||vquery3,VQUERY2);commit;
       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS 

"TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE 

UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND 

A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND 

A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' 

IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND 

(B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND 

(B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND 

(B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR 

'''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= 

'''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND 

upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
        
insert into test1(vstring,vstring2) values('4 '||vquery3,VQUERY2);commit;       

 
       open p_accounts2 for vquery3||vquery2;

  End cir_rep_day_daybook;

  procedure cir_rep_dist_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order 

by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            

vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl

(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS 

'||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            

vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd'

)||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS 

'||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 

'||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY 

SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY 

NAME",
    

substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdatefo

rmat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION 

NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||'''

'||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY 

CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY 

NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||'''

'||','''',''''),''NA'') "CITY ONAME",
       nvl(DIST_CODE,''NA'') "DIST 

CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT 

NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat|

|''''||','''',''''),''NA'') "DISTRICT ONAME",
       COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD 

AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE 

STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND 

A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND 

A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' 

IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND 

(B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND 

(B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND 

(B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR 

'''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= 

'''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND 

upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY 

A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST

_CODE,B.COUNTRY_CODE)
        GROUP BY 

COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY 

COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 

'||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,''NA'') "DIST 

CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT 

NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat|

|''''||','''',''''),''NA'') "DISTRICT ONAME",COUNTRY_CODE "COUNTRY 

CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE 

STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='  FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND 

A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND 

A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' 

IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND 

(B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND 

(B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND 

(B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR 

'''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= 

'''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND 

upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY 

A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS 

"TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE 

UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND 

A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND 

A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' 

IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND 

(B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND 

(B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND 

(B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR 

'''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND 

NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_dist_day_daybook;

  procedure cir_rep_taluka_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order 

by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            

vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl

(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS 

'||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            

vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd'

)||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS 

'||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 

'||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY 

SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY 

NAME",
       

substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdatefo

rmat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION 

NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||'''

'||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY 

CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY 

NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||'''

'||','''',''''),''NA'') "CITY ONAME",
       nvl(TEHSIL_TALUKA,''NA'') "TALUKA 

CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA 

NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateforma

t||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY 

CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD 

AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA 

TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND 

A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND 

A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' 

IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND 

(B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND 

(B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND 

(B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR 

'''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND 

NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY 

A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,TEHSIL_TALUKA,B.COU

NTRY_CODE)
        GROUP BY 

COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 

'||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,''NA'') "TALUKA 

CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA 

NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateforma

t||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY 

CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE 

UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND 

A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND 

A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' 

IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND 

(B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND 

(B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND 

(B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND 

NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY 

A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS 

"TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE 

UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND 

A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND 

A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND 

A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' 

IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND 

(B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND 

(B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND 

(B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' 

OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND 

NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_taluka_day_daybook;

  Procedure cir_rep_route_challan(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     pperiod        in number,
     prmode         in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts)
  As
      vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where 

comp_code=pcomp_code and edtn in(select distinct 

edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = 

punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select 

route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) 

and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vquery     varchar2(4000);
  Begin
    --insert into test1(vstring,vstring2) values('1111 '||vvar,' vsupdate 

'||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');
    --insert into test1(vstring,vstring2) values('2222 '||vvar,' vsupdate 

'||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              

vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_

edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'s

um(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn

,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,

punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    

vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"

'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat

)||'"';
                end if;
    end loop;
    close cur_edtn;
    --vvar:=substr(vvar,1,length(vvar)-1);
    --insert into test1(vstring,vstring2) values('1 '||vvar,' vsupdate 

'||vsupdate);commit;

        if vvar is null then
            vquery:='select a.route "ROUTE 

CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt 

"SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) 

"SUBROUTE NAME",a.sub_subrt "SUB 

SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.s

ub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY 

SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY 

CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL 

PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and 

a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = 

'||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and 

a.publ in (select publ from cir_publ_mast where comp_code = 

'||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and 

a.route in (select route_code from cir_route_mast where comp_code = 

'||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or 

('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' 

group by 

a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_sub

route_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_sub

route_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b

.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by 

a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        else
            vquery:='select a.route "ROUTE 

CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt 

"SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) 

"SUBROUTE NAME",a.sub_subrt "SUB 

SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.s

ub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY 

SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY 

CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL 

PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY 

COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and 

a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = 

'||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and 

a.publ in (select publ from cir_publ_mast where comp_code = 

'||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and 

a.route in (select route_code from cir_route_mast where comp_code = 

'||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or 

('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' 

group by 

a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_sub

route_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_sub

route_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b

.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by 

a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('2 '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_route_challan;

procedure cir_rep_dist_challan(
   pcomp_code       in varchar2,
   punit_code       in varchar2,
   pperiod          in number,
   prmode           in varchar2,
   psupdate         in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2,
   p_accounts       out t_accounts)
   As
     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where 

comp_code=pcomp_code and edtn in(select distinct 

edtn_1--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = 

punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select 

route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) 

and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
Begin
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');

    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              

vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_

edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'s

um(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn

,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,

punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    

vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"

'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat

)||'"';
                end if;
    end loop;
    close cur_edtn;
        if vvar is null then
            vquery:='select b.dist_code "DISTRICT 

CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd 

"AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY 

CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL 

PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and 

a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = 

'||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and 

a.publ in (select publ from cir_publ_mast where comp_code = 

'||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and 

a.route in (select route_code from cir_route_mast where comp_code = 

'||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or 

('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' 

group by 

b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.

ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by 

b.dist_code,b.ag_name';--,'||vvar||'
        else
            vquery:='select b.dist_code "DISTRICT 

CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd 

"AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY 

CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL 

PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY 

COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and 

a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = 

'||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and 

a.publ in (select publ from cir_publ_mast where comp_code = 

'||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and 

a.route in (select route_code from cir_route_mast where comp_code = 

'||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or 

('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' 

group by 

b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.

ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by 

b.dist_code,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('DIST '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_dist_challan;

    procedure cir_rep_taluka_challan(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        pperiod        in number,
        prmode         in varchar2,
        psupdate       in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     As

     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where 

comp_code=pcomp_code and edtn in(select distinct 

edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = 

punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select 

route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) 

and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
    Begin
        vsupdate:=to_date(psupdate,''''||pdateformat||'''');

        open cur_edtn;
        loop
            fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
                    if vvar is null then
                  

vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_

edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'s

um(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn

,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,

punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    else
                        

vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"

'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat

)||'"';
                    end if;
        end loop;
        close cur_edtn;
        if vvar is null then
        vquery:='select b.tehsil_taluka "TALUKA 

CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY 

CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY 

CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL 

PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd 

= b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and 

a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from 

cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = 

'||''''||pperiod||''''||') and a.route in (select route_code from 

cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode 

= '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and 

a.lbl_dt = '||''''||vsupdate||''''||' group by 

b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_

name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by 

b.tehsil_taluka,b.ag_name';--,'||vvar||'
        else
        vquery:='select b.tehsil_taluka "TALUKA 

CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY 

CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY 

CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL 

PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY 

COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd 

= b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and 

a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from 

cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = 

'||''''||pperiod||''''||') and a.route in (select route_code from 

cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode 

= '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and 

a.lbl_dt = '||''''||vsupdate||''''||' group by 

b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_

name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by 

b.tehsil_taluka,b.ag_name';--,'||vvar||'
        end if;
        --insert into tes t1(vstring,vstring2) values('TALUKA 

'||vquery,null);commit;
        open p_accounts for vquery;

    End cir_rep_taluka_challan;

    procedure cir_route_wise_supply(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        ppubl          in varchar2,
        pmainedtn      in varchar2,
        pedtn          in varchar2,
        proute         in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts,
        p_accounts1    out t_accounts,
        p_accounts2    out t_accounts,
        p_accounts3    out t_accounts)
     As
        vfrom_supdate    date;
        vtill_supdate    date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               

cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_c

ode,cir_dbksup.route_code) route_name,
               

cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,

sum(sup_copy),
               

cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_

code) route_seqno,
               

cir_get_supply_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,ppubl,pedtn,cir_

dbksup.agcd,cir_dbksup.dpcd) supply_seqno
               from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate 

and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by 

cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,
                           

cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by 

cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code,sup

ply_seqno ,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               

cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_c

ode,cir_dbksup.route_code) route_name,
               

sum(sup_copy),cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir

_dbksup.route_code) route_seqno from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate 

and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by 

cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code
                  order by 

cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate 

and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                       order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) 

sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate 

and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
    End cir_route_wise_supply;

    procedure cir_dist_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vfrom_supdate  date;
     vtill_supdate  date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               

cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,ci

r_agmast.dist_code) dist_name,
               

cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,

sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate 

and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.dist_code,cir_agmast.state_code,
                            

cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               

cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,ci

r_agmast.dist_code) dist_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate 

and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by 

cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_agmast.state

_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate 

and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) 

sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate 

and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
  End cir_dist_wise_supply;

    procedure cir_taluka_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vsupdate date;
     vsupdate1 date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               

cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_

taluka) taluka_name,
               

cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,

sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) 

and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.tehsil_taluka,
                            

cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by 

cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               

cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_

taluka) taluka_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) 

and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.tehsil_taluka
                  order by 

cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) 

and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) 

sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) 

and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_taluka_wise_supply;


    procedure cir_dist_taluka_wise_sup(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts,
     p_accounts4    out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select 

cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_get_dist(cir

_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               

cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_

taluka) taluka_name,
               

cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,

sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) 

and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            

cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka,
                            

cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by 

cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
        

cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) 

dist_name,cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agma

st.tehsil_taluka) taluka_name,
        sum(sup_copy) from cir_dbksup,cir_agmast
        where cir_dbksup.comp_code = cir_agmast.comp_code and
        cir_dbksup.unit_code = cir_agmast.unit and
        cir_dbksup.agcd = cir_agmast.agcd and
        cir_dbksup.dpcd = cir_agmast.dpcd and
        cir_dbksup.comp_code = pcomp_code and
        cir_dbksup.unit_code = punit_code and
        cir_dbksup.publ = ppubl and
        ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
        cir_dbksup.supdate between vsupdate and vsupdate1 and
        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where 

comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
        group by cir_dbksup.comp_code,cir_dbksup.unit_code,
        cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka
        order by 

cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
               

cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) 

dist_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) 

and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.state_code,cir_agmast.dist_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts3 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) 

and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts4 for
        select cir_dbksup.comp_code comp_code, sum(sup_copy) 

sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) 

and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 

where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_dist_taluka_wise_sup;

     procedure cir_supply_comp(
         pcomp_code     in varchar2,
         punit_code     in varchar2,
         ppublication   in varchar2,
         psupdate       in varchar2,
         psupdate1      in varchar2,
         pdateformat    in varchar2,
         pextra1        in varchar2,
         pextra2        in varchar2,
         p_accounts     out t_accounts,
         p_accounts1    out t_accounts,
         p_accounts2    out t_accounts,
         p_accounts3    out t_accounts)
     as
        vsupdate     date;
        vsupdate1    date;
     begin
        vsupdate    :=to_date(psupdate,''''||pdateformat||'''');
        vsupdate1   :=to_date(psupdate1,''''||pdateformat||'''');
        --insert into test1(vstring,vstring2) 

values(pcomp_code||','||punit_code||','||ppublication,psupdate||','||pdateforma

t||','||pextra1||','||','||pextra2); commit;
        open p_accounts for
             select comp_code,(select "Pub_Cent_name" from pub_cent_mast where 

"Pub_cent_Code"= unit_code) unit_code,publ,cir_get_publ_name(comp_code,publ) 

publ_name,edtn,edtn_name,edtn_name_oth_lang,
             main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             prev_sup,curr_sup,nvl(curr_sup,0)-nvl(prev_sup,0) 

diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) 

mainedtn_seqno,cir_get_edtn_seqno(comp_code,edtn) edtn_seqno from
                    (select distinct 

comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) 

and
                               (unit_code =punit_code or punit_code is null) 

and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               order by 

unit_code,publ_seqno,publ_name,mainedtn_seqno,main_edtn_name,edtn_seqno,edtn_na

me;

        open p_accounts1 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) 

publ_name,main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             sum(prev_sup) prev_sup,sum(curr_sup) 

curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) 

diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno
             from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) 

and
                               (unit_code =punit_code or punit_code is null) 

and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code,main_edtn
                               order by 

unit_code,publ_seqno,publ_name,mainedtn_seqno,main_edtn_name;
        open p_accounts2 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) 

publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) 

curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) 

and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code
                               order by unit_code,publ_seqno,publ_name;

             open p_accounts3 for
             select comp_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) 

curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct 

comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code=cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) 

and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ
                               order by publ_seqno,publ_name;

     End cir_supply_comp;

    procedure cir_route_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    proute              in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,--it is use for finalised or unfinalised
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate     date;
     vseconddate    date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY 

SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE 

NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 

decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0

))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(secon

d_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) 

"DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) 

"DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code 

comp_code,a.unit_code 

unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,

a.route_code,b.route_name,b.route_name_oth_lang,c.station_code 

station_code,c.branch_code branch_code,
                        (select nvl(sum(base_supply),0) from cir_supply
                                   where cir_supply.comp_code     =   

pcomp_code and unit =   punit_code and
                                         cir_supply.publ          =   

ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =   

'Y' and cir_supply.comp_code = b.comp_code and
                                         cir_supply.unit          =   b.unit 

and cir_supply.agcd          = a.agcd and
                                         cir_supply.dpcd          =   a.dpcd 

and cir_supply.route_code    = b.route_code and
                                         cir_supply.publ          =   a.publ 

and cir_supply.edtn          = a.edtn and
                                         (cir_supply.route_code   =   proute or 

proute is null) and
                                         cir_supply.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 

or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and 

unit_code =    punit_code and
                                         publ         =    ppublication and 

(edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and 

cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and 

cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and 

cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or 

proute is null) and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and 

a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and 

a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by 

comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,rou

te_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        else
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY 

SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE 

NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 

decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0

))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(secon

d_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) 

"DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) 

"DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code 

comp_code,a.unit_code 

unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,

a.route_code,b.route_name,b.route_name_oth_lang,c.station_code 

station_code,c.branch_code branch_code,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   

pcomp_code and unit_code =   punit_code and
                                         publ                     =   

ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   

vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     

b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   

a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =  

    a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute 

or proute is null) and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and 

unit_code =    punit_code and
                                         publ         =    ppublication and 

(edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and 

cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and 

cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and 

cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or 

proute is null) and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and 

a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and 

a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by 

comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,rou

te_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE 

CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER 

LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 

decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0

))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(secon

d_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,

a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code     =   

pcomp_code and cir_supply.unit =   punit_code and
                                         cir_supply.publ          =   

ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =  

 'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit          =   b.unit 

and cir_supply.agcd                 =   a.agcd and
                                         cir_supply.dpcd          =   a.dpcd 

and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ 

and cir_supply.edtn                     =      a.edtn and
                                         (cir_supply.route_code   =   proute or 

proute is null) and
                                         cir_supply.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 

or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and 

unit_code =    punit_code and
                                         publ         =    ppublication and 

(edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and 

cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and 

cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and 

cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or 

proute is null) and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and 

a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and 

a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by 

comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        else
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE 

CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER 

LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 

decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0

))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(secon

d_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,

a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   

pcomp_code and unit_code =   punit_code and
                                         publ                     =   

ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   

vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     

b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   

a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =  

    a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute 

or proute is null) and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and 

unit_code =    punit_code and
                                         publ         =    ppublication and 

(edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and 

cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and 

cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and 

cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or 

proute is null) and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and 

a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and 

a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by 

comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 

decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0

))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(secon

d_sup)),2)) "PERCENT_VARIANCE",
                 (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  

where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = 

m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn 

is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn 

in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) 

first_total_supply from
                (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,

a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code                =  

 pcomp_code and unit =   punit_code and
                                         cir_supply.publ                     =  

 ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')                =  

 'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit     =   b.unit and 

cir_supply.agcd          =     a.agcd and
                                         cir_supply.dpcd          =   a.dpcd 

and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ 

and cir_supply.edtn          =     a.edtn and
                                         (cir_supply.route_code   =   proute or 

proute is null) and
                                         cir_supply.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 

or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and 

unit_code =    punit_code and
                                         publ         =    ppublication and 

(edtn   =    pedtn or pedtn is null) and
                                         supdate      = vseconddate and 

cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and 

cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and 

cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or 

proute is null) and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and 

a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and 

a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
                open p_accounts2 for----comp wise total
                     select comp_code "COMP CODE",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                     

decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0

))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(secon

d_sup)),2)) "PERCENT_VARIANCE",
                     (select nvl(sum(d.sup_copy),0) from cir_dbksup 

d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code 

and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn 

is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn 

in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) 

first_total_supply from
                    (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,

a.route_code,b.route_name,b.route_name_oth_lang,
                            (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   

pcomp_code and unit_code =   punit_code and
                                             publ                     =   

ppublication and (edtn   =   pedtn or pedtn is null) and
                                             supdate                  =   

vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                             cir_dbksup.unit_code     =   

b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   

a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   

a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   

proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and
                                             (edtn = pedtn or pedtn is null) 

and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = 

pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and 

unit_code =    punit_code and
                                             publ         =    ppublication and 

(edtn   =    pedtn or pedtn is null) and
                                             supdate      = vseconddate and 

cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and 

cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and 

cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= proute or 

proute is null) and
                                             cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = 

pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast 

c
                                 where a.comp_code=pcomp_code and 

a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=punit_code and 

a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=proute or proute is null) 

and a.route_code=b.route_code )
                                 where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code;
        end if;

   End cir_route_supply_variance_p;

    procedure cir_dist_supply_variance_p(
        pcomp_code          in varchar2,
        punit_code          in varchar2,
        ppublication        in varchar2,
        pmainedtn           in varchar2,
        pedtn               in varchar2,
        pdist               in varchar2,
        pfirstdate          in varchar2,
        pseconddate         in varchar2,
        pdateformat         in varchar2,
        pextra1             in varchar2,--it is use for finalised or 

unfinalised
        pextra2             in varchar2,--it is used for supply type
        p_accounts          out t_accounts,
        p_accounts1         out t_accounts,
        p_accounts2         out t_accounts)
   As
     vfirstdate             date;
     vseconddate            date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY 

SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname 

"DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) 

"SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
                             

cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                             

cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME 

OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code 

unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.

dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is 

null) and
                                         nvl(cir_supply.supply_flag,'N') =    

'Y' and
                                     cir_supply.agcd  =    a.agcd and
                                     cir_supply.dpcd  =    a.dpcd and
                                     cir_supply.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is 

null) and 
                                     (main_edtn=pmainedtn or pmainedtn is 

null)) and
                                     (cir_supply.supply_type_code = pextra2 or 

pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is 

null) and
                                         supdate      =    vseconddate and
                                     cir_dbksup.agcd  =    a.agcd and
                                     cir_dbksup.dpcd  =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is 

null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and 

c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by 

comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist

_name,dist_oname,station_code,branch_code
                                   order by comp_code,dist_code,ag_name;
        else
                open p_accounts for
                     select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd 

"AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                     cir_get_city(comp_code,city_code) "CITY NAME",
                     dist_code "DISTRICT CODE",dist_name "DISTRICT 

NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
                                 

cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                                 

cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME 

OTHER LANG",branch_code "BRANCH NAME" from
                            (select distinct a.comp_code comp_code,a.unit_code 

unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.

dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    

ppublication and
                                             (edtn            =    pedtn or 

pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = 

pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    

ppublication and
                                             (edtn            =    pedtn or 

pedtn is null) and
                                             supdate        =    vseconddate 

and
                                             cir_dbksup.agcd                 =  

  a.agcd and
                                             cir_dbksup.dpcd                 =  

  a.dpcd and
                                             cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = 

pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and 

a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) 

and c.dist_code=b.dist_code)
                                       where 

nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by 

comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist

_name,dist_oname,station_code,branch_code
                                       order by comp_code,dist_code,ag_name;    

        
        end if;
        
        if upper(pextra1)='U' then
        open p_accounts1 for----district wise total
             select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name 

"DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.

dist_name,b.dist_oname,
                          (select nvl(sum(sup_copy),0) from cir_supply
                               where comp_code    =    pcomp_code and
                                     unit    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is 

null) and
                                     nvl(supply_flag,'N')=    'Y' and
                             cir_supply.agcd =    a.agcd and
                             cir_supply.dpcd =    a.dpcd and
                             cir_supply.edtn in(select distinct edtn from 

cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) 

and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_supply.supply_type_code = pextra2 or pextra2 

is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is 

null) and
                                     supdate        =    vseconddate and
                                 cir_dbksup.agcd                 =    a.agcd 

and
                                 cir_dbksup.dpcd                 =    a.dpcd 

and
                                 cir_dbksup.edtn in(select distinct edtn from 

cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) 

and (main_edtn=pmainedtn or pmainedtn is null)) and
                                 (cir_dbksup.sup_type_code = pextra2 or pextra2 

is null)) second_sup
                         from cir_dbksup a,cir_dist_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code   

 =    c.comp_code and b.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit 

and
                               (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.dist_code=    pdist or pdist is null) and 

c.dist_code=b.dist_code)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by 

comp_code,dist_code,dist_name,dist_oname
                               order by comp_code,dist_code;
             else
                open p_accounts1 for----district wise total
                     select comp_code "COMP CODE",dist_code "DISTRICT 

CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER 

LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.

dist_name,b.dist_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ         =    ppublication and
                                             (edtn        =    pedtn or pedtn 

is null) and
                                             supdate      =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    

ppublication and
                                             (edtn            =    pedtn or 

pedtn is null) and
                                             supdate        =    vseconddate 

and
                                         cir_dbksup.agcd                 =    

a.agcd and
                                         cir_dbksup.dpcd                 =    

a.dpcd and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast 
                                         where comp_code=pcomp_code and (edtn = 

pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and 

a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) 

and c.dist_code=b.dist_code)
                                       where 

nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by 

comp_code,dist_code,dist_name,dist_oname
                                       order by comp_code,dist_code;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast 

m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code 

= m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) 

and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select 

distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) 

first_total_supply  from
                        (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.

dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is 

null) and
                                         nvl(supply_flag,'N')      =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and 
                                         (main_edtn=pmainedtn or pmainedtn is 

null)) and
                                         (cir_supply.supply_type_code = pextra2 

or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication 

and
                                         (edtn            =    pedtn or pedtn 

is null) and
                                         supdate        =    vseconddate and
                         cir_dbksup.agcd                 =    a.agcd and
                         cir_dbksup.dpcd                 =    a.dpcd and
                         cir_dbksup.edtn in(select distinct edtn from 

cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) 

and (main_edtn=pmainedtn or pmainedtn is null)) and
                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is 

null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and 

c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
            else
                open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  

where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = 

m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) 

and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select 

distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) 

first_total_supply from
                        (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.

dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication 

and
                                         (edtn            =    pedtn or pedtn 

is null) and
                                         supdate        =    vfirstdate and
                                        cir_dbksup.agcd =    a.agcd and
                                        cir_dbksup.dpcd =    a.dpcd and
                                        cir_dbksup.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is 

null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                        (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication 

and
                                         (edtn            =    pedtn or pedtn 

is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    

a.agcd and
                                         cir_dbksup.dpcd                 =    

a.dpcd and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and 

c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;

            end if;
   End cir_dist_supply_variance_p;

    procedure cir_taluka_supply_variance_p(
    pcomp_code       in varchar2,
    punit_code       in varchar2,
    ppublication     in varchar2,
    pmainedtn        in varchar2,
    pedtn            in varchar2,
    ptaluka          in varchar2,
    pfirstdate       in varchar2,
    pseconddate      in varchar2,
    pdateformat      in varchar2,
    pextra1          in varchar2,--it is use for finalised or unfinalised
    pextra2          in varchar2,--it is used for supply type
    p_accounts       out t_accounts,
    p_accounts1      out t_accounts,
    p_accounts2      out t_accounts)
   As
     vfirstdate      date;
     vseconddate     date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY 

SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA 

NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
                             

cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) 

"DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code 

unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluk

a,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code 

branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    

pcomp_code and
                                         cir_supply.unit    =    punit_code and
                                         cir_supply.publ    =    ppublication 

and
                                         (cir_supply.edtn   =    pedtn or pedtn 

is null) and
                                         nvl(cir_supply.supply_flag,'N') =    

'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 

or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication 

and
                                         (edtn            =    pedtn or pedtn 

is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    

a.agcd and
                                         cir_dbksup.dpcd                 =    

a.dpcd and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is 

null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code 

,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name

,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;
             else
                open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY 

SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA 

NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
                             

cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                            

cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME 

OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code 

unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluk

a,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code 

branch_code,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication 

and
                                         (edtn            =    pedtn or pedtn 

is null) and
                                         supdate        =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication 

and
                                         (edtn            =    pedtn or pedtn 

is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    

a.agcd and
                                         cir_dbksup.dpcd                 =    

a.dpcd and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is 

null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code 

,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name

,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;    

         
             
             end if;
        if upper(pextra1)='U' then
            open p_accounts1 for----taluka wise total
                 select comp_code "COMP CODE",tehsil_taluka "TALUKA 

CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER 

LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE" from
                        (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluk

a,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    

pcomp_code and
                                         cir_supply.unit         =    

punit_code and
                                         cir_supply.publ         =    

ppublication and
                                         (cir_supply.edtn        =    pedtn or 

pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    

'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 

or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication 

and
                                         (edtn            =    pedtn or pedtn 

is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    

a.agcd and
                                         cir_dbksup.dpcd                 =    

a.dpcd and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is 

null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code 

,tehsil_taluka,talu_name,talu_oname
                                   order by comp_code,tehsil_taluka;
              else
                open p_accounts1 for----taluka wise total
                     select comp_code "COMP CODE",tehsil_taluka "TALUKA 

CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER 

LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluk

a,b.talu_name,b.talu_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    

ppublication and
                                             (edtn            =    pedtn or 

pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = 

pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    

ppublication and
                                             (edtn            =    pedtn or 

pedtn is null) and
                                             supdate        =    vseconddate 

and
                                             cir_dbksup.agcd                 =  

  a.agcd and
                                             cir_dbksup.dpcd                 =  

  a.dpcd and
                                             cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = 

pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_taluka_mast b,cir_agmast 

c
                                 where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                       a.unit_code=punit_code and 

a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.tehsil_taluka=    ptaluka or ptaluka 

is null) and c.tehsil_taluka=b.talu_code(+))
                                       where 

nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code 

,tehsil_taluka,talu_name,talu_oname
                                       order by comp_code,tehsil_taluka;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  

where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = 

m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) 

and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn 

in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) 

first_total_supply from
                        (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluk

a,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    

pcomp_code and
                                         cir_supply.unit        =    punit_code 

and
                                         cir_supply.publ         =    

ppublication and
                                         (cir_supply.edtn         =    pedtn or 

pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =  

  'Y' and
                                             cir_supply.agcd =    a.agcd and
                                             cir_supply.dpcd =    a.dpcd and
                                             cir_supply.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_supply.supply_type_code = 

pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication 

and
                                         (edtn            =    pedtn or pedtn 

is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    

a.agcd and
                                         cir_dbksup.dpcd                 =    

a.dpcd and
                                         cir_dbksup.edtn in(select distinct 

edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn 

is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and 

a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and 

a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is 

null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
            open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
             

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
            (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  

where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = 

m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) 

and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn 

in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and 

(main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) 

first_total_supply  from
                    (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluk

a,b.talu_name,b.talu_oname,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ    =    ppublication and
                                     (edtn   =    pedtn or pedtn is null) and
                                     supdate =    vfirstdate and
                             cir_dbksup.agcd =    a.agcd and
                             cir_dbksup.dpcd =    a.dpcd and
                             cir_dbksup.edtn in(select distinct edtn from 

cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) 

and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is 

null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn        =    pedtn or pedtn is null) 

and
                                     supdate      =    vseconddate and
                                     cir_dbksup.agcd                 =    

a.agcd and
                                     cir_dbksup.dpcd                 =    

a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is 

null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or 

pextra2 is null)) second_sup
                         from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code   

 =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit 

and
                               (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.tehsil_taluka=    ptaluka or ptaluka is null) 

and c.tehsil_taluka=b.talu_code(+))
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;
        end if;
   End cir_taluka_supply_variance_p;

    procedure cir_edition_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate         date;
     vseconddate        date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate   :=to_date(pseconddate,''''||pdateformat||'''');
        open p_accounts for
             select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB 

CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
             cir_get_city(comp_code,city_code) "CITY NAME",
             edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang 

"EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND 

SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
                         

cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) 

"DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME",unit_code "UNIT CODE" 

from
                    (select distinct a.comp_code comp_code,a.unit_code 

unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_

name,b.edtn_name_oth_lang,
                     c.station_code station_code,c.branch_code branch_code,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is 

null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                    cir_dbksup.agcd =  a.agcd and
                                    cir_dbksup.dpcd =  a.dpcd and
                                    cir_dbksup.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and 
                                 (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is 

null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code   

 =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    

c.unit and
                               (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication 

or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is 

null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by 

comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,edtn,edtn_name

,edtn_name_oth_lang,station_code,branch_code
                               order by comp_code,unit_code,edtn_name,ag_name;

        open p_accounts1 for----Edition wise total
             select comp_code "COMP CODE",edtn "EDITION CODE",edtn_name 

"EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) 

"FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_

name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is 

null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is 

null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code   

 =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    

c.unit and
                               (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication 

or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is 

null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by 

comp_code,edtn,edtn_name,edtn_name_oth_lang
                               order by comp_code,edtn_name;

        open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST 

SUPPLY",sum(second_sup) "SECOND SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_

sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             

decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_s

up),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         

decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first

_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),su

m(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast 

m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code 

= m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) 

and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    d.edtn in(select distinct edtn from cir_edtn_mast where 

comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn 

is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) 

first_total_supply from
                    (select distinct a.comp_code 

comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_

name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is 

null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is 

null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn 

from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and 

(main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code   

 =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    

c.unit and
                               (a.supdate = vfirstdate or a.supdate = 

vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication 

or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is 

null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;

   End cir_edition_supply_variance_p;

   procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts)
    as
     vfrom_supdate      date;
     vtill_supdate      date;
     cursor cur_sup_type is
         select distinct 

'sum(decode(sup_type_code,'||''''||s.sup_ty_code||''''||',sup_copy,0)) 

"'||s.sup_ty_name||'",' vty,
        'sum(decode(sup_type_code,'||''''||s.sup_ty_code||''''||',sup_copy,0)) 

+' vty_sum,s.sup_seq_no sup_seq_no
        from cir_supply_type_mast s,cir_dbksup d
        where s.comp_code=d.comp_code and s.comp_code=pcomp_code and 

d.unit_code=nvl(punit_code,d.unit_code) and
            d.publ=nvl(ppubl,d.publ) and d.supdate between vfrom_supdate and 

vtill_supdate and
            s.sup_ty_code=d.sup_type_code
            order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar           varchar2(4000);
     vvar_sum       varchar2(4000);
     vquery         varchar2(4000);
     vquery1        varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar        :=substr(vvar,1,length(vvar)-1);
    vvar_sum    :=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);
    If vvar is null then
        vquery:=' select comp_code AS "COMP_CODE",(select distinct 

"Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=unit_code) AS 

"UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS 

"PUBL_NAME",sup_rate as "SUP_RATE", supdate AS "SUPDATE",sum(sup_copy) AS 

"TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and 

((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is 

null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is 

null)) and
                supdate between 

'||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                

to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by 

comp_code,unit_code,publ_name,supdate,sup_rate';
    Else
        vquery:=' select comp_code AS "COMP_CODE",(select distinct 

"Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=unit_code) AS 

"UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS 

"PUBL_NAME",sup_rate as "SUP_RATE", supdate AS 

"SUPDATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where 

comp_code='||
                ''''||pcomp_code||''''||' and 

((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is 

null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is 

null)) and
                supdate between 

'||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                

to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by 

comp_code,unit_code,publ_name,supdate,sup_rate';
    End if;                                    
      --          insert into test1(vstring) values ('11'||vquery);commit;
    open p_accounts for vquery;
    
    If vvar is null then
        vquery1:=' select comp_code AS "COMP_CODE",sup_rate as 

"SUP_RATE",sum(sup_copy) AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or 

('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is 

null)) and
                supdate between 

'||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and 

to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    else
        vquery1:=' select comp_code AS "COMP_CODE",sup_rate as 

"SUP_RATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where 

comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or 

('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is 

null)) and
                supdate between 

'||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and 

to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    end if;
    --insert into test1(vstring) values ('22'||vquery1);commit;
    open p_accounts1 for vquery1;
  End cir_rep_supply_unit;

procedure cir_dist_taluka_publ_wise(
     pcompcode      in varchar2,
     punitcode      in varchar2,
     pbrancode      in varchar2,
     ppublcode      in varchar2,
     pmainedtn      in varchar2,
     pedtncode      in varchar2,
     pdistcode      in varchar2,
     ptalukacode    in varchar2,
     pagtypecode    in varchar2,
     pagclasscode   in varchar2,
     pagcd          in varchar2,
     pdpcd          in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     plangtype      in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is used for agency supply type
     pextra2        in varchar2,--it is used for break on district/taluka wise 

or datewise(1/2)
     p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(32000);
      v_query1    varchar2(32000);
      
     cursor cur_edtn is
        select distinct d.publ publ,p.publ_seqno publ_seqno,e. edtn 

edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn 

main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and 

d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and 

d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (m.agcd=pagcd or pagcd is 

null) and (m.dpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is 

null) and
              d.publ=p.publ and d.edtn=e.edtn and (m.dist_code=pdistcode or 

pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and 

(m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='S'
        union
        select p.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO 

edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn 

main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and 

d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and 

d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (d.billagcd=pagcd or pagcd is 

null) and (d.billdpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or 

ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (m.dist_code=pdistcode or 

pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and 

(m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='B'
        order by publ_seqno,publ,edtn_seqno,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(8000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        delete test1;insert into test1(vstring,vstring2)
        values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat 

'||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd 

'||pagcd||' pdpcd '||pdpcd);commit;

        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            /*if vvar is null then
                vvar        

:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',sup_copy,0))"'||rec_edtn.edt

n||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn||'") 

"'||rec_edtn.edtn||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn||'"';
            else
                vvar        

:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',sup_copy,0))"'||r

ec_edtn.edtn||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn||'") 

"'||rec_edtn.edtn||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn||'"';
            end if;*/
            
            if vvar is null then
                vvar        

:='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||'

,sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    

:='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") 

"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   

:='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        

:=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_ra

te||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    

:=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") 

"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   

:=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
                        
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
       -- insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise 

',vvar||' , '||vvar_sum1);commit;
        if pextra2='2' then--for datewise
            if vvar is null then
                v_query:='select comp_code,unit_code,supdate,
                

station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1''

,'||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select 

d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.

agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = 

'||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and 

d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' 

and
                (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
                (m.branch_code='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                group by 

d.comp_code,d.unit_code,m.dist_code,d.supdate,m.tehsil_taluka,m.station_code,d.

agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by 

comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                union ';
                v_query1:='select comp_code,unit_code,supdate,
                

station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1''

,'||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select 

d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = 

'||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and 

d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and 

'||''''||pextra1||''''||'=''B'' and 
                (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
                (m.branch_code='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by 

d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_n

ame_oth_lang)
                group by 

comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
            else
                v_query:='select comp_code,unit_code,supdate,
                

station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1''

,'||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' 

from(select d.comp_code,d.unit_code,d.supdate,station_code,d.agcd agcd,d.dpcd 

dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = 

'||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and 

d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' 

and
                (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
                (m.branch_code='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by 

d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_n

ame_oth_lang)
                group by 

comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                union ';
                --insert into test1(vstring,vstring2) 

values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;
                v_query1:='select comp_code,unit_code,supdate,
                

station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1''

,'||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' 

from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd 

dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = 

'||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and 

d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and 

'||''''||pextra1||''''||'=''B'' and
                (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
                (m.branch_code='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by 

d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_n

ame_oth_lang)
                group by 

comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,supdate,agency_name';
            end if;
        else--- for district/taluka wise
            if vvar is null then
                v_query:='select 

comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1

'','||''''||pdateformat||''''||','''','''') dist_name,
                

tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pd

ateformat||''''||','''','''') 

taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,statio

n_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select 

d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd 

agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = 

'||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and 

d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' 

and
                (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
                (m.branch_code='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                group by 

d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpc

d,m.ag_name,m.ag_name_oth_lang)
                group by 

comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                union ';
                v_query1:='select 

comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1

'','||''''||pdateformat||''''||','''','''') dist_name,
                

tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pd

ateformat||''''||','''','''') 

taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,statio

n_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select 

d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.

agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = 

'||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and 

d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and 

'||''''||pextra1||''''||'=''B'' and 
                (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
                (m.branch_code='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by 

d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.

agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by 

comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                order by 

comp_code,unit_code,dist_name,taluka_name,agcd,dpcd,agency_name';
            else
                v_query:='select 

comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1

'','||''''||pdateformat||''''||','''','''') dist_name,
                

tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pd

ateformat||''''||','''','''') 

taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,statio

n_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' 

from(select 

d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,station_code,d.agcd 

agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = 

'||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and 

d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' 

and
                (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
                (m.branch_code='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by 

d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpc

d,m.ag_name,m.ag_name_oth_lang)
                group by 

comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                union ';
                --insert into test1(vstring,vstring2) 

values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;
                v_query1:='select 

comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1

'','||''''||pdateformat||''''||','''','''') dist_name,
                

tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pd

ateformat||''''||','''','''') 

taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,statio

n_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' 

from(select 

d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd 

agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = 

'||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and 

d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and 

'||''''||pextra1||''''||'=''B'' and
                (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
                (m.branch_code='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by 

d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpc

d,m.ag_name,m.ag_name_oth_lang)
                group by 

comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                order by 

comp_code,unit_code,dist_name,taluka_name,agency_name';
            end if;


        end if;

        --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise 

v_query',v_query||v_query1);commit;

        open p_accounts for v_query||v_query1;

    End cir_dist_taluka_publ_wise;

    procedure cir_datewise_resale(
        pcompcode      in varchar2,
        punitcode      in varchar2,
        pbrancode      in varchar2,
        ppublcode      in varchar2,
        pmainedtn      in varchar2,
        pedtncode      in varchar2,
        pdistcode      in varchar2,
        ptalukacode    in varchar2,
        pagtypecode    in varchar2,
        pagclasscode   in varchar2,
        pagcd          in varchar2,
        pdpcd          in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        plangtype      in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(8000);
     cursor cur_edtn is
        select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
         case when plangtype='1' then
          substr(p.edition_nick,1,15)
         else
          substr(p.edtn_name_oth_lang,1,20)
         end edtn_name,d.sup_rate sup_rate,p.main_edtn main_edtn
        from cir_agmast m,cir_dbksup_resale d ,cir_edtn_mast p
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and 

d.comp_code=p.comp_code and m.unit=d.unit_code and 
              m.unit=p.unit_code and d.unit_code = punitcode and
              d.supdate >= vsupdate and d.supdate <=vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and m.agcd=nvl(pagcd,m.agcd) and 

m.dpcd=nvl(pdpcd,m.dpcd) and d.publ=nvl(ppublcode,d.publ) and
              d.publ=p.publ and d.edtn=p.edtn and (m.dist_code=pdistcode or 

pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
              (m.ag_type=pagtypecode or pagtypecode is null) and 

(m.ag_class=pagclasscode or pagclasscode is null) and
              (d.resale_branch=pbrancode or pbrancode is null)
        order by publ,main_edtn,edtn_seqno,edtn,sup_rate;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
     vquery     varchar2(8000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        --delete test1;insert into test1(vstring,vstring2)
        --values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat 

'||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd 

'||pagcd||' pdpcd '||pdpcd);commit;
        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            if vvar is null then
                --vvar    

:='decode(u.edtn||u.copy_rate,'||''''||rec_edtn.edtn||rec_edtn.copy_rate||''''|

|',sum(u.return_copy))"'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                

--tot_vvar:=',sum("'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'") 

"'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                
                vvar        

:='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||'

,sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    

:='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") 

"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   

:='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        

:=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_ra

te||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    

:=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") 

"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   

:=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
        --insert into test1(vstring,vstring2) values('cir_datewise_resale 

',vvar||' , '||vvar_sum1);commit;

        if vvar is null then
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.agcd 

agcd,d.dpcd dpcd,d.supdate supdate,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = 

nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and 

d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
            (d.resale_branch='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
            group by 

d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
        else
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select 

d.comp_code,d.unit_code,d.supdate supdate,d.agcd agcd,d.dpcd dpcd,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name,'||vvar||' from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and 

d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = 

nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and 

d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and 

d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or 

'||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = 

'||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or 

'||''''||pagtypecode||''''||' is null) and 

(m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is 

null) and
            (d.resale_branch='||''''||pbrancode||''''||' or 

'||''''||pbrancode||''''||' is null) and d.supdate >= 

'||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
            group by 

d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agency_name';
        end if;

        --insert into test1(vstring,vstring2) values('cir_datewise_resale 

v_query',v_query);commit;

        open p_accounts for v_query;

    End cir_datewise_resale;
END cir_rep_supply;
/


                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE procedure cir_billing_agency_bind_p (
    pcompcode       in varchar2,
    punit           in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,    
    p_accounts      out Cur_Type_New1.cursor_type) as
Begin
    if upper(pextra2)='D' then
        open p_accounts for
            select 

cir_agmast_dis.*,cir_get_area(cir_agmast_dis.comp_code,cir_agmast_dis.area_code

) "AREA_NAME",cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) 

"CITY_NAME" from cir_agmast_dis 
                where comp_code = pcompcode and unit    = punit and
                        agcd    = bill_agcd and dpcd    = bill_dpcd and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 

is null))
            union
            select 

cir_agmast_dis.*,cir_get_area(cir_agmast_dis.comp_code,cir_agmast_dis.area_code

) "AREA_NAME",cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) 

"CITY_NAME" from cir_agmast_dis 
                where comp_code = pcompcode and unit    = punit and
                        agcd    = bill_agcd and dpcd    = bill_dpcd and
                        upper(agcd) = upper(pextra1)
                           order by 5;
    else
        open p_accounts for
            select 

cir_agmast.*,cir_get_area(cir_agmast.comp_code,cir_agmast.area_code) 

"AREA_NAME",cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" 

from cir_agmast 
                where comp_code = pcompcode and unit = punit and
                      agcd    = bill_agcd and dpcd    = bill_dpcd and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 

is null))
            union
            select 

cir_agmast.*,cir_get_area(cir_agmast.comp_code,cir_agmast.area_code) 

"AREA_NAME",cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" 

from cir_agmast 
                where comp_code = pcompcode and unit = punit and
                      agcd    = bill_agcd and dpcd    = bill_dpcd and
                        upper(agcd) = upper(pextra1)
                           order by 5;
    end if;

End cir_billing_agency_bind_p;
/

                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE procedure CIR_RECEIPT_DATA_MOVE(
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pdoctype        in varchar2,
    precptdt        in varchar2,
    precptno        in varchar2,
    pdateformate    in varchar2,
    puserid         in varchar2,
    prectype        in varchar2,--it is for agency receipt or distraibution 

receipt
    pextra1         in varchar2,
    pextra2         in varchar2,
    pextra3         in varchar2,
    pextra4         in varchar2,
    pextra5         in varchar2,
    p_accounts      OUT Cur_Type_New1.cursor_type)
is
v_recno number(10);
v_dt    date;
begin
    v_dt:=to_date(precptdt,''''||pdateformate||'''');
    --insert into test1(vstring,vstring2) values(' data move 

',prectype);commit;
    if upper(prectype)='D' then
        insert into 

cir_rcphdr_dis(comp_code,unit_code,doctype,agcd,dpcd,recptno,
            

recptdt,chno,chdt,chbank,amount,oth_amount,ccdp,ccds,rcdp,rcds,ocdp,ocds,reason

,
            

remark,achd,voucherno,voucherdt,vchtype,publ,received_from,tdsrate,tdsamt,staxr

ate,
              

staxamt,status,ref_recptno,ref_recptdt,ref_amount,ref_doctype,cancel_user,cance

l_date,
              

cancel_remark,userid,creation_date,branch_code,prov_rec_no,prov_rec_dt,remark_o

th)
          select comp_code,unit_code,doctype,agcd,dpcd,recptno,
          

recptdt,chno,chdt,chbank,amount,oth_amount,ccdp,ccds,rcdp,rcds,ocdp,ocds,reason

,
          

remark,achd,voucherno,voucherdt,vchtype,publ,received_from,tdsrate,tdsamt,staxr

ate,
          

staxamt,status,ref_recptno,ref_recptdt,ref_amount,ref_doctype,cancel_user,cance

l_date,
          

cancel_remark,userid,creation_date,branch_code,prov_rec_no,prov_rec_dt,remark_o

th from cir_rcphdr_dis_temp
            where comp_code=pcompcode and unit_code=punitcode and 

doctype=pdoctype and 
                    recptno=precptno and recptdt=v_dt;
      
          insert into cir_rcpdet_dis(comp_code, unit_code, agcd, dpcd, doctyp, 

billno, billdt, recptno, recptdt, 
                            payfor, achd, publ, chno, chbnk, chdt, amount, 

reason, remark, voucherno, voucherdt, 
                            tds, stax, status, usrid, creation_date, 

branch_code)
          select comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, 

recptno, recptdt, 
                            payfor, achd, publ, chno, chbnk, chdt, amount, 

reason, remark, voucherno, voucherdt, 
                            tds, stax, status, usrid, creation_date, 

branch_code from cir_rcpdet_dis_temp
            where comp_code=pcompcode and unit_code=punitcode and 

doctyp=pdoctype and 
                    recptno=precptno and recptdt=v_dt;

        insert into cir_outmast_dis (comp_code, unit_code, agcd, dpcd, doctyp, 

billno, billdt, recptno, recptdt, 
                        achd, publ, chno, chbnk, chdt, amount, reason, remark, 

voucherno, voucherdt, balance, 
                        tds, stax, status, cancel_userid, cancel_dt, 

cancel_remark, usrid, creation_date, bill_sec_amt, branch_code)
        select comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, 

recptno, recptdt, 
                        achd, publ, chno, chbnk, chdt, amount, reason, remark, 

voucherno, voucherdt, balance, 
                        tds, stax, status, cancel_userid, cancel_dt, 

cancel_remark, usrid, creation_date, bill_sec_amt, branch_code from 

cir_outmast_dis_temp
             where comp_code=pcompcode and unit_code=punitcode and 

doctyp=pdoctype and 
                    recptno=precptno and recptdt=v_dt;
    else
        insert into cir_rcphdr(comp_code,unit_code,doctype,agcd,dpcd,recptno,
            

recptdt,chno,chdt,chbank,amount,oth_amount,ccdp,ccds,rcdp,rcds,ocdp,ocds,reason

,
            

remark,achd,voucherno,voucherdt,vchtype,publ,received_from,tdsrate,tdsamt,staxr

ate,
              

staxamt,status,ref_recptno,ref_recptdt,ref_amount,ref_doctype,cancel_user,cance

l_date,
              

cancel_remark,userid,creation_date,branch_code,prov_rec_no,prov_rec_dt,remark_o

th)
          select comp_code,unit_code,doctype,agcd,dpcd,recptno,
          

recptdt,chno,chdt,chbank,amount,oth_amount,ccdp,ccds,rcdp,rcds,ocdp,ocds,reason

,
          

remark,achd,voucherno,voucherdt,vchtype,publ,received_from,tdsrate,tdsamt,staxr

ate,
          

staxamt,status,ref_recptno,ref_recptdt,ref_amount,ref_doctype,cancel_user,cance

l_date,
          

cancel_remark,userid,creation_date,branch_code,prov_rec_no,prov_rec_dt,remark_o

th from cir_rcphdr_temp
            where comp_code=pcompcode and unit_code=punitcode and 

doctype=pdoctype and 
                    recptno=precptno and recptdt=v_dt;
      
          insert into cir_rcpdet(comp_code, unit_code, agcd, dpcd, doctyp, 

billno, billdt, recptno, recptdt, 
                            payfor, achd, publ, chno, chbnk, chdt, amount, 

reason, remark, voucherno, voucherdt, 
                            tds, stax, status, usrid, creation_date, 

branch_code)
          select comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, 

recptno, recptdt, 
                            payfor, achd, publ, chno, chbnk, chdt, amount, 

reason, remark, voucherno, voucherdt, 
                            tds, stax, status, usrid, creation_date, 

branch_code from cir_rcpdet_temp
            where comp_code=pcompcode and unit_code=punitcode and 

doctyp=pdoctype and 
                    recptno=precptno and recptdt=v_dt;

        insert into cir_outmast (comp_code, unit_code, agcd, dpcd, doctyp, 

billno, billdt, recptno, recptdt, 
                        achd, publ, chno, chbnk, chdt, amount, reason, remark, 

voucherno, voucherdt, balance, 
                        tds, stax, status, cancel_userid, cancel_dt, 

cancel_remark, usrid, creation_date, bill_sec_amt, branch_code)
        select comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, 

recptno, recptdt, 
                        achd, publ, chno, chbnk, chdt, amount, reason, remark, 

voucherno, voucherdt, balance, 
                        tds, stax, status, cancel_userid, cancel_dt, 

cancel_remark, usrid, creation_date, bill_sec_amt, branch_code from 

cir_outmast_temp
             where comp_code=pcompcode and unit_code=punitcode and 

doctyp=pdoctype and 
                    recptno=precptno and recptdt=v_dt;
    end if;                    
    
    if upper(prectype)='D' then            
        select count(*) into v_recno from cir_rcphdr_dis 
            where comp_code=pcompcode and unit_code=punitcode and 

doctype=pdoctype and 
                recptno=precptno and recptdt=v_dt;
    else
        select count(*) into v_recno from cir_rcphdr 
            where comp_code=pcompcode and unit_code=punitcode and 

doctype=pdoctype and 
                recptno=precptno and recptdt=v_dt;
    end if;

    if nvl(v_recno,0)>0 then
        if upper(prectype)='D' then            
            delete from cir_rcphdr_dis_temp 
                where comp_code=pcompcode and unit_code=punitcode and 

doctype=pdoctype and 
                    recptno=precptno and recptdt=v_dt;
        else
            delete from cir_rcphdr_temp
                where comp_code=pcompcode and unit_code=punitcode and 

doctype=pdoctype and 
                    recptno=precptno and recptdt=v_dt;
        end if;
        commit;
        open p_accounts for
        select v_recno recno from dual;
     else
        open p_accounts for
        select 0 recno from dual;
     end if;

end;
/

                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE PACKAGE Rpt_receipt_register IS
TYPE T_Accounts_Cursor is Ref Cursor;
PROCEDURE Rpt_receipt_reg_excel_p(
    pcompcode                  in varchar2,
    punitcode                  in varchar2,
    pprinting_cen              in varchar2,
    pfrom_date                 in varchar2,
    pto_date                   in varchar2,
    pbank                      in varchar2,
    pagency_code               in varchar2,
    pagency_subcode         in varchar2,
    pdoctype                in varchar2,
    ppaymode                in varchar2,
    prcpt_no                in varchar2,
    pchq_no                 in varchar2,
    prepcode                in varchar2,
    pretcode                in varchar2,
    pexecode                in varchar2,
    dateformate             in varchar2,
    P_Accounts              out T_Accounts_Cursor);

    PROCEDURE Rpt_receipt_register_p(
    pcompcode               in varchar2,---company code
    punitcode               in varchar2,---branch code
    pprinting_cen           in varchar2,---printing center code
    pfrom_date              in varchar2,---from date
    pto_date                in varchar2,---till date
    pdebit_bank             in varchar2,---cheque deposit bank
    pagency_code            in varchar2,---agency main code
    pagency_subcode         in varchar2,---agency sub code
    pdoctype                in varchar2,---doctype
    ppaymode                in varchar2,---reason or paymode
    prepcode                in varchar2,---representative Code
    dateformate             in varchar2,---dateformat
    pprov_flag              in varchar2,---for Provisional receipt Yes/No
    pextra1              in varchar2,
    pextra2              in varchar2,
    pentryfrom         in varchar2,
    pentryto         in varchar2,
    P_Accounts              out T_Accounts_Cursor,
    P_Accounts1             out T_Accounts_Cursor);

    PROCEDURE Rpt_DNCN_register_p(
    pcompcode               in varchar2,---company code
    punitcode               in varchar2,---branch code
    pprinting_cen           in varchar2,---printing center code
    pfrom_date              in varchar2,---from date
    pto_date                in varchar2,---till date
    pagency_code            in varchar2,---agency main code
    pagency_subcode         in varchar2,---agency sub code
    pdoctype                in varchar2,---doctype
    ppaymode                in varchar2,---reason or paymode
    pretcode                in varchar2,---retainer code
    pexecode                in varchar2,---executive code
    dateformate             in varchar2,---dateformat
    P_Accounts              out T_Accounts_Cursor);
END Rpt_receipt_register;
/
CREATE OR REPLACE package body Rpt_receipt_register is
    procedure Rpt_receipt_reg_excel_p(
    pcompcode          in varchar2,
    punitcode          in varchar2,
    pprinting_cen      in varchar2,
    pfrom_date         in varchar2,
    pto_date           in varchar2,
    pbank              in varchar2,
    pagency_code       in varchar2,
    pagency_subcode    in varchar2,
    pdoctype           in varchar2,
    ppaymode           in varchar2,
    prcpt_no           in varchar2,
    pchq_no            in varchar2,
    prepcode           in varchar2,
    pretcode           in varchar2,
    pexecode           in varchar2,
    dateformate        in varchar2,
    P_Accounts         out T_Accounts_Cursor)
    As
    v_frdt                 date;
    v_todt                 date;
    v_rec_bill_amt number(15,2);
    v_dueamt      number(15,2);
    v_leftamt     number(15,2);
    v_ronum       varchar2(30);
    v_clientname  varchar2(30);
    cursor c1 is
        select distinct a."comp_code" as comp_code,a."unit" as unit,a."recptdt" 

as recptdt,a."recptno" as recptno,a."doctype" as doctype,
        a."ag_main_code" as agency_code,a."ag_sub_code" as agency_sub_code,
        a."voucherno" as voucherno,a."chno" as chno,a."chdt" as 

chdt,bankname(a."comp_code","bank") as bank,
        abs(a."amount") as rec_amount,a."remark" as narration,a."repcode" as 

repcode,"prov_rec_no" prov_rec_no,"prov_rec_dt" prov_rec_dt,
        a."reason"  as paymode,a."cashbank" as debit_ac_code,a."revenue" as 

credit_ac_code,a."agcode" as agcode,a."cashbank" as cashbank
        from ad_rcpthdr a
        where (a."comp_code"=pcompcode or pcompcode is null) and (a."unit" 

=punitcode or punitcode is null) and
        (a."doctype" = pdoctype or pdoctype is null) and a."recptdt" between 

v_frdt and v_todt and
        (a."ag_main_code"=pagency_code or pagency_code is null) and 

(a."ag_sub_code"=pagency_subcode or pagency_subcode is null) and
        (a."recptno"  =prcpt_no or prcpt_no is null) and (a."reason" =ppaymode 

or ppaymode is null) and
        (a."repcode" = prepcode or prepcode is null) and (a."chno"  =pchq_no or 

pchq_no is null) and
        (a."bank" = pbank or pbank is null) and a."unit" in(select 

"Branch_Code" from branch_mst where "Comp_Code"=a."comp_code" and 

("pub_center"=pprinting_cen or pprinting_cen is null))
       order by a."comp_code",a."recptdt" ,a."recptno";
      v1 c1%rowtype;

    cursor c2 is
            select doctype,billno,billdt,abs(sum(amount)) amount from 

ad_outstand
            where comp_code=v1.comp_code and /*unit=v1.unit and*/
                      recptno=v1.recptno and recptdt<=v_todt and
                      billno is not null and billdt is not null and
                      ag_main_code=v1.agency_code and 

ag_sub_code=v1.agency_sub_code
                group by doctype,billno,billdt
                order by billdt,doctype,billno;
    v2 c2%rowtype;
    v_adjamt         number(15,2):=0;
    v_ret_code     varchar2(20);
    v_exe_code     varchar2(20);
    v_rec_seqno number:=0;
    v_recovary_days number(5);
Begin
    v_frdt    :=to_date(pfrom_date,''''||dateformate||'''');
    v_todt    :=to_date(pto_date,''''||dateformate||'''');

    delete from temp_ad_receipt_report where sess_id=userenv('sessionid');
    --delete from test1;
    open c1;--agency wise receipt
    loop
        fetch c1 into v1;
        exit when c1%notfound;
                v_rec_seqno:=nvl(v_rec_seqno,0)+1;
        select abs(sum(amount)) into v_rec_bill_amt from ad_outstand--adj. 

receipt with bill amount
            where comp_code=v1.comp_code and /*unit=v1.unit and*/
                  doctype=v1.doctype and recptno=v1.recptno and 

recptdt=v1.recptdt and
                  billno is not null and billdt is not null and 

ag_main_code=v1.agency_code and
                  ag_sub_code=v1.agency_sub_code;

                if nvl(v_rec_bill_amt,0)=0 then
                    v_rec_bill_amt:=null;
                end if;
        insert into temp_ad_receipt_report
                

(comp_code,unit_code,pcentre_code,agcode,ag_main_code,ag_sub_code,doctype,recpt

no,recptdt,amount,
                

rep_code,remarks,chqno,chqdt,chq_bank,reason,debit_head,credit_head,
                

billno,billdt,billamt,adjamt,leftamt,ret_code,exe_code,rec_seqno)
            

values(v1.comp_code,v1.unit,null,v1.agency_code||v1.agency_sub_code,v1.agency_c

ode,v1.agency_sub_code,v1.doctype,v1.recptno,v1.recptdt,v1.rec_amount,
                    

v1.repcode,v1.narration,v1.chno,v1.chdt,v1.bank,v1.paymode,v1.debit_ac_code,v1.

credit_ac_code,
                    

null,null,null,v_rec_bill_amt,nvl(v1.rec_amount,0)-nvl(v_rec_bill_amt,0),null,n

ull,v_rec_seqno);
        open c2;---billno wise billamount
        loop
          fetch c2 into v2;
          exit when c2%notfound;

              begin
                  select distinct 

substr(ronum,1,30),replace(substr(nvl(clientname,clientcd),1,20),',',''),retain

er_code,executive_name
                into v_ronum,v_clientname,v_ret_code,v_exe_code from ad_bills
                    where comp_code_v=v1.comp_code and bildt=v2.billdt and 

bilno=v2.billno;
              exception when others then
                  

v_ronum:=null;v_clientname:=null;v_ret_code:=null;v_exe_code:=null;
              end;

              select abs(sum(amount)) into v_dueamt from ad_outstand
                where comp_code=v1.comp_code and /*unit=v1.unit and*/
                      recptno is not null and recptdt is not null and
                      recptno<v1.recptno and billno=v2.billno and 

billdt=v2.billdt and
                      ag_main_code=v1.agency_code and 

ag_sub_code=v1.agency_sub_code;

                      if nvl(v_dueamt,0)=0 then
                          v_dueamt:=nvl(v2.amount,0);
                      else
                          v_dueamt:=abs(nvl(v2.amount,0)-nvl(v_dueamt,0));
                      end if;

                      v_leftamt:=nvl(v_dueamt,0)-nvl(v_adjamt,0);
                      if v_leftamt=0 then
                         v_leftamt:=null;
                      end if;

              --INSERT INTO TEST1(VSTRING,VSTRING2) VALUES('BILLNO 

'||v2.billno,v1.recptno||' ADJ_AMT '||v_adjamt);

              select abs(sum(amount)) into v_adjamt FROM ad_outstand
                where comp_code=v1.comp_code and /*unit=v1.unit and*/
                      recptno=v1.recptno and billno=v2.billno and 

billdt=v2.billdt and
                      ag_main_code=v1.agency_code and 

ag_sub_code=v1.agency_sub_code;
            --INSERT INTO TEST1(VSTRING,VSTRING2) VALUES('BILLNO 

'||v2.billno,v1.recptno||' ADJ_AMT '||v_adjamt);
            if v2.billno is not null and v_adjamt<>0 then

                if v_clientname='0' OR v_clientname IS NULL THEN
                    v_clientname:=NULL;
                end if;
                if v_ret_code='0' or v_ret_code is null then
                    v_ret_code:=null;
                end if;
                if v_exe_code='0' or v_exe_code is null then
                    v_exe_code:=null;
                end if;

                v_rec_seqno     :=nvl(v_rec_seqno,0)+1;
                v_recovary_days :=(v1.recptdt-v2.billdt+1);

                insert into temp_ad_receipt_report
                

(comp_code,unit_code,pcentre_code,agcode,ag_main_code,ag_sub_code,doctype,recpt

no,recptdt,amount,
                

rep_code,remarks,chqno,chqdt,chq_bank,reason,debit_head,credit_head,
                

billno,billdt,billamt,adjamt,leftamt,ret_code,exe_code,rec_seqno,recovary_days)
            

values(v1.comp_code,v1.unit,null,v1.agency_code||v1.agency_sub_code,v1.agency_c

ode,v1.agency_sub_code,v1.doctype,v1.recptno,v1.recptdt,NULL,
                    

v1.repcode,v1.narration,v1.chno,v1.chdt,v1.bank,v1.paymode,v1.debit_ac_code,v1.

credit_ac_code,
                    

v2.billno,v2.billdt,v_dueamt,v_adjamt,nvl(v_dueamt,0)-nvl(v_adjamt,0),v_ret_cod

e,v_exe_code,v_rec_seqno,v_recovary_days);
            end if;
        end loop;
        close c2;
        if (v_exe_code is not null or v_ret_code is not null) then
            update temp_ad_receipt_report set 

ret_code=v_ret_code,exe_code=v_exe_code
                where comp_code=v1.comp_code and unit_code=v1.unit and 

doctype=v1.doctype and recptno=v1.recptno and recptdt=v1.recptdt and
                            ag_main_code=v1.agency_code and 

ag_sub_code=v1.agency_sub_code and billno is null;
        end if;
    end loop;
    close c1;
    commit;

    open P_Accounts for
    select distinct a.comp_code as COMP_CODE,a.unit_code as UNIT,a.recptdt as 

RECEIPT_DATE,a.recptno as RECEIPT_NUMBER,a.doctype as DOCTYPE,
        a.ag_main_code as AGENCY_CODE,a.ag_sub_code as 

AGENCY_SUB_CODE,agename(a.comp_code,a.agcode) as AGENCY_NAME,
        cityname(a.comp_code,a.agcode) as CITY_NAME,a.chqno as 

CHEQUE_NUMBER,a.chqdt as CHEQUE_DATE,Bankname(a.comp_code,chq_bank) as BANK,
        abs(a.amount) as REC_AMOUNT,repname(a.comp_code,a.rep_code) as 

"REPRESENTIVE", a.remarks as "NARRATION",
        (select "Comp_Name" from comp_mst where "Comp_Code"=a.comp_code)  as 

"CNAME",
        a.reason  as "PAYMODE",(SELECT "Payment_Mode_Name" FROM 

PAYMENT_MODE_MAST WHERE "Comp_Code"=a.comp_code and "Pay_Mode_Code"=a.reason) 

as PAYMODE_NAME,
        ad_get_branchname(a.comp_code,a.unit_code)  as "BRANCH_NAME",
        a.debit_head as "DEBIT_AC_CODE",nvl((select acc_name from fa_acc_mast 

where comp_code=a.comp_code and cdp=a.debit_head),a.debit_head) as 

"DEBIT_HEAD",
        a.credit_head as "CREDIT_AC_CODE",nvl((select acc_name from fa_acc_mast 

where comp_code=a.comp_code and cdp=a.credit_head),a.credit_head) as 

"CREDIT_HEAD",
        

a.billno,a.billdt,a.billamt,a.adjamt,a.leftamt,a.ret_code,ad_get_retainer(a.com

p_code,a.ret_code) as "RETAINER_NAME",
        a.exe_code,ad_get_execname(a.comp_code,a.exe_code) as "EXECUTIVE_NAME",
        A.REC_SEQNO,A.RECOVARY_DAYS RECOVARY_DAYS
        from temp_ad_receipt_report a
        where (a.comp_code=pcompcode or pcompcode is null) and
        (a.unit_code =punitcode or punitcode is null) and
        a.unit_code in(select "Branch_Code" from branch_mst where 

"Comp_Code"=a.comp_code and ("pub_center"=pprinting_cen or pprinting_cen is 

null)) and
       (a.doctype  =pdoctype or pdoctype is null) and
        a.recptdt  between v_frdt and v_todt and
        (a.agcode   =pagency_code||pagency_subcode or pagency_code is null) and
        (a.recptno  =prcpt_no or prcpt_no is null) and (a.rep_code = prepcode 

or prepcode is null) and
       (a.reason   =ppaymode or ppaymode is null) and
        (a.chqno      =pchq_no or pchq_no is null) and (a.chq_bank = pbank or 

pbank is null) and
       (a.exe_code = pexecode or pexecode is null) and
       (a.ret_code = pretcode or pretcode is null) and 

sess_id=userenv('sessionid')
       ORDER BY a.comp_code,A.RECPTDT,A.RECPTNO,A.REC_SEQNO;
        delete from temp_ad_receipt_report where sess_id=userenv('sessionid');
    End Rpt_receipt_reg_excel_p;

    PROCEDURE Rpt_receipt_register_p(
        pcompcode               in varchar2,
        punitcode               in varchar2,
        pprinting_cen           in varchar2,
        pfrom_date              in varchar2,
        pto_date                in varchar2,
        pdebit_bank             in varchar2,
        pagency_code            in varchar2,
        pagency_subcode         in varchar2,
        pdoctype                in varchar2,
        ppaymode                in varchar2,
        prepcode                in varchar2,
        dateformate             in varchar2,
        pprov_flag              in varchar2, --for Provisional receipt Yes/No
        pextra1              in varchar2,
        pextra2              in varchar2,
        pentryfrom         in varchar2,
        pentryto         in varchar2,
        P_Accounts              out T_Accounts_Cursor,
        P_Accounts1             out T_Accounts_Cursor)
    As
       v_frdt date;
       v_todt date;
       v_pentryfrom date;
       v_pentryto date;
        cursor c1 is
            /*select distinct a."comp_code",a."reason" as "PAYMODE",NVL((SELECT 

"Payment_Mode_Name" FROM PAYMENT_MODE_MAST WHERE "Comp_Code"=a."comp_code" and 

"Pay_Mode_Code"=a."reason"),a."reason") as PAYMODE_NAME
            from ad_rcpthdr a where (a."comp_code"=:pcompcode or :pcompcode is 

null) and (a."unit" =:punitcode or :punitcode is null) and a."unit" in(select 

"Branch_Code" from branch_mst where "Comp_Code"=a."comp_code" and 

("pub_center"=:pprinting_cen or :pprinting_cen is null)) and
            (a."doctype" =:PDOCTYPE or :pdoctype is null) and
            a."recptdt" is not null and a."recptdt"  between :v_frdt and 

:v_todt and
            (a."ag_main_code"=:pagency_code or :pagency_code is null) and 

(a."ag_sub_code"=:pagency_subcode or :pagency_subcode is null) and
             (a."reason" =:ppaymode or :ppaymode is null) and
            (a."repcode" = :prepcode or :prepcode is null) and
            (a."cashbank"=:pdebit_bank or :pdebit_bank is null)
            order by a."comp_code",2;*/
            select distinct a."comp_code" comp_code,a."reason" as 

"PAYMODE",NVL((SELECT "Payment_Mode_Name" FROM PAYMENT_MODE_MAST WHERE 

"Comp_Code"=a."comp_code" and "Pay_Mode_Code"=a."reason"),a."reason") as 

PAYMODE_NAME
        from ad_rcpthdr a where (a."comp_code"=pcompcode or pcompcode is null) 

and
        (a."unit" =punitcode or punitcode is null) and a."unit" in(select 

"Branch_Code" from branch_mst where "Comp_Code"=a."comp_code" and 

("pub_center"=pprinting_cen or pprinting_cen is null)) and
        (a."doctype" in(select replace(EDITION_NAME,'''','') from result) or 

pdoctype is null) and
        a."recptdt" is not null and a."recptdt"  between v_frdt and v_todt and
        (a."ag_main_code"=pagency_code or pagency_code is null) and 

(a."ag_sub_code"=pagency_subcode or pagency_subcode is null) and
        (a."reason" =ppaymode or ppaymode is null) and (a."repcode" = prepcode 

or prepcode is null) and
        (a."bank"=pdebit_bank or pdebit_bank is null) and pprov_flag ='N' and
        a."unit" in(select lb.branch_code from login_branch_mast lb where  

lb.user_code=pextra1 and nvl(lb.user_flag,'N')='Y')
        union
        select distinct a.comp_code comp_code,a.reason as "PAYMODE",NVL((SELECT 

"Payment_Mode_Name" FROM PAYMENT_MODE_MAST WHERE "Comp_Code"=a.comp_code and 

"Pay_Mode_Code"=a.reason),'ADVANCE') as PAYMODE_NAME
        from ad_rcpthdr_prov a where (a.comp_code=pcompcode or pcompcode is 

null) and
        (a.unit =punitcode or punitcode is null) and a.unit in(select 

"Branch_Code" from branch_mst where "Comp_Code"=a.comp_code and 

("pub_center"=pprinting_cen or pprinting_cen is null)) and
        (a.doctype in(select replace(EDITION_NAME,'''','') from result) or 

pdoctype is null) and
        a.recptdt is not null and a.recptdt  between v_frdt and v_todt and
        (a.ag_main_code=pagency_code or pagency_code is null) and 

(a.ag_sub_code=pagency_subcode or pagency_subcode is null) and
        (a.reason =ppaymode or ppaymode is null) and (a.repcode = prepcode or 

prepcode is null) and
        (a.bank=pdebit_bank or pdebit_bank is null) and pprov_flag ='Y' and
        a.unit in(select lb.branch_code from login_branch_mast lb where  

lb.user_code=pextra1 and nvl(lb.user_flag,'N')='Y')
        order by comp_code,PAYMODE_NAME;
       v1 c1%rowtype;
       v_var        varchar2(2000);
       v_var_sum    varchar2(2000);
       v_query      varchar2(8000);
       v_doctype    varchar2(200);
       a number;
    Begin

        v_frdt      :=to_date(pfrom_date,''''||dateformate||'''');
        v_todt      :=to_date(pto_date,''''||dateformate||'''');
        --DELETE FROM TEST1;
        if(pentryfrom = '' or pentryfrom is null)
        then
        v_pentryfrom :=to_date('01/01/1990',''''||dateformate||'''');
        v_pentryto :=to_date(sysdate+1,''''||dateformate||'''');
        else
        v_pentryfrom :=to_date(pentryfrom,''''||dateformate||'''');
        v_pentryto :=to_date(pentryto,''''||dateformate||'''');
        end if;
        --INSERT INTO TEST1(VSTRING,VSTRING2) VALUES(' RECEIPT REG2 

',v_doctype);COMMIT;
        if pprov_flag ='N' then
            a:=fn_SplitField(pdoctype,',');

            v_doctype   :=replace(pdoctype,',',''''||','||'''');
            v_doctype   :=''''||v_doctype||'''';
            v_query:='select distinct a."comp_code" as COMP_CODE,a."unit" as 

UNIT,a."recptdt" as RECEIPT_DATE1,a."recptno" as RECEIPT_NUMBER,a."doctype" as 

DOCTYPE,
                     a."ag_main_code" as AGENCY_CODE,a."ag_sub_code" as 

AGENCY_SUB_CODE,agename(a."comp_code",a."ag_main_code"||a."ag_sub_code") as 

AGENCY_NAME,
                     cityname(a."comp_code",a."ag_main_code"||a."ag_sub_code") 

as CITY_NAME,a."voucherno" as VOUCHER_NUMBER,a."chno" as CHEQUE_NUMBER
                     ,to_char(a."chdt",''' || dateformate ||''') as 

CHEQUE_DATE,Bankname(a."comp_code","bank") as BANK,
            abs(a."amount") as REC_AMOUNT,repname(a."comp_code","repcode") as 

"REPRESENTIVE", nvl(a."remark",(select min(receipt_no) from ad_outstand o where 

a."comp_code"=o.comp_code and a."unit"=o.unit and a."doctype"=o.doctype and 

a."recptno"=o.recptno and receipt_no is not null)) as "NARRATION",
            (select "Comp_Name" from comp_mst where "Comp_Code"=a."comp_code")  

as "CNAME",
            a."reason"  as "PAYMODE",(SELECT "Payment_Mode_Name" FROM 

PAYMENT_MODE_MAST WHERE "Comp_Code"=a."comp_code" and 

"Pay_Mode_Code"=a."reason") as PAYMODE_NAME,
            ad_get_branchname(a."comp_code",a."unit") as "BRANCH_NAME",
            a."cashbank" as 

"DEBIT_AC_CODE",nvl(fa_get_account_name(a."comp_code",a."cashbank"),a."cashbank

") as "DEBIT_HEAD",
            a."revenue" as 

"CREDIT_AC_CODE",nvl(fa_get_account_name(a."comp_code",a."revenue"),a."revenue"

) as "CREDIT_HEAD"
            ,a."agcode" as agcode, a."cashbank" as CASHBANK, 

a."AD_UNIQUE_NUMBER" as AD_UNIQUE_NUMBER,a."reason" as REASON,"prov_rec_no" 

prov_rec_no
            ,to_char(a."prov_rec_dt",''' || dateformate ||''') prov_rec_dt 

,to_char(a."recptdt",''' || dateformate ||''') as RECEIPT_DATE
            from ad_rcpthdr a
            where (a."comp_code"='||''''||pcompcode||''''||' or 

'||''''||pcompcode||''''||' is null) and
            (a."unit" ='||''''||punitcode||''''||' or 

'||''''||punitcode||''''||' is null) and
            a."unit" in(select "Branch_Code" from branch_mst where 

"Comp_Code"=a."comp_code" and ("pub_center"='||''''||pprinting_cen||''''||' or 

'||''''||pprinting_cen||''''||' is null)) and
            ((a."doctype" in ('||v_doctype||')'||' or 

('||''''||pdoctype||''''||' is null))) and
            a."recptdt" is not null and a."recptdt"  between 

'||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
            a."Creation_Datetime" between '||''''||v_pentryfrom||''''||' and 

'||''''||v_pentryto||''''||' and
            (a."ag_main_code"='||''''||pagency_code||''''||' or 

'||''''||pagency_code||''''||' is null) and 

(a."ag_sub_code"='||''''||pagency_subcode||''''||' or 

'||''''||pagency_subcode||''''||' is null) and
            (a."reason" ='||''''||ppaymode||''''||' or 

'||''''||ppaymode||''''||' is null) and
            (a."repcode" = '||''''||prepcode||''''||' or 

'||''''||prepcode||''''||' is null) and
            (a."bank"='||''''||pdebit_bank||''''||' or 

'||''''||pdebit_bank||''''||' is null) and 
            a."unit" in(select lb.branch_code from login_branch_mast lb where  

lb.user_code='||''''||pextra1||''''||' and nvl(lb.user_flag,''N'')=''Y'')
            order by a."comp_code",a."recptdt" 

,a."AD_UNIQUE_NUMBER",a."doctype",a."recptno"';
        else
            v_query:='select distinct a.comp_code as COMP_CODE,a.unit as 

UNIT,a.recptdt as RECEIPT_DATE1,a.recptno as RECEIPT_NUMBER,a.doctype as 

DOCTYPE,
                     a.ag_main_code as AGENCY_CODE,a.ag_sub_code as 

AGENCY_SUB_CODE,agename(a.comp_code,a.ag_main_code||a.ag_sub_code) as 

AGENCY_NAME,
                     cityname(a.comp_code,a.ag_main_code||a.ag_sub_code) as 

CITY_NAME,a.voucherno as VOUCHER_NUMBER,a.chno as 

CHEQUE_NUMBER,to_char(a.chdt,''' || dateformate ||''') as 

CHEQUE_DATE,Bankname(a.comp_code,a.bank) as BANK,
            abs(a.amount) as REC_AMOUNT,repname(a.comp_code,repcode) as 

"REPRESENTIVE", a.remark as "NARRATION",
            (select "Comp_Name" from comp_mst where "Comp_Code"=a.comp_code)  

as "CNAME",
            a.reason  as "PAYMODE",NVL((SELECT "Payment_Mode_Name" FROM 

PAYMENT_MODE_MAST WHERE "Comp_Code"=a.comp_code and 

"Pay_Mode_Code"=a.reason),''ADVANCE'') as PAYMODE_NAME,
            ad_get_branchname(a.comp_code,a.unit) as "BRANCH_NAME",
            a.cashbank as 

"DEBIT_AC_CODE",nvl(fa_get_account_name(a.comp_code,a.cashbank),a.cashbank) as 

"DEBIT_HEAD",
            a.revenue as 

"CREDIT_AC_CODE",nvl(fa_get_account_name(a.comp_code,a.revenue),a.revenue) as 

"CREDIT_HEAD"
            ,a.agcode as agcode, a.cashbank as CASHBANK, 1 as 

AD_UNIQUE_NUMBER,a.reason as REASON,null prov_rec_no,null prov_rec_dt 

,to_char(a.recptdt,''' || dateformate ||''') as RECEIPT_DATE
            from ad_rcpthdr_prov a
            where (a.comp_code='||''''||pcompcode||''''||' or 

'||''''||pcompcode||''''||' is null) and
            (a.unit ='||''''||punitcode||''''||' or '||''''||punitcode||''''||' 

is null) and
            a.unit in(select "Branch_Code" from branch_mst where 

"Comp_Code"=a.comp_code and ("pub_center"='||''''||pprinting_cen||''''||' or 

'||''''||pprinting_cen||''''||' is null)) and
            ((a.doctype ='||''''||pdoctype||''''||' or 

('||''''||pdoctype||''''||' is null))) and
            a.recptdt is not null and a.recptdt  between 

'||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
            a.Creation_Datetime between '||''''||v_pentryfrom||''''||' and 

'||''''||v_pentryto||''''||' and
            (a.ag_main_code='||''''||pagency_code||''''||' or 

'||''''||pagency_code||''''||' is null) and 

(a.ag_sub_code='||''''||pagency_subcode||''''||' or 

'||''''||pagency_subcode||''''||' is null) and
            (a.reason ='||''''||ppaymode||''''||' or '||''''||ppaymode||''''||' 

is null) and
            (a.repcode = '||''''||prepcode||''''||' or 

'||''''||prepcode||''''||' is null) and
            (a.bank='||''''||pdebit_bank||''''||' or 

'||''''||pdebit_bank||''''||' is null) and
            a.unit in(select lb.branch_code from login_branch_mast lb where  

lb.user_code='||''''||pextra1||''''||' and nvl(lb.user_flag,''N'')=''Y'')
            order by a.comp_code,a.recptdt 

,AD_UNIQUE_NUMBER,a.doctype,a.recptno';
        end if;
        --INSERT INTO TEST1(VSTRING,VSTRING2) VALUES(' RECEIPT REG 

v_query',v_query);COMMIT;

        open P_Accounts for v_query;

      --DELETE FROM TEST1;COMMIT;
      if pprov_flag ='N' then
          open c1;
          loop
            fetch c1 into v1;
            exit when c1%notfound;
            if v_var is null then
                v_var       

:='decode(a."reason",'||''''||v1.paymode||''''||',sum(abs(a."amount")))"'||v1.P

AYMODE_NAME||'"';
                v_var_sum   :='sum("'||v1.PAYMODE_NAME||'") as 

"'||v1.PAYMODE_NAME||'"';
            else
                v_var       

:=v_var||','||'decode(a."reason",'||''''||v1.paymode||''''||',sum(abs(a."amount

")))"'||v1.PAYMODE_NAME||'"';
                v_var_sum   :=v_var_sum||',sum("'||v1.PAYMODE_NAME||'") as 

"'||v1.PAYMODE_NAME||'"';
            end if;
          end loop;
          close c1;

          --INSERT INTO TEST1(VSTRING,VSTRING2) VALUES('V_VAR ',V_VAR);COMMIT;
          if v_var is null then
          v_query:='select distinct a."comp_code" as COMP_CODE,(select 

"Comp_Name" from comp_mst where "Comp_Code"=a."comp_code")  as "CNAME",
            a."recptdt" as RECEIPT_DATE1,a."reason" as reaSON,sum(a."amount") 

amount,to_char(a."recptdt",'''||dateformate||''') as RECEIPT_DATE
            from ad_rcpthdr a where (a."comp_code"='||''''||pcompcode||''''||' 

or '||''''||pcompcode||''''||' is null) and
            (a."unit" ='||''''||punitcode||''''||' or 

'||''''||punitcode||''''||' is null) and
            a."unit" in(select "Branch_Code" from branch_mst where 

"Comp_Code"=a."comp_code" and ("pub_center"='||''''||pprinting_cen||''''||' or 

'||''''||pprinting_cen||''''||' is null)) and
            ((a."doctype" in ('||v_doctype||')'||') or 

('||''''||pdoctype||''''||' is null)) and
            a."recptdt" between '||''''||v_frdt||''''||' and 

'||''''||v_todt||''''||' and
            a."Creation_Datetime" between '||''''||v_pentryfrom||''''||' and 

'||''''||v_pentryto||''''||' and
            (a."reason" ='||''''||ppaymode||''''||' or 

'||''''||ppaymode||''''||' is null) and
            (a."ag_main_code"='||''''||pagency_code||''''||' or 

'||''''||pagency_code||''''||' is null) and 

(a."ag_sub_code"='||''''||pagency_subcode||''''||' or 

'||''''||pagency_subcode||''''||' is null) and
            (a."repcode" = '||''''||prepcode||''''||' or 

'||''''||prepcode||''''||' is null) and
            (a."bank"='||''''||pdebit_bank||''''||' or 

'||''''||pdebit_bank||''''||' is null) and
            a."unit" in(select lb.branch_code from login_branch_mast lb where  

lb.user_code='||''''||pextra1||''''||' and nvl(lb.user_flag,''N'')=''Y'')
            group by a."comp_code",a."recptdt",a."reason"
            order by a."comp_code",a."recptdt",a."reason"';
          else
          v_query:='select distinct u.comp_code as COMP_CODE,(select 

"Comp_Name" from comp_mst where "Comp_Code"='||''''||pcompcode||''''||')  as 

"CNAME",
            u.RECEIPT_DATE as RECEIPT_DATE,u.RECEIPT_DATE1 as 

RECEIPT_DATE1,'||v_var_sum||' from (select distinct a."comp_code" as 

COMP_CODE,a."recptdt" as RECEIPT_DATE1,'||v_var||'
            ,to_char(a."recptdt",'''||dateformate||''') as RECEIPT_DATE from 

ad_rcpthdr a where (a."comp_code"='||''''||pcompcode||''''||' or 

'||''''||pcompcode||''''||' is null) 
            and a."recptdt" is not null and a."recptdt" between 

'||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and
            a."Creation_Datetime" between '||''''||v_pentryfrom||''''||' and 

'||''''||v_pentryto||''''||' and
            (a."unit" ='||''''||punitcode||''''||' or 

'||''''||punitcode||''''||' is null) and
            a."unit" in(select "Branch_Code" from branch_mst where 

"Comp_Code"=a."comp_code" and ("pub_center"='||''''||pprinting_cen||''''||' or 

'||''''||pprinting_cen||''''||' is null)) and
            ((a."doctype" in ('||v_doctype||')'||') or 

('||''''||pdoctype||''''||' is null))
            and (a."reason" ='||''''||ppaymode||''''||' or 

'||''''||ppaymode||''''||' is null) and
            (a."ag_main_code"='||''''||pagency_code||''''||' or 

'||''''||pagency_code||''''||' is null) and 

(a."ag_sub_code"='||''''||pagency_subcode||''''||' or 

'||''''||pagency_subcode||''''||' is null) and
            (a."repcode" = '||''''||prepcode||''''||' or 

'||''''||prepcode||''''||' is null) and
            (a."bank"='||''''||pdebit_bank||''''||' or 

'||''''||pdebit_bank||''''||' is null) and
            a."unit" in(select lb.branch_code from login_branch_mast lb where  

lb.user_code='||''''||pextra1||''''||' and nvl(lb.user_flag,''N'')=''Y'')
            group by a."comp_code",a."recptdt",a."reason") u
            group by u.comp_code,u.RECEIPT_DATE,u.RECEIPT_DATE1
            order by u.comp_code,u.RECEIPT_DATE1';
          end if;
       else
          open c1;
          loop
            fetch c1 into v1;
            exit when c1%notfound;
            if v_var is null then
                v_var       

:='decode(a.reason,'||''''||v1.paymode||''''||',sum(abs(a.amount)))"'||v1.PAYMO

DE_NAME||'"';
                v_var_sum   :='sum("'||v1.PAYMODE_NAME||'") as 

"'||v1.PAYMODE_NAME||'"';
            else
                v_var       

:=v_var||','||'decode(a.reason,'||''''||v1.paymode||''''||',sum(abs(a.amount)))

"'||v1.PAYMODE_NAME||'"';
                v_var_sum   :=v_var_sum||',sum("'||v1.PAYMODE_NAME||'") as 

"'||v1.PAYMODE_NAME||'"';
            end if;
          end loop;
          close c1;
             if v_var is null then
          

v_var:='decode(a.reason,''AAA'',sum(abs(a.amount)))"'||'ADVANCE'||'"';
          v_var_sum:='sum("ADVANCE") as "ADVANCE"';
          end if;
          --INSERT INTO TEST1(VSTRING,VSTRING2) VALUES('V_VAR ',V_VAR);COMMIT;
          if v_var is null then
          v_query:='select distinct a.comp_code as COMP_CODE,(select 

"Comp_Name" from comp_mst where "Comp_Code"=a.comp_code)  as "CNAME",
            a.recptdt as RECEIPT_DATE,a.reason as reason,sum(a.amount) amount
            from ad_rcpthdr_prov a where 

(a.comp_code='||''''||pcompcode||''''||' or '||''''||pcompcode||''''||' is 

null) and
            (a.unit ='||''''||punitcode||''''||' or '||''''||punitcode||''''||' 

is null) and
            a.unit in(select "Branch_Code" from branch_mst where 

"Comp_Code"=a.comp_code and ("pub_center"='||''''||pprinting_cen||''''||' or 

'||''''||pprinting_cen||''''||' is null)) and
            (a.doctype ='||''''||pdoctype||''''||' or 

'||''''||pdoctype||''''||' is null) and
            a.recptdt between '||''''||v_frdt||''''||' and 

'||''''||v_todt||''''||' and
            a.Creation_Datetime between '||''''||v_pentryfrom||''''||' and 

'||''''||v_pentryto||''''||' and
            (a.reason ='||''''||ppaymode||''''||' or '||''''||ppaymode||''''||' 

is null) and
            (a.ag_main_code='||''''||pagency_code||''''||' or 

'||''''||pagency_code||''''||' is null) and 

(a.ag_sub_code='||''''||pagency_subcode||''''||' or 

'||''''||pagency_subcode||''''||' is null) and
            (a.repcode = '||''''||prepcode||''''||' or 

'||''''||prepcode||''''||' is null) and
            (a.bank='||''''||pdebit_bank||''''||' or 

'||''''||pdebit_bank||''''||' is null) and
            a.unit in(select lb.branch_code from login_branch_mast lb where  

lb.user_code='||''''||pextra1||''''||' and nvl(lb.user_flag,''N'')=''Y'')
            group by a.comp_code,a.recptdt,a.reason
            order by a.comp_code,a.recptdt,a.reason';
          else
          v_query:='select distinct u.comp_code as COMP_CODE,(select 

"Comp_Name" from comp_mst where "Comp_Code"='||''''||pcompcode||''''||')  as 

"CNAME",
            u.RECEIPT_DATE as RECEIPT_DATE,u.RECEIPT_DATE1 as 

RECEIPT_DATE1,'||v_var_sum||' from (select distinct a.comp_code as 

COMP_CODE,a.recptdt as RECEIPT_DATE1,to_char(a.recptdt,'''||dateformate||''') 

as RECEIPT_DATE,'||v_var||'
            from ad_rcpthdr_prov a where 

(a.comp_code='||''''||pcompcode||''''||' or '||''''||pcompcode||''''||' is 

null) 
            and a.recptdt between '||''''||v_frdt||''''||' and 

'||''''||v_todt||''''||' and
            a.Creation_Datetime between '||''''||v_pentryfrom||''''||' and 

'||''''||v_pentryto||''''||' and
            (a.unit ='||''''||punitcode||''''||' or '||''''||punitcode||''''||' 

is null) and
            a.unit in(select "Branch_Code" from branch_mst where 

"Comp_Code"=a.comp_code and ("pub_center"='||''''||pprinting_cen||''''||' or 

'||''''||pprinting_cen||''''||' is null)) and
            (a.doctype ='||''''||pdoctype||''''||' or 

'||''''||pdoctype||''''||' is null)
            and (a.reason ='||''''||ppaymode||''''||' or 

'||''''||ppaymode||''''||' is null) and
            (a.ag_main_code='||''''||pagency_code||''''||' or 

'||''''||pagency_code||''''||' is null) and 

(a.ag_sub_code='||''''||pagency_subcode||''''||' or 

'||''''||pagency_subcode||''''||' is null) and
            (a.repcode = '||''''||prepcode||''''||' or 

'||''''||prepcode||''''||' is null) and
            (a.bank='||''''||pdebit_bank||''''||' or 

'||''''||pdebit_bank||''''||' is null) and
            a.unit in(select lb.branch_code from login_branch_mast lb where  

lb.user_code='||''''||pextra1||''''||' and nvl(lb.user_flag,''N'')=''Y'')
            group by a.comp_code,a.recptdt,a.reason) u
            group by u.comp_code,u.RECEIPT_DATE,u.RECEIPT_DATE1
            order by u.comp_code,u.RECEIPT_DATE1';
          end if;
       end if;
       --delete from TEST1;
      INSERT INTO TEST1(VSTRING,VSTRING2) VALUES('V_QUERY ',V_QUERY);COMMIT;
      delete from temp_ad_receipt_report where sess_id=userenv('sessionid');
      open P_accounts1 for v_query;
    End Rpt_receipt_register_p;


    PROCEDURE Rpt_DNCN_register_p(
    pcompcode               in varchar2,---company code
    punitcode               in varchar2,---branch code
    pprinting_cen           in varchar2,---printing center code
    pfrom_date              in varchar2,---from date
    pto_date                in varchar2,---till date
    pagency_code            in varchar2,---agency main code
    pagency_subcode         in varchar2,---agency sub code
    pdoctype                in varchar2,---doctype
    ppaymode                in varchar2,---reason or paymode
    pretcode                in varchar2,---retainer code
    pexecode                in varchar2,---executive code
    dateformate             in varchar2,---dateformat
    P_Accounts              out T_Accounts_Cursor)
   As
    v_frdt                 date;
    v_todt                 date;
    v_rec_bill_amt number(15,2);
    v_dueamt      number(15,2);
    v_leftamt     number(15,2);
    v_ronum       varchar2(30);
    v_clientname  varchar2(30);
    cursor c1 is
        select distinct a."comp_code" as COMP_CODE,a."unit" as UNIT,a."recptdt" 

as recptdt,a."recptno" as recptno,a."doctype" as doctype,
        a."ag_main_code" as AGENCY_CODE,a."ag_sub_code" as AGENCY_SUB_CODE,
        a."voucherno" as voucherno,a."chno" as chno,a."chdt" as 

chdt,Bankname(a."comp_code","bank") as bank,
        abs(a."amount") as REC_AMOUNT,a."remark" as "NARRATION",a."repcode" as 

repcode,
        a."reason"  as "PAYMODE",a."cashbank" as "DEBIT_AC_CODE",a."revenue" as 

"CREDIT_AC_CODE"
        from ad_rcpthdr a
        where (a."comp_code"=pcompcode or pcompcode is null) and (a."unit" 

=punitcode or punitcode is null) and
        a."unit" in(select "Branch_Code" from branch_mst where 

"Comp_Code"=a."comp_code" and ("pub_center"=pprinting_cen or pprinting_cen is 

null)) and
        a."doctype" in('DN','CN') and (a."doctype" =pdoctype or pdoctype is 

null) and
        a."recptdt"  between v_frdt and v_todt and
        (a."ag_main_code"=pagency_code or pagency_code is null) and 

(a."ag_sub_code"=pagency_subcode or pagency_subcode is null) and
        (a."reason" =ppaymode or ppaymode is null)
        order by a."comp_code",a."recptdt" ,a."recptno";
      v1 c1%rowtype;

    cursor c2 is
            select doctype,billno,billdt,abs(sum(amount)) amount from 

ad_outstand
            where comp_code=v1.comp_code and (unit=punitcode or punitcode is 

null) and
                      ag_main_code=v1.agency_code and 

ag_sub_code=v1.agency_sub_code and
                      recptno =v1.recptno and recptdt is not null and 

recptdt<=v_todt and
                      billno is not null and billdt is not null
                group by doctype,billno,billdt
                  order by billdt,doctype,billno;
    v2 c2%rowtype;
    v_adjamt         number(15,2):=0;
    v_ret_code     varchar2(20);
    v_exe_code     varchar2(20);
    v_rec_seqno number:=0;
    v_recovary_days number(5);
Begin
    v_frdt    :=to_date(pfrom_date,''''||dateformate||'''');
    v_todt    :=to_date(pto_date,''''||dateformate||'''');

    delete from temp_ad_receipt_report where sess_id=userenv('sessionid');
    --delete from test1;
    open c1;--agency wise receipt
    loop
        fetch c1 into v1;
        exit when c1%notfound;
                v_rec_seqno:=nvl(v_rec_seqno,0)+1;
        select abs(sum(amount)) into v_rec_bill_amt from ad_outstand--adj. 

receipt with bill amount
            where comp_code=v1.comp_code and (unit=punitcode or punitcode is 

null) and
                doctype=v1.doctype and recptno=v1.recptno and 

recptdt=v1.recptdt and
                      billno is not null and billdt is not null and 

ag_main_code=v1.agency_code and
                      ag_sub_code=v1.agency_sub_code;

                if nvl(v_rec_bill_amt,0)=0 then
                    v_rec_bill_amt:=null;
                end if;
        insert into temp_ad_receipt_report
                

(comp_code,unit_code,pcentre_code,agcode,ag_main_code,ag_sub_code,doctype,recpt

no,recptdt,amount,
                

rep_code,remarks,chqno,chqdt,chq_bank,reason,debit_head,credit_head,
                

billno,billdt,billamt,adjamt,leftamt,ret_code,exe_code,rec_seqno)
            

values(v1.comp_code,v1.unit,null,v1.agency_code||v1.agency_sub_code,v1.agency_c

ode,v1.agency_sub_code,v1.doctype,v1.recptno,v1.recptdt,v1.rec_amount,
                    

v1.repcode,v1.narration,v1.chno,v1.chdt,v1.bank,v1.paymode,v1.debit_ac_code,v1.

credit_ac_code,
                    

null,null,null,v_rec_bill_amt,nvl(v1.rec_amount,0)-nvl(v_rec_bill_amt,0),null,n

ull,v_rec_seqno);

        open c2;---billno wise billamount
        loop
          fetch c2 into v2;
          exit when c2%notfound;

              begin
                  select distinct 

substr(ronum,1,30),replace(substr(nvl(clientname,clientcd),1,20),',',''),retain

er_code,executive_name
                into v_ronum,v_clientname,v_ret_code,v_exe_code from ad_bills
                    where comp_code_v=v1.comp_code and bildt=v2.billdt and 

bilno=v2.billno ;
              exception when others then
                  

v_ronum:=null;v_clientname:=null;v_ret_code:=null;v_exe_code:=null;
              end;

              select abs(sum(amount)) into v_dueamt from ad_outstand
                where comp_code=v1.comp_code and (unit=punitcode or punitcode 

is null) and billdt=v2.billdt and
                      ag_main_code=v1.agency_code and 

ag_sub_code=v1.agency_sub_code and
                      recptno is not null and recptno<v1.recptno and 

billno=v2.billno;

                      if nvl(v_dueamt,0)=0 then
                          v_dueamt:=nvl(v2.amount,0);
                      else
                          v_dueamt:=abs(nvl(v2.amount,0)-nvl(v_dueamt,0));
                      end if;

                      v_leftamt:=nvl(v_dueamt,0)-nvl(v_adjamt,0);
                      if v_leftamt=0 then
                          v_leftamt:=null;
                      end if;

              --INSERT INTO TEST1(VSTRING,VSTRING2) VALUES('BILLNO 

'||v2.billno,v1.recptno||' ADJ_AMT '||v_adjamt);

              select abs(sum(amount)) into v_adjamt FROM ad_outstand
                where comp_code=v1.comp_code and (unit=punitcode or punitcode 

is null) and
                      recptno=v1.recptno and billno=v2.billno and 

billdt=v2.billdt and
                      ag_main_code=v1.agency_code and 

ag_sub_code=v1.agency_sub_code;

            --INSERT INTO TEST1(VSTRING,VSTRING2) VALUES('BILLNO 

'||v2.billno,v1.recptno||' ADJ_AMT '||v_adjamt);
            if v2.billno is not null and v_adjamt<>0 then

              if v_clientname='0' OR v_clientname IS NULL THEN
                      v_clientname:=NULL;
              end if;
              if v_ret_code='0' or v_ret_code is null then
                  v_ret_code:=null;
              end if;
              if v_exe_code='0' or v_exe_code is null then
                  v_exe_code:=null;
              end if;

              v_rec_seqno:=nvl(v_rec_seqno,0)+1;
              v_recovary_days:=(v1.recptdt-v2.billdt+1);
                insert into temp_ad_receipt_report
                

(comp_code,unit_code,pcentre_code,agcode,ag_main_code,ag_sub_code,doctype,recpt

no,recptdt,amount,
                

rep_code,remarks,chqno,chqdt,chq_bank,reason,debit_head,credit_head,
                

billno,billdt,billamt,adjamt,leftamt,ret_code,exe_code,rec_seqno,recovary_days)
            

values(v1.comp_code,v1.unit,null,v1.agency_code||v1.agency_sub_code,v1.agency_c

ode,v1.agency_sub_code,v1.doctype,v1.recptno,v1.recptdt,NULL,
                    

v1.repcode,v1.narration,v1.chno,v1.chdt,v1.bank,v1.paymode,v1.debit_ac_code,v1.

credit_ac_code,
                    

v2.billno,v2.billdt,v_dueamt,v_adjamt,nvl(v_dueamt,0)-nvl(v_adjamt,0),v_ret_cod

e,v_exe_code,v_rec_seqno,v_recovary_days);
            end if;
        end loop;
        close c2;
        if (v_exe_code is not null or v_ret_code is not null) then
            update temp_ad_receipt_report set 

ret_code=v_ret_code,exe_code=v_exe_code
                where comp_code=v1.comp_code and unit_code=v1.unit and 

doctype=v1.doctype and recptno=v1.recptno and recptdt=v1.recptdt and
                      ag_main_code=v1.agency_code and 

ag_sub_code=v1.agency_sub_code and billno is null;
        end if;
    end loop;
    close c1;
    commit;

    open P_Accounts for
    select distinct a.comp_code as COMP_CODE,a.unit_code as 

UNIT,to_char(a.recptdt,dateformate) as RECEIPT_DATE,a.recptno as 

RECEIPT_NUMBER,a.doctype as DOCTYPE,
        a.ag_main_code as AGENCY_CODE,a.ag_sub_code as 

AGENCY_SUB_CODE,substr(agename(a.comp_code,a.agcode),1,20) as AGENCY_NAME,
        cityname(a.comp_code,a.agcode) as CITY_NAME,a.chqno as 

CHEQUE_NUMBER,a.chqdt as CHEQUE_DATE,Bankname(a.comp_code,chq_bank) as BANK,
        abs(nvl(a.amount,0)) as 

REC_AMOUNT,substr(repname(a.comp_code,a.rep_code),1,20) as "REPRESENTIVE", 

substr(a.remarks,1,30) as "NARRATION",
        (select "Comp_Name" from comp_mst where "Comp_Code"=a.comp_code)  as 

"CNAME",
        a.reason  as "PAYMODE",substr((SELECT "reason_name" FROM reason_MST 

WHERE "Comp_Code"=a.comp_code and "reason_code"=a.reason),1,13) as 

PAYMODE_NAME,
        substr(ad_get_branchname(a.comp_code,a.unit_code),1,10)  as 

"BRANCH_NAME",
        a.debit_head as 

"DEBIT_AC_CODE",nvl(fa_get_account_name(a.comp_code,a.debit_head),a.debit_head) 

as "DEBIT_HEAD",
        a.credit_head as 

"CREDIT_AC_CODE",nvl(fa_get_account_name(a.comp_code,a.credit_head),a.credit_he

ad) as "CREDIT_HEAD",
        

a.billno,a.billdt,a.billamt,a.adjamt,a.leftamt,a.ret_code,ad_get_retainer(a.com

p_code,a.ret_code) as "RETAINER_NAME",
        a.exe_code,ad_get_execname(a.comp_code,a.exe_code) as "EXECUTIVE_NAME",
        A.REC_SEQNO,A.RECOVARY_DAYS RECOVARY_DAYS,a.recptdt
        from temp_ad_receipt_report a
        where (a.comp_code=pcompcode or pcompcode is null) and
        (a.unit_code =punitcode or punitcode is null) and
        a.unit_code in(select "Branch_Code" from branch_mst where 

"Comp_Code"=a.comp_code and ("pub_center"=pprinting_cen or pprinting_cen is 

null)) and(
        a.doctype =pdoctype or pdoctype is null) and
        a.recptdt between v_frdt and v_todt and
        (a.AG_MAIN_CODE   =pagency_code or pagency_code is null) and
        (a.AG_SUB_CODE   =pagency_subcode or pagency_subcode is null) and
        (a.reason   =ppaymode or ppaymode is null) and
         sess_id=userenv('sessionid')
        ORDER BY a.recptdt,A.RECPTNO,A.REC_SEQNO;
        delete from temp_ad_receipt_report where sess_id=userenv('sessionid');
   End Rpt_DNCN_register_p;

End Rpt_receipt_register;
/

/********laxman sir       28-sept*****************/




//=========================================NEW CHANGES IN PROCEDURE FOR ISSUE NO 4768 29/09/2011

=============================BODY========================================================================
CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_rep_supply IS
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts)
     As

     vfrom_supdate    date;
     vtill_supdate    date;
     cursor cur_sup_type is
         select 'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) "'||sup_ty_name||'",' vty,
         'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) +' vty_sum
      from cir_supply_type_mast
      where comp_code=pcomp_code /*and sup_ty_code in(select distinct sup_type_code from cir_dbksup
      where comp_code=pcomp_code and unit_code=punit_code and
                  ((publ=ppubl) or (ppubl is null)) and ((edtn=pedtn) or (pedtn is null)) and
                  supdate between vfrom_supdate and vtill_supdate)*/
      order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar         varchar2(4000);
     vvar_sum    varchar2(4000);
     vquery     varchar2(4000);
     vquery1     varchar2(4000);
     vquery2     varchar2(4000);
     vquery3     varchar2(4000);
     vquery4     varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);commit;

    vquery:=' select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,cir_get_edtn_name(comp_code,edtn) edtn_name,route_code,cir_get_route_name(comp_code,unit_code,route_code) route_name,agcd "AGENCY CODE",dpcd "AGENCY SUBCODE",
    substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",(select cir_get_city(m.comp_code,m.city_code) city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY NAME",
    (select nvl(CIR_GET_NAME.CIR_CITY(m.comp_code,m.city_code,2,'||''''||pdateformat||''''||','''',''''),''NA'') city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY ONAME",/*supdate,*/'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||') and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
               edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/ order by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/';
     ---insert into test1(vstring) values ('1'||vquery);commit;
      open p_accounts for vquery;

      vquery2:=' select comp_code,unit_code,publ,edtn,route_code, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
                edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code
                order by comp_code,unit_code,publ,edtn,route_code';
        --insert into test1(vstring) values ('22'||vquery2);commit;
      open p_accounts2 for vquery2;

      vquery3:=' select comp_code,unit_code,publ,edtn, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn
                order by comp_code,unit_code,publ,edtn';
      open p_accounts3 for vquery3;

      vquery4:=' select comp_code,unit_code,publ, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ
                order by comp_code,unit_code,publ';
      open p_accounts4 for vquery4;

      vquery1:=' select comp_code,unit_code,'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code';
        --insert into test1(vstring) values ('2'||vquery);commit;

     open p_accounts1 for vquery1;
  End cir_rep_supply1;

procedure cir_rep_supply_po(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is use for finalised or unfinalised
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts) as
     v_date             date;
     cursor cur_sup_type is
         select 'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) "'||sup_ty_name||'",' vty,
             'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) +' vty_sum,sup_seq_no
             from cir_supply_type_mast
             where comp_code=pcomp_code and (upper(pextra1)!='U' or pextra1 is null)
         union
         select 
            case when to_char(v_date,'DY')='SUN' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sun,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='MON' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_mon,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='TUE' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_tue,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='WED' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_wed,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='THU' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_thu,0),0)) "'||sup_ty_name||'",'
            when to_char(v_date,'DY')='FRI' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_fri,0),0)) "'||sup_ty_name||'",'
            else
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sat,0),0)) "'||sup_ty_name||'",'
            end vty,
            
            case when to_char(v_date,'DY')='SUN' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sun,0),0)) +'
            when to_char(v_date,'DY')='MON' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_mon,0),0)) +'
            when to_char(v_date,'DY')='TUE' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_tue,0),0)) +'
            when to_char(v_date,'DY')='WED' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_wed,0),0)) +'
            when to_char(v_date,'DY')='THU' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_thu,0),0)) +'
            when to_char(v_date,'DY')='FRI' then
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_fri,0),0)) +'
            else
                'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',nvl(d.base_supply,0)+nvl(d.supply_sat,0),0)) +'
            end  vty_sum,
            --'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',d.base_supply,0)) "'||sup_ty_name||'",' vty,
             --'sum(decode(d.supply_type_code,'||''''||sup_ty_code||''''||',d.base_supply,0)) +' vty_sum,
             sup_seq_no
             from cir_supply_type_mast
             where comp_code=pcomp_code and upper(pextra1)='U'
             order by sup_seq_no;
     rec_sup_type cur_sup_type%rowtype;

cursor cur_dbk is
            select x.comp_code comp_code,x.unit_code unit_code,x.supdate supdate,x.publ_name publ_name,x.mainedtn_name mainedtn_name,
            x.main_edtn_seqno main_edtn_seqno,x.edtn_name edtn_name,x.edtn_seq_no edtn_seq_no,x.sup_ty_name sup_ty_name,
            x.sup_seq_no sup_seq_no,x.sup_rate sup_rate,x.supply_copy supply_copy,x.supl_name supl_name,x.pgno pgno from
            (select d.comp_code comp_code,d.unit_code unit_code,d.supdate supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seq_no,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seq_no,d.sup_rate sup_rate, sum(d.sup_copy) supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit_code,e.edtn,d.supdate,pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(d.supdate,'DY')='SUN' then min(e.pgno_sun)
                when to_char(d.supdate,'DY')='MON' then min(e.pgno_mon)
                when to_char(d.supdate,'DY')='TUE' then min(e.pgno_tue)
                when to_char(d.supdate,'DY')='WED' then min(e.pgno_wed)
                when to_char(d.supdate,'DY')='THU' then min(e.pgno_thu)
                when to_char(d.supdate,'DY')='FRI' then min(e.pgno_fri) else min(e.pgno_sat) end pgno
            from cir_dbksup d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit_code=e.unit_code and (d.unit_code=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supdate =v_date and d.sup_type_code=t.sup_ty_code and upper(pextra1)!='U'
            group by d.comp_code,d.unit_code,d.supdate,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no,d.sup_rate
            union
            select d.comp_code comp_code,d.unit unit_code,v_date supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seq_no,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seq_no,
            cir_get_edtn_rate(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),'dd/mm/yyyy') sup_rate, 
            case when to_char(v_date,'DY')='SUN' then sum(nvl(d.base_supply,0)+nvl(d.supply_sun,0))
                 when to_char(v_date,'DY')='MON' then sum(nvl(d.base_supply,0)+nvl(d.supply_mon,0))
                 when to_char(v_date,'DY')='TUE' then sum(nvl(d.base_supply,0)+nvl(d.supply_tue,0))
                 when to_char(v_date,'DY')='WED' then sum(nvl(d.base_supply,0)+nvl(d.supply_wed,0))
                 when to_char(v_date,'DY')='THU' then sum(nvl(d.base_supply,0)+nvl(d.supply_thu,0))
                 when to_char(v_date,'DY')='FRI' then sum(nvl(d.base_supply,0)+nvl(d.supply_fri,0))
            else sum(nvl(d.base_supply,0)+nvl(d.supply_sat,0)) end supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(v_date,'DY')='SUN' then min(e.pgno_sun)
                when to_char(v_date,'DY')='MON' then min(e.pgno_mon)
                when to_char(v_date,'DY')='TUE' then min(e.pgno_tue)
                when to_char(v_date,'DY')='WED' then min(e.pgno_wed)
                when to_char(v_date,'DY')='THU' then min(e.pgno_thu)
                when to_char(v_date,'DY')='FRI' then min(e.pgno_fri) else min(e.pgno_sat) end pgno
            from cir_supply d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit=e.unit_code and (d.unit=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supply_flag='Y' and d.supply_type_code=t.sup_ty_code and upper(pextra1)='U'
            group by d.comp_code,d.unit,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no) x
            order by comp_code,unit_code,supdate,publ_name,main_edtn_seqno,mainedtn_name,edtn_seq_no,edtn_name,sup_seq_no,sup_ty_name;
        
        rec_dbk cur_dbk%rowtype;
                                            
    vvar        varchar2(4000);
    vvar_sum    varchar2(4000);
    vquery      varchar2(4000);
    vquery1     varchar2(4000);
    v_count     number(5);
    vlength     number(7);
    vrunval     varchar2(8000);
    v_val       varchar2(800);
    v_name      varchar2(8000);
    vno         number:=0;
  Begin
    if upper(pextra1)='U' then  
        v_date:=to_date(trunc(sysdate),''''||pdateformat||'''');
    else
        v_date:=to_date(psupdate,''''||pdateformat||'''');
    end if;    
    
    delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
    delete from cir_ledger_report where sess_id=userenv('sessionid');commit;
    delete from test1;commit;
    open cur_dbk;
    loop
        fetch cur_dbk into rec_dbk;
        exit when cur_dbk%notfound;
        
        v_count:=nvl(v_count,0)+1;
        if rec_dbk.pgno=0 then
            rec_dbk.pgno:=null;
        end if;
        
        vlength :=null; v_val :=null; vrunval :=null; vno:=null;

        v_val   :=replace(rec_dbk.supl_name||'+','+',',');
        vlength :=length(v_val);
        vno:=1;

        for i in 1.. vlength loop
        vrunval:=substr(v_val,i,1);
        if vrunval!=',' then
            v_name:=v_name||vrunval;
        else
            insert into cir_ledger_report(comp_code, unit_code, recptdt,agcd, dpcd, recptno, chq_bank, rec_seqno,sess_id)
                    values (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,v_name,rec_dbk.supply_copy,userenv('sessionid'));
            vno:=vno+1;
            v_name:='';
        end if;
        end loop;
        
        insert into cir_temp_bill_collection
        (comp_code, unit_code, billdt, publ_code, agcd, dpcd, supply_copy, gross_amt, 
        cur_sessionid, agname,return_copy,sec_opbal,remarks)
        values
        (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,rec_dbk.supply_copy,rec_dbk.sup_rate,
        userenv('sessionid'),rec_dbk.sup_ty_name,rec_dbk.pgno,v_count,replace(rec_dbk.supl_name||'+','+',' = '||rec_dbk.supply_copy));
    end loop;
    close cur_dbk;
         
    --delete from test1;commit;
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
                vvar:=vvar||rec_sup_type.vty;
                vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (pextra1||' '||vquery);
    if upper(pextra1)='U' then  
        vquery:=' select d.comp_code comp_code,d.unit unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,e.edtn_name "EDITION NAME",
                to_char(sysdate'||','||''''||pdateformat||''''||') supdate,'||vvar||','||vvar_sum||' TOTAL,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,e.edtn_seq_no edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,cir_get_edtn_supl(d.comp_code,d.unit_code,d.edtn,to_date(sysdate),'||''''||pdateformat||''''||',1,null,null,null,null,null) supl_name from cir_agmast m,cir_supply d,cir_edtn_mast e
                where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.comp_code=m.comp_code and d.unit='||''''||punit_code||''''||' and d.unit=e.unit_code and d.unit=m.unit and d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.publ=e.publ and
                d.supply_flag='||'''Y'''||' and nvl(m.suspend_type,''N'')='||'''N'''||' and d.edtn=e.edtn and d.agcd=m.agcd and d.dpcd=m.dpcd
                group by d.comp_code,d.unit,d.publ,e.main_edtn,d.edtn,sysdate,e.edtn_name,e.edtn_seq_no order by d.comp_code,d.unit,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn';
    else
        vquery:=' select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,e.edtn_name "EDITION NAME",
                to_char(d.supdate'||','||''''||pdateformat||''''||') supdate,'||vvar||','||vvar_sum||' TOTAL,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,e.edtn_seq_no edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,cir_get_edtn_supl(d.comp_code,d.unit_code,d.edtn,d.supdate,'||''''||pdateformat||''''||',1,null,null,null,null,null) supl_name from cir_dbksup d,cir_edtn_mast e
                where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.unit_code='||''''||punit_code||''''||' and d.unit_code=e.unit_code and d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.publ=e.publ /*and ((e.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null))*/ and
                d.supdate='||''''||v_date||''''||' and d.edtn=e.edtn
                group by d.comp_code,d.unit_code,d.publ,e.main_edtn,d.edtn,d.supdate,e.edtn_name,e.edtn_seq_no order by d.comp_code,d.unit_code,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn';
    end if;                    
    --insert into test1(vstring) values ('1 pextra1 '||vquery);commit;

    open p_accounts for vquery;
    if upper(pextra1)='U' then
    vquery1:=' select d.comp_code comp_code,d.unit unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,'||vvar||','||vvar_sum||'TOTAL from cir_agmast m,cir_supply d where d.comp_code=m.comp_code and d.comp_code='||''''||pcomp_code||''''||' and d.unit=m.unit and d.unit='||''''||punit_code||''''||' and
            d.publ=nvl('||''''||ppubl||''''||',d.publ) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supply_flag='||'''Y'''||' and nvl(m.suspend_type,''N'')='||'''N'''||'
            group by d.comp_code,d.unit,d.publ order by d.comp_code,d.unit,d.publ';
    else
    vquery1:=' select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,'||vvar||','||vvar_sum||'TOTAL from cir_dbksup d where d.comp_code='||''''||pcomp_code||''''||' and d.unit_code='||''''||punit_code||''''||' and
            d.publ=nvl('||''''||ppubl||''''||',d.publ) and supdate='||''''||v_date||''''||'
            group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ';
    end if;
    --insert into test1(vstring) values ('2 pextra1 '||vquery1);commit;

    open p_accounts1 for vquery1;
  End cir_rep_supply_po;

  procedure cir_rep_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",
       nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
            nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND
        A.PUBL=PPUBL AND A.EDTN=NVL(PEDTN,A.EDTN) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND 
        A.SUPDATE >= VFRDT AND A.SUPDATE <=VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,/*A.EDTN,*/B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<=VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_daybook;

  procedure cir_rep_dist_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt            date;
     vtodt            date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(DIST_CODE,'NA') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",
       STATE_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,'NA') DIST_CODE,nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",
       nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",STATE_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT  AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_dist_daybook;

  procedure cir_rep_taluka_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",
       STATE_CODE "STATE CODE",
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",
       nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",STATE_CODE "STATE CODE",
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_taluka_daybook;

  procedure cir_rep_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(12000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE';
insert into test1(vstring,vstring2) values('3 '||vquery3,VQUERY2);commit;
       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
        
insert into test1(vstring,vstring2) values('4 '||vquery3,VQUERY2);commit;        
       open p_accounts2 for vquery3||vquery2;

  End cir_rep_day_daybook;

  procedure cir_rep_dist_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
    substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",
       COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='  FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_dist_day_daybook;

  procedure cir_rep_taluka_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_taluka_day_daybook;

  Procedure cir_rep_route_challan(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     pperiod        in number,
     prmode         in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts)
  As
      vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vquery     varchar2(4000);
  Begin
    --insert into test1(vstring,vstring2) values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');
    --insert into test1(vstring,vstring2) values('2222 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
    --vvar:=substr(vvar,1,length(vvar)-1);
    --insert into test1(vstring,vstring2) values('1 '||vvar,' vsupdate '||vsupdate);commit;

        if vvar is null then
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        else
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('2 '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_route_challan;

procedure cir_rep_dist_challan(
   pcomp_code       in varchar2,
   punit_code       in varchar2,
   pperiod          in number,
   prmode           in varchar2,
   psupdate         in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2,
   p_accounts       out t_accounts)
   As
     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn_1--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
Begin
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');

    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
        if vvar is null then
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        else
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('DIST '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_dist_challan;

    procedure cir_rep_taluka_challan(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        pperiod        in number,
        prmode         in varchar2,
        psupdate       in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     As

     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
    Begin
        vsupdate:=to_date(psupdate,''''||pdateformat||'''');

        open cur_edtn;
        loop
            fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
                    if vvar is null then
                  vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    else
                        vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    end if;
        end loop;
        close cur_edtn;
        if vvar is null then
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        else
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        end if;
        --insert into tes t1(vstring,vstring2) values('TALUKA '||vquery,null);commit;
        open p_accounts for vquery;

    End cir_rep_taluka_challan;

    procedure cir_route_wise_supply(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        ppubl          in varchar2,
        pmainedtn      in varchar2,
        pedtn          in varchar2,
        proute         in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts,
        p_accounts1    out t_accounts,
        p_accounts2    out t_accounts,
        p_accounts3    out t_accounts)
     As
        vfrom_supdate    date;
        vtill_supdate    date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno,
               cir_get_supply_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,ppubl,pedtn,cir_dbksup.agcd,cir_dbksup.dpcd) supply_seqno
               from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,
                           cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code,supply_seqno ,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               sum(sup_copy),cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                       order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
    End cir_route_wise_supply;

    procedure cir_dist_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vfrom_supdate  date;
     vtill_supdate  date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.dist_code,cir_agmast.state_code,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_agmast.state_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
  End cir_dist_wise_supply;

    procedure cir_taluka_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vsupdate date;
     vsupdate1 date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.tehsil_taluka
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_taluka_wise_supply;


    procedure cir_dist_taluka_wise_sup(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts,
     p_accounts4    out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
        cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
        sum(sup_copy) from cir_dbksup,cir_agmast
        where cir_dbksup.comp_code = cir_agmast.comp_code and
        cir_dbksup.unit_code = cir_agmast.unit and
        cir_dbksup.agcd = cir_agmast.agcd and
        cir_dbksup.dpcd = cir_agmast.dpcd and
        cir_dbksup.comp_code = pcomp_code and
        cir_dbksup.unit_code = punit_code and
        cir_dbksup.publ = ppubl and
        ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
        cir_dbksup.supdate between vsupdate and vsupdate1 and
        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
        group by cir_dbksup.comp_code,cir_dbksup.unit_code,
        cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka
        order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
               cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.state_code,cir_agmast.dist_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts3 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts4 for
        select cir_dbksup.comp_code comp_code, sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_dist_taluka_wise_sup;

     procedure cir_supply_comp(
         pcomp_code     in varchar2,
         punit_code     in varchar2,
         ppublication   in varchar2,
         psupdate       in varchar2,
         psupdate1      in varchar2,
         pdateformat    in varchar2,
         pextra1        in varchar2,
         pextra2        in varchar2,
         p_accounts     out t_accounts,
         p_accounts1    out t_accounts,
         p_accounts2    out t_accounts,
         p_accounts3    out t_accounts)
     as
        vsupdate     date;
        vsupdate1    date;
     begin
        vsupdate    :=to_date(psupdate,''''||pdateformat||'''');
        vsupdate1   :=to_date(psupdate1,''''||pdateformat||'''');
        --insert into test1(vstring,vstring2) values(pcomp_code||','||punit_code||','||ppublication,psupdate||','||pdateformat||','||pextra1||','||','||pextra2); commit;
        open p_accounts for
             select comp_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"= unit_code) unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,edtn_name,edtn_name_oth_lang,
             main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             prev_sup,curr_sup,nvl(curr_sup,0)-nvl(prev_sup,0) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno,cir_get_edtn_seqno(comp_code,edtn) edtn_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               order by unit_code,publ_seqno,publ_name,mainedtn_seqno,main_edtn_name,edtn_seqno,edtn_name;

        open p_accounts1 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno
             from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code,main_edtn
                               order by unit_code,publ_seqno,publ_name,mainedtn_seqno,main_edtn_name;
        open p_accounts2 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code
                               order by unit_code,publ_seqno,publ_name;

             open p_accounts3 for
             select comp_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code=cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ
                               order by publ_seqno,publ_name;

     End cir_supply_comp;

    procedure cir_route_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    proute              in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,--it is use for finalised or unfinalised
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate     date;
     vseconddate    date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(base_supply),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        else
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and cir_supply.unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd                 =   a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn                     =      a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        else
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code                =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')                =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit     =   b.unit and cir_supply.agcd          =     a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          =     a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
                open p_accounts2 for----comp wise total
                     select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                     decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                     (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   pcomp_code and unit_code =   punit_code and
                                             publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                             supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                             (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and unit_code =    punit_code and
                                             publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                             supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                                 where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code;
        end if;

   End cir_route_supply_variance_p;

    procedure cir_dist_supply_variance_p(
        pcomp_code          in varchar2,
        punit_code          in varchar2,
        ppublication        in varchar2,
        pmainedtn           in varchar2,
        pedtn               in varchar2,
        pdist               in varchar2,
        pfirstdate          in varchar2,
        pseconddate         in varchar2,
        pdateformat         in varchar2,
        pextra1             in varchar2,--it is use for finalised or unfinalised
        pextra2             in varchar2,--it is used for supply type
        p_accounts          out t_accounts,
        p_accounts1         out t_accounts,
        p_accounts2         out t_accounts)
   As
     vfirstdate             date;
     vseconddate            date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                     cir_supply.agcd  =    a.agcd and
                                     cir_supply.dpcd  =    a.dpcd and
                                     cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                     (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         supdate      =    vseconddate and
                                     cir_dbksup.agcd  =    a.agcd and
                                     cir_dbksup.dpcd  =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                   order by comp_code,dist_code,ag_name;
        else
                open p_accounts for
                     select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                     cir_get_city(comp_code,city_code) "CITY NAME",
                     dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                            (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                       order by comp_code,dist_code,ag_name;            
        end if;
        
        if upper(pextra1)='U' then
        open p_accounts1 for----district wise total
             select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                          (select nvl(sum(sup_copy),0) from cir_supply
                               where comp_code    =    pcomp_code and
                                     unit    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     nvl(supply_flag,'N')=    'Y' and
                             cir_supply.agcd =    a.agcd and
                             cir_supply.dpcd =    a.dpcd and
                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     supdate        =    vseconddate and
                                 cir_dbksup.agcd                 =    a.agcd and
                                 cir_dbksup.dpcd                 =    a.dpcd and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                 (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_dist_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,dist_code,dist_name,dist_oname
                               order by comp_code,dist_code;
             else
                open p_accounts1 for----district wise total
                     select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ         =    ppublication and
                                             (edtn        =    pedtn or pedtn is null) and
                                             supdate      =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 
                                         where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,dist_code,dist_name,dist_oname
                                       order by comp_code,dist_code;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')      =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                         (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                         cir_dbksup.agcd                 =    a.agcd and
                         cir_dbksup.dpcd                 =    a.dpcd and
                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
            else
                open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                        cir_dbksup.agcd =    a.agcd and
                                        cir_dbksup.dpcd =    a.dpcd and
                                        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                        (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;

            end if;
   End cir_dist_supply_variance_p;

    procedure cir_taluka_supply_variance_p(
    pcomp_code       in varchar2,
    punit_code       in varchar2,
    ppublication     in varchar2,
    pmainedtn        in varchar2,
    pedtn            in varchar2,
    ptaluka          in varchar2,
    pfirstdate       in varchar2,
    pseconddate      in varchar2,
    pdateformat      in varchar2,
    pextra1          in varchar2,--it is use for finalised or unfinalised
    pextra2          in varchar2,--it is used for supply type
    p_accounts       out t_accounts,
    p_accounts1      out t_accounts,
    p_accounts2      out t_accounts)
   As
     vfirstdate      date;
     vseconddate     date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit    =    punit_code and
                                         cir_supply.publ    =    ppublication and
                                         (cir_supply.edtn   =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;
             else
                open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                            cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;             
             
             end if;
        if upper(pextra1)='U' then
            open p_accounts1 for----taluka wise total
                 select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit         =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                   order by comp_code,tehsil_taluka;
              else
                open p_accounts1 for----taluka wise total
                     select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                       order by comp_code,tehsil_taluka;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit        =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn         =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =    'Y' and
                                             cir_supply.agcd =    a.agcd and
                                             cir_supply.dpcd =    a.dpcd and
                                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
            open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
            (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ    =    ppublication and
                                     (edtn   =    pedtn or pedtn is null) and
                                     supdate =    vfirstdate and
                             cir_dbksup.agcd =    a.agcd and
                             cir_dbksup.dpcd =    a.dpcd and
                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn        =    pedtn or pedtn is null) and
                                     supdate      =    vseconddate and
                                     cir_dbksup.agcd                 =    a.agcd and
                                     cir_dbksup.dpcd                 =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;
        end if;
   End cir_taluka_supply_variance_p;

    procedure cir_edition_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate         date;
     vseconddate        date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate   :=to_date(pseconddate,''''||pdateformat||'''');
        open p_accounts for
             select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
             cir_get_city(comp_code,city_code) "CITY NAME",
             edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                         cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME",unit_code "UNIT CODE" from
                    (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                     c.station_code station_code,c.branch_code branch_code,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                    cir_dbksup.agcd =  a.agcd and
                                    cir_dbksup.dpcd =  a.dpcd and
                                    cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                 (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,edtn,edtn_name,edtn_name_oth_lang,station_code,branch_code
                               order by comp_code,unit_code,edtn_name,ag_name;

        open p_accounts1 for----Edition wise total
             select comp_code "COMP CODE",edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,edtn,edtn_name,edtn_name_oth_lang
                               order by comp_code,edtn_name;

        open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    d.edtn in(select distinct edtn from cir_edtn_mast where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;

   End cir_edition_supply_variance_p;

   procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts)
    as
     vfrom_supdate      date;
     vtill_supdate      date;
     cursor cur_sup_type is
         select distinct 'sum(decode(sup_type_code,'||''''||s.sup_ty_code||''''||',sup_copy,0)) "'||s.sup_ty_name||'",' vty,
        'sum(decode(sup_type_code,'||''''||s.sup_ty_code||''''||',sup_copy,0)) +' vty_sum,s.sup_seq_no sup_seq_no
        from cir_supply_type_mast s,cir_dbksup d
        where s.comp_code=d.comp_code and s.comp_code=pcomp_code and d.unit_code=nvl(punit_code,d.unit_code) and
            d.publ=nvl(ppubl,d.publ) and d.supdate between vfrom_supdate and vtill_supdate and
            s.sup_ty_code=d.sup_type_code
            order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar           varchar2(4000);
     vvar_sum       varchar2(4000);
     vquery         varchar2(4000);
     vquery1        varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar        :=substr(vvar,1,length(vvar)-1);
    vvar_sum    :=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);
    If vvar is null then
        vquery:=' select comp_code AS "COMP_CODE",(select distinct "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=unit_code) AS "UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS "PUBL_NAME",sup_rate as "SUP_RATE", supdate AS "SUPDATE",sum(sup_copy) AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by comp_code,unit_code,publ_name,supdate,sup_rate';
    Else
        vquery:=' select comp_code AS "COMP_CODE",(select distinct "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=unit_code) AS "UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS "PUBL_NAME",sup_rate as "SUP_RATE", supdate AS "SUPDATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by comp_code,unit_code,publ_name,supdate,sup_rate';
    End if;                                    
      --          insert into test1(vstring) values ('11'||vquery);commit;
    open p_accounts for vquery;
    
    If vvar is null then
        vquery1:=' select comp_code AS "COMP_CODE",sup_rate as "SUP_RATE",sum(sup_copy) AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    else
        vquery1:=' select comp_code AS "COMP_CODE",sup_rate as "SUP_RATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    end if;
    --insert into test1(vstring) values ('22'||vquery1);commit;
    open p_accounts1 for vquery1;
  End cir_rep_supply_unit;

procedure cir_dist_taluka_publ_wise(
     pcompcode      in varchar2,
     punitcode      in varchar2,
     pbrancode      in varchar2,
     ppublcode      in varchar2,
     pmainedtn      in varchar2,
     pedtncode      in varchar2,
     pdistcode      in varchar2,
     ptalukacode    in varchar2,
     pagtypecode    in varchar2,
     pagclasscode   in varchar2,
     pagcd          in varchar2,
     pdpcd          in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     plangtype      in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is used for agency supply type
     pextra2        in varchar2,--it is used for break on district/taluka wise or datewise(1/2)
     p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(32000);
      v_query1    varchar2(32000);
      
     cursor cur_edtn is
        select distinct d.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (m.agcd=pagcd or pagcd is null) and (m.dpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='S'
        union
        select p.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (d.billagcd=pagcd or pagcd is null) and (d.billdpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='B'
        order by publ_seqno,publ,edtn_seqno,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(8000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        delete test1;insert into test1(vstring,vstring2)
        values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;

        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            /*if vvar is null then
                vvar        :='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',sup_copy,0))"'||rec_edtn.edtn||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn||'") "'||rec_edtn.edtn||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',sup_copy,0))"'||rec_edtn.edtn||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn||'") "'||rec_edtn.edtn||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn||'"';
            end if;*/
            
            if vvar is null then
                vvar        :='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
                        
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
       -- insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise ',vvar||' , '||vvar_sum1);commit;
        if pextra2='2' then--for datewise
            if vvar is null then
                v_query:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,d.supdate,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                union ';
                v_query1:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
            else
                v_query:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                union ';
                --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;
                v_query1:='select comp_code,unit_code,supdate,
                station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,supdate,agency_name';
            end if;
        else--- for district/taluka wise
            if vvar is null then
                v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                union ';
                v_query1:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,dist_name,taluka_name,agcd,dpcd,agency_name';
            else
                v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                union ';
                --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;
                v_query1:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                case when '||''''||plangtype||''''||'=''1'' then
                    substr(m.ag_name,1,25)
                else
                    substr(m.ag_name_oth_lang,1,25)
                end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m
                where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                order by comp_code,unit_code,dist_name,taluka_name,agency_name';
            end if;


        end if;

        --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;

        open p_accounts for v_query||v_query1;

    End cir_dist_taluka_publ_wise;

    procedure cir_datewise_resale(
        pcompcode      in varchar2,
        punitcode      in varchar2,
        pbrancode      in varchar2,
        ppublcode      in varchar2,
        pmainedtn      in varchar2,
        pedtncode      in varchar2,
        pdistcode      in varchar2,
        ptalukacode    in varchar2,
        pagtypecode    in varchar2,
        pagclasscode   in varchar2,
        pagcd          in varchar2,
        pdpcd          in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        plangtype      in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(8000);
     cursor cur_edtn is
        select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
         case when plangtype='1' then
          substr(p.edition_nick,1,15)
         else
          substr(p.edtn_name_oth_lang,1,20)
         end edtn_name,d.sup_rate sup_rate,p.main_edtn main_edtn
        from cir_agmast m,cir_dbksup_resale d ,cir_edtn_mast p
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and m.unit=d.unit_code and 
              m.unit=p.unit_code and d.unit_code = punitcode and
              d.supdate >= vsupdate and d.supdate <=vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and m.agcd=nvl(pagcd,m.agcd) and m.dpcd=nvl(pdpcd,m.dpcd) and d.publ=nvl(ppublcode,d.publ) and
              d.publ=p.publ and d.edtn=p.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
              (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (d.resale_branch=pbrancode or pbrancode is null)
        order by publ,main_edtn,edtn_seqno,edtn,sup_rate;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
     vquery     varchar2(8000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        --delete test1;insert into test1(vstring,vstring2)
        --values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;
        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            if vvar is null then
                --vvar    :='decode(u.edtn||u.copy_rate,'||''''||rec_edtn.edtn||rec_edtn.copy_rate||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                --tot_vvar:=',sum("'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'") "'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                
                vvar        :='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
        --insert into test1(vstring,vstring2) values('cir_datewise_resale ',vvar||' , '||vvar_sum1);commit;

        if vvar is null then
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.agcd agcd,d.dpcd dpcd,d.supdate supdate,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
        else
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate supdate,d.agcd agcd,d.dpcd dpcd,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name,'||vvar||' from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agency_name';
        end if;

        --insert into test1(vstring,vstring2) values('cir_datewise_resale v_query',v_query);commit;

        open p_accounts for v_query;

    End cir_datewise_resale;
END cir_rep_supply;
/
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

============================================SPECIFICATION-----------------------------------------

CREATE OR REPLACE PACKAGE HT18JULY.cir_rep_supply IS
  type t_accounts is ref cursor;
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl                 in varchar2,
     pmainedtn             in varchar2,
     pedtn                 in varchar2,
     proute                in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts);

   procedure cir_rep_supply_po(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

  procedure cir_rep_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

  procedure cir_rep_dist_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);  
  
  procedure cir_rep_taluka_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);  
     
  procedure cir_rep_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

  procedure cir_rep_dist_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);     

  procedure cir_rep_taluka_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);
     
  procedure cir_rep_route_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

    procedure cir_rep_dist_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
     
    procedure cir_rep_taluka_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

     procedure cir_route_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);
     
     procedure cir_dist_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

     procedure cir_taluka_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

     procedure cir_dist_taluka_wise_sup(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts);
     
    procedure cir_supply_comp(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     psupdate           in varchar2,
     psupdate1          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

    procedure cir_route_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_dist_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pdist              in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_taluka_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     ptaluka            in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_edition_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

     procedure cir_dist_taluka_publ_wise(
     pcompcode          in varchar2,
     punitcode          in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pmainedtn          in varchar2,
     pedtncode          in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pagtypecode        in varchar2,
     pagclasscode       in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
        
procedure cir_datewise_resale(
     pcompcode          in varchar2,
     punitcode          in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pmainedtn          in varchar2,
     pedtncode          in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pagtypecode        in varchar2,
     pagclasscode       in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);              
END;
/
/////////////////////////////////////////////END OF NEW PROCEDURE FOR ISSUE NO 4768=========================



////////////////////////////////////////////////////PROCEDURE FOR ISSUE NO 0004828..............07/10/2011.............. //////////////////////////

CREATE OR REPLACE PACKAGE BODY HT18JULY.Cir_SubSubRoute_bind IS
Procedure Cir_SubSubRoute_Bind_p (
    pcompcode       in varchar2,
    punitcode 		in varchar2,
    proutecode 	    in varchar2,
    psubrtcode 	    in varchar2,
    pdateformat 	in varchar2,
    pextra1 		in varchar2,
    pextra2 		in varchar2,
    p_circuls 		out T_Circul_Cursor)
As 
Begin
  	open p_circuls for
  	    select cir_sub_subroute_mast.* ,cir_get_route_rep(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.UNIT,cir_sub_subroute_mast.ROUTE_CODE) as route_name,cir_get_subroute_rep(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.UNIT,cir_sub_subroute_mast.ROUTE_CODE,cir_sub_subroute_mast.SUBRT_CODE) as Route_sub_name from cir_sub_subroute_mast  
            where comp_code=pcompcode and 
                  unit=punitcode and
  	              (route_code=proutecode or proutecode is null) and 
                  (subrt_code=psubrtcode or psubrtcode is null) and
                  nvl(freeze_flag,'N')='N' 
            order by route_code,subrt_code,sub_subrt_code;
End	Cir_SubSubRoute_Bind_p;
  
Procedure Cir_SubSubRoute_Bind_p (
    pcompcode       in varchar2,
    punitcode 		in varchar2,
    proutecode 		in varchar2,
    psubrtcode 		in varchar2,
    psubsubrtcode 	in varchar2,
    pdateformat 	in varchar2,
    pextra1 		in varchar2,
    pextra2 		in varchar2,
    p_circuls 		out T_Circul_Cursor) 
As
Begin
  	open p_circuls for
  	    select cir_sub_subroute_mast.*,cir_get_route_name(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.unit,cir_sub_subroute_mast.route_code) "ROUTE NAME",
  	    cir_get_subroute_name(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.unit,cir_sub_subroute_mast.route_code,cir_sub_subroute_mast.subrt_code) "SUBROUTE NAME",
  	    cir_get_drop_point_name(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.unit,cir_sub_subroute_mast.start_point,1) start_drop_point_name,
   	    cir_get_drop_point_name(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.unit,cir_sub_subroute_mast.end_point,1) end_drop_point_name,
        sub_subrt_mode, (select b.mode_desc from cir_route_mode_mast b where b.comp_code=cir_sub_subroute_mast.comp_code and b.mode_code=cir_sub_subroute_mast.sub_subrt_mode) as mode_name
  	    from cir_sub_subroute_mast 
              where comp_code=pcompcode and 
                    unit=punitcode and
  	                (route_code=proutecode OR proutecode is null) and 
                    (subrt_code=psubrtcode or psubrtcode is null) and 
                    (sub_subrt_code=psubsubrtcode or nvl(psubsubrtcode,'0')='0')
                    and ((upper(SUB_SUBRT_NAME) like upper(pextra1||'%')) or (pextra1 is null))
                    and (sub_subrt_mode=pextra2 or pextra2 is null)
                     /*and
                    nvl(freeze_flag,'N')='N'*/
  	          order by route_code,subrt_code,sub_subrt_code;
End Cir_SubSubRoute_Bind_p;
 
procedure  Cir_SubSubRoute_Bind_p (
    pcompcode 		in varchar2,
    punitcode 		in varchar2,
    pdateformat 	in varchar2,
    pextra1 		in varchar2,
    pextra2 		in varchar2,
    p_circuls 		out T_Circul_Cursor)
  As
  Begin
  	open p_circuls for
  	   select * from cir_sub_subroute_mast 
            where comp_code=pcompcode and 
                  unit=punitcode and
                  nvl(freeze_flag,'N')='N'
            order by route_code,subrt_code,sub_subrt_code;
  End	Cir_SubSubRoute_Bind_p;
End Cir_SubSubRoute_Bind;
/

////////////////////////////////////////////////////END OF PROCEDURE FOR ISSUE NO 0004828 //////////////////////////
/****************sub route for issue 4827******************************************/
CREATE OR REPLACE PACKAGE Cir_SubRoute_Bind is
  TYPE T_Circul_Cursor is Ref Cursor;
  Procedure Cir_SubRoute_Bind_p (
   pcompcode in varchar2,
   punitcode in varchar2,
   proutecode in varchar2,
   pdateformat in varchar2,
   pextra1 in varchar2,
   pextra2 in varchar2,
   p_circuls out T_Circul_Cursor);
  Procedure Cir_SubRoute_Bind_p (
   pcompcode in varchar2,
   punitcode in varchar2,
   proutecode in varchar2,
   psubrtcode in varchar2,
   pdateformat in varchar2,
   pextra1 in varchar2,
   pextra2 in varchar2,
   p_circuls out T_Circul_Cursor);
  Procedure Cir_SubRoute_Bind_p (
   pcompcode 		in varchar2,
   punitcode 		in varchar2,
   pdateformat in varchar2,
   pextra1 in varchar2,
   pextra2 in varchar2,
   p_circuls 		out T_Circul_Cursor);
End Cir_SubRoute_Bind;
/
CREATE OR REPLACE PACKAGE BODY Cir_SubRoute_Bind is
    Procedure Cir_SubRoute_Bind_p (
       pcompcode    in varchar2,
       punitcode    in varchar2,
       proutecode   in varchar2,
       pdateformat  in varchar2,
       pextra1      in varchar2,
       pextra2      in varchar2,
       p_circuls    out T_Circul_Cursor) as
 Begin
 	open p_circuls for
 	     select * from cir_sub_route_mast
              where comp_code=pcompcode and
                    unit=punitcode and
 		            ((route_code=proutecode)  or (proutecode is null))
                         and ((upper("SUBRT_NAME") like upper(pextra1)||'%') or (pextra1 is null))
                     and
                    nvl(freeze_flag,'N')='N' 
              order by route_code,subrt_code;
 End Cir_SubRoute_Bind_p;
 
 Procedure Cir_SubRoute_Bind_p (
   pcompcode        in varchar2,
   punitcode        in varchar2,
   proutecode       in varchar2,
   psubrtcode       in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2,
   p_circuls        out T_Circul_Cursor) as
 Begin
 	open p_circuls for
	    select a.comp_code comp_code,a.unit unit,a.route_code route_code,cir_get_route_name(a.comp_code,a.unit,a.route_code) route_name,a.subrt_code subrt_code,
               a.subrt_name subrt_name,a.subrt_name_oth_lang subrt_name_oth_lang,a.subrt_mode subrt_mode,b.mode_desc mode_name,
               a.start_point start_point,a.end_point end_point,a.subrt_dist subrt_dist,a.subrt_seq subrt_seq,
               (select c.drop_point_name from cir_drop_point_mast c	where a.comp_code=c.comp_code and a.unit=c.unit_code and a.start_point=c.drop_point) start_drop_point_name,
               (select d.drop_point_name from cir_drop_point_mast d	where a.comp_code=d.comp_code and a.unit=d.unit_code and a.end_point=d.drop_point) end_drop_point_name
           from cir_sub_route_mast a,cir_route_mode_mast b
           where a.comp_code=b.comp_code(+) and
                 a.comp_code=pcompcode and
                 a.subrt_mode=b.mode_code(+) and
                 a.unit=punitcode and
                 (a.route_code=proutecode or nvl(proutecode,'0')='0') and
                 (a.subrt_code=psubrtcode or nvl(psubrtcode,'0')='0')
                  and ((upper("SUBRT_NAME") like upper(pextra1)||'%') or (pextra1 is null))
                  and (a.SUBRT_MODE=pextra2 or pextra2 is null)
                 --and nvl(a.freeze_flag,'N')='N'
           order by route_code,subrt_code;
 End Cir_SubRoute_Bind_p;
 
 procedure Cir_SubRoute_Bind_p (
   pcompcode        in varchar2,
   punitcode        in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2,
   p_circuls        out T_Circul_Cursor) as
 Begin
 	open p_circuls for
 	       select * from cir_sub_route_mast
                 where comp_code=pcompcode and
                       unit=punitcode and
                       nvl(freeze_flag,'N')='N'  and ((upper("SUBRT_NAME") like upper(pextra1)||'%') or (pextra1 is null))
 	             order by route_code,subrt_code;
 End Cir_SubRoute_Bind_p;
End Cir_SubRoute_Bind;
/

/****************sub route for issue 4827******************************************/
/***********************laxman sir*****************************************/
                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE TRIGGER CIR_UNSOLD_DTL_CALC before insert or update on CIR_UNSOLD_DTL for each row
declare
    v_unsold_copy   number;
    v_tot_copy      number;
    v_waste_amt     number;
    v_gross_amt     number;
    v_comm_amt      number;
    v_total_amt     number;
begin
    
    if (inserting or updating)  and :new.process_crno is null then
        if :new.app_userid is not null then
            v_tot_copy      :=nvl(:new.apr_short_recpt,0)+nvl(:new.apr_late_recpt,0)+nvl(:new.apr_bnr,0)+nvl(:new.apr_unsold,0);
            v_unsold_copy   :=nvl(:new.apr_unsold,0);
        else
            v_tot_copy      :=nvl(:new.short_recpt,0)+nvl(:new.late_recpt,0)+nvl(:new.bnr,0)+nvl(:new.unsold,0);
            v_unsold_copy   :=nvl(:new.unsold,0);
        end if;
    
        if nvl(:new.waste_alw,'N')='Y' then
            v_waste_amt :=round((v_unsold_copy*nvl(:new.waste_rate,0)),2);
        else
            v_waste_amt:=0;
        end if;
        :new.waste_amt:=v_waste_amt;
        
        v_gross_amt :=nvl(v_tot_copy,0)*nvl(:new.copy_rate,0);
        
        if :new.comm_catg_type='C' then--for per copy rate
            v_comm_amt  :=round((v_tot_copy*nvl(:new.comm_rate,0)),2);
        else
            v_comm_amt  :=round((v_gross_amt*nvl(:new.comm_rate,0)/100),2);
        end if;
        v_total_amt :=round((v_gross_amt-v_comm_amt-v_waste_amt),2);
        
        :new.copy_amt:=v_total_amt;
        :new.comm_amt:=v_comm_amt;
    end if;
end;
/

                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE PACKAGE Cir_SubRoute_Bind is
  TYPE T_Circul_Cursor is Ref Cursor;
    Procedure Cir_SubRoute_Bind_p (
        pcompcode   in varchar2,
        punitcode   in varchar2,
        proutecode  in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,
        p_circuls   out T_Circul_Cursor);
        
    Procedure Cir_SubRoute_Bind_p (
        pcompcode   in varchar2,
        punitcode   in varchar2,
        proutecode  in varchar2,
        psubrtcode  in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,
        p_circuls   out T_Circul_Cursor);
    Procedure Cir_SubRoute_Bind_p (
        pcompcode 	in varchar2,
        punitcode 	in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,
        p_circuls 	out T_Circul_Cursor);
End Cir_SubRoute_Bind;
/
CREATE OR REPLACE PACKAGE BODY Cir_SubRoute_Bind is
Procedure Cir_SubRoute_Bind_p (
    pcompcode    in varchar2,
    punitcode    in varchar2,
    proutecode   in varchar2,
    pdateformat  in varchar2,
    pextra1      in varchar2,    
    pextra2      in varchar2,
    p_circuls    out T_Circul_Cursor) as
Begin
    open p_circuls for
 	select * from cir_sub_route_mast
        where comp_code=pcompcode and
            unit=punitcode and
 		    ((route_code=proutecode)  or (proutecode is null)) and 
            ((upper(subrt_name) like upper(pextra1)||'%') or (pextra1 is null)) and 
            nvl(freeze_flag,'N')='N'
            order by route_code,subrt_code;
End Cir_SubRoute_Bind_p;

Procedure Cir_SubRoute_Bind_p (
    pcompcode        in varchar2,
    punitcode        in varchar2,
    proutecode       in varchar2,
    psubrtcode       in varchar2,
    pdateformat      in varchar2,
    pextra1          in varchar2,
    pextra2          in varchar2,
    p_circuls        out T_Circul_Cursor) as
Begin
 	open p_circuls for
    select a.comp_code comp_code,a.unit unit,a.route_code route_code,cir_get_route_name(a.comp_code,a.unit,a.route_code) route_name,a.subrt_code subrt_code,
           a.subrt_name subrt_name,a.subrt_name_oth_lang subrt_name_oth_lang,a.subrt_mode subrt_mode,
           (select b.mode_desc from cir_route_mode_mast b where b.comp_code=a.comp_code and b.mode_code=a.subrt_mode) as mode_name,
           a.start_point start_point,a.end_point end_point,a.subrt_dist subrt_dist,a.subrt_seq subrt_seq,
           (select c.drop_point_name from cir_drop_point_mast c	where a.comp_code=c.comp_code and a.unit=c.unit_code and a.start_point=c.drop_point) start_drop_point_name,
           (select d.drop_point_name from cir_drop_point_mast d	where a.comp_code=d.comp_code and a.unit=d.unit_code and a.end_point=d.drop_point) end_drop_point_name
       from cir_sub_route_mast a
       where a.comp_code=pcompcode and
             a.unit=punitcode and
             (a.route_code=proutecode or nvl(proutecode,'0')='0') and
             (a.subrt_code=psubrtcode or nvl(psubrtcode,'0')='0')
              and ((upper(subrt_name) like upper(pextra1)||'%') or (pextra1 is null))
              and (a.subrt_mode=pextra2 or pextra2 is null)
             --and nvl(a.freeze_flag,'N')='N'
       order by route_code,subrt_code;
End Cir_SubRoute_Bind_p;

procedure Cir_SubRoute_Bind_p (
    pcompcode        in varchar2,
    punitcode        in varchar2,
    pdateformat      in varchar2,
    pextra1          in varchar2,
    pextra2          in varchar2,
    p_circuls        out T_Circul_Cursor) as
Begin
    open p_circuls for
 	select * from cir_sub_route_mast
    where comp_code=pcompcode and
    unit=punitcode and
    nvl(freeze_flag,'N')='N'  and ((upper(subrt_name) like upper(pextra1)||'%') or (pextra1 is null))
 	order by route_code,subrt_code;
    
End Cir_SubRoute_Bind_p;
End Cir_SubRoute_Bind;
/
                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE PACKAGE Cir_SubSubRoute_bind IS
    TYPE T_Circul_Cursor is Ref Cursor;
Procedure Cir_SubSubRoute_Bind_p (
    pcompcode 	    in varchar2,
    punitcode 	    in varchar2,
    proutecode 	    in varchar2,
    psubrtcode 	    in varchar2,
    pdateformat     in varchar2,
    pextra1 	    in varchar2,
    pextra2 	    in varchar2,
    p_circuls 	    out T_Circul_Cursor);
Procedure Cir_SubSubRoute_Bind_p (
   pcompcode 	    in varchar2,
   punitcode 	    in varchar2,
   proutecode 	    in varchar2,
   psubrtcode 	    in varchar2,
   psubsubrtcode    in varchar2,
   pdateformat 	    in varchar2,
   pextra1 			in varchar2,
   pextra2 			in varchar2,
   p_circuls 		out T_Circul_Cursor);
procedure Cir_SubSubRoute_Bind_p (
   pcompcode 		in varchar2,
   punitcode 		in varchar2,
   pdateformat	    in varchar2,
   pextra1 			in varchar2,
   pextra2 			in varchar2,
   p_circuls 		out T_Circul_Cursor);
End Cir_SubSubRoute_Bind;
/
CREATE OR REPLACE PACKAGE BODY Cir_SubSubRoute_bind IS
Procedure Cir_SubSubRoute_Bind_p (
    pcompcode       in varchar2,
    punitcode 		in varchar2,
    proutecode 	    in varchar2,
    psubrtcode 	    in varchar2,
    pdateformat 	in varchar2,
    pextra1 		in varchar2,
    pextra2 		in varchar2,
    p_circuls 		out T_Circul_Cursor)
As 
Begin
  	open p_circuls for
  	    select cir_sub_subroute_mast.* ,cir_get_route_rep(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.UNIT,cir_sub_subroute_mast.ROUTE_CODE) as route_name,cir_get_subroute_rep(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.UNIT,cir_sub_subroute_mast.ROUTE_CODE,cir_sub_subroute_mast.SUBRT_CODE) as Route_sub_name from cir_sub_subroute_mast  
            where comp_code=pcompcode and 
                  unit=punitcode and
  	              (route_code=proutecode or proutecode is null) and 
                  (subrt_code=psubrtcode or psubrtcode is null) and
                  nvl(freeze_flag,'N')='N' 
            order by route_code,subrt_code,sub_subrt_code;
End	Cir_SubSubRoute_Bind_p;
  
Procedure Cir_SubSubRoute_Bind_p (
    pcompcode       in varchar2,
    punitcode 		in varchar2,
    proutecode 		in varchar2,
    psubrtcode 		in varchar2,
    psubsubrtcode 	in varchar2,
    pdateformat 	in varchar2,
    pextra1 		in varchar2,
    pextra2 		in varchar2,
    p_circuls 		out T_Circul_Cursor) 
As
Begin
  	open p_circuls for
  	    select cir_sub_subroute_mast.*,cir_get_route_name(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.unit,cir_sub_subroute_mast.route_code) "ROUTE NAME",
  	    cir_get_subroute_name(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.unit,cir_sub_subroute_mast.route_code,cir_sub_subroute_mast.subrt_code) "SUBROUTE NAME",
  	    cir_get_drop_point_name(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.unit,cir_sub_subroute_mast.start_point,1) start_drop_point_name,
   	    cir_get_drop_point_name(cir_sub_subroute_mast.comp_code,cir_sub_subroute_mast.unit,cir_sub_subroute_mast.end_point,1) end_drop_point_name,
        sub_subrt_mode, (select b.mode_desc from cir_route_mode_mast b where b.comp_code=cir_sub_subroute_mast.comp_code and b.mode_code=cir_sub_subroute_mast.sub_subrt_mode) as mode_name
  	    from cir_sub_subroute_mast 
              where comp_code=pcompcode and 
                    unit=punitcode and
  	                (route_code=proutecode OR proutecode is null) and 
                    (subrt_code=psubrtcode or psubrtcode is null) and 
                    (sub_subrt_code=psubsubrtcode or nvl(psubsubrtcode,'0')='0')
                    and ((upper(SUB_SUBRT_NAME) like upper(pextra1||'%')) or (pextra1 is null))
                    and (sub_subrt_mode=pextra2 or pextra2 is null)
                     /*and
                    nvl(freeze_flag,'N')='N'*/
  	          order by route_code,subrt_code,sub_subrt_code;
End Cir_SubSubRoute_Bind_p;
 
procedure  Cir_SubSubRoute_Bind_p (
    pcompcode 		in varchar2,
    punitcode 		in varchar2,
    pdateformat 	in varchar2,
    pextra1 		in varchar2,
    pextra2 		in varchar2,
    p_circuls 		out T_Circul_Cursor)
  As
  Begin
  	open p_circuls for
  	   select * from cir_sub_subroute_mast 
            where comp_code=pcompcode and 
                  unit=punitcode and
                  nvl(freeze_flag,'N')='N'
            order by route_code,subrt_code,sub_subrt_code;
  End	Cir_SubSubRoute_Bind_p;
End Cir_SubSubRoute_Bind;
/
                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE PACKAGE cir_agency_bind is
   type t_accounts_cursor is ref cursor;
procedure cir_agency_bind_p (
    pcompcode   in varchar2,
    punit       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    p_accounts  out t_accounts_cursor);
   
procedure cir_branch_billagency_p (
    pcompcode   in varchar2,
    punit       in varchar2,
    pbranchcode in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    p_accounts  out t_accounts_cursor);

procedure cir_agency_bind_p (
    pcompcode   in varchar2,
    punit       in varchar2,
    pagcd       in varchar2,
    pdpcd       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,    
    p_accounts  out t_accounts_cursor);
    
procedure cir_agency_listing_p (
    pcompcode   in varchar2,
    punit       in varchar2,
    pagty       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,    
    p_accounts  out t_accounts_cursor);
      
procedure cir_agency_area_p (
    pcompcode   in varchar2,
    punit       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,    
    p_accounts  out t_accounts_cursor);
        
procedure cir_agency_extraLabel_p(
    pcompcode     in varchar2,
    punit         in varchar2,
    pdateformat   in varchar2,
    pextra1       in varchar2,
    pextra2       in varchar2,
    p_accounts    out t_accounts_cursor);
procedure cir_agency_bind_pd (
    pcompcode       in varchar2,
    punit           in varchar2,
    pname           in varchar2,
    pdateformat     in varchar2,
    -- pextra1 in varchar2,
    pextra2         in varchar2,
    p_accounts      out t_accounts_cursor);
        
procedure cir_agency_bind_pgoogle (
    pcompcode   in varchar2,
    punit       in varchar2,
    pagcd       in varchar2,
    pdpcd       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,    
    p_accounts  out t_accounts_cursor);
End cir_agency_bind;
/
CREATE OR REPLACE PACKAGE BODY cir_agency_bind is
    procedure cir_agency_bind_p (
        pcompcode         in varchar2,
        punit             in varchar2,
        pdateformat     in varchar2,
        pextra1         in varchar2,
        pextra2         in varchar2,
        p_accounts         out t_accounts_cursor)
        As
  Begin
      if upper(pextra2)='D' then
        open p_accounts for
        select cir_agmast_dis.*,cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
            where comp_code = pcompcode and unit = punit and
            ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and nvl(freeze_flag,'N')='N'
        union
        select cir_agmast_dis.*,cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
            where comp_code = pcompcode and unit = punit and
            ((upper(agcd) like upper(pextra1||'%')) or (pextra1 is null)) and nvl(freeze_flag,'N')='N'    
        order by 5;
      else
        open p_accounts for
        select cir_agmast.*,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
          where comp_code = pcompcode and
                    unit = punit and
                    ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and
              nvl(freeze_flag,'N')='N'
        union
        select cir_agmast.*,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
          where comp_code = pcompcode and
                    unit = punit and
                    ((upper(agcd) like upper(pextra1||'%')) or (pextra1 is null)) and
              nvl(freeze_flag,'N')='N'      
        order by 5;
      end if;
  End cir_agency_bind_p;

  procedure cir_branch_billagency_p (
        pcompcode         in varchar2,
        punit             in varchar2,
        pbranchcode     in varchar2,
        pdateformat     in varchar2,
        pextra1         in varchar2,
        pextra2         in varchar2,
        p_accounts         out t_accounts_cursor)
        As
  Begin
      if upper(pextra2)='D' then
          open p_accounts for
            select cir_agmast_dis.* ,cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
              where comp_code = pcompcode and
                        unit = punit and
                        (branch_code=pbranchcode or pbranchcode is null) and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and
                  nvl(freeze_flag,'N')='N'
            union
            select cir_agmast_dis.* ,cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
              where comp_code = pcompcode and
                        unit = punit and
                        (branch_code=pbranchcode or pbranchcode is null) and
                        ((upper(agcd) like upper(pextra1||'%')) or (pextra1 is null)) and
                  nvl(freeze_flag,'N')='N'      
            order by 5;
       else
          open p_accounts for
            select cir_agmast.* ,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
              where comp_code = pcompcode and
                        unit = punit and
                        (branch_code=pbranchcode or pbranchcode is null) and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and
                  nvl(freeze_flag,'N')='N'
            union
            select cir_agmast.* ,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
              where comp_code = pcompcode and
                        unit = punit and
                        (branch_code=pbranchcode or pbranchcode is null) and
                        ((upper(agcd) like upper(pextra1||'%')) or (pextra1 is null)) and
                  nvl(freeze_flag,'N')='N'      
            order by 5;
       end if;
  End cir_branch_billagency_p;

  
procedure cir_agency_bind_pd (
    pcompcode   in varchar2,
    punit       in varchar2,
    pname       in varchar2,
    pdateformat in varchar2,
    -- pextra1 in varchar2,
    pextra2     in varchar2,
    p_accounts  out t_accounts_cursor) as
  Begin
      open p_accounts for
        select * from cir_agmast
           where comp_code = pcompcode and
                 unit = punit and
              ((upper(ag_name)=upper(pname)) or (upper(ag_name) like upper(pname||'%'))) and
              nvl(freeze_flag,'N')='N'
        union
        select * from cir_agmast
           where comp_code = pcompcode and
                 unit = punit and
              ((upper(agcd)=upper(pname)) or (upper(ag_name) like upper(pname||'%'))) and
              nvl(freeze_flag,'N')='N'      
         order by 5;
  End cir_agency_bind_pd;
  
procedure cir_agency_bind_p (
    pcompcode       in varchar2,
    punit           in varchar2,
    pagcd           in varchar2,
    pdpcd           in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    p_accounts      out t_accounts_cursor) as
Begin
    if upper(pextra2)='D' then
        open p_accounts for
            select * from cir_agmast_dis
             where comp_code = pcompcode and
                   unit = punit and
                   agcd=pagcd and
                   dpcd=pdpcd and
                   nvl(freeze_flag,'N')='N'
             order by ag_name;
     else
        open p_accounts for
            select * from cir_agmast
             where comp_code = pcompcode and
                   unit = punit and
                   agcd=pagcd and
                   dpcd=pdpcd and
                   nvl(freeze_flag,'N')='N'
             order by ag_name;
     end if;
End cir_agency_bind_p;

procedure cir_agency_listing_p (--Agency Master Listing
    pcompcode       in varchar2,
    punit           in varchar2,
    pagty           in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    p_accounts      out t_accounts_cursor) as
Begin
  open p_accounts for
     select cir_agmast.*,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY NAME",cir_get_agency_type(cir_agmast.comp_code,cir_agmast.ag_type) "AGENCY TYPE NAME" 
     from cir_agmast
        where comp_code = pcompcode and
              unit      = punit and
              ((ag_type = pagty) or (pagty is null)) order by cir_agmast.ag_type,cir_agmast.ag_name;
End cir_agency_listing_p;


procedure cir_agency_area_p (
    pcompcode       in varchar2,
    punit           in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    p_accounts      out t_accounts_cursor) as
Begin
    if upper(pextra2)='D' then
        open p_accounts for
            select cir_agmast_dis.*,cir_get_area(cir_agmast_dis.comp_code,cir_agmast_dis.area_code) "AREA_NAME",cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
                where comp_code = pcompcode and
                        unit      = punit and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null))
            union            
            select cir_agmast_dis.*,cir_get_area(cir_agmast_dis.comp_code,cir_agmast_dis.area_code) "AREA_NAME",cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
                where comp_code = pcompcode and
                        unit      = punit and
                        ((upper(agcd) like upper(pextra1||'%')) or (pextra1 is null))                        
                           order by 7,5;
    else
        open p_accounts for
            select cir_agmast.*,cir_get_area(cir_agmast.comp_code,cir_agmast.area_code) "AREA_NAME",cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
                where comp_code = pcompcode and
                          unit      = punit and
                        ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null))
            union
            select cir_agmast.*,cir_get_area(cir_agmast.comp_code,cir_agmast.area_code) "AREA_NAME",cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
                where comp_code = pcompcode and
                          unit      = punit and
                        ((upper(agcd) like upper(pextra1||'%')) or (pextra1 is null))            
                           order by 7,5;
    end if;
End cir_agency_area_p;

procedure cir_agency_extraLabel_p(
    pcompcode     in varchar2,
    punit         in varchar2,
    pdateformat   in varchar2,
    pextra1       in varchar2,
    pextra2       in varchar2,
    p_accounts    out t_accounts_cursor) as
Begin

    open p_accounts for
    select cir_agmast.*,cir_get_area(cir_agmast.comp_code,cir_agmast.area_code) "AREA_NAME",cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
        where comp_code = pcompcode and
              unit      = punit and
              (PRINT_LABEL= 'N' or PRINT_LABEL is null ) and
              (SUSPEND_TYPE='N' or SUSPEND_TYPE is null) and
            ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null))
    union
    select cir_agmast.*,cir_get_area(cir_agmast.comp_code,cir_agmast.area_code) "AREA_NAME",cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
        where comp_code = pcompcode and
              unit      = punit and
              (PRINT_LABEL= 'N' or PRINT_LABEL is null ) and
              (SUSPEND_TYPE='N' or SUSPEND_TYPE is null) and
            ((upper(agcd) like upper(pextra1||'%')) or (pextra1 is null))        
               order by 7,5;
End cir_agency_extraLabel_p;


procedure cir_agency_bind_pgoogle (
    pcompcode   in varchar2,
    punit       in varchar2,
    pagcd       in varchar2,
    pdpcd       in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,    
    p_accounts  out t_accounts_cursor)
As
Begin
      if upper(pextra2)='D' then
        open p_accounts for
        select cir_agmast_dis.*,cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
            where comp_code = pcompcode and unit = punit and
            ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and nvl(freeze_flag,'N')='N' AND ROWNUM<=10
        union
        select cir_agmast_dis.*,cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME" from cir_agmast_dis
            where comp_code = pcompcode and unit = punit and
            ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and nvl(freeze_flag,'N')='N' AND ROWNUM<=10    
        order by 5;
      else
        open p_accounts for
        select cir_agmast.*,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
          where comp_code = pcompcode and
                    unit = punit and
                    ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and
              nvl(freeze_flag,'N')='N' AND ROWNUM<=10
        union
        select cir_agmast.*,cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME" from cir_agmast
          where comp_code = pcompcode and
                    unit = punit and
                    ((upper(ag_name) like upper(pextra1||'%')) or (pextra1 is null)) and
              nvl(freeze_flag,'N')='N' AND ROWNUM<=10              
        order by 5;
      end if;
End cir_agency_bind_pgoogle;

End cir_agency_bind;
/
                                                                     
                                                                     
                                                                     
                                             
CREATE OR REPLACE FUNCTION cir_get_receipt_exist
    (pcomp_code     in varchar2,
     punit_code     in varchar2,
     pbran_code     in varchar2,
     precptno       in varchar2,
     pdoctype       in varchar2,
     pagcd          in varchar2,
     pdpcd          in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2) RETURN number IS
 v_rec_exist number(5):=0;
BEGIN
    if upper(pextra2)='D' then
        select count(*) into v_rec_exist from cir_rcphdr_dis where comp_code=pcomp_code and unit_code=punit_code and 
        doctype=pdoctype and recptno=precptno and agcd=pagcd and dpcd=pdpcd and branch_code=pbran_code;
    else
        select count(*) into v_rec_exist from cir_rcphdr where comp_code=pcomp_code and unit_code=punit_code and 
        doctype=pdoctype and recptno=precptno and agcd=pagcd and dpcd=pdpcd and branch_code=pbran_code;    
    end if;    
     
  return nvl(v_rec_exist,0);
END;
/

/***********************laxman sir*****************************************/


/************************************************************************ISSUE NO.0004816 *******************************************/


 CREATE OR REPLACE package body HT18JULY.cir_edtion_bind is
   procedure cir_edtion_bind_p (
   	pcomp_code      in varchar2,
   	ppubl_code      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
   	p_circuls       out T_Circul_Cursor) as
   Begin
      open p_circuls for
         select * from cir_edtn_mast
                 where comp_code = pcomp_code and
                      (publ=ppubl_code or ppubl_code is null) and
                       nvl(freeze_flag,'N')='N' and edtn<>main_edtn and
                       ((upper(edtn_name) like upper(pextra1)||'%') or (pextra1 is null)) and
                       (unit_code=pextra2 or pextra2 is null)
                 order by edtn_name;
   End cir_edtion_bind_p;

   procedure cir_edtion_bind_p (
   	pcomp_code      in varchar2,
   	ppubl_code      in varchar2,
   	pedtn_code      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
   	p_circuls       out T_Circul_Cursor) as
   Begin
      open p_circuls for
         select * from cir_edtn_mast
                 where comp_code = pcomp_code and
                       publ = ppubl_code and
                       (edtn=pedtn_code or pedtn_code is null) and
                       nvl(freeze_flag,'N')='N' and
                       (unit_code=pextra2 or pextra2 is null)
                       order by edtn_name;
   End cir_edtion_bind_p;
   
   procedure cir_mian_edtion_bind_p (
       pcomp_code   in varchar2,
       ppubl_code   in varchar2,
       pedtn_code   in varchar2,
       pdateformat  in varchar2,
       pextra1      in varchar2,
       pextra2      in varchar2,
       p_circuls    out T_Circul_Cursor)
   As
   Begin
        open p_circuls for
        select * from cir_edtn_mast
            where comp_code = pcomp_code and (unit_code=pextra1 or pextra1 is null) and publ = ppubl_code and
                    (edtn=pedtn_code or pedtn_code is null) and edtn=main_edtn AND (upper(edtn_name) like upper(pextra2)||'%' or pextra2 is null)
                    and nvl(freeze_flag,'N')='N' 
        order by edtn_name;

   End cir_mian_edtion_bind_p;
   
   procedure cir_sub_edtion_bind_p (
       pcomp_code       in varchar2,
       ppubl_code       in varchar2,
       pedtn_code       in varchar2,
       psubedtn_code    in varchar2,
       pdateformat      in varchar2,
       pextra1          in varchar2,
       pextra2          in varchar2,
       p_circuls        out T_Circul_Cursor)
   As
   Begin
        open p_circuls for
        select * from cir_edtn_mast
            where comp_code = pcomp_code and publ = ppubl_code and
                    (edtn=psubedtn_code or psubedtn_code is null) and (main_edtn=pedtn_code or pedtn_code is null) and
                    edtn<>main_edtn and
        nvl(freeze_flag,'N')='N' and (unit_code=pextra2 or pextra2 is null)
        order by edtn_name;

   End cir_sub_edtion_bind_p;

   procedure cir_mian_edtion_pick_bind_p (
   pcomp_code       in varchar2,
   ppubl_code       in varchar2,
   pedtn_code       in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2,
   p_circuls        out T_Circul_Cursor)
   As
   Begin
        open p_circuls for
        select * from cir_edtn_mast
            where comp_code = pcomp_code and publ = ppubl_code and
                    edtn in (select main_edtn from cir_edtn_mast where comp_code = pcomp_code and publ = ppubl_code and
                         edtn<>nvl(main_edtn,'/') and edtn=pedtn_code) and
                       nvl(freeze_flag,'N')='N' and (unit_code=pextra2 or pextra2 is null)
        order by EDTN_SEQ_NO;

   End cir_mian_edtion_pick_bind_p;  
End cir_edtion_bind;
/


/************************************************************************ END OF ISSUE NO.0004816 *******************************************/



/***************5268 prachi 11-oct***********************/
CREATE OR REPLACE FUNCTION cir_get_genrate_agcd(pcomp_code in varchar2,punit_code in varchar,pextra1 in varchar2,pextra2 in varchar2) RETURN number IS
v_name number(5);
BEGIN
    
    select GENRATE_CIR_AGCD into v_name from preferrences where "comp_code"=pcomp_code;
    
  return nvl(v_name,1);
END;

CREATE OR REPLACE PACKAGE Cir_Genrate_Code IS
	type p_circul_cursor is ref cursor;
	PROCEDURE agency_type_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE agency_class_P (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE suspend_type_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE area_type_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE publ_mast_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ppubl_code 	out p_circul_cursor);
	PROCEDURE edtn_mast_P (
		pcompcode 	in varchar2,
		ppubl_code 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		pedtn_code 	out p_circul_cursor);
	PROCEDURE agmast_P (
		pcompcode 	in varchar2,
		punitcode 	in varchar2,
		pprefix 		in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		pag_code 		out p_circul_cursor);
	PROCEDURE agsubcode_P (
		pcompcode 	in varchar2,
		punitcode 	in varchar2,
		pagcode  		in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		pag_code 		out p_circul_cursor);
	PROCEDURE areacode_P (
		pcompcode  	in varchar2,
		punitcode  	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		parea_code  out p_circul_cursor);
	PROCEDURE drop_point_code_P (
		pcompcode  	in varchar2,
		punitcode  	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		pdrop_point_code  out p_circul_cursor);
	PROCEDURE executive_code_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		pexe_code 	out p_circul_cursor);
	PROCEDURE routecode_P (
		pcompcode 	in varchar2,
		punitcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		prt_code	 	out p_circul_cursor);
	PROCEDURE subroutecode_P (
		pcompcode 	in varchar2,
		punitcode 	in varchar2,
		prtcode 		in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		psubrt_code out p_circul_cursor);
	PROCEDURE subsubroutecode_P (
		pcompcode 	in varchar2,
		punitcode 	in varchar2,
		prtcode 		in varchar2,
		psubrtcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		psubsubrt_code out p_circul_cursor);
	PROCEDURE transportercode_P (
		pcompcode 	in varchar2,
		pprefix 		in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptp_code 		out p_circul_cursor);
	PROCEDURE districtcode_P (
		pcompcode 	in varchar2,
		pstatecode 	in varchar2,
		pprefix 		in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		pdist_code 	out p_circul_cursor);
	PROCEDURE comm_catg_p (
		pcompcode 	in varchar2,
		pcomm_type 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE comm_p (
		pcompcode 	in varchar2,
		pcomm_type 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE zone_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE taluka_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 	in varchar2,
		pextra2 	in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE receipt_p (
		pcompcode 	in varchar2,
		pbranchcode in varchar2,
        pdoctype    in varchar2,
        precptdt    in varchar2,
        pdateformat in varchar2,
		pextra1 	in varchar2,
		pextra2 	in varchar2,
		ptype_code 	out p_circul_cursor);
        
	PROCEDURE mode_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE supply_type_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE expenses_type_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE city_p (
		pcompcode 	in varchar2,
		pdateformat in varchar2,
		pextra1 		in varchar2,
		pextra2 		in varchar2,
		ptype_code 	out p_circul_cursor);
	PROCEDURE cir_region_p (
		pcompcode 		in varchar2,
		pdateformat 	in varchar2,
		pextra1 			in varchar2,
		pextra2 			in varchar2,
		preg_code 		out p_circul_cursor);
	PROCEDURE cir_unsold_receipt_p (
		pcompcode 		in varchar2,
		pdateformat 	in varchar2,
		pextra1 			in varchar2,
		pextra2 			in varchar2,
		preceipt_no 	out p_circul_cursor);
	PROCEDURE cir_surcharge_p (
		pcompcode 		in varchar2,
		pdateformat 	in varchar2,
		pextra1 			in varchar2,
		pextra2 			in varchar2,
		psurch_cd 		out p_circul_cursor);
PROCEDURE cir_roleMatser_p (
		pcompcode 		in varchar2,
		pdateformat 	in varchar2,
		pextra1 			in varchar2,
		pextra2 			in varchar2,
		psurch_cd 		out p_circul_cursor);
PROCEDURE cir_narr_p (
		pcompcode 		in varchar2,
		pdateformat 	in varchar2,
		pextra1 			in varchar2,
		pextra2 			in varchar2,
		pnarr_cd 		out p_circul_cursor);
PROCEDURE cir_taxi_code_p (
        pcompcode in varchar2,
        pdateformat in varchar2,
        pextra1 in varchar2,
        pextra2 in varchar2,
        ptaxi_code out p_circul_cursor);

PROCEDURE cir_lable_htmlformatid_p (
        pcompcode   in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,
        pformat_id  out p_circul_cursor); 

PROCEDURE cir_installment_code_p (
        pcompcode   in varchar2,
        punitcode   in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,
        pcode       out p_circul_cursor);               
END Cir_Genrate_Code;
/
CREATE OR REPLACE PACKAGE BODY Cir_Genrate_Code IS
PROCEDURE agency_type_p (
  pcompcode in varchar2,
  pdateformat in varchar2,
  pextra1 in varchar2,
  pextra2 in varchar2,
  ptype_code out p_circul_cursor) as
    vno number(5);
    vtype_code     varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(agency_type_code,3,5))+1 into vno from cir_agency_typ_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='AT'||'001';
     Else
    vtype_code:='AT'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End agency_type_p;
PROCEDURE agency_class_p (
    pcompcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
    ptype_code out p_circul_cursor) as
    vno number(8);
    vtype_code     varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select to_number(max(substr(class_code,3,5)))+1 into vno from cir_agency_class_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='AC'||'001';
     Else
    vtype_code:='AC'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End agency_class_p;
PROCEDURE suspend_type_p (
      pcompcode in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2,
      ptype_code out p_circul_cursor) as
    vno number(5);
    vtype_code varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(suspend_type_code,3,5))+1 into vno from cir_suspend_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='ST'||'001';
     Else
    vtype_code:='ST'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End suspend_type_p;
PROCEDURE area_type_p (
    pcompcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
    ptype_code out p_circul_cursor) as
    vno number(5);
    vtype_code varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(area_type,3,5))+1 into vno from cir_area_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='AR'||'001';
     Else
    vtype_code:='AR'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End area_type_p;
PROCEDURE publ_mast_p(
   pcompcode in varchar2,
   pdateformat in varchar2,
   pextra1 in varchar2,
   pextra2 in varchar2,
   ppubl_code out p_circul_cursor) as
    vno number(5);
    vpubl_code varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(to_number(substr(publ,2)))+1 into vno from cir_publ_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vpubl_code:='P'||'01';
     Else
    vpubl_code:='P'||lpad(vno,2,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vpubl_code,v_sess_id);
  commit;
  open ppubl_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End publ_mast_p;
PROCEDURE edtn_mast_p (
   pcompcode in varchar2,
   ppubl_code in varchar2,
   pdateformat in varchar2,
   pextra1 in varchar2,
   pextra2 in varchar2,
   pedtn_code out p_circul_cursor) as
    vno number(5);
    vedtn_code varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(edtn,2))+1 into vno from cir_edtn_mast where comp_code=pcompcode /*and publ=ppubl_code*/;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vedtn_code:=/*'E'||*/'001';
     Else
    vedtn_code:=/*'E'||*/lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vedtn_code,v_sess_id);
  commit;
  open pedtn_code for select var_code from cir_gen_code where  vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End edtn_mast_p;
PROCEDURE agmast_P (
  pcompcode         in varchar2,
  punitcode         in varchar2,
  pprefix             in varchar2,
  pdateformat     in varchar2,
  pextra1             in varchar2,
  pextra2             in varchar2,
  pag_code             out p_circul_cursor) as
  vno                 number(8);
  vag_code     varchar2(8);
  v_sess_id     number(20);
  v_prefix      varchar2(20);
Begin
    select userenv('sessionid') into v_sess_id from dual;
    Begin
      if upper(pextra2)='D' then
          v_prefix:='D'||upper(pprefix);
          select max(substr(agcd,length(v_prefix)+1))+1 into vno from cir_agmast_dis
              where comp_code=pcompcode and unit=punitcode and upper(substr(agcd,1,length(v_prefix)))=upper(v_prefix);
      else
        v_prefix:=upper(pprefix);
        select max(substr(agcd,length(v_prefix)+1))+1 into vno from cir_agmast
                  where comp_code=pcompcode and unit=punitcode and upper(substr(agcd,1,length(v_prefix)))=upper(v_prefix);      
      end if;
  Exception when others then
         vno:=0;
  End;
  if nvl(vno,0)=0 then
       vag_code:=upper(v_prefix)||'0001';
  else
       vag_code:=upper(v_prefix)||lpad(vno,4,'0');
  end if;
  delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vag_code,v_sess_id);
  commit;
  open pag_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End agmast_P;
PROCEDURE agsubcode_P (
      pcompcode     in varchar2,
      punitcode     in varchar2,
      pagcode         in varchar2,
      pdateformat in varchar2,
      pextra1         in varchar2,
      pextra2         in varchar2,
      pag_code         out p_circul_cursor) as
    vno             number(8);
    vag_code     varchar2(8);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
      if upper(pextra2)='D' then
        select to_number(max(dpcd))+1 into vno from cir_agmast_dis
              where comp_code=pcompcode and unit=punitcode and upper(agcd)=upper(pagcode);
      else
        select to_number(max(dpcd))+1 into vno from cir_agmast
              where comp_code=pcompcode and unit=punitcode and upper(agcd)=upper(pagcode);      
      end if;
  Exception when others then
      vno:=0;
  End;
  if nvl(vno,0)=0 then
       vag_code:='0001';
  else
       vag_code:=lpad(vno,4,'0');
  end if;
  delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vag_code,v_sess_id);
  commit;
  open pag_code for select var_code from cir_gen_code where  vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End agsubcode_P;
PROCEDURE areacode_P (
       pcompcode      in varchar2,
       punitcode         in varchar2,
       pdateformat    in varchar2,
       pextra1             in varchar2,
       pextra2             in varchar2,
       parea_code     out p_circul_cursor) as
    vno                 number(8);
    varea_code     varchar2(15);
    v_sess_id     number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(area_code,2,5))+1 into vno from cir_area_mast where comp_code=pcompcode and unit_code=punitcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      varea_code:='A'||'0001';
     Else
    varea_code:='A'||lpad(vno,4,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(varea_code,v_sess_id);
  commit;
  open parea_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End areacode_P;
    PROCEDURE drop_point_code_P (
           pcompcode      in varchar2,
           punitcode         in varchar2,
           pdateformat     in varchar2,
           pextra1             in varchar2,
           pextra2             in varchar2,
           pdrop_point_code out p_circul_cursor) as
        vno number(8);
        vdrop_point     varchar2(15);
        v_sess_id number(20);
    BEGIN
        select userenv('sessionid') into v_sess_id from dual;
        Begin
           select max(substr(drop_point,2,5))+1 into vno from cir_drop_point_mast where comp_code=pcompcode and unit_code=punitcode;
        Exception When Others Then
            vno:=null;
        End;
         If nvl(vno,0)=0 Then
          vdrop_point:='D'||'0001';
         Else
        vdrop_point:='D'||lpad(vno,4,'0');
         End if;
         delete from cir_gen_code where vsessionid=v_sess_id;
      insert into cir_gen_code(var_code,vsessionid) values(vdrop_point,v_sess_id);
      commit;
      open pdrop_point_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
      delete from cir_gen_code where vsessionid=v_sess_id;
      commit;
    End drop_point_code_P;
    Procedure executive_code_p (
            pcompcode      in varchar2,
            pdateformat in varchar2,
            pextra1         in varchar2,
            pextra2         in varchar2,
            pexe_code     out p_circul_cursor) as
    vno             number(8);
        v_code         varchar2(15);
        v_sess_id number(20);
    Begin
        select userenv('sessionid') into v_sess_id from dual;
        Begin
           select max(substr(executive_code,2,5))+1 into vno from cir_executive_mast where comp_code=pcompcode;
        Exception When Others Then
            vno:=null;
        End;
         If nvl(vno,0)=0 Then
          v_code:='E'||'00001';
         Else
        v_code:='E'||lpad(vno,5,'0');
         End if;
         delete from cir_gen_code where vsessionid=v_sess_id;
      insert into cir_gen_code(var_code,vsessionid) values(v_code,v_sess_id);
      commit;
      open pexe_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
      delete from cir_gen_code where vsessionid=v_sess_id;
      commit;
    End executive_code_p;
    PROCEDURE routecode_P (
          pcompcode in varchar2,
          punitcode in varchar2,
          pdateformat in varchar2,
          pextra1 in varchar2,
          pextra2 in varchar2,
          prt_code out p_circul_cursor) As
        vno number(8);
        vrt_code varchar2(15);
    BEGIN
        Begin
           select max(substr(route_code,3,5))+1 into vno from cir_route_mast where comp_code=pcompcode and unit=punitcode;
        Exception When Others Then
            vno:=null;
        End;
         If nvl(vno,0)=0 Then
          vrt_code:='RT'||'001';
         Else
        vrt_code:='RT'||lpad(vno,3,'0');
         End if;
         delete from cir_gen_code where vsessionid=userenv('sessionid');
      insert into cir_gen_code(var_code,vsessionid) values(vrt_code,userenv('sessionid'));
      commit;
      open prt_code for select var_code from cir_gen_code  where vsessionid=userenv('sessionid');
      delete from cir_gen_code where vsessionid=userenv('sessionid');
      commit;
    End routecode_P;
    PROCEDURE subroutecode_P (
           pcompcode in varchar2,
           punitcode in varchar2,
           prtcode in varchar2,
           pdateformat in varchar2,
           pextra1 in varchar2,
           pextra2 in varchar2,
           psubrt_code out p_circul_cursor) as
        vno number(8);
        vsubrt_code    varchar2(15);
    BEGIN
      Begin
           select max(substr(subrt_code,3,5))+1 into vno from cir_sub_route_mast where comp_code=pcompcode and unit=punitcode and route_code=prtcode;
              Exception When Others Then
                   vno:=null;
        End;
         If nvl(vno,0)=0 Then
          vsubrt_code:='SR'||'001';
         Else
        vsubrt_code:='SR'||lpad(vno,3,'0');
         End if;
         delete from cir_gen_code where vsessionid=userenv('sessionid');
      insert into cir_gen_code(var_code,vsessionid) values(vsubrt_code,userenv('sessionid'));
      commit;
      open psubrt_code for select var_code from cir_gen_code  where vsessionid=userenv('sessionid');
      delete from cir_gen_code where vsessionid=userenv('sessionid');
      commit;
    End;
    PROCEDURE subsubroutecode_P (
           pcompcode in varchar2,
           punitcode in varchar2,
           prtcode in varchar2,
           psubrtcode in varchar2,
           pdateformat in varchar2,
           pextra1 in varchar2,
           pextra2 in varchar2,
           psubsubrt_code out p_circul_cursor) as
        vno number(8);
        vsubsubrt_code varchar2(15);
    BEGIN
      Begin
           select max(substr(sub_subrt_code,3,5))+1 into vno from cir_sub_subroute_mast
                where comp_code=pcompcode and
                      unit=punitcode and
                      route_code=prtcode and
                      subrt_code=psubrtcode;
                      Exception When Others Then
                           vno:=null;
        End;
         If nvl(vno,0)=0 Then
          vsubsubrt_code:='SS'||'001';
         Else
        vsubsubrt_code:='SS'||lpad(vno,3,'0');
         End if;
         delete from cir_gen_code where vsessionid=userenv('sessionid');
      insert into cir_gen_code(var_code,vsessionid) values(vsubsubrt_code,userenv('sessionid'));
      commit;
      open psubsubrt_code for select var_code from cir_gen_code  where vsessionid=userenv('sessionid');
      delete from cir_gen_code where vsessionid=userenv('sessionid');
      commit;
    End;
    PROCEDURE transportercode_P (
            pcompcode in varchar2,
            pprefix in varchar2,
            pdateformat in varchar2,
            pextra1 in varchar2,
            pextra2 in varchar2,
            ptp_code out p_circul_cursor) as
        vno number(8);
        vtp_code varchar2(8);
        v_sess_id number(20);
    Begin
        select userenv('sessionid') into v_sess_id from dual;
        Begin
          select max(substr(transporter_code,2))+1 into vno from cir_transporter_mast
              where comp_code=pcompcode and upper(substr(transporter_code,1,1))=upper(pprefix);
      Exception when others then
             vno:=0;
      End;
      if nvl(vno,0)=0 then
           vtp_code:=upper(pprefix)||'0001';
      else
           vtp_code:=upper(pprefix)||lpad(vno,4,'0');
      end if;
      delete from cir_gen_code where vsessionid=v_sess_id;
      insert into cir_gen_code(var_code,vsessionid) values(vtp_code,v_sess_id);
      commit;
      open ptp_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
      delete from cir_gen_code where vsessionid=v_sess_id;
      commit;
    End;
    PROCEDURE districtcode_P (
            pcompcode in varchar2,
            pstatecode in varchar2,
            pprefix in varchar2,
            pdateformat in varchar2,
            pextra1 in varchar2,
            pextra2 in varchar2,
            pdist_code out p_circul_cursor) as
        vno number(8);
        vdist_code varchar2(8);
        v_sess_id number(20);
    Begin
        select userenv('sessionid') into v_sess_id from dual;
        Begin
          select max(substr(dist_code,3))+1 into vno from cir_dist_mast
              where comp_code=pcompcode and upper(substr(dist_code,1,2))=upper(pprefix);
      Exception when others then
             vno:=0;
      End;
      if nvl(vno,0)=0 then
           vdist_code:=upper(pprefix)||'0001';
      else
           vdist_code:=upper(pprefix)||lpad(vno,4,'0');
      end if;
      delete from cir_gen_code where vsessionid=v_sess_id;
      insert into cir_gen_code(var_code,vsessionid) values(vdist_code,v_sess_id);
      commit;
      open pdist_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
      delete from cir_gen_code where vsessionid=v_sess_id;
      commit;
    End;
    PROCEDURE comm_catg_p (
      pcompcode     in varchar2,
      pcomm_type     in varchar2,
      pdateformat in varchar2,
      pextra1         in varchar2,
      pextra2         in varchar2,
      ptype_code     out p_circul_cursor) as
      vno                 number(5);
        vtype_code     varchar2(15);
        v_sess_id     number(20);
        vcomm_type  varchar2(1);
    BEGIN
        select userenv('sessionid') into v_sess_id from dual;
        Begin
           select max(substr(comm_catg_code,3,5))+1 into vno from cir_comm_catg_mast where comp_code=pcompcode;
        Exception When Others Then
            vno:=null;
        End;
        If pcomm_type is null then
            vcomm_type:='C';
        Else
            vcomm_type:=pcomm_type;
        End if;
         If nvl(vno,0)=0 Then
          vtype_code:='C'||pcomm_type||'001';
         Else
        vtype_code:='C'||pcomm_type||lpad(vno,3,'0');
         End if;
         delete from cir_gen_code where vsessionid=v_sess_id;
      insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
      commit;
      open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
      delete from cir_gen_code where vsessionid=v_sess_id;
      commit;
    End comm_catg_p;
    PROCEDURE comm_p (
      pcompcode     in varchar2,
      pcomm_type     in varchar2,
      pdateformat in varchar2,
      pextra1         in varchar2,
      pextra2         in varchar2,
      ptype_code     out p_circul_cursor) as
      vno                 number(5);
        vtype_code     varchar2(15);
        v_sess_id     number(20);
        vcomm_type  varchar2(1);
    BEGIN
        select userenv('sessionid') into v_sess_id from dual;
        Begin
           select max(substr(comm_code,3,5))+1 into vno from cir_comm_mast where comp_code=pcompcode;
        Exception When Others Then
            vno:=null;
        End;
        If pcomm_type is null then
            vcomm_type:='F';
        Else
            vcomm_type:=pcomm_type;
        End if;
         If nvl(vno,0)=0 Then
          vtype_code:='C'||pcomm_type||'001';
         Else
        vtype_code:='C'||pcomm_type||lpad(vno,3,'0');
         End if;
         delete from cir_gen_code where vsessionid=v_sess_id;
      insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
      commit;
      open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
      delete from cir_gen_code where vsessionid=v_sess_id;
      commit;
    End comm_p;
    PROCEDURE zone_p (
    pcompcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
    ptype_code out p_circul_cursor) as
    vno number(5);
    vtype_code varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(zone_code,3,5))+1 into vno from cir_zone_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='ZN'||'001';
     Else
    vtype_code:='ZN'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End zone_p;
 PROCEDURE taluka_p (
    pcompcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
    ptype_code out p_circul_cursor)
    as
    vno number(5);
    vtype_code varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(talu_code,3,6))+1 into vno from cir_taluka_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='TK'||'0001';
     Else
    vtype_code:='TK'||lpad(vno,4,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End taluka_p;

PROCEDURE receipt_p (
    pcompcode   in varchar2,
    pbranchcode in varchar2,
    pdoctype    in varchar2,
    precptdt    in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(20);
    vrecptno  varchar2(15);
    v_sess_id   number(20);
    v_dt date;
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    v_dt:=to_date(precptdt,''''||pdateformat||'''');
    
    Begin
       if upper(pextra2)='D' then
        select max(to_number(substr(recptno,-8)))+1 into vno from cir_rcphdr_dis 
            where comp_code=pcompcode and doctype=pdoctype and to_char(recptdt,'yymm')=to_char(v_dt,'yymm') and branch_code=pbranchcode;
       else
        select max(to_number(substr(recptno,-8)))+1 into vno from cir_rcphdr 
            where comp_code=pcompcode and doctype=pdoctype and to_char(recptdt,'yymm')=to_char(v_dt,'yymm') and branch_code=pbranchcode;       
       end if;             
    Exception When Others Then
       vno:=null;
    End;
    
    If nvl(vno,0)=0 Then
      vrecptno:=pbranchcode||'-'||to_char(v_dt,'yymm')||'0001';
    Else
      vrecptno:=pbranchcode||'-'||lpad(vno,8,'0');
    End if;
    
    --delete from cir_gen_code where vsessionid=v_sess_id;
    --insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id); commit;
    
    open ptype_code for select vrecptno as "VAR_CODE" from dual;--select var_code from cir_gen_code  where vsessionid=v_sess_id;
    
    --delete from cir_gen_code where vsessionid=v_sess_id;commit;
End receipt_p;

PROCEDURE mode_p (
    pcompcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
    ptype_code out p_circul_cursor)
    as
    vno number(5);
    vtype_code varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(mode_code,3,3))+1 into vno from cir_route_mode_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='RM'||'001';
     Else
    vtype_code:='RM'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End mode_p;

PROCEDURE supply_type_p (
    pcompcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
    ptype_code out p_circul_cursor)
    as
    vno number(5);
      vtype_code varchar2(15);
      v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(sup_ty_code,2,2))+1 into vno from cir_supply_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='S'||'01';
     Else
    vtype_code:='S'||lpad(vno,2,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End supply_type_p;

PROCEDURE expenses_type_p (
    pcompcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
    ptype_code out p_circul_cursor)
    as
    vno number(5);
      vtype_code varchar2(15);
      v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(exp_type_code,2,3))+1 into vno from cir_expenses_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='E'||'001';
     Else
    vtype_code:='E'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End expenses_type_p;

PROCEDURE city_p (
    pcompcode in varchar2,
    pdateformat in varchar2,
    pextra1 in varchar2,
    pextra2 in varchar2,
    ptype_code out p_circul_cursor)
    as
    vno number(5);
    vtype_code varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(city_code,3,6))+1 into vno from cir_city_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='CT'||'0001';
     Else
    vtype_code:='CT'||lpad(vno,4,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open ptype_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End city_p;

PROCEDURE cir_region_p (
    pcompcode     in varchar2,
    pdateformat in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    preg_code     out p_circul_cursor)
    as
  vno             number(5);
    vreg_code varchar2(15);
    v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
       select max(substr(reg_code,3,6))+1 into vno from cir_region_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vreg_code:='RG'||'0001';
     Else
    vreg_code:='RG'||lpad(vno,4,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vreg_code,v_sess_id);
  commit;
  open preg_code for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End cir_region_p;
    PROCEDURE cir_unsold_receipt_p (
        pcompcode         in varchar2,
        pdateformat     in varchar2,
        pextra1             in varchar2,
        pextra2             in varchar2,
        preceipt_no     out p_circul_cursor)
    As
    vno number(5);
        vtype_code varchar2(15);
        v_sess_id number(20);
BEGIN
    select userenv('sessionid') into v_sess_id from dual;
    Begin
        if upper(pextra2)='D' then
            select max(substr(RECPTNO,3,8))+1 into vno from cir_unsold_hdr_dis where comp_code=pcompcode;
        else
            select max(substr(RECPTNO,3,8))+1 into vno from cir_unsold_hdr where comp_code=pcompcode;
        end if;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='UN'||'000001';
     Else
    vtype_code:='UN'||lpad(vno,6,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vtype_code,v_sess_id);
  commit;
  open preceipt_no for
  select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End cir_unsold_receipt_p;

PROCEDURE cir_surcharge_p (
        pcompcode         in varchar2,
        pdateformat     in varchar2,
        pextra1             in varchar2,
        pextra2             in varchar2,
        psurch_cd         out p_circul_cursor)
    as
     vno             number(5);
       vsurch_cd varchar2(15);
       v_sess_id number(20);
BEGIN
       select userenv('sessionid') into v_sess_id from dual;
        Begin
           select max(substr(surch_cd,2,3))+1 into vno from cir_surcharge_mast where comp_code=pcompcode;
              Exception When Others Then
                   vno:=null;
        End;
     If nvl(vno,0)=0 Then
      vsurch_cd:='S'||'001';
     Else
    vsurch_cd:='S'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vsurch_cd,v_sess_id);
  commit;
  open psurch_cd for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End cir_surcharge_p;

PROCEDURE cir_roleMatser_p (
        pcompcode         in varchar2,
        pdateformat     in varchar2,
        pextra1             in varchar2,
        pextra2             in varchar2,
        psurch_cd         out p_circul_cursor)
    as
     vno             number(5);
       vsurch_cd varchar2(15);
       v_sess_id number(20);
BEGIN
       select userenv('sessionid') into v_sess_id from dual;
        Begin
           select max(substr(role_code,2,3))+1 into vno from cir_role_mast where comp_code=pcompcode;
              Exception When Others Then
                   vno:=null;
        End;
     If nvl(vno,0)=0 Then
      vsurch_cd:='R'||'001';
     Else
    vsurch_cd:='R'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vsurch_cd,v_sess_id);
  commit;
  open psurch_cd for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End cir_roleMatser_p;

PROCEDURE cir_narr_p (
        pcompcode         in varchar2,
        pdateformat     in varchar2,
        pextra1             in varchar2,
        pextra2             in varchar2,
        pnarr_cd         out p_circul_cursor)
    as
     vno             number(5);
       vsurch_cd varchar2(15);
       v_sess_id number(20);
BEGIN
       select userenv('sessionid') into v_sess_id from dual;
        Begin
           select max(substr(na_code,3,4))+1 into vno from fa_vch_narration_mast where comp_code=pcompcode;
              Exception When Others Then
                   vno:=null;
        End;
     If nvl(vno,0)=0 Then
      vsurch_cd:='N'||'001';
     Else
    vsurch_cd:='N'||lpad(vno,3,'0');
     End if;
     delete from cir_gen_code where vsessionid=v_sess_id;
  insert into cir_gen_code(var_code,vsessionid) values(vsurch_cd,v_sess_id);
  commit;
  open pnarr_cd for select var_code from cir_gen_code  where vsessionid=v_sess_id;
  delete from cir_gen_code where vsessionid=v_sess_id;
  commit;
End cir_narr_p;
Procedure cir_taxi_code_p (
pcompcode in varchar2,
pdateformat in varchar2,
pextra1 in varchar2,
pextra2 in varchar2,
ptaxi_code out p_circul_cursor) as

vno number(8);
v_code varchar2(15);
v_sess_id number(20);
Begin
select userenv('sessionid') into v_sess_id from dual;
Begin
select max(substr(taxi_id,2,4))+1 into vno from cir_taxi_mast where comp_code=pcompcode;
Exception When Others Then
vno:=null;
End;

If nvl(vno,0)=0 Then
v_code:='V'||'0001';
Else
v_code:='V'||lpad(vno,4,'0');
End if;
delete from cir_gen_code where vsessionid=v_sess_id;
insert into cir_gen_code(var_code,vsessionid) values(v_code,v_sess_id);
commit;
open ptaxi_code for select var_code from cir_gen_code where vsessionid=v_sess_id;
delete from cir_gen_code where vsessionid=v_sess_id;
commit;
End cir_taxi_code_p;

PROCEDURE cir_lable_htmlformatid_p (
        pcompcode   in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,
        pformat_id  out p_circul_cursor)
As
vno number(8);
v_code varchar2(15);
v_sess_id number(20);
Begin
    Begin
        select max(formatid)+1 into vno from cir_lable_htmlformat;
    Exception When Others Then
        vno:=null;
    End;

    If nvl(vno,0)=0 Then
        v_code:=1;
    Else
        v_code:=vno;
    End if;
    insert into cir_lable_htmlformat(comp_code,formatid,format_desc) values(pcompcode,v_code,pextra1);commit;
    open pformat_id for select v_code as "FORMAT_ID" from dual;
End cir_lable_htmlformatid_p;

    PROCEDURE cir_installment_code_p (
        pcompcode   in varchar2,
        punitcode   in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,
        pcode       out p_circul_cursor) as
    vno         number(10);
    v_code      varchar2(15);
    Begin

    Begin
        select max(substr(inst_code,2,7))+1 into vno from cir_installment_mast where comp_code=pcompcode;
        Exception When Others Then
            vno:=null;
    End;

    If nvl(vno,0)=0 Then
        v_code:='I'||'0000001';
    Else
        v_code:='I'||lpad(vno,7,'0');
    End if;
    
    open pcode for select v_code as "VAR_CODE" from dual;

    End cir_installment_code_p;        
END Cir_Genrate_Code;
/

/***************5268 prachi 11-oct***********************/



/////////////////////////////issue no.5258 12/10/2011==================================


////////////////////////////body====================================

CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_rep_abc IS
   procedure cir_commwise_supply_unsold(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pagtype             in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,--for Edition 
     pextra2            in varchar2,--for Sub Edition
     p_accounts         out t_accounts)
    As
     vfrom_supdate    date;
     vtill_supdate    date;
    Begin
        vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
        vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
     
        open p_accounts for 
        select mon_date mon_dt,to_char(mon_date,'Mon/YYYY') mon_date,comm_rate,sum(billed_copy) billed_copy,sum(unsold_copy) unsold_copy,sum(billed_copy-unsold_copy) net_copy,sum(billed_amt-unsold_amt) net_amount
        from (select last_day(b.billdt) mon_date,b.comm_rate,sum(b.bill_copy) billed_copy,sum(nvl(gross_amount,0)+nvl(sur_amt,0)-nvl(comm_amt,0)) billed_amt,0 unsold_copy,0 unsold_amt 
        from cir_agmast a, cir_bill_det b,cir_edtn_mast e
        where a.comp_code=b.comp_code and a.comp_code=e.comp_code and b.comp_code=pcomp_code and a.unit=b.unit_code and a.unit=e.unit_code and b.unit_code=punit_code and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl(pbrancode,a.branch_code) and a.ag_type=nvl(pagtype,a.ag_type) and b.publ=nvl(ppublcode,b.publ) and
        b.publ=e.publ and b.edtn=e.edtn and b.edtn=nvl(pextra2,b.edtn) and b.billdt between vfrom_supdate and vtill_supdate and e.main_edtn=nvl(pextra1,e.main_edtn)
        group by b.billdt,b.comm_rate
        union
        select last_day(b.app_dt) mon_date,b.comm_rate comm_rate,0 billed_copy,0 billed_amt,sum(nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0)) unsold_copy,
        sum(nvl(copy_amt,0)-nvl(comm_amt,0)-nvl(waste_amt,0)) unsold_amt 
        from cir_agmast a, cir_unsold_dtl b,cir_edtn_mast e
        where a.comp_code=b.comp_code and a.comp_code=e.comp_code and b.comp_code=pcomp_code and a.unit=b.unit_code and a.unit=e.unit_code and b.unit_code=punit_code and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl(pbrancode,a.branch_code) and a.ag_type=nvl(pagtype,a.ag_type) and b.publ=nvl(ppublcode,b.publ) and
        b.publ=e.publ and b.edtn=e.edtn and b.edtn=nvl(pextra2,b.edtn) and b.app_dt between vfrom_supdate and vtill_supdate and e.main_edtn=nvl(pextra1,e.main_edtn)
        group by b.app_dt,b.comm_rate)
        group by mon_date,comm_rate
        order by mon_dt,comm_rate;
     
    End cir_commwise_supply_unsold;
    
    procedure cir_rate_comm_supply_unsold(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pagtype             in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     preptype           in varchar2,--for comm & rate wise supply & unsold--
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts)
    As
     vfrdt    date;
     vtodt    date;
     v_dt     date;
     v_cnt    number(5):=0;
     vvar     varchar2(2000);
     vvar_sum  varchar2(2000);
     vvar_sum1 varchar2(2000);
     v_query   varchar2(30000);
     v_query1  varchar2(30000);
       cursor c1 is
           select dt from cir_temp_dt order by sqno,dt;
   Begin
        vfrdt:=trunc(to_date(pfrom_supdate,''''||pdateformat||''''),'mm');
        vtodt:=last_day(to_date(ptill_supdate,''''||pdateformat||''''));   
   --delete from test1;commit;
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=last_day(vfrdt);
            else
                v_dt:=add_months(v_dt,1);
            end if;
        end if;
        v_cnt:=v_cnt+1;
        
        insert into cir_temp_dt(sqno,dt) values(v_cnt,v_dt);
    end loop;

    open c1;
    loop
        fetch c1 into v_dt;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if preptype in('CS','RS') then--comm. wise & Rate wise supply--
            if vvar is null then
                vvar        :='sum(decode(last_day(b.billdt),'||''''||v_dt||''''||',b.bill_copy,0))"'||to_char(v_dt,'Mon/YYYY')||'"';
                vvar_sum    :='sum('||'"'||to_char(v_dt,'Mon/YYYY')||'") "'||to_char(v_dt,'Mon/YYYY')||'"';
                vvar_sum1   :='sum('||'"'||to_char(v_dt,'Mon/YYYY')||'"';
            else
                vvar        :=vvar||','||'sum(decode(last_day(b.billdt),'||''''||v_dt||''''||',b.bill_copy,0))"'||to_char(v_dt,'Mon/YYYY')||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||to_char(v_dt,'Mon/YYYY')||'") "'||to_char(v_dt,'Mon/YYYY')||'"';
                vvar_sum1   :=vvar_sum1||'+"'||to_char(v_dt,'Mon/YYYY')||'"';
            end if;
         elsif preptype in('CU','RU') then--comm. wise & Rate wise unsold--
            if vvar is null then
                vvar        :='sum(decode(last_day(b.app_dt),'||''''||v_dt||''''||',(nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0)),0))"'||to_char(v_dt,'Mon/YYYY')||'"';
                vvar_sum    :='sum('||'"'||to_char(v_dt,'Mon/YYYY')||'") "'||to_char(v_dt,'Mon/YYYY')||'"';
                vvar_sum1   :='sum('||'"'||to_char(v_dt,'Mon/YYYY')||'"';
            else
                vvar        :=vvar||','||'sum(decode(last_day(b.app_dt),'||''''||v_dt||''''||',(nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0)),0))"'||to_char(v_dt,'Mon/YYYY')||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||to_char(v_dt,'Mon/YYYY')||'") "'||to_char(v_dt,'Mon/YYYY')||'"';
                vvar_sum1   :=vvar_sum1||'+"'||to_char(v_dt,'Mon/YYYY')||'"';
            end if;
         end if;
    end loop;
    close c1;
    if vvar_sum1 is not null then
        vvar_sum1:=vvar_sum1||') "Total"';
    end if;

    if preptype='CS' then--comm. wise supply-- 
        v_query:='select comp_code,unit_code,comm_rate ,'||vvar_sum||','||vvar_sum1||' from (select b.comp_code comp_code,b.unit_code unit_code,nvl(b.comm_rate,0) comm_rate, '||vvar||' from cir_agmast a, cir_bill_det b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.billdt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.billdt,b.comm_rate)
        group by comp_code,unit_code,comm_rate order by comp_code,unit_code,comm_rate';
        
        v_query1:='select comp_code,unit_code,'||vvar_sum||','||vvar_sum1||' from (select b.comp_code comp_code,b.unit_code unit_code,nvl(b.comm_rate,0) comm_rate, '||vvar||' from cir_agmast a, cir_bill_det b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.billdt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.billdt,b.comm_rate)
        group by comp_code,unit_code order by comp_code,unit_code';        
    elsif preptype='RS' then-- Edition Rate wise supply-- 
        v_query:='select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,cir_get_publ_seqno(comp_code,publ) publ_seqno,edtn,cir_get_edtn_name(comp_code,edtn) edtn_name,cir_get_edtn_seqno(comp_code,edtn) edtn_seqno,copy_rate ,'||vvar_sum||','||vvar_sum1||' 
        from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,nvl(b.copy_rate,0) copy_rate, '||vvar||' from cir_agmast a, cir_bill_det b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.billdt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.billdt,b.publ,b.edtn,b.copy_rate)
        group by comp_code,unit_code,publ,edtn,copy_rate order by comp_code,unit_code,publ_seqno,publ,edtn_seqno,edtn,copy_rate';
        
        v_query1:='select comp_code,unit_code,'||vvar_sum||','||vvar_sum1||' 
        from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,nvl(b.copy_rate,0) copy_rate, '||vvar||' from cir_agmast a, cir_bill_det b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.billdt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.billdt,b.publ,b.edtn,b.copy_rate)
        group by comp_code,unit_code order by comp_code,unit_code';
    elsif preptype='CU' then--comm. wise unsold-- 
        v_query:='select comp_code,unit_code,comm_rate ,'||vvar_sum||','||vvar_sum1||' from (select b.comp_code comp_code,b.unit_code unit_code,nvl(b.comm_rate,0) comm_rate, '||vvar||' from cir_agmast a, cir_unsold_dtl b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.app_dt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.app_dt,b.comm_rate)
        group by comp_code,unit_code,comm_rate order by comp_code,unit_code,comm_rate'; 
        
        v_query1:='select comp_code,unit_code,'||vvar_sum||','||vvar_sum1||' from (select b.comp_code comp_code,b.unit_code unit_code,nvl(b.comm_rate,0) comm_rate, '||vvar||' from cir_agmast a, cir_unsold_dtl b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.app_dt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.app_dt,b.comm_rate)
        group by comp_code,unit_code order by comp_code,unit_code';        
    elsif preptype='RU' then-- Edition Rate wise Unsold-- 
        v_query:='select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,cir_get_publ_seqno(comp_code,publ) publ_seqno,edtn,cir_get_edtn_name(comp_code,edtn) edtn_name,cir_get_edtn_seqno(comp_code,edtn) edtn_seqno,copy_rate ,'||vvar_sum||','||vvar_sum1||' 
        from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,nvl(b.copy_rate,0) copy_rate, '||vvar||' from cir_agmast a, cir_unsold_dtl b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.app_dt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.app_dt,b.publ,b.edtn,b.copy_rate)
        group by comp_code,unit_code,publ,edtn,copy_rate order by comp_code,unit_code,publ_seqno,publ,edtn_seqno,edtn,copy_rate';
        
        v_query1:='select comp_code,unit_code,'||vvar_sum||','||vvar_sum1||' 
        from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,nvl(b.copy_rate,0) copy_rate, '||vvar||' from cir_agmast a, cir_unsold_dtl b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.app_dt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.app_dt,b.publ,b.edtn,b.copy_rate)
        group by comp_code,unit_code order by comp_code,unit_code';
    end if;   
    
    --insert into test1(vstring,vstring2) values('cir_rate_comm_supply_unsold ',v_query);commit;
   --insert into test1(vstring,vstring2) values('cir_rate_comm_supply_unsold v_query1',v_query1);commit;
    
    open p_accounts for v_query;
    
    open p_accounts1 for v_query1;
        
    End cir_rate_comm_supply_unsold;
        
    procedure cir_citywise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pagtype             in varchar2,
     pstatecode         in varchar2,
     pcitycode          in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts)
    As
     vfrdt    date;
     vtodt    date;
     v_dt     date;
     v_cnt    number(5):=0;
     vvar     varchar2(2000);
     vvar_sum     varchar2(2000);
     vvar_sum1    varchar2(2000);
     v_query    varchar2(30000);
       cursor c1 is
           select dt from cir_temp_dt order by sqno,dt;
   Begin
        vfrdt:=trunc(to_date(pfrom_supdate,''''||pdateformat||''''),'mm');
        vtodt:=last_day(to_date(ptill_supdate,''''||pdateformat||''''));
        delete from cir_temp_dt;
        --delete from test1;
        loop
            if v_dt>=vtodt then
                exit;
            else
                if v_dt is null then
                    v_dt:=last_day(vfrdt);
                else
                    v_dt:=add_months(v_dt,1);
                end if;
            end if;
            v_cnt:=v_cnt+1;
            
            insert into cir_temp_dt(sqno,dt) values(v_cnt,v_dt);
        end loop;

        open c1;
        loop
            fetch c1 into v_dt;
            exit when c1%notfound;
            v_cnt        := v_cnt+1;
                if vvar is null then
                    vvar        :='sum(decode(last_day(b.billdt),'||''''||v_dt||''''||',b.bill_copy,0))"'||to_char(v_dt,'Mon/YYYY')||'"';
                    vvar_sum    :='sum('||'"'||to_char(v_dt,'Mon/YYYY')||'") "'||to_char(v_dt,'Mon/YYYY')||'"';
                    vvar_sum1   :='sum('||'"'||to_char(v_dt,'Mon/YYYY')||'"';
                else
                    vvar        :=vvar||','||'sum(decode(last_day(b.billdt),'||''''||v_dt||''''||',b.bill_copy,0))"'||to_char(v_dt,'Mon/YYYY')||'"';
                    vvar_sum    :=vvar_sum||','||'sum('||'"'||to_char(v_dt,'Mon/YYYY')||'") "'||to_char(v_dt,'Mon/YYYY')||'"';
                    vvar_sum1   :=vvar_sum1||'+"'||to_char(v_dt,'Mon/YYYY')||'"';
                end if;
        end loop;
        close c1;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') "Total"';
        end if;
                
        v_query:='select d.comp_code comp_code,d.unit_code unit_code,s."State_Name" state_name,cir_get_city(d.comp_code,d.city_code) city_name,'||vvar_sum||','||vvar_sum1||' from (select b.comp_code comp_code,b.unit_code unit_code,a.state_code state_code,
        a.city_code city_code,'||vvar||' from cir_agmast a, cir_bill_det b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and 
        b.publ=nvl('||''''||ppublcode||''''||',b.publ) and a.state_code=nvl('||''''||pstatecode||''''||',a.state_code) and a.city_code=nvl('||''''||pcitycode||''''||',a.city_code) and
        b.billdt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.billdt,a.city_code,a.state_code) d,state_mst s
        where d.state_code=s."State_Code"(+)
        group by d.comp_code,d.unit_code,s."State_Name",d.city_code order by comp_code,unit_code,state_name,city_name';
        --insert into test1(vstring,vstring2) values('cir_citywise_supply ',v_query);commit;
        open p_accounts for v_query;
        
        v_query:='select d.comp_code comp_code,d.unit_code unit_code,s."State_Name" state_name,'||vvar_sum||','||vvar_sum1||' from (select b.comp_code comp_code,b.unit_code unit_code,a.state_code state_code,
        a.city_code city_code,'||vvar||' from cir_agmast a, cir_bill_det b
        where a.comp_code=b.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and 
        b.publ=nvl('||''''||ppublcode||''''||',b.publ) and a.state_code=nvl('||''''||pstatecode||''''||',a.state_code) and a.city_code=nvl('||''''||pcitycode||''''||',a.city_code) and
        b.billdt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' group by b.comp_code,b.unit_code,b.billdt,a.city_code,a.state_code) d,state_mst s
        where d.state_code=s."State_Code"(+)
        group by d.comp_code,d.unit_code,s."State_Name" order by comp_code,unit_code,state_name';
        --insert into test1(vstring,vstring2) values('cir_citywise_supply ',v_query);commit;
        open p_accounts1 for v_query;        
        
   End cir_citywise_supply;
    
    procedure cir_agencywise_supply(
        pcomp_code      in varchar2,
        punit_code      in varchar2,
        pbrancode       in varchar2,
        ppublcode       in varchar2,
        pmedtncode      in varchar2,
        pedtncode       in varchar2,
        pagcd           in varchar2,
        pdpcd           in varchar2,
        pagtype         in varchar2,
        pstatecode      in varchar2,
        pcitycode       in varchar2,
        pfrom_supdate   in varchar2,
        ptill_supdate   in varchar2,
        psortedby       in varchar2,
        pdateformat     in varchar2,
        pextra1         in varchar2,--for supply -->S,Unsold -->U
        pextra2         in varchar2,
        pextra3         in varchar2,
        pextra4         in varchar2,
        pextra5         in varchar2,
        p_accounts      out t_accounts)
    As
     vfrdt    date;
     vtodt    date;
     v_dt     date;
     v_cnt    number(5):=0;
     vvar     varchar2(2000);
     vvar_sum     varchar2(2000);
     vvar_sum1    varchar2(2000);
     v_query    varchar2(30000);
       cursor c1 is
           select dt from cir_temp_dt order by sqno,dt;
   Begin
        vfrdt:=trunc(to_date(pfrom_supdate,''''||pdateformat||''''),'mm');
        vtodt:=last_day(to_date(ptill_supdate,''''||pdateformat||''''));   
    delete from cir_temp_dt;
    --delete from test1;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=last_day(vfrdt);
            else
                v_dt:=add_months(v_dt,1);
            end if;
        end if;
        v_cnt:=v_cnt+1;
        
        insert into cir_temp_dt(sqno,dt) values(v_cnt,v_dt);
    end loop;

    open c1;
    loop
        fetch c1 into v_dt;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
            if vvar is null then
                if upper(pextra1)='U' then
                    vvar        :='sum(decode(last_day(b.app_dt),'||''''||v_dt||''''||',nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0),0))"'||to_char(v_dt,'Mon/YY')||'"';
                else
                    vvar        :='sum(decode(last_day(b.billdt),'||''''||v_dt||''''||',b.bill_copy,0))"'||to_char(v_dt,'Mon/YY')||'"';
                end if;    
                vvar_sum    :='sum('||'"'||to_char(v_dt,'Mon/YY')||'") "'||to_char(v_dt,'Mon/YY')||'"';
                vvar_sum1   :='sum('||'"'||to_char(v_dt,'Mon/YY')||'"';
            else
                if upper(pextra1)='U' then
                    vvar        :=vvar||','||'sum(decode(last_day(b.app_dt),'||''''||v_dt||''''||',nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0),0))"'||to_char(v_dt,'Mon/YY')||'"';
                else
                    vvar        :=vvar||','||'sum(decode(last_day(b.billdt),'||''''||v_dt||''''||',b.bill_copy,0))"'||to_char(v_dt,'Mon/YY')||'"';
                end if;    
                vvar_sum    :=vvar_sum||','||'sum('||'"'||to_char(v_dt,'Mon/YY')||'") "'||to_char(v_dt,'Mon/YY')||'"';
                vvar_sum1   :=vvar_sum1||'+"'||to_char(v_dt,'Mon/YY')||'"';
            end if;
    end loop;
    close c1;
    if vvar_sum1 is not null then
        vvar_sum1:=vvar_sum1||') "Total"';
    end if;
    if upper(pextra1)='U' then
        v_query:='select comp_code,unit_code,comm_rate ,ag_name,cir_get_city(comp_code,city_code) city_name,'||vvar_sum||','||vvar_sum1||' from (select b.comp_code comp_code,b.unit_code unit_code,nvl(b.comm_catg_type,''P'')||''-''||nvl(b.comm_rate,0) comm_rate,a.agcd agcd,b.dpcd dpcd,
        a.ag_name ag_name,a.city_code city_code,'||vvar||' from cir_agmast a, cir_unsold_dtl b,cir_edtn_mast e
        where a.comp_code=b.comp_code and a.comp_code=e.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and a.unit=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.agcd=nvl('||''''||pagcd||''''||',a.agcd) and a.dpcd=nvl('||''''||pdpcd||''''||',a.dpcd) and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=e.publ and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.app_dt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' and b.edtn=e.edtn and b.edtn=nvl('||''''||pedtncode||''''||',b.edtn) and e.main_edtn=nvl('||''''||pmedtncode||''''||',e.main_edtn) and a.state_code=nvl('||''''||pstatecode||''''||',a.state_code) and a.city_code=nvl('||''''||pcitycode||''''||',a.city_code) group by b.comp_code,b.unit_code,b.app_dt,b.comm_catg_type,b.comm_rate,a.city_code,a.agcd,b.dpcd,a.ag_name)
        group by comp_code,unit_code,comm_rate,city_code,ag_name order by comp_code,unit_code,comm_rate,ag_name';
    else
        v_query:='select comp_code,unit_code,comm_rate ,ag_name,cir_get_city(comp_code,city_code) city_name,'||vvar_sum||','||vvar_sum1||' from (select b.comp_code comp_code,b.unit_code unit_code,nvl(b.COMM_TYPE,''P'')||''-''||nvl(b.comm_rate,0) comm_rate,a.agcd agcd,b.dpcd dpcd,
        a.ag_name ag_name,a.city_code city_code,'||vvar||' from cir_agmast a, cir_bill_det b,cir_edtn_mast e
        where a.comp_code=b.comp_code and a.comp_code=e.comp_code and b.comp_code='||''''||pcomp_code||''''||' and a.unit=b.unit_code and a.unit=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.agcd=nvl('||''''||pagcd||''''||',a.agcd) and a.dpcd=nvl('||''''||pdpcd||''''||',a.dpcd) and a.branch_code=nvl('||''''||pbrancode||''''||',a.branch_code) and a.ag_type=nvl('||''''||pagtype||''''||',a.ag_type) and b.publ=e.publ and b.publ=nvl('||''''||ppublcode||''''||',b.publ) and
        b.billdt between '||''''||vfrdt||''''||' and '||''''||vtodt||''''||' and b.edtn=e.edtn and b.edtn=nvl('||''''||pedtncode||''''||',b.edtn) and e.main_edtn=nvl('||''''||pmedtncode||''''||',e.main_edtn) and a.state_code=nvl('||''''||pstatecode||''''||',a.state_code) and a.city_code=nvl('||''''||pcitycode||''''||',a.city_code) group by b.comp_code,b.unit_code,b.billdt,b.comm_type,b.comm_rate,a.city_code,a.agcd,b.dpcd,a.ag_name)
        group by comp_code,unit_code,comm_rate,city_code,ag_name order by comp_code,unit_code,comm_rate,ag_name';
    end if;
--    insert into test1(vstring,vstring2) values('cir_agencywise_supply ',v_query);commit;
    delete from searchtbl;
    insert into searchtbl values( v_query);commit;
    open p_accounts for v_query;
        
    End cir_agencywise_supply;  
    
    procedure cir_monthwise_billing_summary(
        pcomp_code         in varchar2,
        punit_code         in varchar2,
        pbrancode       in varchar2,
        ppublcode       in varchar2,
        pagtype         in varchar2,
        pstatecode      in varchar2,
        pcitycode       in varchar2,
        pfromdate       in varchar2,
        ptilldate       in varchar2,
        pdateformat     in varchar2,
        pextra1         in varchar2,
        pextra2         in varchar2,
        p_accounts      out t_accounts)
    As
     vfrdt    date;
     vtodt    date;
   Begin
        vfrdt:=trunc(to_date(pfromdate,''''||pdateformat||''''),'mm');
        vtodt:=last_day(to_date(ptilldate,''''||pdateformat||''''));
        
        open p_accounts for 
        select b.comp_code comp_code,b.unit_code unit_code,last_day(b.billdt) billdt,to_char(last_day(b.billdt),'Mon/YYYY') month_date,sum(b.bill_copy) billing_copy,sum(b.gross_amount) gross_amount,
       sum(b.sur_amt) sur_amount, sum(b.comm_amt) comm_amount,sum(b.bill_amount) bill_amount 
        from cir_agmast a,cir_bill_det b 
        where a.comp_code=b.comp_code and b.comp_code=pcomp_code and a.unit=b.unit_code and b.unit_code=punit_code and 
        a.agcd=b.agcd and a.dpcd=b.dpcd and a.branch_code=nvl(pbrancode,a.branch_code) and a.ag_type=nvl(pagtype,a.ag_type) and 
        b.publ=nvl(ppublcode,b.publ) and b.billdt between vfrdt and vtodt
        group by b.comp_code,b.unit_code,last_day(b.billdt)
        order by b.comp_code,b.unit_code,last_day(b.billdt);
        
        
    End cir_monthwise_billing_summary;
    
  procedure cir_billing_outstanding(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbrancode          in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pagtype             in varchar2,
     pstatecode         in varchar2,
     pcitycode          in varchar2,
     pason_date         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts)
    As
        v_ason        date;
        v_opdate      date;
        v_opbal       number(15,2):=0;
        v_clbal       number(15,2):=0;
        v_billamt     number:=0;
        v_dbcramt     number:=0;
        v_diff        number:=0;
        cursor c1 is 
            select distinct comp_code,unit,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,dist_code,state_code,
            country_code from cir_agmast 
                where comp_code=pcomp_code and unit=punit_code and 
                      (ag_type=pagtype or pagtype is null) and agcd||dpcd in(select distinct agcd||dpcd from cir_outmast 
                      where comp_code=pcomp_code and (unit_code=punit_code or punit_code is null) and 
                      achd='NM' /*and (agcd=pagcd or pagcd is null) and (dpcd=pdpcd or pdpcd is null)*/);
        v1 c1%rowtype;
    Begin
        v_ason:=to_date(pason_date,''''||pdateformat||'''');

        v_opdate    :=cir_get_finandt(pcomp_code,v_ason,pdateformat,'','');--for financial date
        
        delete from cir_temp_outstanding;
        --delete from test1;commit;
        --insert into test1(vstring,vstring2) values('unit outstanding monthwise vvar ',v_months);commit;    
        open c1;
        loop
            fetch c1 into v1;
            exit when c1%notfound;
            v_opbal        :=cir_accounts.cir_agency_opbal(pcomp_code,punit_code,'',v1.agcd,v1.dpcd,v_opdate,'NM',pdateformat,pextra1,pextra2);

            select sum(amount) into v_billamt from cir_outmast
                where comp_code=pcomp_code and (unit_code=punit_code or punit_code is null) and 
                            agcd=v1.agcd and dpcd=v1.dpcd and billdt >= v_opdate and billdt<=v_ason and 
                            achd='NM' and recptno is null;            
            select sum(amount) into v_dbcramt from cir_rcphdr
                where comp_code=pcomp_code and (unit_code=punit_code or punit_code is null) and 
                            agcd=v1.agcd and dpcd=v1.dpcd and recptdt>= v_opdate and recptdt<=v_ason and 
                            achd='NM';
            
            v_clbal:=nvl(v_opbal,0)+nvl(v_billamt,0)+nvl(v_dbcramt,0);
            v_billamt:=0;v_dbcramt:=0;
            select sum(bill_amount) into v_dbcramt from cir_bill ----previous bill amount
                where comp_code=pcomp_code and unit_code=punit_code and 
                    billdt between trunc(add_months(v_ason,-1)) and last_day(add_months(v_ason,-1)) and 
                    agcd=v1.agcd and dpcd=v1.dpcd;


            select sum(bill_amount) into v_billamt from cir_bill--------current bill amount 
                where comp_code=pcomp_code and unit_code=punit_code and 
                    billdt=last_day(v_ason) and agcd=v1.agcd  and dpcd=v1.dpcd;
                                
            if v_clbal<>0 or nvl(v_billamt,0)<>0 or nvl(v_dbcramt,0)<>0 then
                
                v_diff:=(nvl(v_clbal,0)-nvl(v_billamt,0)-nvl(v_dbcramt,0));
                
                if v_diff<=0 then
                    v_diff:=0;
                else            
                    v_diff:=v_diff;
                end if;    

                insert into cir_temp_outstanding(comp_code,unit_code,dt,publ_code,agcd,dpcd,op_amt,bill_amt,dn_amt,cn_amt,
                            agname,agname_oth_lang,city_code,taluka_code,dist_code,state_code,country_code)
                            values(v1.comp_code,v1.unit,v_ason,'',v1.agcd,v1.dpcd,v_clbal,v_billamt,v_dbcramt,v_diff,
                            v1.ag_name,v1.ag_name_oth_lang,v1.city_code,v1.tehsil_taluka,v1.dist_code,v1.state_code,v1.country_code);
            end if;
            v_billamt:=0;v_dbcramt:=0;v_opbal    :=0;v_clbal:=0;v_diff:=0;
        end loop;
        close c1;
        
        open p_accounts for
        select comp_code,unit_code,dt,publ_code,agcd,dpcd,agname,agname_oth_lang,
        op_amt as outstanding_amt,bill_amt as curr_billamt,dn_amt as prev_billamt,cn_amt as diff_amt,
        city_code,cir_get_city(comp_code,city_code) city_name,taluka_code,cir_get_taluka(comp_code,taluka_code) taluka_name,
        dist_code,cir_get_dist(comp_code,state_code,dist_code) dist_name, state_code,country_code 
        from cir_temp_outstanding
        where comp_code=pcomp_code and unit_code=punit_code
        order by comp_code,unit_code,city_name,agname;
        
   End cir_billing_outstanding;
   
    procedure cir_area_break_down(
        pcomp_code         in varchar2,
        punit_code         in varchar2,
        pbrancode          in varchar2,
        ppublcode          in varchar2,
        pmedtncode         in varchar2,
        pedtncode          in varchar2,
        pagtype            in varchar2,
        pzonecode          in varchar2,
        pregioncode        in varchar2,
        pstatecode         in varchar2,
        pdistcode          in varchar2,
        pfromdate          in varchar2,
        ptilldate          in varchar2,
        psup_copy          in number,
        psup_baseon        in varchar2,--it is used for Gross(G)/Average(A)
        pdateformat        in varchar2,
        puserid            in varchar2,
        pbreakon           in number,--it is used for Grouping on Zone(1)/Region(2)/State(3)/Branch(4)/District(5)/Taluka(6)
        pdatashow          in number,--it is used for data show Agency(1)/City(2)
        pextra1            in varchar2,
        pextra2            in varchar2,
        pextra3            in varchar2,
        pextra4            in varchar2,
        pextra5            in varchar2,
        p_accounts         out t_accounts,
        p_accounts1        out t_accounts)
  As
    v_frdt date;
    v_todt date;
    cursor cur_supply is 
    select a.comp_code comp_code,a.unit unit,a.agcd agcd,a.dpcd dpcd,a.ag_name agency_name,
    d.zone_code zone_code,cir_get_zone_name(a.comp_code,d.zone_code) zone_name,
    d.region_code region,cir_get_region_name(a.comp_code,d.region_code) region_name,
    a.state_code state_code,cir_get_state(a.comp_code,a.country_code,a.state_code) state_name,
    a.dist_code dist_code,cir_get_dist(a.comp_code,a.state_code,a.dist_code) dist_name, 
    nvl(a.abc_citycode,a.city_code) city_code,d.city_name city_name,
    a.tehsil_taluka taluka_code,cir_get_taluka(a.comp_code,a.tehsil_taluka) taluka_name,
    a.branch_code branch_code,null branch_name,
    sum(b.sup_copy) sup_copy
    from cir_agmast a,cir_dbksup b,cir_edtn_mast c,cir_city_mast d
    where a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=d.comp_code and a.comp_code=pcomp_code and 
        a.unit=punit_code and a.unit=b.unit_code and a.unit=c.unit_code and a.agcd=b.agcd and a.dpcd=b.dpcd and 
        b.supdate>=v_frdt and b.supdate<=v_todt and b.publ=c.publ and b.publ=nvl(ppublcode,b.publ) and b.edtn=c.edtn and  b.edtn=nvl(pedtncode, b.edtn) and c.main_edtn=nvl(pmedtncode, c.main_edtn) and
        nvl(a.abc_citycode,a.city_code)=d.city_code and (d.zone_code=pzonecode or pzonecode is null) and (d.region_code=pregioncode  or pregioncode is null)
        group by a.comp_code,a.unit,a.agcd,a.dpcd,a.ag_name,a.country_code,a.state_code,a.dist_code,nvl(a.abc_citycode,a.city_code),d.city_name,d.zone_code,d.region_code,a.tehsil_taluka,a.branch_code;
    rec_supply cur_supply%rowtype;        
  Begin
    v_frdt:=to_date(pfromdate,''''||pdateformat||'''');
    v_todt:=to_date(ptilldate,''''||pdateformat||'''');
    delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
    open cur_supply;
    loop
        fetch cur_supply into rec_supply;
        exit when cur_supply%notfound;
        
        insert into cir_temp_bill_collection(comp_code,unit_code,agcd,dpcd,agname, agname_oth_lang ,remarks ,state_code,
            billno,dist_code,taluka_code,city_code,publ_code,supply_copy,return_copy,cur_sessionid)
        values(rec_supply.comp_code,rec_supply.unit,rec_supply.agcd,rec_supply.dpcd,rec_supply.agency_name,rec_supply.zone_name,rec_supply.region_name,rec_supply.state_name,
            rec_supply.branch_name,rec_supply.dist_name,rec_supply.taluka_name,rec_supply.city_name,null,rec_supply.sup_copy,0,userenv('sessionid'));

    end loop;
    close cur_supply;    
    
    if pbreakon='1' then --zone wise
        open p_accounts for
        select a.comp_code comp_code,a.unit_code unit_code,
        a.agname_oth_lang zone_code,a.city_code city_name,
        sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.agname_oth_lang,a.city_code
        order by comp_code,unit_code,zone_code,city_name;
        
        open p_accounts1 for 
        select a.comp_code comp_code,a.unit_code unit_code,
        a.agname_oth_lang zone_code,sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.agname_oth_lang
        order by comp_code,unit_code,agname_oth_lang;
    elsif pbreakon='2' then --region wise
        open p_accounts for
        select a.comp_code comp_code,a.unit_code unit_code,
        a.remarks region_name,
        a.city_code city_name,
        sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.remarks,a.city_code
        order by comp_code,unit_code,region_name,city_name;
        
        open p_accounts1 for 
        select a.comp_code comp_code,a.unit_code unit_code,
        a.remarks region_name,sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.remarks
        order by comp_code,unit_code,region_name;        
    elsif pbreakon='3' then --state wise
        open p_accounts for
        select a.comp_code comp_code,a.unit_code unit_code,
        a.state_code state_name,
        a.dist_code dist_name, 
        a.city_code city_name,
        a.taluka_code taluka_name,sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.state_code,a.city_code
        order by comp_code,unit_code,state_name,city_name;
        
        open p_accounts1 for 
        select a.comp_code comp_code,a.unit_code unit_code,
        a.state_code state_name,sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.state_code
        order by comp_code,unit_code,state_name;        
    elsif pbreakon='4' then --Branch wise
        open p_accounts for
        select a.comp_code comp_code,a.unit_code unit_code,
        a.billno branch_name,
        a.city_code city_name,
        sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.billno,a.city_code
        order by comp_code,unit_code,branch_name,city_name;
        
        open p_accounts1 for 
        select a.comp_code comp_code,a.unit_code unit_code,
        a.billno branch_name,sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.billno
        order by comp_code,unit_code,branch_name;        
    elsif pbreakon='5' then --District wise
        open p_accounts for
        select a.comp_code comp_code,a.unit_code unit_code,
        a.dist_code dist_name, 
        a.city_code city_name,
        sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.dist_code,a.city_code
        order by comp_code,unit_code,dist_name,city_name;
        
        open p_accounts1 for 
        select a.comp_code comp_code,a.unit_code unit_code,
        a.dist_code dist_name, sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.dist_code
        order by comp_code,unit_code,dist_name;        
    elsif pbreakon='6' then --Taluka wise
        open p_accounts for
        select a.comp_code comp_code,a.unit_code unit_code,
        a.taluka_code taluka_name,
        a.city_code city_name,
        sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.taluka_code,a.city_code
        order by comp_code,unit_code,taluka_name,city_name;
        
        open p_accounts1 for 
        select a.comp_code comp_code,a.unit_code unit_code,
        a.taluka_code taluka_name, sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy     
        from cir_temp_bill_collection a where a.cur_sessionid=userenv('sessionid')
        group by a.comp_code,a.unit_code,a.taluka_code
        order by comp_code,unit_code,taluka_name;        
     end if;   
    
    delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
  End cir_area_break_down;
END cir_rep_abc;
/
////////////////////////////////////////////////////////////////////////////////////////////////////////////


-------------------------------------description-----------------------------------------------


CREATE OR REPLACE PACKAGE HT18JULY.cir_rep_abc IS
  type t_accounts is ref cursor;
  procedure cir_commwise_supply_unsold(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pagtype             in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

  procedure cir_rate_comm_supply_unsold(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pagtype             in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     preptype           in varchar2,--for comm & rate wise supply & unsold--
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

  procedure cir_citywise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pagtype             in varchar2,
     pstatecode         in varchar2,
     pcitycode          in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

    procedure cir_agencywise_supply(
        pcomp_code      in varchar2,
        punit_code      in varchar2,
        pbrancode       in varchar2,
        ppublcode       in varchar2,
        pmedtncode      in varchar2,
        pedtncode       in varchar2,
        pagcd           in varchar2,
        pdpcd           in varchar2,
        pagtype         in varchar2,
        pstatecode      in varchar2,
        pcitycode       in varchar2,
        pfrom_supdate   in varchar2,
        ptill_supdate   in varchar2,
        psortedby       in varchar2,
        pdateformat     in varchar2,
        pextra1         in varchar2,
        pextra2         in varchar2,
        pextra3         in varchar2,
        pextra4         in varchar2,
        pextra5         in varchar2,
        p_accounts      out t_accounts);

  procedure cir_monthwise_billing_summary(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pagtype             in varchar2,
     pstatecode         in varchar2,
     pcitycode          in varchar2,
     pfromdate          in varchar2,
     ptilldate          in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

  procedure cir_billing_outstanding(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbrancode          in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pagtype             in varchar2,
     pstatecode         in varchar2,
     pcitycode          in varchar2,
     pason_date         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
     
    procedure cir_area_break_down(
        pcomp_code         in varchar2,
        punit_code         in varchar2,
        pbrancode          in varchar2,
        ppublcode          in varchar2,
        pmedtncode         in varchar2,
        pedtncode          in varchar2,
        pagtype            in varchar2,
        pzonecode          in varchar2,
        pregioncode        in varchar2,
        pstatecode         in varchar2,
        pdistcode          in varchar2,
        pfromdate          in varchar2,
        ptilldate          in varchar2,
        psup_copy          in number,
        psup_baseon        in varchar2,--it is used for Gross(G)/Average(A)
        pdateformat        in varchar2,
        puserid            in varchar2,
        pbreakon           in number,--it is used for Grouping on Zone(1)/Region(2)/State(3)/Branch(4)/District(5)/Taluka(6)
        pdatashow          in number,--it is used for data show Agency(1)/City(2)
        pextra1            in varchar2,
        pextra2            in varchar2,
        pextra3            in varchar2,
        pextra4            in varchar2,
        pextra5            in varchar2,
        p_accounts         out t_accounts,
        p_accounts1        out t_accounts);           
END cir_rep_abc;
/
///////////////////////////////////////end of procedure 5258============================================


************satrt mimoh mahajan-18/oct/2011******0005354**********************************************************

DROP PACKAGE HT18JULY.CIR_GENRATE_CODE;

CREATE OR REPLACE PACKAGE HT18JULY.Cir_Genrate_Code IS
	type p_circul_cursor is ref cursor;
PROCEDURE agency_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE agency_class_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE suspend_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE area_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE publ_mast_p(
   pcompcode    in varchar2,
   pdateformat  in varchar2,
   pextra1      in varchar2,
   pextra2      in varchar2,
   ppubl_code   out p_circul_cursor);

PROCEDURE edtn_mast_p (
    pcompcode   in varchar2,
    ppubl_code  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pedtn_code  out p_circul_cursor);

PROCEDURE agmast_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pag_code    out p_circul_cursor);

PROCEDURE agsubcode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pagcode         in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    pag_code        out p_circul_cursor);

PROCEDURE areacode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    parea_code      out p_circul_cursor);

PROCEDURE drop_point_code_P (
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    pdrop_point_code    out p_circul_cursor);

Procedure executive_code_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pexe_code   out p_circul_cursor);

PROCEDURE routecode_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    prt_code    out p_circul_cursor);

PROCEDURE subroutecode_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    prtcode     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psubrt_code out p_circul_cursor);

PROCEDURE subsubroutecode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    prtcode         in varchar2,
    psubrtcode      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    psubsubrt_code  out p_circul_cursor);

PROCEDURE transportercode_P (
    pcompcode   in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptp_code    out p_circul_cursor);

PROCEDURE districtcode_P (
    pcompcode   in varchar2,
    pstatecode  in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pdist_code  out p_circul_cursor);

PROCEDURE comm_catg_p (
    pcompcode   in varchar2,
    pcomm_type  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE comm_p (
    pcompcode   in varchar2,
    pcomm_type  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE zone_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE taluka_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE receipt_p (
    pcompcode   in varchar2,
    pbranchcode in varchar2,
    pdoctype    in varchar2,
    precptdt    in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE mode_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE supply_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE expenses_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE city_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE cir_region_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    preg_code   out p_circul_cursor);

PROCEDURE cir_unsold_receipt_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    preceipt_no out p_circul_cursor);

PROCEDURE cir_surcharge_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psurch_cd   out p_circul_cursor);

PROCEDURE cir_roleMatser_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psurch_cd   out p_circul_cursor);

PROCEDURE cir_narr_p (
    pcompcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    pnarr_cd        out p_circul_cursor);

Procedure cir_taxi_code_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptaxi_code  out p_circul_cursor);

PROCEDURE cir_lable_htmlformatid_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pformat_id  out p_circul_cursor);
PROCEDURE cir_installment_code_p (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pcode       out p_circul_cursor);
PROCEDURE race_code_P (
    pcompcode     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code     out p_circul_cursor);    
END Cir_Genrate_Code;
/



DROP PACKAGE BODY HT18JULY.CIR_GENRATE_CODE;

CREATE OR REPLACE PACKAGE BODY HT18JULY.Cir_Genrate_Code IS
PROCEDURE agency_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(agency_type_code,3,5))+1 into vno from cir_agency_typ_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='AT'||'001';
     Else
    vtype_code:='AT'||lpad(vno,3,'0');
     End if;

  open ptype_code for select vtype_code as "VAR_CODE" from dual;

End agency_type_p;

PROCEDURE agency_class_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(8);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select to_number(max(substr(class_code,3,5)))+1 into vno from cir_agency_class_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
        vtype_code:='AC'||'001';
     Else
        vtype_code:='AC'||lpad(vno,3,'0');
     End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End agency_class_p;

PROCEDURE suspend_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(suspend_type_code,3,5))+1 into vno from cir_suspend_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
        vtype_code:='ST'||'001';
     Else
        vtype_code:='ST'||lpad(vno,3,'0');
     End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End suspend_type_p;

PROCEDURE area_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(area_type,3,5))+1 into vno from cir_area_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
    vtype_code:='AR'||'001';
    Else
    vtype_code:='AR'||lpad(vno,3,'0');
    End if;

     open ptype_code for select vtype_code as "VAR_CODE" from dual;

End area_type_p;

PROCEDURE publ_mast_p(
   pcompcode    in varchar2,
   pdateformat  in varchar2,
   pextra1      in varchar2,
   pextra2      in varchar2,
   ppubl_code   out p_circul_cursor) as
    vno         number(5);
    vpubl_code  varchar2(15);

BEGIN

    Begin
       select max(to_number(substr(publ,2)))+1 into vno from cir_publ_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vpubl_code:='P'||'01';
    Else
        vpubl_code:='P'||lpad(vno,2,'0');
    End if;

    open ppubl_code for  select vpubl_code as "VAR_CODE" from dual;

End publ_mast_p;

PROCEDURE edtn_mast_p (
    pcompcode   in varchar2,
    ppubl_code  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pedtn_code  out p_circul_cursor) as
    vno         number(5);
    vedtn_code  varchar2(15);
BEGIN

    Begin
       select max(substr(edtn,1))+1 into vno from cir_edtn_mast where comp_code=pcompcode /*and publ=ppubl_code*/;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vedtn_code:=/*'E'||*/'001';
    Else
        vedtn_code:=/*'E'||*/lpad(vno,3,'0');
    End if;

    open pedtn_code for select vedtn_code as "VAR_CODE" from dual;

End edtn_mast_p;

PROCEDURE agmast_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pag_code    out p_circul_cursor) as
    vno         number(8);
    vag_code    varchar2(8);
    v_prefix    varchar2(20);
Begin

    Begin
        if upper(pextra2)='D' then
          v_prefix:='D'||upper(pprefix);
          select max(substr(agcd,length(v_prefix)+1))+1 into vno from cir_agmast_dis
              where comp_code=pcompcode and unit=punitcode and upper(substr(agcd,1,length(v_prefix)+1))=upper(v_prefix);
        else
            v_prefix:=upper(pprefix);
            select max(substr(agcd,length(v_prefix)+1))+1 into vno from cir_agmast
                  where comp_code=pcompcode and unit=punitcode and upper(substr(agcd,1,length(v_prefix)+1))=upper(v_prefix);
        end if;
    Exception when others then
         vno:=0;
    End;
    if nvl(vno,0)=0 then
       vag_code:=upper(v_prefix)||'0001';
    else
       vag_code:=upper(v_prefix)||lpad(vno,4,'0');
    end if;

    open pag_code for select vag_code as "VAR_CODE" from dual;

End agmast_P;

PROCEDURE agsubcode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pagcode         in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    pag_code        out p_circul_cursor) as
    vno             number(8);
    vag_code        varchar2(8);

BEGIN

    Begin
        if upper(pextra2)='D' then
            select to_number(max(dpcd))+1 into vno from cir_agmast_dis
                where comp_code=pcompcode and unit=punitcode and upper(agcd)=upper(pagcode);
        else
            select to_number(max(dpcd))+1 into vno from cir_agmast
                where comp_code=pcompcode and unit=punitcode and upper(agcd)=upper(pagcode);
        end if;
    Exception when others then
      vno:=0;
    End;
    if nvl(vno,0)=0 then
       vag_code:='0001';
    else
       vag_code:=lpad(vno,4,'0');
    end if;

    open pag_code for select vag_code as "VAR_CODE" from dual;

End agsubcode_P;

PROCEDURE areacode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    parea_code      out p_circul_cursor) as
    vno             number(8);
    varea_code      varchar2(15);

BEGIN

    Begin
       select max(substr(area_code,2,5))+1 into vno from cir_area_mast where comp_code=pcompcode and unit_code=punitcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
        varea_code:='A'||'0001';
     Else
        varea_code:='A'||lpad(vno,4,'0');
     End if;

    open parea_code for select varea_code as "VAR_CODE" from dual;

End areacode_P;

PROCEDURE drop_point_code_P (
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    pdrop_point_code    out p_circul_cursor) as
    vno         number(8);
    vdrop_point varchar2(15);

BEGIN

    Begin
        select max(substr(drop_point,2,5))+1 into vno from cir_drop_point_mast where comp_code=pcompcode and unit_code=punitcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vdrop_point:='D'||'0001';
    Else
        vdrop_point:='D'||lpad(vno,4,'0');
    End if;

    open pdrop_point_code for select vdrop_point as "VAR_CODE" from dual;

End drop_point_code_P;

Procedure executive_code_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pexe_code   out p_circul_cursor) as
    vno         number(8);
    v_code      varchar2(15);

Begin

    Begin
       select max(substr(executive_code,2,5))+1 into vno from cir_executive_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        v_code:='E'||'00001';
    Else
        v_code:='E'||lpad(vno,5,'0');
    End if;

    open pexe_code for select v_code as "VAR_CODE" from dual;

End executive_code_p;

PROCEDURE routecode_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    prt_code    out p_circul_cursor) As
    vno         number(8);
    vrt_code    varchar2(15);
BEGIN
    Begin
       select max(substr(route_code,3,5))+1 into vno from cir_route_mast where comp_code=pcompcode and unit=punitcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vrt_code:='RT'||'001';
    Else
        vrt_code:='RT'||lpad(vno,3,'0');
    End if;

    open prt_code for select vrt_code as "VAR_CODE" from dual;

End routecode_P;

PROCEDURE subroutecode_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    prtcode     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psubrt_code out p_circul_cursor) as
    vno         number(8);
    vsubrt_code varchar2(15);
BEGIN
    Begin
        select max(substr(subrt_code,3,5))+1 into vno from cir_sub_route_mast where comp_code=pcompcode and unit=punitcode and route_code=prtcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vsubrt_code:='SR'||'001';
    Else
        vsubrt_code:='SR'||lpad(vno,3,'0');
    End if;

    open psubrt_code for select vsubrt_code as "VAR_CODE" from dual;

End subroutecode_P;

PROCEDURE subsubroutecode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    prtcode         in varchar2,
    psubrtcode      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    psubsubrt_code  out p_circul_cursor) as
    vno             number(8);
    vsubsubrt_code  varchar2(15);
BEGIN
    Begin
        select max(substr(sub_subrt_code,3,5))+1 into vno from cir_sub_subroute_mast
            where comp_code=pcompcode and unit=punitcode and route_code=prtcode and
                    subrt_code=psubrtcode;
    Exception When Others Then
       vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vsubsubrt_code:='SS'||'001';
    Else
        vsubsubrt_code:='SS'||lpad(vno,3,'0');
    End if;
    open psubsubrt_code for select vsubsubrt_code as "VAR_CODE" from dual;

End subsubroutecode_P;

PROCEDURE transportercode_P (
    pcompcode   in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptp_code    out p_circul_cursor) as
    vno         number(8);
    vtp_code    varchar2(8);

Begin

    Begin
        select max(substr(transporter_code,2))+1 into vno from cir_transporter_mast
            where comp_code=pcompcode and upper(substr(transporter_code,1,1))=upper(pprefix);
    Exception when others then
        vno:=0;
    End;

    if nvl(vno,0)=0 then
        vtp_code:=upper(pprefix)||'0001';
    else
        vtp_code:=upper(pprefix)||lpad(vno,4,'0');
    end if;

    open ptp_code for select vtp_code as "VAR_CODE" from dual;
End transportercode_P;

PROCEDURE districtcode_P (
    pcompcode   in varchar2,
    pstatecode  in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pdist_code  out p_circul_cursor) as
    vno         number(8);
    vdist_code  varchar2(8);

Begin

    Begin
        select max(substr(dist_code,3))+1 into vno from cir_dist_mast
            where comp_code=pcompcode and upper(substr(dist_code,1,2))=upper(pprefix);
    Exception when others then
    vno:=0;
    End;
    if nvl(vno,0)=0 then
        vdist_code:=upper(pprefix)||'0001';
    else
        vdist_code:=upper(pprefix)||lpad(vno,4,'0');
    end if;

    open pdist_code for select vdist_code as "VAR_CODE" from dual;

End districtcode_P;

PROCEDURE comm_catg_p (
    pcompcode   in varchar2,
    pcomm_type  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);
    vcomm_type  varchar2(1);
BEGIN

    Begin
        select max(substr(comm_catg_code,3,5))+1 into vno from cir_comm_catg_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If pcomm_type is null then
        vcomm_type:='C';
    Else
        vcomm_type:=pcomm_type;
    End if;
    If nvl(vno,0)=0 Then
        vtype_code:='C'||pcomm_type||'001';
    Else
        vtype_code:='C'||pcomm_type||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End comm_catg_p;

PROCEDURE comm_p (
    pcompcode   in varchar2,
    pcomm_type  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

    vcomm_type  varchar2(1);
BEGIN

    Begin
        select max(substr(comm_code,3,5))+1 into vno from cir_comm_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If pcomm_type is null then
        vcomm_type:='F';
    Else
        vcomm_type:=pcomm_type;
    End if;
    If nvl(vno,0)=0 Then
        vtype_code:='C'||pcomm_type||'001';
    Else
        vtype_code:='C'||pcomm_type||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End comm_p;

PROCEDURE zone_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(zone_code,3,5))+1 into vno from cir_zone_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='ZN'||'001';
    Else
        vtype_code:='ZN'||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End zone_p;

PROCEDURE taluka_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(talu_code,3,6))+1 into vno from cir_taluka_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='TK'||'0001';
    Else
        vtype_code:='TK'||lpad(vno,4,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End taluka_p;

PROCEDURE receipt_p (
    pcompcode   in varchar2,
    pbranchcode in varchar2,
    pdoctype    in varchar2,
    precptdt    in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(20);
    vrecptno  varchar2(15);
    v_dt date;
BEGIN

    v_dt:=to_date(precptdt,''''||pdateformat||'''');

    Begin
       if upper(pextra2)='D' then
        select max(to_number(substr(recptno,-8)))+1 into vno from cir_rcphdr_dis
            where comp_code=pcompcode and doctype=pdoctype and to_char(recptdt,'yymm')=to_char(v_dt,'yymm') and branch_code=pbranchcode;
       else
        select max(to_number(substr(recptno,-8)))+1 into vno from cir_rcphdr
            where comp_code=pcompcode and doctype=pdoctype and to_char(recptdt,'yymm')=to_char(v_dt,'yymm') and branch_code=pbranchcode;
       end if;
    Exception When Others Then
       vno:=null;
    End;

    If nvl(vno,0)=0 Then
      vrecptno:=pbranchcode||'-'||to_char(v_dt,'yymm')||'0001';
    Else
      vrecptno:=pbranchcode||'-'||lpad(vno,8,'0');
    End if;

    open ptype_code for select vrecptno as "VAR_CODE" from dual;

End receipt_p;

PROCEDURE mode_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(mode_code,3,3))+1 into vno from cir_route_mode_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='RM'||'001';
    Else
        vtype_code:='RM'||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End mode_p;

PROCEDURE supply_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(sup_ty_code,2,2))+1 into vno from cir_supply_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='S'||'01';
    Else
        vtype_code:='S'||lpad(vno,2,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End supply_type_p;

PROCEDURE expenses_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(exp_type_code,2,3))+1 into vno from cir_expenses_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='E'||'001';
    Else
        vtype_code:='E'||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End expenses_type_p;

PROCEDURE city_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(city_code,3,6))+1 into vno from cir_city_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;

    If nvl(vno,0)=0 then
        vtype_code:='CT'||'0001';
    Else
        vtype_code:='CT'||lpad(vno,4,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End city_p;

PROCEDURE cir_region_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    preg_code   out p_circul_cursor)
    as
    vno         number(5);
    vreg_code   varchar2(15);
BEGIN

    Begin
       select max(substr(reg_code,3,6))+1 into vno from cir_region_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vreg_code:='RG'||'0001';
    Else
        vreg_code:='RG'||lpad(vno,4,'0');
    End if;

    open preg_code for select vreg_code as "VAR_CODE" from dual;

End cir_region_p;

PROCEDURE cir_unsold_receipt_p (
    pcompcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    preceipt_no     out p_circul_cursor)
    As
    vno number(5);
    vtype_code  varchar2(15);
    v_sess_id   number(20);
    v_prefix    varchar2(20);
    v_no        varchar2(20);
    v_dt        date;
    v_chkdt     date;
BEGIN
    /*loop
     begin
        select gen_unsold_rec_yn into v_gen_unsold_rec_yn from cir_control;
        if nvl(v_gen_unsold_rec_yn,'N')  = 'N' then
           exit;
        end if;
        exception when no_data_found then
            insert into cir_control values('Y');
            exit;
     end;
    end loop;
    update cir_control set GEN_UNSOLD_REC_YN='Y';commit;*/

    /*Begin
        if upper(pextra2)='D' then
            select max(substr(RECPTNO,3,8))+1 into vno from cir_unsold_hdr_dis where comp_code=pcompcode;
        else
            select max(substr(RECPTNO,3,8))+1 into vno from cir_unsold_hdr where comp_code=pcompcode;
        end if;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='UN'||'000001';
    Else
        vtype_code:='UN'||lpad(vno,6,'0');
    End if;

    open preceipt_no for
    select vtype_code as "VAR_CODE" from dual;
    */

    v_dt    :=to_date(pextra1,''''||pdateformat||'''');
    v_prefix:='UN'||to_char(v_dt,'yymm');

    select trunc(v_dt,'mm') into v_chkdt from dual;

    begin
        select curr_no into v_no from cir_series
        where comp_code=pcompcode and ty='UCN' and trunc(year_monid,'mm')=v_chkdt and prefix=v_prefix;
    exception when no_data_found then
        v_no:=null;
    end;

    if v_no is null or v_no='0' then
        vtype_code:=v_prefix||'00001';
        insert into cir_series(comp_code,unit_code,branch_code,ty,year_monid,prefix, curr_no)
        values(pcompcode,null,null,'UCN',trunc(v_dt,'mm'),v_prefix,1);
    else
        v_no        :=to_number(v_no)+1;
        vtype_code  :=v_prefix||lpad(v_no,5,'0');
        update cir_series set curr_no=nvl(curr_no,0)+1
            where comp_code=pcompcode and ty='UCN' and trunc(year_monid,'mm')=v_chkdt and prefix=v_prefix;
    end if;
    commit;

    open preceipt_no for
    select vtype_code as "VAR_CODE" from dual;
End cir_unsold_receipt_p;

PROCEDURE cir_surcharge_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psurch_cd   out p_circul_cursor)
    as
    vno         number(5);
    vsurch_cd   varchar2(15);

BEGIN

    Begin
            select max(substr(surch_cd,2,3))+1 into vno from cir_surcharge_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vsurch_cd:='S'||'001';
    Else
        vsurch_cd:='S'||lpad(vno,3,'0');
    End if;

    open psurch_cd for select vsurch_cd as "VAR_CODE" from dual;

End cir_surcharge_p;

PROCEDURE cir_roleMatser_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psurch_cd   out p_circul_cursor)
    as
    vno         number(5);
    vsurch_cd   varchar2(15);

BEGIN

    Begin
       select max(substr(role_code,2,3))+1 into vno from cir_role_mast where comp_code=pcompcode;
          Exception When Others Then
               vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vsurch_cd:='R'||'001';
    Else
        vsurch_cd:='R'||lpad(vno,3,'0');
    End if;

    open psurch_cd for select vsurch_cd as "VAR_CODE" from dual;

End cir_roleMatser_p;

PROCEDURE cir_narr_p (
    pcompcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    pnarr_cd        out p_circul_cursor)
    as
    vno             number(5);
    vsurch_cd       varchar2(15);
BEGIN
    Begin
        select max(substr(na_code,3,4))+1 into vno from fa_vch_narration_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;

    If nvl(vno,0)=0 Then
        vsurch_cd:='N'||'001';
    Else
        vsurch_cd:='N'||lpad(vno,3,'0');
    End if;

    open pnarr_cd for select vsurch_cd as "VAR_CODE" from dual;

End cir_narr_p;

Procedure cir_taxi_code_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptaxi_code  out p_circul_cursor) as

    vno         number(8);
    v_code      varchar2(15);

Begin

    Begin
        select max(substr(taxi_id,2,4))+1 into vno from cir_taxi_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;

    If nvl(vno,0)=0 Then
        v_code:='V'||'0001';
    Else
        v_code:='V'||lpad(vno,4,'0');
    End if;

    open ptaxi_code for select v_code as "VAR_CODE" from dual;

End cir_taxi_code_p;

PROCEDURE cir_lable_htmlformatid_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pformat_id  out p_circul_cursor)
    As
    vno         number(8);
    v_code      varchar2(15);
    v_sess_id   number(20);
Begin
    Begin
        select max(formatid)+1 into vno from cir_lable_htmlformat;
    Exception When Others Then
        vno:=null;
    End;

    If nvl(vno,0)=0 Then
        v_code:=1;
    Else
        v_code:=vno;
    End if;
    insert into cir_lable_htmlformat(comp_code,formatid,format_desc) values(pcompcode,v_code,pextra1);commit;
    open pformat_id for select v_code as "FORMAT_ID" from dual;

End cir_lable_htmlformatid_p;
PROCEDURE cir_installment_code_p (
        pcompcode   in varchar2,
        punitcode   in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,
        pcode       out p_circul_cursor) as
    vno         number(10);
    v_code      varchar2(15);
    Begin

    Begin
        select max(substr(inst_code,2,7))+1 into vno from cir_installment_mast where comp_code=pcompcode;
        Exception When Others Then
            vno:=null;
    End;

    If nvl(vno,0)=0 Then
        v_code:='I'||'0000001';
    Else
        v_code:='I'||lpad(vno,7,'0');
    End if;

    open pcode for select v_code as "VAR_CODE" from dual;

    End cir_installment_code_p;
PROCEDURE race_code_P (
    pcompcode 	in varchar2,
    pdateformat in varchar2,
    pextra1 	in varchar2,
    pextra2 	in varchar2,
    ptype_code 	out p_circul_cursor) as
    
    vno         number(8);
    vtype_code  varchar2(25);
BEGIN
    Begin
       select to_number(max(substr(race_code,3,5)))+1 into vno from cir_race_mast;
    Exception When Others Then
        vno:=null;
    End;
    
    If nvl(vno,0)=0 Then
        vtype_code:='RC'||'001';
    Else
        vtype_code:='RC'||lpad(vno,3,'0');
    End if;
    open ptype_code for select vtype_code as "VAR_CODE" from dual;
    
End race_code_P;    
END Cir_Genrate_Code;
/


**********************************************************************************
DROP PACKAGE HT18JULY.CIR_DYNAMIC_DML;

CREATE OR REPLACE PACKAGE HT18JULY.Cir_Dynamic_DML IS
  procedure variable_insert_stmt(
      ptable_name in varchar2,
      pcolname in varchar2,
      pcolvalue in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2);
  /*procedure variable_insert_stmt(
      ptable_name in varchar2,
      pcolname in varchar2,
      pcolvalue in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2,
      p_error_text out varchar2);*/

  procedure variable_update_stmt(
      ptable_name in varchar2,
      pcolname in varchar2,
      pcolvalue in varchar2,
      pcond_colname in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2);
  procedure variable_delete_stmt(
      ptable_name in varchar2,
      pcond_colname in varchar2,
      pcond_colval in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2);
      type t_accounts_type is ref cursor;
  procedure variable_execute_stmt(
      ptable_name in varchar2,
      pcond_colname in varchar2,
      pcond_colval in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2,
      p_accounts out t_accounts_type);
      type t_accounts is ref cursor;
   
   procedure variable_order(
      pcomp_code in varchar2,
      pcomp_val in varchar2,
      punit_code in varchar2,
      punit_val in varchar2,
      ptable_name in varchar2,
      pcolname in varchar2,
      porder in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2,
      p_accounts out t_accounts);
END Cir_Dynamic_DML;
/



DROP PACKAGE BODY HT18JULY.CIR_DYNAMIC_DML;

CREATE OR REPLACE PACKAGE BODY HT18JULY.Cir_Dynamic_DML IS
PROCEDURE variable_insert_stmt(
    ptable_name     in varchar2,
    pcolname        in varchar2,
    pcolvalue       in varchar2,
    pdelimiter      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2) as

    pstmt_str   varchar2(4000);
    v_sess_id   number;
cursor cur_stmt is


	select * from temp_col_ins  where session_id=v_sess_id order by sqno;
	rec_stmt cur_stmt%rowtype;

	vlength 	number(5);
	vcolval 	varchar2(4000);
	vrunval 	varchar2(1);
	vcol_name 	varchar2(500);
	vno 		number(5);
	vrec 		varchar2(4000);
	vrec_upd 	varchar2(4000);
	vformat 	varchar2(20);
	v_col_exists number(5);
Begin
	--insert into test1(vstring) values (pcolname||'33333'||pcolvalue);commit;
    dbg('vrec:');
    insert into searchtbl(search) values ('neha');commit;


    Begin
		select userenv('sessionid') into v_sess_id from dual;
      	delete from temp_col_ins where session_id=v_sess_id;
		vlength	:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;vno:=null;

		vcolval	:=replace(pcolname,pdelimiter,',');
		vlength	:=length(vcolval);
		vno			:=1;

		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
		  else
            --insert into test1(vstring2) values (vno||','||upper(ltrim(rtrim(vcol_name)))||','||v_sess_id);
            --commit;
		  	insert into temp_col_ins (sqno,col_name,session_id) values (vno,upper(ltrim(rtrim(vcol_name))),v_sess_id);
		  	vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;

         insert into searchtbl(search) values ('neha_1');commit;
		/*select count(*) into v_col_exists from col where tname=upper(ltrim(rtrim(ptable_name))) and
				cname=upper(ltrim(rtrim(vcol_name)));*/
		select count(*) into v_col_exists from temp_col_ins where session_id=v_sess_id and
			col_name=upper(ltrim(rtrim(vcol_name)));
		if nvl(v_col_exists,0)=0 then
			insert into temp_col_ins(sqno,col_name,session_id) values (vno,upper(vcol_name),v_sess_id);
		end if;
		commit;
		vlength:=null;	vcolval:=null; 	vrunval:=null;	vcol_name:=null;	vno:=null;
		if instr(pcolvalue,',')>0 or instr(pcolvalue,'''')>0 then
		   vcolval:=replace(pcolvalue,',','~~~');
        else
			 vcolval:=pcolvalue;
		end if;
		vcolval:=replace(vcolval,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval			:=substr(vcolval,i,1);
		  if vrunval	!=',' then
		  	vcol_name	:=vcol_name||vrunval;
		  else
		  	vcol_name	:=replace(vcol_name,'~~~',',');
		    update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=v_sess_id;
		  	vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;
		if vcol_name is not null then
			update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=v_sess_id;
		end if;
		update temp_col_ins set col_data_type=(select coltype from col where tname = upper(ltrim(rtrim(ptable_name))) and cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=v_sess_id;
		commit;
         insert into searchtbl(search) values ('neha_2');commit;
		vrec:='insert into '||ptable_name||'('||replace(pcolname,pdelimiter,',')||') values ( ';

        insert into searchtbl(search) values (vrec);commit;

		--select "date_format" into vformat from preferrences;
          vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||'to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||',';
		       else
		       	 vrec:=vrec||rec_stmt.col_value||',';
		       end if;
		  end loop;
		vrec		:=substr(vrec,1,length(vrec)-1)||')';
		vlength	:=null;
		vcolval	:=null;
		vrunval	:=null;
		vcol_name:=null;
		vno:=null;
		/*vcolval:=replace(pcond_colname,pdelimiter,',');
		vlength:=length(vcolval);
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   update temp_col_ins set upd_flag='I' where col_name=vcol_name and session_id=userenv('sessionid');
		       vcol_name:='';
		  end if;
		end loop;
		commit;
	 close cur_stmt; */
     update temp_col_ins set upd_str=vrec where session_id=v_sess_id and rownum<2;
	 --update temp_col_ins1 set upd_str=vrec where session_id=v_sess_id and rownum<2;
     --insert into test1(vstring) values (pcolname||'33333'||vrec);
     commit;

	End;
    dbg('vrec:'||vrec);
	execute immediate vrec;
	commit;
	 --delete from temp_col_ins where session_id=userenv('sessionid');
	commit;
End variable_insert_stmt;

PROCEDURE variable_update_stmt(
   ptable_name      in varchar2,
   pcolname         in varchar2,
   pcolvalue        in varchar2,
   pcond_colname    in varchar2,
   pdelimiter       in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2) as

pstmt_str varchar2(4000);
cursor cur_stmt is select * from temp_col_ins  where session_id=userenv('sessionid') order by sqno;
	rec_stmt cur_stmt%rowtype;
cursor cur_upd_stmt is select * from temp_col_ins  where nvl(upd_flag,'N')='U' and session_id=userenv('sessionid');
	rec_upd_stmt cur_upd_stmt%rowtype;

	vlength 	number(5);
	vcolval 	varchar2(4000);
	vrunval 	varchar2(1);
	vcol_name 	varchar2(100);
	vno 		number(5);
	vrec 		varchar2(4000);
	vrec_upd 	varchar2(4000);
	vpextra1 	varchar2(4000);
	vformat 	varchar2(20);
Begin
insert into searchtbl values('tblname-'|| ptable_name||'colname-'|| pcolname||'colvalue-'|| pcolvalue|| 'condname-' || pcond_colname|| 'delimeter-'|| pdelimiter || 'dateformat-'|| pdateformat || 'pextra1-'||pextra1||'pextra2-'|| pextra2);commit;






	--insert into test1(vstring) values (vrec||vrec_upd||ptable_name||','||pcolname||','||pcolvalue||','||pcond_colname||','||pdelimiter||','||pdateformat||','||pextra1||','||pextra2);
	Begin
		delete from temp_col_ins where session_id=userenv('sessionid');
		vlength		:=null;	vcolval:=null;	vrunval:=null;	vcol_name	:=null;	vno:=null;

		vcolval		:=replace(pcolname,pdelimiter,',');	vlength		:=length(vcolval);	vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
		  else
		  	insert into temp_col_ins (sqno,col_name,session_id) values (vno,vcol_name,userenv('sessionid'));
		  	vno				:=vno+1;
		    vcol_name	:='';
		  end if;
		end loop;
		commit;
		vlength:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;	vno:=null;

		if instr(pcolvalue,',')>0 then
			vcolval:=replace(pcolvalue,',','~~~');
		else
			vcolval:=pcolvalue;
		end if;

		vcolval:=replace(vcolval,pdelimiter,',');	vlength:=length(vcolval);	vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   vcol_name:=replace(vcol_name,'~~~',',');
		       update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=userenv('sessionid');
		  	   vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		/*Start New Change For Old and New Concept */
		if pextra1='' or pextra1 is null then
			 vpextra1:=pcolvalue;
		else
			 vpextra1:=pextra1;
		end if;
		vlength:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;	vno:=null;

		if instr(vpextra1,',')>0 then
			vcolval:=replace(vpextra1,',','~~~');
		else
			vcolval:=vpextra1;
		end if;

		vcolval:=replace(vcolval,pdelimiter,',');	vlength:=length(vcolval);	vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   vcol_name:=replace(vcol_name,'~~~',',');
		       update temp_col_ins set col_value_old=vcol_name where sqno=vno and session_id=userenv('sessionid');
		  	   vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		/*End New Change For Old and New Concept */
		update temp_col_ins set temp_col_ins.col_data_type=(select col.coltype from col where col.tname = upper(ltrim(rtrim(ptable_name))) and col.cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=userenv('sessionid');
		commit;
		vrec:='update '||ptable_name||' set ';
		--select "date_format" into vformat from preferrences;
          vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||rec_stmt.col_name||'=to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||',';
		       else
		       	 vrec:=vrec||rec_stmt.col_name||'='||replace(rec_stmt.col_value,'null','')||',';
		       end if;
		  end loop;
		  vrec:=substr(vrec,1,length(vrec)-1);
		vlength:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;	vno:=null;

		vcolval:=replace(pcond_colname,pdelimiter,',');	vlength:=length(vcolval);

		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
          else
		  	update temp_col_ins set upd_flag='U' where col_name=vcol_name and session_id=userenv('sessionid');
            vcol_name:='';
		  end if;
		end loop;
		commit;
	  close cur_stmt;
		if pcond_colname is not null then
		 	vrec_upd:=' where ';
		else
		 	vrec_upd:='';
		end if;

		open cur_upd_stmt;
		  loop
		    fetch cur_upd_stmt into rec_upd_stmt;
		       exit when cur_upd_stmt%notfound;
		       if rec_upd_stmt.col_data_type='DATE' then
		       	 vrec_upd:=vrec_upd||rec_upd_stmt.col_name||'=to_date('||rec_upd_stmt.col_value_old||','||''''||vformat||''''||')'||' and ';
		       else
		       	 vrec_upd:=vrec_upd||rec_upd_stmt.col_name||'='||rec_upd_stmt.col_value_old||' and ';
		       end if;
		  end loop;
		 close cur_upd_stmt;
		 vrec_upd:=substr(vrec_upd,1,length(vrec_upd)-5);
		 update temp_col_ins set upd_str=vrec||vrec_upd where session_id=userenv('sessionid') and rownum<2;
		 commit;

	End;
	 insert into test1(vstring) values (vrec||vrec_upd);commit;
    execute immediate vrec||vrec_upd;
    --insert into temp_col_ins1 values (vrec||vrec_upd);
	commit;
	   --delete from temp_col_ins where session_id=userenv('sessionid');commit;

End variable_update_stmt;

procedure variable_delete_stmt(
  ptable_name   in varchar2,
  pcond_colname in varchar2,
  pcond_colval  in varchar2,
  pdelimiter    in varchar2,
  pdateformat   in varchar2,
  pextra1       in varchar2,
  pextra2       in varchar2) as

  pstmt_str varchar2(4000);
cursor cur_stmt is select * from temp_col_ins  where session_id=userenv('sessionid') order by sqno;
	rec_stmt cur_stmt%rowtype;

cursor cur_upd_stmt is select * from temp_col_ins  where nvl(upd_flag,'N')='U' and session_id=userenv('sessionid');
	rec_upd_stmt cur_upd_stmt%rowtype;

	vlength     number(5);
	vcolval     varchar2(4000);
	vrunval     varchar2(1);
	vcol_name   varchar2(100);
	vno         number(5);
	vrec        varchar2(4000);
	vformat     varchar2(20);
Begin
	Begin
		delete from temp_col_ins where session_id=userenv('sessionid');
		vlength:=null;
		vcolval:=null;
		vrunval:=null;
		vcol_name:=null;
		vno:=null;
		vcolval:=replace(pcond_colname,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   insert into temp_col_ins (sqno,col_name,upd_flag,session_id,upd_str) values (vno,vcol_name,'U',userenv('sessionid'),pcond_colval);
		  	   vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		commit;
		vlength:=null;
		vcolval:=null;
		vrunval:=null;
		vcol_name:=null;
		vno:=null;
		if instr(pcond_colval,',')>0 then
		   vcolval:=replace(pcond_colval,',','~~~');
		else
			 vcolval:=pcond_colval;
		end if;
		vcolval:=replace(vcolval,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   --vcol_name:=replace(vcol_name,'~~~',',');
		       update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=userenv('sessionid');
		  	   vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		update temp_col_ins set temp_col_ins.col_data_type=(select col.coltype from col where col.tname = upper(ltrim(rtrim(ptable_name))) and cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=userenv('sessionid');
		commit;
		vrec:='delete from '||ptable_name||' where ';
		--select "date_format" into vformat from preferrences;
        vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||rec_stmt.col_name||'=to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||' and ';
		       else
		       	 vrec:=vrec||rec_stmt.col_name||'='||rec_stmt.col_value||' and ';
		       end if;
		  end loop;
		 vrec:=substr(vrec,1,length(vrec)-5);
		 --update temp_col_ins set upd_str=vrec where session_id=userenv('sessionid') and rownum<2;
		 --commit;

	End;
    --insert  into temp_col_ins_c (vstr) values (vrec);
    commit;
	execute immediate vrec;
	commit;
	delete from temp_col_ins where session_id=userenv('sessionid');
	commit;

End variable_delete_stmt;

procedure variable_execute_stmt(
  ptable_name   in varchar2,
  pcond_colname in varchar2,
  pcond_colval  in varchar2,
  pdelimiter    in varchar2,
  pdateformat   in varchar2,
  pextra1       in varchar2,
  pextra2       in varchar2,
  p_accounts    out t_accounts_type) as

  pstmt_str varchar2(4000);
cursor cur_stmt is select * from temp_col_ins  where session_id=userenv('sessionid');
	rec_stmt cur_stmt%rowtype;

/*cursor cur_upd_stmt is select * from temp_col_ins  where nvl(upd_flag,'N')='U' and session_id=userenv('sessionid');
	rec_upd_stmt cur_upd_stmt%rowtype;*/

	vlength     number(5);
	vcolval     varchar2(4000);
	vrunval     varchar2(1);
	vcol_name   varchar2(100);
	vno         number(5);
	vrec        varchar2(4000);
	vformat     varchar2(20);
Begin

delete from searchtbl;
insert into searchtbl values('table-'||ptable_name);
insert into searchtbl values('pcond_colname-'||pcond_colname);
insert into searchtbl values('pcond_colval-'||pcond_colval);
insert into searchtbl values('pdelimiter-'||pdelimiter);
insert into searchtbl values('pdateformat-'||pdateformat);
commit;
	 insert into temp_col_ins1 (sqno,col_name,upd_str,session_id) values (9999,'',sysdate||pcond_colname||'#'||pcond_colval||'#'||vrec,userenv('sessionid'));
    Begin
		delete from temp_col_ins where session_id=userenv('sessionid');
        delete from temp_col_ins1 where session_id=userenv('sessionid');
		vlength	:=null;	vcolval	:=null;	vrunval	:=null;	vcol_name	:=null;vno:=null;
		vcolval	:=replace(pcond_colname,pdelimiter,',');
		vlength	:=length(vcolval);vno:=1;

		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
		  else
		  	insert into temp_col_ins (sqno,col_name,upd_flag,session_id) values (vno,vcol_name,'U',userenv('sessionid'));
            insert into temp_col_ins1 (sqno,col_name,upd_flag,session_id) values (vno,vcol_name,'U',userenv('sessionid'));
            vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;
		commit;
		vlength:=null;
		vcolval:=null;
		vrunval:=null;
		vcol_name:=null;
		vno:=null;
		vcolval:=replace(pcond_colval,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		       update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=userenv('sessionid');
               vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		update temp_col_ins set temp_col_ins.col_data_type=(select col.coltype from col where col.tname = upper(ltrim(rtrim(ptable_name))) and cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=userenv('sessionid');
       		delete from temp_col_ins where col_value=''''||'''' and session_id=userenv('sessionid');
		commit;
		vrec:='select * from '||ptable_name||' where ';
		--select "date_format" into vformat from preferrences;
          vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||rec_stmt.col_name||'=to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||' and   ';
		       else
		       	 --vrec:=vrec||rec_stmt.col_name||'='||rec_stmt.col_value||' and ';
		       	 vrec:=vrec||'(('||rec_stmt.col_name||'='||rec_stmt.col_value||') or ('||rec_stmt.col_name||' like '||rec_stmt.col_value||'))'||' and   ';
		       end if;
		  end loop;
          /*if substr(vrec,length(vrec)-5,5)=' and ' then
		     vrec:=substr(vrec,1,length(vrec)-4);
          elsif substr(vrec,length(vrec)-7,7)=' where ' then
             vrec:=substr(vrec,1,length(vrec)-6);
          end if;*/
             vrec:=substr(vrec,1,length(vrec)-7);
             --insert into test1(vstring) values(vrec);
		 update temp_col_ins set upd_str=vrec where session_id=userenv('sessionid') and rownum<2;
		 commit;

	End;
   -- delete from searchtbl;
    --insert into searchtbl values(pextra1);commit;

    if pextra1 is not null then
       vrec:=vrec||' order by '||pextra1;
       insert into temp_col_ins1 (sqno,col_name,upd_str,session_id) values (1234,'',pcond_colname||'#'||pcond_colval||'#'||vrec,userenv('sessionid'));
    else
       vrec:=vrec||' order by rowid ';
    end if;
   -- insert into searchtbl values(vrec);commit;

    --insert into temp_col_ins1 values (vrec);
    insert into temp_col_ins1 (sqno,col_name,upd_str,session_id) values (9999,'',pcond_colname||'#'||pcond_colval||'#'||vrec,userenv('sessionid'));
	open p_accounts for vrec;
      dbg(vrec);
	--delete from temp_col_ins where session_id=userenv('sessionid');
	commit;
End variable_execute_stmt;

--var a refcursor;
--exec CIR_DYNAMIC_DML.variable_order('','','','','ABC_CHARGE_MAST','CHG_CODE','ASC','','','',:A);

procedure variable_order(
 pcomp_code 	in varchar2,
 pcomp_val 		in varchar2,
 punit_code 	in varchar2,
 punit_val 		in varchar2,
 ptable_name 	in varchar2,
 pcolname 		in varchar2,
 porder 		in varchar2,
 pdateformat 	in varchar2,
 pextra1 		in varchar2,
 pextra2 		in varchar2,
 p_accounts 	out t_accounts) as
Begin


   if punit_code is null and pcomp_code is not null then
      open p_accounts for ' select * from '||ptable_name||' where '||pcomp_code||'='||''''||pcomp_val||''''||' order by '||pcolname||' '||porder;
   elsif pcomp_code is null and punit_code is not null then
      open p_accounts for ' select * from '||ptable_name||' where '||punit_code||'='||''''||punit_val||''''||' order by '||pcolname||' '||porder;
   elsif pcomp_code is null and punit_code is null then
      open p_accounts for ' select * from '||ptable_name||' order by '||pcolname||' '||porder;
   else
   	  open p_accounts for ' select * from '||ptable_name||' where '||pcomp_code||'='||''''||pcomp_val||''''||' and '||punit_code||'='||''''||punit_val||''''||' order by '||pcolname||' '||porder;
   end if;
End variable_order;

PROCEDURE variable_insert_stmt(
    ptable_name     in varchar2,
    pcolname        in varchar2,
    pcolvalue       in varchar2,
    pdelimiter      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    p_error_text    out varchar2) as

    pstmt_str   varchar2(4000);
    v_sess_id   number;
cursor cur_stmt is
	select * from temp_col_ins  where session_id=v_sess_id order by sqno;
	rec_stmt cur_stmt%rowtype;
/*cursor cur_upd_stmt is
	select * from temp_col_ins  where nvl(upd_flag,'N')='I' and session_id=v_sess_id;
	rec_upd_stmt cur_upd_stmt%rowtype;*/
	vlength 	number(5);
	vcolval 	varchar2(4000);
	vrunval 	varchar2(1);
	vcol_name 	varchar2(100);
	vno 		number(5);
	vrec 		varchar2(4000);
	vrec_upd 	varchar2(4000);
	vformat 	varchar2(20);
	v_col_exists number(5);
Begin
	--insert into test1(vstring) values (pcolname||'33333'||pcolvalue);commit;
    Begin
		select userenv('sessionid') into v_sess_id from dual;
		delete from temp_col_ins where session_id=v_sess_id;
		vlength	:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;vno:=null;

		vcolval	:=replace(pcolname,pdelimiter,',');
		vlength	:=length(vcolval);
		vno			:=1;

		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
		  else
            --insert into test1(vstring2) values (vno||','||upper(ltrim(rtrim(vcol_name)))||','||v_sess_id);
            --commit;
		  	insert into temp_col_ins (sqno,col_name,session_id) values (vno,upper(ltrim(rtrim(vcol_name))),v_sess_id);
		  	vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;
		/*select count(*) into v_col_exists from col where tname=upper(ltrim(rtrim(ptable_name))) and
				cname=upper(ltrim(rtrim(vcol_name)));*/
		select count(*) into v_col_exists from temp_col_ins where session_id=v_sess_id and
			col_name=upper(ltrim(rtrim(vcol_name)));
		if nvl(v_col_exists,0)=0 then
			insert into temp_col_ins(sqno,col_name,session_id) values (vno,upper(vcol_name),v_sess_id);
		end if;
		commit;
		vlength:=null;	vcolval:=null; 	vrunval:=null;	vcol_name:=null;	vno:=null;
		if instr(pcolvalue,',')>0 or instr(pcolvalue,'''')>0 then
		   vcolval:=replace(pcolvalue,',','~~~');
        else
			 vcolval:=pcolvalue;
		end if;
		vcolval:=replace(vcolval,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval			:=substr(vcolval,i,1);
		  if vrunval	!=',' then
		  	vcol_name	:=vcol_name||vrunval;
		  else
		  	vcol_name	:=replace(vcol_name,'~~~',',');
		    update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=v_sess_id;
		  	vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;
		if vcol_name is not null then
			update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=v_sess_id;
		end if;
		update temp_col_ins set col_data_type=(select coltype from col where tname = upper(ltrim(rtrim(ptable_name))) and cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=v_sess_id;
		commit;
		vrec:='insert into '||ptable_name||'('||replace(pcolname,pdelimiter,',')||') values ( ';

		--select "date_format" into vformat from preferrences;
          vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||'to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||',';
		       else
		       	 vrec:=vrec||rec_stmt.col_value||',';
		       end if;
		  end loop;
		vrec		:=substr(vrec,1,length(vrec)-1)||')';
		vlength	:=null;
		vcolval	:=null;
		vrunval	:=null;
		vcol_name:=null;
		vno:=null;
		/*vcolval:=replace(pcond_colname,pdelimiter,',');
		vlength:=length(vcolval);
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   update temp_col_ins set upd_flag='I' where col_name=vcol_name and session_id=userenv('sessionid');
		       vcol_name:='';
		  end if;
		end loop;
		commit;
	 close cur_stmt; */
     update temp_col_ins set upd_str=vrec where session_id=v_sess_id and rownum<2;
	 --update temp_col_ins1 set upd_str=vrec where session_id=v_sess_id and rownum<2;
     --insert into test1(vstring) values (pcolname||'33333'||vrec);
     commit;

	End;
	execute immediate vrec;
	commit;
	 --delete from temp_col_ins where session_id=userenv('sessionid');
	commit;
    exception
       when others then
            p_error_text := 'Error:'||sqlerrm;
End variable_insert_stmt;

END Cir_Dynamic_DML;
/


*************************************************************************************************************************************

DROP PACKAGE HT18JULY.CIR_CHECK_DUPLICACY;

CREATE OR REPLACE PACKAGE HT18JULY.cir_check_duplicacy IS
  type t_circul_type is ref cursor;
  procedure cir_check_duplicacy_p(
  pcomp_col 		in varchar2,
  pcomp_val 		in varchar2,
  punit_col 		in varchar2,
  punit_val 		in varchar2,
	ptbl_name 		in varchar2,
	pdesc_col 		in varchar2,
	pdesc_val 		in varchar2,
	palias_col 		in varchar2,
	palias_val 		in varchar2,
	pdateformat 	in varchar2,
	pextra1 			in varchar2,
	pextra2 			in varchar2,
	p_circul 			out t_circul_type);
End cir_check_duplicacy;
/



DROP PACKAGE BODY HT18JULY.CIR_CHECK_DUPLICACY;

CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_check_duplicacy IS

--var a refcursor;
--exec cir_check_duplicacy.cir_check_duplicacy_p('LOC_ID',''''||'BRY'||'''','','','CRM_ZONE_MASTER','ZONE_NAME',''''||'BAREILLY'||'''','','','','','',:a);
	Procedure cir_check_duplicacy_p(
  	pcomp_col 		in varchar2,
	  pcomp_val 		in varchar2,
	  punit_col 		in varchar2,
	  punit_val 		in varchar2,
		ptbl_name 		in varchar2,
		pdesc_col 		in varchar2,
		pdesc_val 		in varchar2,
		palias_col 		in varchar2,
		palias_val 		in varchar2,
		pdateformat 	in varchar2,
		pextra1 			in varchar2,
		pextra2 			in varchar2,
		p_circul 			out t_circul_type)
	As
	 v_str1 varchar2(2000);
	 v_str2 varchar2(2000);
	 v_cnt1 number(5):=0;
	 v_cnt2 number(5):=0;
	 v_comp_exists number(1):=0;
	 v_unit_exists number(1):=0;
	Begin
	    v_str1:='pcomp_col '||pcomp_col||' pcomp_val '||pcomp_val||' punit_col '||punit_col||' punit_val '||punit_val||' ptbl_name '||ptbl_name||' pdesc_col '||pdesc_col||' pdesc_val '||pdesc_val||' palias_col '||palias_col||' palias_val '||palias_val;
	    insert into test1(vstring,vstring2) values(' duplicacy ',v_str1);
	    commit;
	  delete from cir_chk_duplicacy where 1=1;
		select count(*) into v_comp_exists from col where tname=ptbl_name and cname =pcomp_col;
    insert into test1(vstring,vstring2) values(' v_comp_exists ',v_comp_exists);
    commit;
		select count(*) into v_unit_exists from col where tname=ptbl_name and cname =punit_col;
    insert into test1(vstring,vstring2) values(' v_unit_exists ',v_unit_exists);
    commit;
	  select count(*) into v_cnt1 from col where tname=ptbl_name and cname =pdesc_col;
    insert into test1(vstring,vstring2) values(' v_cnt1 ',v_cnt1);
    commit;
	  select count(*) into v_cnt2 from col where tname=ptbl_name and cname =palias_col;
    insert into test1(vstring,vstring2) values(' v_cnt2 ',v_cnt2);
    commit;	
	  if v_cnt1=1 and v_cnt2=0 then
	    if v_comp_exists=1 and v_unit_exists=0 then--if comp code exists and unit code not exists in table
	    	--v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||''''||pcomp_val||''''||' and '||pdesc_col||'='||''''||pdesc_val||'''';
	    	v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||pcomp_val||' and upper('||pdesc_col||')=upper('||pdesc_val||')';
	    elsif v_comp_exists=1 and v_unit_exists=1 then--if both are existng in table
	    	--v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||''''||pcomp_val||''''||' and '||punit_col||'='||''''||punit_val||''''||' and '||pdesc_col||'='||''''||pdesc_val||'''';
	    	v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||pcomp_val||' and '||punit_col||'='||punit_val||' and upper('||pdesc_col||')=upper('||pdesc_val||')';
	    else--if both are not existng in table
				--v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pdesc_col||'='||''''||pdesc_val||'''';
				v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where upper('||pdesc_col||')=upper('||pdesc_val||')';
	    end if;
	    insert into test1(vstring,vstring2) values(' 1duplicacy ',v_str1);
	    commit;
	    execute immediate v_str1;
	  elsif v_cnt1=0 and v_cnt2=1 then
	    if v_comp_exists=1 and v_unit_exists=0 then--if comp code exists and unit code not exists in table
	    	--v_str2:=' insert into cir_chk_duplicacy(rec_name2) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||''''||pcomp_val||''''||' and '||palias_col||'='||''''||palias_val||'''';
	    	v_str2:=' insert into cir_chk_duplicacy(rec_name2) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||pcomp_val||' and upper('||pdesc_col||')=upper('||pdesc_val||')';
	    elsif v_comp_exists=1 and v_unit_exists=1 then--if both are existng in table
	    	--v_str2:=' insert into cir_chk_duplicacy(rec_name2) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||''''||pcomp_val||''''||' and '||punit_col||'='||''''||punit_val||''''||' and '||palias_col||'='||''''||palias_val||'''';
	    	v_str2:=' insert into cir_chk_duplicacy(rec_name2) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||pcomp_val||' and '||punit_col||'='||punit_val||' and upper('||pdesc_col||')=upper('||pdesc_val||')';
	    else--if both are not existng in table
				--v_str2:=' insert into cir_chk_duplicacy(rec_name2) select count(*) from '||ptbl_name||' where '||palias_col||'='||''''||palias_val||'''';
				v_str2:=' insert into cir_chk_duplicacy(rec_name2) select count(*) from '||ptbl_name||' where upper('||pdesc_col||')=upper('||pdesc_val||')';
	    end if;
	    insert into test1(vstring,vstring2) values(' 2duplicacy ',v_str2);
	    commit;	    
	    execute immediate v_str2;
	  elsif v_cnt1=1 and v_cnt2=1 then
	    if v_comp_exists=1 and v_unit_exists=0 then--if comp code exists and unit code not exists in table
	    	--v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||''''||pcomp_val||''''||' and '||pdesc_col||'='||''''||pdesc_val||'''';
	    	v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||pcomp_val||' and upper('||pdesc_col||')=upper('||pdesc_val||')';
	    elsif v_comp_exists=1 and v_unit_exists=1 then--if both are existng in table
	    	--v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||''''||pcomp_val||''''||' and '||punit_col||'='||''''||punit_val||''''||' and '||pdesc_col||'='||''''||pdesc_val||'''';
	    	v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pcomp_col||'='||pcomp_val||' and '||punit_col||'='||punit_val||' and upper('||pdesc_col||')=upper('||pdesc_val||')';
	    else--if both are not existng in table
				--v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where '||pdesc_col||'='||''''||pdesc_val||'''';
				v_str1:=' insert into cir_chk_duplicacy(rec_name1) select count(*) from '||ptbl_name||' where upper('||pdesc_col||')=upper('||pdesc_val||')';
	    end if;
	    insert into test1(vstring,vstring2) values(' 3duplicacy ',v_str1);
	    commit;
	    execute immediate v_str1;
	    if v_comp_exists=1 and v_unit_exists=0 then--if comp code exists and unit code not exists in table
	    	--v_str2:=' update cir_chk_duplicacy set rec_name2=(select count(*) from '||ptbl_name||' where '||pcomp_col||'='||''''||pcomp_val||''''||' and '||palias_col||'='||''''||palias_val||''''||')';
	    	v_str2:=' update cir_chk_duplicacy set rec_name2=(select count(*) from '||ptbl_name||' where '||pcomp_col||'='||pcomp_val||' and upper('||palias_col||')=upper('||palias_val||')'||')';
	    elsif v_comp_exists=1 and v_unit_exists=1 then--if both are existng in table
	    	--v_str2:=' update cir_chk_duplicacy set rec_name2=(select count(*) from '||ptbl_name||' where '||pcomp_col||'='||''''||pcomp_val||''''||' and '||punit_col||'='||''''||punit_val||''''||' and '||palias_col||'='||''''||palias_val||''''||')';
	    	v_str2:=' update cir_chk_duplicacy set rec_name2=(select count(*) from '||ptbl_name||' where '||pcomp_col||'='||pcomp_val||' and '||punit_col||'='||punit_val||' and upper('||palias_col||')=upper('||palias_val||')'||')';
	    else--if both are not existng in table
				--v_str2:=' update cir_chk_duplicacy set rec_name2=(select count(*) from '||ptbl_name||' where '||palias_col||'='||''''||palias_val||''''||')';
				v_str2:=' update cir_chk_duplicacy set rec_name2=(select count(*) from '||ptbl_name||' where upper('||palias_col||')=upper('||palias_val||')'||')';
	    end if;
	    insert into test1(vstring,vstring2) values(' 4duplicacy ',v_str2);
	    commit;	  	
	  	execute immediate v_str2;
	  else
	   	insert into cir_chk_duplicacy(rec_name1,rec_name2) values(0,0);
	  end if;
		commit;

		open p_circul for
		select distinct nvl(rec_name1,0) "NAME",nvl(rec_name2,0) "ALIAS" from cir_chk_duplicacy where 1=1;
		
	End cir_check_duplicacy_p;

End cir_check_duplicacy;
/

*************************************************************************************************************


************end mimoh mahajan-18/oct/2011******0005354*******************************************************************


/***************prachi agency master 18-oct*****************/
ALTER TABLE CIR_AGMAST_DIS ADD SUPPLY_SUBAGENCY VARCHAR2(1) DEFAULT 'N'

ALTER TABLE CIR_AGMAST ADD SUPPLY_SUBAGENCY VARCHAR2(1) DEFAULT 'N'

alter table cir_agmast_dis add SUSPEND_DATE date
alter table cir_agmast_dis add ALert_valid_date date
alter table cir_agmast_dis add SUPPLY_SUBAGENCY varchar2(1) default 'N'

CREATE OR REPLACE PACKAGE cir_chk_doc_permission IS
Type T_Accounts_Cursor Is Ref Cursor;
  PROCEDURE cir_chk_doc_permission_P(

    loginid            in varchar2,    
    pcompany         in varchar2, 
    pbranch             in varchar2,    
    pdoctypes         in varchar,
     pamount         in varchar,
    P_Accounts Out T_Accounts_Cursor);
END cir_chk_doc_permission;
/

CREATE OR REPLACE PACKAGE BODY cir_chk_doc_permission IS
  PROCEDURE cir_chk_doc_permission_P(
    loginid            in varchar2,    
    pcompany         in varchar2, 
    pbranch         in varchar2,    
    pdoctypes       in varchar,
    pamount         in varchar,
    P_Accounts Out T_Accounts_Cursor) as
    
    vcount number; 

begin      


    Begin
        select count(*) into vcount from CIR_DOCTYP_PERMISSION where COMP_CODE=pcompany and BRANCH_CODE=pbranch and DOCTYPE=pdoctypes and USER_ID=loginid
        and AMOUNT<pamount;
        Exception When no_data_found then
        vcount:=0;
    End;

    if(vcount=0) then
        open P_Accounts for
        select 'ok' as "output" from dual;
    else
        open P_Accounts for
        select 'novalue' as "output" from dual;
    end if;


End cir_chk_doc_permission_P;
END cir_chk_doc_permission;
/


/***************prachi agency master 18-oct*****************/

/************************mimoh 19 oct 2011*****************/
DROP PACKAGE HT18JULY.CIR_TABLE_COLUMN_DETAIL;

CREATE OR REPLACE PACKAGE HT18JULY.Cir_Table_Column_Detail IS
  Type t_circul_cursor is ref cursor;
  procedure Cir_Table_Column_Detail_p(
  ptable_name			in  varchar2,
  pcolumn_name		in  varchar2,
  p_circul				out t_circul_cursor);
END Cir_Table_Column_Detail;
/



DROP PACKAGE BODY HT18JULY.CIR_TABLE_COLUMN_DETAIL;

CREATE OR REPLACE PACKAGE BODY HT18JULY.Cir_Table_Column_Detail IS

  Procedure Cir_Table_Column_Detail_p(
  	ptable_name			in  varchar2,
  	pcolumn_name		in  varchar2,
  	p_circul				out t_circul_cursor)
  	As
  	vquery varchar2(2000);
  Begin
  	vquery:= ' select tname tablename,cname colname,coltype,decode(coltype,''DATE'',width+5,''NUMBER'',precision,width) colwidth,nulls colcondition,defaultval default_value,scale 
  		from col where upper(ltrim(rtrim(tname))) in ('||''''||replace(ptable_name,',',''''||','||'''')||''''||') and 
  									 (upper(ltrim(rtrim(cname)))='||''''||upper(ltrim(rtrim(pcolumn_name)))||''''||' or '||''''||pcolumn_name||''''||' is null) order by tname,colno';
  	/*INSERT INTO TEST1 VALUES(VQUERY,'');
  	COMMIT;*/
  	open p_circul for vquery;
  	/*select tname tablename,cname colname,coltype,width colwidth,nulls colcondition,defaultval default_value 
  		from col where upper(ltrim(rtrim(tname)))=upper(ltrim(rtrim(ptable_name))) and 
  									 (upper(ltrim(rtrim(cname)))=upper(ltrim(rtrim(pcolumn_name))) or pcolumn_name is null) order by tname,colno;*/

  End Cir_Table_Column_Detail_p;
END Cir_Table_Column_Detail;
/

/************19oct2011******************************************************************************/



/////////*******************issue no-4820////////// specification////////////////////////
CREATE OR REPLACE PACKAGE HT18JULY.cir_chk_doc_permission IS
Type T_Accounts_Cursor Is Ref Cursor;
  PROCEDURE cir_chk_doc_permission_P(

    loginid            in varchar2,    
    pcompany         in varchar2, 
    pbranch             in varchar2,    
    pdoctypes         in varchar,
     pamount         in varchar,
    P_Accounts Out T_Accounts_Cursor);
END cir_chk_doc_permission;
/

//////////////////////issue no-4820 body////////////////////
CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_chk_doc_permission IS
  PROCEDURE cir_chk_doc_permission_P(
    loginid            in varchar2,    
    pcompany         in varchar2, 
    pbranch         in varchar2,    
    pdoctypes       in varchar,
    pamount         in varchar,
    P_Accounts Out T_Accounts_Cursor) as
    
    vcount number; 

begin      


    Begin
        select count(*) into vcount from CIR_DOCTYP_PERMISSION where COMP_CODE=pcompany and BRANCH_CODE=pbranch and DOCTYPE=pdoctypes and USER_ID=loginid
        and (AMOUNT<pamount or pamount is null );
        Exception When no_data_found then
        vcount:=0;
    End;

    if(vcount=0) then
        open P_Accounts for
        select 'ok' as "output" from dual;
    else
        open P_Accounts for
        select 'novalue' as "output" from dual;
    end if;


End cir_chk_doc_permission_P;
END cir_chk_doc_permission;
/
/////////////////////end of  4820////////////////////////


//////////////////issue n0 4820/////specification/////////////////////
CREATE OR REPLACE PACKAGE HT18JULY.cir_execute_doctype_grid IS
Type T_Accounts_Cursor Is Ref Cursor;
  PROCEDURE cir_execute_doctype_grid_P(

    loginid            in varchar2,  
    P_Accounts Out T_Accounts_Cursor,
    P_Accounts1 Out T_Accounts_Cursor,
    P_Accounts2 Out T_Accounts_Cursor,
    P_Accounts3 Out T_Accounts_Cursor,
    P_Accounts4 Out T_Accounts_Cursor);
END cir_execute_doctype_grid;
/

//////////////body 4280/////////////////
CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_execute_doctype_grid IS
  PROCEDURE cir_execute_doctype_grid_P(

    loginid            in varchar2,    
    P_Accounts Out T_Accounts_Cursor,
    P_Accounts1 Out T_Accounts_Cursor,
    P_Accounts2 Out T_Accounts_Cursor,
    P_Accounts3 Out T_Accounts_Cursor,
    P_Accounts4 Out T_Accounts_Cursor) as
    
begin    
    open P_Accounts for
    select * from CIR_DOCTYP_PERMISSION where (USER_ID=loginid OR loginid IS NULL);
    
    open P_Accounts1 for
    select  "Branch_Code","Branch_Name" from branch_mst order by  "Branch_Name";
    
    open P_Accounts2 for
    select  "Comp_Code","Comp_Name" from comp_mst order by "Comp_Name";
    
    open P_Accounts3 for
    select  "doc_type","doc_Name" from fa_docmst where "doc_type" in ('RCR','DN','CN') order by "doc_Name";  

open P_Accounts4 for
    select MAX(INSERT_ID) INSERT_ID from CIR_DOCTYP_PERMISSION where (USER_ID=loginid OR loginid IS NULL);
End cir_execute_doctype_grid_P;
END cir_execute_doctype_grid;
/

///////end of 4820////////////////


///////////////**************************************** ISSUE NO. 0005363************************///////////////////////////////////

ALTER TABLE HT18JULY.CIR_HOLIDAY_MAST
 DROP PRIMARY KEY CASCADE;
DROP TABLE HT18JULY.CIR_HOLIDAY_MAST CASCADE CONSTRAINTS;

CREATE TABLE HT18JULY.CIR_HOLIDAY_MAST
(
  COMP_CODE      VARCHAR2(8 BYTE),
  UNIT           VARCHAR2(8 BYTE),
  H_PUBL         VARCHAR2(3 BYTE),
  H_NAME         VARCHAR2(100 BYTE),
  H_DATE         DATE,
  USERID         VARCHAR2(10 BYTE),
  CREATION_DATE  DATE                           DEFAULT sysdate,
  FREEZE_FLAG    VARCHAR2(1 BYTE)               DEFAULT 'N',
  H_MAIN_EDTN    VARCHAR2(3 BYTE),
  H_EDTN         VARCHAR2(3 BYTE),
  DIST_CODE      VARCHAR2(8 BYTE),
  STATE_CODE     VARCHAR2(8 BYTE)
)
TABLESPACE USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;


CREATE UNIQUE INDEX HT18JULY.PK_CIR_HOLIDAY_MAST ON HT18JULY.CIR_HOLIDAY_MAST
(COMP_CODE, UNIT, H_PUBL, H_DATE)
LOGGING
TABLESPACE USERS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;


ALTER TABLE HT18JULY.CIR_HOLIDAY_MAST ADD (
  CONSTRAINT PK_CIR_HOLIDAY_MAST
 PRIMARY KEY
 (COMP_CODE, UNIT, H_PUBL, H_DATE)
    USING INDEX 
    TABLESPACE USERS
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                PCTINCREASE      0
               ));

 
////////////////***********************************END 0005363*********************************/////////////////////

///////////////////////////////////////////ISSUE NO. 5361--20-OCT----//////////////////////////////////////////////


CREATE OR REPLACE procedure HT18JULY.ADDPUBLICATIONBIND(
   
    p_accounts    OUT Cur_Type_New1.cursor_type)
As
Begin
    open p_accounts for
    select "pubtypecode","pubname" from PUB_TYPE_MAST
       
        order by "pubname";
    
End ADDPUBLICATIONBIND;
/


///////////////////////////////////////END///////////////////////////////////////////////////////////////////




/////////////////////issue no-4676  procedure specification for code generate/////////////////////////////////
CREATE OR REPLACE PACKAGE HT18JULY.Cir_Genrate_Code IS
	type p_circul_cursor is ref cursor;
PROCEDURE agency_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE agency_class_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE suspend_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE area_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE publ_mast_p(
   pcompcode    in varchar2,
   pdateformat  in varchar2,
   pextra1      in varchar2,
   pextra2      in varchar2,
   ppubl_code   out p_circul_cursor);

PROCEDURE edtn_mast_p (
    pcompcode   in varchar2,
    ppubl_code  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pedtn_code  out p_circul_cursor);

PROCEDURE agmast_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pag_code    out p_circul_cursor);

PROCEDURE agsubcode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pagcode         in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    pag_code        out p_circul_cursor);

PROCEDURE areacode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    parea_code      out p_circul_cursor);

PROCEDURE drop_point_code_P (
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    pdrop_point_code    out p_circul_cursor);

Procedure executive_code_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pexe_code   out p_circul_cursor);

PROCEDURE routecode_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    prt_code    out p_circul_cursor);

PROCEDURE subroutecode_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    prtcode     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psubrt_code out p_circul_cursor);

PROCEDURE subsubroutecode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    prtcode         in varchar2,
    psubrtcode      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    psubsubrt_code  out p_circul_cursor);

PROCEDURE transportercode_P (
    pcompcode   in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptp_code    out p_circul_cursor);

PROCEDURE districtcode_P (
    pcompcode   in varchar2,
    pstatecode  in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pdist_code  out p_circul_cursor);

PROCEDURE comm_catg_p (
    pcompcode   in varchar2,
    pcomm_type  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE comm_p (
    pcompcode   in varchar2,
    pcomm_type  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE zone_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE taluka_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE receipt_p (
    pcompcode   in varchar2,
    pbranchcode in varchar2,
    pdoctype    in varchar2,
    precptdt    in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE mode_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE supply_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE expenses_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE city_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor);

PROCEDURE cir_region_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    preg_code   out p_circul_cursor);

PROCEDURE cir_unsold_receipt_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    preceipt_no out p_circul_cursor);

PROCEDURE cir_surcharge_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psurch_cd   out p_circul_cursor);

PROCEDURE cir_roleMatser_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psurch_cd   out p_circul_cursor);

PROCEDURE cir_narr_p (
    pcompcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    pnarr_cd        out p_circul_cursor);

Procedure cir_taxi_code_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptaxi_code  out p_circul_cursor);

PROCEDURE cir_lable_htmlformatid_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pformat_id  out p_circul_cursor);
PROCEDURE cir_installment_code_p (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pcode       out p_circul_cursor);
PROCEDURE race_code_P (
    pcompcode     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code     out p_circul_cursor);    
END Cir_Genrate_Code;
/
////////////////////////////////////////code generate  body////////////////////////////////////////
CREATE OR REPLACE PACKAGE BODY HT18JULY.Cir_Genrate_Code IS
PROCEDURE agency_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(agency_type_code,3,5))+1 into vno from cir_agency_typ_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
      vtype_code:='AT'||'001';
     Else
    vtype_code:='AT'||lpad(vno,3,'0');
     End if;

  open ptype_code for select vtype_code as "VAR_CODE" from dual;

End agency_type_p;

PROCEDURE agency_class_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(8);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select to_number(max(substr(class_code,3,5)))+1 into vno from cir_agency_class_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
        vtype_code:='AC'||'001';
     Else
        vtype_code:='AC'||lpad(vno,3,'0');
     End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End agency_class_p;

PROCEDURE suspend_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(suspend_type_code,3,5))+1 into vno from cir_suspend_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
        vtype_code:='ST'||'001';
     Else
        vtype_code:='ST'||lpad(vno,3,'0');
     End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End suspend_type_p;

PROCEDURE area_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(area_type,3,5))+1 into vno from cir_area_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
    vtype_code:='AR'||'001';
    Else
    vtype_code:='AR'||lpad(vno,3,'0');
    End if;

     open ptype_code for select vtype_code as "VAR_CODE" from dual;

End area_type_p;

PROCEDURE publ_mast_p(
   pcompcode    in varchar2,
   pdateformat  in varchar2,
   pextra1      in varchar2,
   pextra2      in varchar2,
   ppubl_code   out p_circul_cursor) as
    vno         number(5);
    vpubl_code  varchar2(15);

BEGIN

    Begin
       select max(to_number(substr(publ,2)))+1 into vno from cir_publ_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vpubl_code:='P'||'01';
    Else
        vpubl_code:='P'||lpad(vno,2,'0');
    End if;

    open ppubl_code for  select vpubl_code as "VAR_CODE" from dual;

End publ_mast_p;

PROCEDURE edtn_mast_p (
    pcompcode   in varchar2,
    ppubl_code  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pedtn_code  out p_circul_cursor) as
    vno         number(5);
    vedtn_code  varchar2(15);
BEGIN

    Begin
       select max(substr(edtn,2))+1 into vno from cir_edtn_mast where comp_code=pcompcode /*and publ=ppubl_code*/;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vedtn_code:=/*'E'||*/'001';
    Else
        vedtn_code:=/*'E'||*/lpad(vno,3,'0');
    End if;

    open pedtn_code for select vedtn_code as "VAR_CODE" from dual;

End edtn_mast_p;

PROCEDURE agmast_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pag_code    out p_circul_cursor) as
    vno         number(8);
    vag_code    varchar2(8);
    v_prefix    varchar2(20);
Begin

    Begin
        if upper(pextra2)='D' then
          v_prefix:='D'||upper(pprefix);
          select max(substr(agcd,length(v_prefix)+1))+1 into vno from cir_agmast_dis
              where comp_code=pcompcode and unit=punitcode and upper(substr(agcd,1,length(v_prefix)+1))=upper(v_prefix);
        else
            v_prefix:=upper(pprefix);
            select max(substr(agcd,length(v_prefix)+1))+1 into vno from cir_agmast
                  where comp_code=pcompcode and unit=punitcode and upper(substr(agcd,1,length(v_prefix)+1))=upper(v_prefix);
        end if;
    Exception when others then
         vno:=0;
    End;
    if nvl(vno,0)=0 then
       vag_code:=upper(v_prefix)||'0001';
    else
       vag_code:=upper(v_prefix)||lpad(vno,4,'0');
    end if;

    open pag_code for select vag_code as "VAR_CODE" from dual;

End agmast_P;

PROCEDURE agsubcode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pagcode         in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    pag_code        out p_circul_cursor) as
    vno             number(8);
    vag_code        varchar2(8);

BEGIN

    Begin
        if upper(pextra2)='D' then
            select to_number(max(dpcd))+1 into vno from cir_agmast_dis
                where comp_code=pcompcode and unit=punitcode and upper(agcd)=upper(pagcode);
        else
            select to_number(max(dpcd))+1 into vno from cir_agmast
                where comp_code=pcompcode and unit=punitcode and upper(agcd)=upper(pagcode);
        end if;
    Exception when others then
      vno:=0;
    End;
    if nvl(vno,0)=0 then
       vag_code:='0001';
    else
       vag_code:=lpad(vno,4,'0');
    end if;

    open pag_code for select vag_code as "VAR_CODE" from dual;

End agsubcode_P;

PROCEDURE areacode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    parea_code      out p_circul_cursor) as
    vno             number(8);
    varea_code      varchar2(15);

BEGIN

    Begin
       select max(substr(area_code,2,5))+1 into vno from cir_area_mast where comp_code=pcompcode and unit_code=punitcode;
    Exception When Others Then
        vno:=null;
    End;
     If nvl(vno,0)=0 Then
        varea_code:='A'||'0001';
     Else
        varea_code:='A'||lpad(vno,4,'0');
     End if;

    open parea_code for select varea_code as "VAR_CODE" from dual;

End areacode_P;

PROCEDURE drop_point_code_P (
    pcompcode           in varchar2,
    punitcode           in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,
    pdrop_point_code    out p_circul_cursor) as
    vno         number(8);
    vdrop_point varchar2(15);

BEGIN

    Begin
        select max(substr(drop_point,2,5))+1 into vno from cir_drop_point_mast where comp_code=pcompcode and unit_code=punitcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vdrop_point:='D'||'0001';
    Else
        vdrop_point:='D'||lpad(vno,4,'0');
    End if;

    open pdrop_point_code for select vdrop_point as "VAR_CODE" from dual;

End drop_point_code_P;

Procedure executive_code_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pexe_code   out p_circul_cursor) as
    vno         number(8);
    v_code      varchar2(15);

Begin

    Begin
       select max(substr(executive_code,2,5))+1 into vno from cir_executive_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        v_code:='E'||'00001';
    Else
        v_code:='E'||lpad(vno,5,'0');
    End if;

    open pexe_code for select v_code as "VAR_CODE" from dual;

End executive_code_p;

PROCEDURE routecode_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    prt_code    out p_circul_cursor) As
    vno         number(8);
    vrt_code    varchar2(15);
BEGIN
    Begin
       select max(substr(route_code,3,5))+1 into vno from cir_route_mast where comp_code=pcompcode and unit=punitcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vrt_code:='RT'||'001';
    Else
        vrt_code:='RT'||lpad(vno,3,'0');
    End if;

    open prt_code for select vrt_code as "VAR_CODE" from dual;

End routecode_P;

PROCEDURE subroutecode_P (
    pcompcode   in varchar2,
    punitcode   in varchar2,
    prtcode     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psubrt_code out p_circul_cursor) as
    vno         number(8);
    vsubrt_code varchar2(15);
BEGIN
    Begin
        select max(substr(subrt_code,3,5))+1 into vno from cir_sub_route_mast where comp_code=pcompcode and unit=punitcode and route_code=prtcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vsubrt_code:='SR'||'001';
    Else
        vsubrt_code:='SR'||lpad(vno,3,'0');
    End if;

    open psubrt_code for select vsubrt_code as "VAR_CODE" from dual;

End subroutecode_P;

PROCEDURE subsubroutecode_P (
    pcompcode       in varchar2,
    punitcode       in varchar2,
    prtcode         in varchar2,
    psubrtcode      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    psubsubrt_code  out p_circul_cursor) as
    vno             number(8);
    vsubsubrt_code  varchar2(15);
BEGIN
    Begin
        select max(substr(sub_subrt_code,3,5))+1 into vno from cir_sub_subroute_mast
            where comp_code=pcompcode and unit=punitcode and route_code=prtcode and
                    subrt_code=psubrtcode;
    Exception When Others Then
       vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vsubsubrt_code:='SS'||'001';
    Else
        vsubsubrt_code:='SS'||lpad(vno,3,'0');
    End if;
    open psubsubrt_code for select vsubsubrt_code as "VAR_CODE" from dual;

End subsubroutecode_P;

PROCEDURE transportercode_P (
    pcompcode   in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptp_code    out p_circul_cursor) as
    vno         number(8);
    vtp_code    varchar2(8);

Begin

    Begin
        select max(substr(transporter_code,2))+1 into vno from cir_transporter_mast
            where comp_code=pcompcode and upper(substr(transporter_code,1,1))=upper(pprefix);
    Exception when others then
        vno:=0;
    End;

    if nvl(vno,0)=0 then
        vtp_code:=upper(pprefix)||'0001';
    else
        vtp_code:=upper(pprefix)||lpad(vno,4,'0');
    end if;

    open ptp_code for select vtp_code as "VAR_CODE" from dual;
End transportercode_P;

PROCEDURE districtcode_P (
    pcompcode   in varchar2,
    pstatecode  in varchar2,
    pprefix     in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pdist_code  out p_circul_cursor) as
    vno         number(8);
    vdist_code  varchar2(8);

Begin

    Begin
        select max(substr(dist_code,3))+1 into vno from cir_dist_mast
            where comp_code=pcompcode and upper(substr(dist_code,1,2))=upper(pprefix);
    Exception when others then
    vno:=0;
    End;
    if nvl(vno,0)=0 then
        vdist_code:=upper(pprefix)||'0001';
    else
        vdist_code:=upper(pprefix)||lpad(vno,4,'0');
    end if;

    open pdist_code for select vdist_code as "VAR_CODE" from dual;

End districtcode_P;

PROCEDURE comm_catg_p (
    pcompcode   in varchar2,
    pcomm_type  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);
    vcomm_type  varchar2(1);
BEGIN

    Begin
        select max(substr(comm_catg_code,3,5))+1 into vno from cir_comm_catg_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If pcomm_type is null then
        vcomm_type:='C';
    Else
        vcomm_type:=pcomm_type;
    End if;
    If nvl(vno,0)=0 Then
        vtype_code:='C'||pcomm_type||'001';
    Else
        vtype_code:='C'||pcomm_type||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End comm_catg_p;

PROCEDURE comm_p (
    pcompcode   in varchar2,
    pcomm_type  in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

    vcomm_type  varchar2(1);
BEGIN

    Begin
        select max(substr(comm_code,3,5))+1 into vno from cir_comm_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If pcomm_type is null then
        vcomm_type:='F';
    Else
        vcomm_type:=pcomm_type;
    End if;
    If nvl(vno,0)=0 Then
        vtype_code:='C'||pcomm_type||'001';
    Else
        vtype_code:='C'||pcomm_type||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End comm_p;

PROCEDURE zone_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor) as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(zone_code,3,5))+1 into vno from cir_zone_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='ZN'||'001';
    Else
        vtype_code:='ZN'||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End zone_p;

PROCEDURE taluka_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(talu_code,3,6))+1 into vno from cir_taluka_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='TK'||'0001';
    Else
        vtype_code:='TK'||lpad(vno,4,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End taluka_p;

PROCEDURE receipt_p (
    pcompcode   in varchar2,
    pbranchcode in varchar2,
    pdoctype    in varchar2,
    precptdt    in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(20);
    vrecptno  varchar2(15);
    v_dt date;
BEGIN

    v_dt:=to_date(precptdt,''''||pdateformat||'''');

    Begin
       if upper(pextra2)='D' then
        select max(to_number(substr(recptno,-8)))+1 into vno from cir_rcphdr_dis
            where comp_code=pcompcode and doctype=pdoctype and to_char(recptdt,'yymm')=to_char(v_dt,'yymm') and branch_code=pbranchcode;
       else
        select max(to_number(substr(recptno,-8)))+1 into vno from cir_rcphdr
            where comp_code=pcompcode and doctype=pdoctype and to_char(recptdt,'yymm')=to_char(v_dt,'yymm') and branch_code=pbranchcode;
       end if;
    Exception When Others Then
       vno:=null;
    End;

    If nvl(vno,0)=0 Then
      vrecptno:=pbranchcode||'-'||to_char(v_dt,'yymm')||'0001';
    Else
      vrecptno:=pbranchcode||'-'||lpad(vno,8,'0');
    End if;

    open ptype_code for select vrecptno as "VAR_CODE" from dual;

End receipt_p;

PROCEDURE mode_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(mode_code,3,3))+1 into vno from cir_route_mode_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='RM'||'001';
    Else
        vtype_code:='RM'||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End mode_p;

PROCEDURE supply_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(sup_ty_code,2,2))+1 into vno from cir_supply_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='S'||'01';
    Else
        vtype_code:='S'||lpad(vno,2,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End supply_type_p;

PROCEDURE expenses_type_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(exp_type_code,2,3))+1 into vno from cir_expenses_type_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='E'||'001';
    Else
        vtype_code:='E'||lpad(vno,3,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End expenses_type_p;

PROCEDURE city_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptype_code  out p_circul_cursor)
    as
    vno         number(5);
    vtype_code  varchar2(15);

BEGIN

    Begin
       select max(substr(city_code,3,6))+1 into vno from cir_city_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;

    If nvl(vno,0)=0 then
        vtype_code:='CT'||'0001';
    Else
        vtype_code:='CT'||lpad(vno,4,'0');
    End if;

    open ptype_code for select vtype_code as "VAR_CODE" from dual;

End city_p;

PROCEDURE cir_region_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    preg_code   out p_circul_cursor)
    as
    vno         number(5);
    vreg_code   varchar2(15);
BEGIN

    Begin
       select max(substr(reg_code,3,6))+1 into vno from cir_region_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vreg_code:='RG'||'0001';
    Else
        vreg_code:='RG'||lpad(vno,4,'0');
    End if;

    open preg_code for select vreg_code as "VAR_CODE" from dual;

End cir_region_p;

PROCEDURE cir_unsold_receipt_p (
    pcompcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    preceipt_no     out p_circul_cursor)
    As
    vno number(5);
    vtype_code  varchar2(15);
    v_sess_id   number(20);
    v_prefix    varchar2(20);
    v_no        varchar2(20);
    v_dt        date;
    v_chkdt     date;
BEGIN
    /*loop
     begin
        select gen_unsold_rec_yn into v_gen_unsold_rec_yn from cir_control;
        if nvl(v_gen_unsold_rec_yn,'N')  = 'N' then
           exit;
        end if;
        exception when no_data_found then
            insert into cir_control values('Y');
            exit;
     end;
    end loop;
    update cir_control set GEN_UNSOLD_REC_YN='Y';commit;*/

    /*Begin
        if upper(pextra2)='D' then
            select max(substr(RECPTNO,3,8))+1 into vno from cir_unsold_hdr_dis where comp_code=pcompcode;
        else
            select max(substr(RECPTNO,3,8))+1 into vno from cir_unsold_hdr where comp_code=pcompcode;
        end if;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vtype_code:='UN'||'000001';
    Else
        vtype_code:='UN'||lpad(vno,6,'0');
    End if;

    open preceipt_no for
    select vtype_code as "VAR_CODE" from dual;
    */

    v_dt    :=to_date(pextra1,''''||pdateformat||'''');
    v_prefix:='UN'||to_char(v_dt,'yymm');

    select trunc(v_dt,'mm') into v_chkdt from dual;

    begin
        select curr_no into v_no from cir_series
        where comp_code=pcompcode and ty='UCN' and trunc(year_monid,'mm')=v_chkdt and prefix=v_prefix;
    exception when no_data_found then
        v_no:=null;
    end;

    if v_no is null or v_no='0' then
        vtype_code:=v_prefix||'00001';
        insert into cir_series(comp_code,unit_code,branch_code,ty,year_monid,prefix, curr_no)
        values(pcompcode,null,null,'UCN',trunc(v_dt,'mm'),v_prefix,1);
    else
        v_no        :=to_number(v_no)+1;
        vtype_code  :=v_prefix||lpad(v_no,5,'0');
        update cir_series set curr_no=nvl(curr_no,0)+1
            where comp_code=pcompcode and ty='UCN' and trunc(year_monid,'mm')=v_chkdt and prefix=v_prefix;
    end if;
    commit;

    open preceipt_no for
    select vtype_code as "VAR_CODE" from dual;
End cir_unsold_receipt_p;

PROCEDURE cir_surcharge_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psurch_cd   out p_circul_cursor)
    as
    vno         number(5);
    vsurch_cd   varchar2(15);

BEGIN

    Begin
            select max(substr(surch_cd,2,3))+1 into vno from cir_surcharge_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vsurch_cd:='S'||'001';
    Else
        vsurch_cd:='S'||lpad(vno,3,'0');
    End if;

    open psurch_cd for select vsurch_cd as "VAR_CODE" from dual;

End cir_surcharge_p;

PROCEDURE cir_roleMatser_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    psurch_cd   out p_circul_cursor)
    as
    vno         number(5);
    vsurch_cd   varchar2(15);

BEGIN

    Begin
       select max(substr(role_code,2,3))+1 into vno from cir_role_mast where comp_code=pcompcode;
          Exception When Others Then
               vno:=null;
    End;
    If nvl(vno,0)=0 Then
        vsurch_cd:='R'||'001';
    Else
        vsurch_cd:='R'||lpad(vno,3,'0');
    End if;

    open psurch_cd for select vsurch_cd as "VAR_CODE" from dual;

End cir_roleMatser_p;

PROCEDURE cir_narr_p (
    pcompcode       in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    pnarr_cd        out p_circul_cursor)
    as
    vno             number(5);
    vsurch_cd       varchar2(15);
BEGIN
    Begin
        select max(substr(na_code,3,4))+1 into vno from fa_vch_narration_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;

    If nvl(vno,0)=0 Then
        vsurch_cd:='N'||'001';
    Else
        vsurch_cd:='N'||lpad(vno,3,'0');
    End if;

    open pnarr_cd for select vsurch_cd as "VAR_CODE" from dual;

End cir_narr_p;

Procedure cir_taxi_code_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    ptaxi_code  out p_circul_cursor) as

    vno         number(8);
    v_code      varchar2(15);

Begin

    Begin
        select max(substr(taxi_id,2,4))+1 into vno from cir_taxi_mast where comp_code=pcompcode;
    Exception When Others Then
        vno:=null;
    End;

    If nvl(vno,0)=0 Then
        v_code:='V'||'0001';
    Else
        v_code:='V'||lpad(vno,4,'0');
    End if;

    open ptaxi_code for select v_code as "VAR_CODE" from dual;

End cir_taxi_code_p;

PROCEDURE cir_lable_htmlformatid_p (
    pcompcode   in varchar2,
    pdateformat in varchar2,
    pextra1     in varchar2,
    pextra2     in varchar2,
    pformat_id  out p_circul_cursor)
    As
    vno         number(8);
    v_code      varchar2(15);
    v_sess_id   number(20);
Begin
    Begin
        select max(formatid)+1 into vno from cir_lable_htmlformat;
    Exception When Others Then
        vno:=null;
    End;

    If nvl(vno,0)=0 Then
        v_code:=1;
    Else
        v_code:=vno;
    End if;
    insert into cir_lable_htmlformat(comp_code,formatid,format_desc) values(pcompcode,v_code,pextra1);commit;
    open pformat_id for select v_code as "FORMAT_ID" from dual;

End cir_lable_htmlformatid_p;
PROCEDURE cir_installment_code_p (
        pcompcode   in varchar2,
        punitcode   in varchar2,
        pdateformat in varchar2,
        pextra1     in varchar2,
        pextra2     in varchar2,
        pcode       out p_circul_cursor) as
    vno         number(10);
    v_code      varchar2(15);
    Begin

    Begin
        select max(substr(inst_code,2,7))+1 into vno from cir_installment_mast where comp_code=pcompcode;
        Exception When Others Then
            vno:=null;
    End;

    If nvl(vno,0)=0 Then
        v_code:='I'||'0000001';
    Else
        v_code:='I'||lpad(vno,7,'0');
    End if;

    open pcode for select v_code as "VAR_CODE" from dual;

    End cir_installment_code_p;
PROCEDURE race_code_P (
    pcompcode 	in varchar2,
    pdateformat in varchar2,
    pextra1 	in varchar2,
    pextra2 	in varchar2,
    ptype_code 	out p_circul_cursor) as
    
    vno         number(8);
    vtype_code  varchar2(25);
BEGIN
    Begin
       select to_number(max(substr(race_code,3,5)))+1 into vno from cir_race_mast;
    Exception When Others Then
        vno:=null;
    End;
    
    If nvl(vno,0)=0 Then
        vtype_code:='RC'||'001';
    Else
        vtype_code:='RC'||lpad(vno,3,'0');
    End if;
    open ptype_code for select vtype_code as "VAR_CODE" from dual;
    
End race_code_P;    
END Cir_Genrate_Code;
/
////////////////////////////end of code generate/////////////////////

/////////////////////issue no- 4676 grid procedure specification/////////////////////////////////
CREATE OR REPLACE package HT18JULY.cir_installment_bind is
   type t_accounts_cursor is ref cursor;
   procedure cir_installment_bind_p (
       pcomp_code 	in varchar2,
       punit_code 	in varchar2,
       pinst_code 	in varchar2,
       pagcd     	in varchar2,
       pdpcd     	in varchar2,
       pdateformat 	in varchar2,
       pextra1 		in varchar2,
       pextra2 		in varchar2,
       pextra3 		in varchar2,
       pextra4 		in varchar2,
       pextra5 		in varchar2,
       p_accounts 	out t_accounts_cursor);
End cir_installment_bind;
/
////////////////grid procedure of body///////////////////


CREATE OR REPLACE package body HT18JULY.cir_installment_bind is
   procedure cir_installment_bind_p (
    pcomp_code 	    in varchar2,
    punit_code 	    in varchar2,
    pinst_code 	    in varchar2,
    pagcd 	        in varchar2,
    pdpcd 	        in varchar2,
    pdateformat 	in varchar2,
    pextra1 		in varchar2,
    pextra2 		in varchar2,
    pextra3 		in varchar2,
    pextra4 		in varchar2,
    pextra5 		in varchar2,
    p_accounts 	out t_accounts_cursor) 
   As
   Begin
   	open p_accounts for
		select * from cir_installment_mast
		where comp_code=pcomp_code and (unit_code=punit_code or punit_code is null) and
        (inst_code=pinst_code or pinst_code is null) and
        (agcd=pagcd or pagcd is null) and (dpcd=pdpcd or pdpcd is null) 
          order by INST_CODE;
   End cir_installment_bind_p;
   
End cir_installment_bind;
/


/////////////////////////end of issue no-4676////////////////////////////////////////////////////


**********mimoh 24oct2011***********************0005364**********************************start*********************************
DROP PROCEDURE HT18JULY.CIR_OVERDUE_BIND;

CREATE OR REPLACE PROCEDURE HT18JULY.cir_overdue_bind(
    pcompcode       in varchar2,
    pbill_cycle     in varchar2,
    pdateformat     in varchar2,
    puserid         in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    p_accounts      out cur_type_new1.cursor_type)
as

begin
    open p_Accounts for
    select trans_ty AS "TRANS_TY", comp_code AS "COMP_CODE", publ AS "PUBL", publ_name AS "PUBL_NAME", pnick AS "PNICK", publ_frequancy AS "PUBL_FREQUANCY",
    product AS "PRODUCT",credit_days AS "CREDIT_DAYS",credit_limit  AS "CREDIT_LIMIT" from
    (select 'I' trans_ty,comp_code, publ, publ_name, pnick, 
    case when period='1' then 'Daily' when period='7' then 'Weekly' when period='30' then 'Monthly' 
    when period='15' then 'Fortnightly'
    when period='365' then 'Yearly' else to_char(period) end publ_frequancy,
    case when pro_type='N' then 'Newspaper' when pro_type='M' then 'Magzine' else pro_type end product,0 credit_days,0 credit_limit
    from cir_publ_mast 
    where comp_code=pcompcode and publ not in(select publ_code from cir_overdue_mast where comp_code=pcompcode and 
    bill_cycle=pbill_cycle)
    union all
    select 'U' trans_ty,p.comp_code comp_code, p.publ publ, p.publ_name publ_name, p.pnick pnick, 
    case when p.period='1' then 'Daily' when p.period='7' then 'Weekly' when p.period='30' then 'Monthly' 
    when p.period='15' then 'Fortnightly'
    when p.period='365' then 'Yearly' else to_char(p.period) end publ_frequancy,
    case when p.pro_type='N' then 'Newspaper' when p.pro_type='M' then 'Magzine' else p.pro_type end product,
    o.credit_days credit_days,o.credit_limit credit_limit
    from cir_publ_mast p,cir_overdue_mast o
    where p.comp_code=o.comp_code and p.publ=o.publ_code and p.comp_code=pcompcode and o.bill_cycle=pbill_cycle)x
    order by comp_code,publ_name;

end cir_overdue_bind;
/

*****************************************************************************************************************************
DROP PACKAGE HT18JULY.CIR_DYNAMIC_DML;

CREATE OR REPLACE PACKAGE HT18JULY.Cir_Dynamic_DML IS
  procedure variable_insert_stmt(
      ptable_name in varchar2,
      pcolname in varchar2,
      pcolvalue in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2);
  /*procedure variable_insert_stmt(
      ptable_name in varchar2,
      pcolname in varchar2,
      pcolvalue in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2,
      p_error_text out varchar2);*/

  procedure variable_update_stmt(
      ptable_name in varchar2,
      pcolname in varchar2,
      pcolvalue in varchar2,
      pcond_colname in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2);
  procedure variable_delete_stmt(
      ptable_name in varchar2,
      pcond_colname in varchar2,
      pcond_colval in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2);
      type t_accounts_type is ref cursor;
  procedure variable_execute_stmt(
      ptable_name in varchar2,
      pcond_colname in varchar2,
      pcond_colval in varchar2,
      pdelimiter in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2,
      p_accounts out t_accounts_type);
      type t_accounts is ref cursor;
   
   procedure variable_order(
      pcomp_code in varchar2,
      pcomp_val in varchar2,
      punit_code in varchar2,
      punit_val in varchar2,
      ptable_name in varchar2,
      pcolname in varchar2,
      porder in varchar2,
      pdateformat in varchar2,
      pextra1 in varchar2,
      pextra2 in varchar2,
      p_accounts out t_accounts);
END Cir_Dynamic_DML;
/



DROP PACKAGE BODY HT18JULY.CIR_DYNAMIC_DML;

CREATE OR REPLACE PACKAGE BODY HT18JULY.Cir_Dynamic_DML IS
PROCEDURE variable_insert_stmt(
    ptable_name     in varchar2,
    pcolname        in varchar2,
    pcolvalue       in varchar2,
    pdelimiter      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2) as

    pstmt_str   varchar2(4000);
    v_sess_id   number;
cursor cur_stmt is


	select * from temp_col_ins  where session_id=v_sess_id order by sqno;
	rec_stmt cur_stmt%rowtype;

	vlength 	number(5);
	vcolval 	varchar2(4000);
	vrunval 	varchar2(1);
	vcol_name 	varchar2(500);
	vno 		number(5);
	vrec 		varchar2(4000);
	vrec_upd 	varchar2(4000);
	vformat 	varchar2(20);
	v_col_exists number(5);
Begin
	--insert into test1(vstring) values (pcolname||'33333'||pcolvalue);commit;
    dbg('vrec:');
    insert into searchtbl(search) values ('neha');commit;


    Begin
		select userenv('sessionid') into v_sess_id from dual;
      	delete from temp_col_ins where session_id=v_sess_id;
		vlength	:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;vno:=null;

		vcolval	:=replace(pcolname,pdelimiter,',');
		vlength	:=length(vcolval);
		vno			:=1;

		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
		  else
            --insert into test1(vstring2) values (vno||','||upper(ltrim(rtrim(vcol_name)))||','||v_sess_id);
            --commit;
		  	insert into temp_col_ins (sqno,col_name,session_id) values (vno,upper(ltrim(rtrim(vcol_name))),v_sess_id);
		  	vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;

         insert into searchtbl(search) values ('neha_1');commit;
		/*select count(*) into v_col_exists from col where tname=upper(ltrim(rtrim(ptable_name))) and
				cname=upper(ltrim(rtrim(vcol_name)));*/
		select count(*) into v_col_exists from temp_col_ins where session_id=v_sess_id and
			col_name=upper(ltrim(rtrim(vcol_name)));
		if nvl(v_col_exists,0)=0 then
			insert into temp_col_ins(sqno,col_name,session_id) values (vno,upper(vcol_name),v_sess_id);
		end if;
		commit;
		vlength:=null;	vcolval:=null; 	vrunval:=null;	vcol_name:=null;	vno:=null;
		if instr(pcolvalue,',')>0 or instr(pcolvalue,'''')>0 then
		   vcolval:=replace(pcolvalue,',','~~~');
        else
			 vcolval:=pcolvalue;
		end if;
		vcolval:=replace(vcolval,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval			:=substr(vcolval,i,1);
		  if vrunval	!=',' then
		  	vcol_name	:=vcol_name||vrunval;
		  else
		  	vcol_name	:=replace(vcol_name,'~~~',',');
		    update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=v_sess_id;
		  	vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;
		if vcol_name is not null then
			update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=v_sess_id;
		end if;
		update temp_col_ins set col_data_type=(select coltype from col where tname = upper(ltrim(rtrim(ptable_name))) and cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=v_sess_id;
		commit;
         insert into searchtbl(search) values ('neha_2');commit;
		vrec:='insert into '||ptable_name||'('||replace(pcolname,pdelimiter,',')||') values ( ';

        insert into searchtbl(search) values (vrec);commit;

		--select "date_format" into vformat from preferrences;
          vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||'to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||',';
		       else
		       	 vrec:=vrec||rec_stmt.col_value||',';
		       end if;
		  end loop;
		vrec		:=substr(vrec,1,length(vrec)-1)||')';
		vlength	:=null;
		vcolval	:=null;
		vrunval	:=null;
		vcol_name:=null;
		vno:=null;
		/*vcolval:=replace(pcond_colname,pdelimiter,',');
		vlength:=length(vcolval);
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   update temp_col_ins set upd_flag='I' where col_name=vcol_name and session_id=userenv('sessionid');
		       vcol_name:='';
		  end if;
		end loop;
		commit;
	 close cur_stmt; */
     update temp_col_ins set upd_str=vrec where session_id=v_sess_id and rownum<2;
	 --update temp_col_ins1 set upd_str=vrec where session_id=v_sess_id and rownum<2;
     --insert into test1(vstring) values (pcolname||'33333'||vrec);
     commit;

	End;
    dbg('vrec:'||vrec);
	execute immediate vrec;
	commit;
	 --delete from temp_col_ins where session_id=userenv('sessionid');
	commit;
End variable_insert_stmt;

PROCEDURE variable_update_stmt(
   ptable_name      in varchar2,
   pcolname         in varchar2,
   pcolvalue        in varchar2,
   pcond_colname    in varchar2,
   pdelimiter       in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2) as

pstmt_str varchar2(4000);
cursor cur_stmt is select * from temp_col_ins  where session_id=userenv('sessionid') order by sqno;
	rec_stmt cur_stmt%rowtype;
cursor cur_upd_stmt is select * from temp_col_ins  where nvl(upd_flag,'N')='U' and session_id=userenv('sessionid');
	rec_upd_stmt cur_upd_stmt%rowtype;

	vlength 	number(5);
	vcolval 	varchar2(4000);
	vrunval 	varchar2(1);
	vcol_name 	varchar2(100);
	vno 		number(5);
	vrec 		varchar2(4000);
	vrec_upd 	varchar2(4000);
	vpextra1 	varchar2(4000);
	vformat 	varchar2(20);
Begin
insert into searchtbl values('tblname-'|| ptable_name||'colname-'|| pcolname||'colvalue-'|| pcolvalue|| 'condname-' || pcond_colname|| 'delimeter-'|| pdelimiter || 'dateformat-'|| pdateformat || 'pextra1-'||pextra1||'pextra2-'|| pextra2);commit;






	--insert into test1(vstring) values (vrec||vrec_upd||ptable_name||','||pcolname||','||pcolvalue||','||pcond_colname||','||pdelimiter||','||pdateformat||','||pextra1||','||pextra2);
	Begin
		delete from temp_col_ins where session_id=userenv('sessionid');
		vlength		:=null;	vcolval:=null;	vrunval:=null;	vcol_name	:=null;	vno:=null;

		vcolval		:=replace(pcolname,pdelimiter,',');	vlength		:=length(vcolval);	vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
		  else
		  	insert into temp_col_ins (sqno,col_name,session_id) values (vno,vcol_name,userenv('sessionid'));
		  	vno				:=vno+1;
		    vcol_name	:='';
		  end if;
		end loop;
		commit;
		vlength:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;	vno:=null;

		if instr(pcolvalue,',')>0 then
			vcolval:=replace(pcolvalue,',','~~~');
		else
			vcolval:=pcolvalue;
		end if;

		vcolval:=replace(vcolval,pdelimiter,',');	vlength:=length(vcolval);	vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   vcol_name:=replace(vcol_name,'~~~',',');
		       update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=userenv('sessionid');
		  	   vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		/*Start New Change For Old and New Concept */
		if pextra1='' or pextra1 is null then
			 vpextra1:=pcolvalue;
		else
			 vpextra1:=pextra1;
		end if;
		vlength:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;	vno:=null;

		if instr(vpextra1,',')>0 then
			vcolval:=replace(vpextra1,',','~~~');
		else
			vcolval:=vpextra1;
		end if;

		vcolval:=replace(vcolval,pdelimiter,',');	vlength:=length(vcolval);	vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   vcol_name:=replace(vcol_name,'~~~',',');
		       update temp_col_ins set col_value_old=vcol_name where sqno=vno and session_id=userenv('sessionid');
		  	   vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		/*End New Change For Old and New Concept */
		update temp_col_ins set temp_col_ins.col_data_type=(select col.coltype from col where col.tname = upper(ltrim(rtrim(ptable_name))) and col.cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=userenv('sessionid');
		commit;
		vrec:='update '||ptable_name||' set ';
		--select "date_format" into vformat from preferrences;
          vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||rec_stmt.col_name||'=to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||',';
		       else
		       	 vrec:=vrec||rec_stmt.col_name||'='||replace(rec_stmt.col_value,'null','')||',';
		       end if;
		  end loop;
		  vrec:=substr(vrec,1,length(vrec)-1);
		vlength:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;	vno:=null;

		vcolval:=replace(pcond_colname,pdelimiter,',');	vlength:=length(vcolval);

		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
          else
		  	update temp_col_ins set upd_flag='U' where col_name=vcol_name and session_id=userenv('sessionid');
            vcol_name:='';
		  end if;
		end loop;
		commit;
	  close cur_stmt;
		if pcond_colname is not null then
		 	vrec_upd:=' where ';
		else
		 	vrec_upd:='';
		end if;

		open cur_upd_stmt;
		  loop
		    fetch cur_upd_stmt into rec_upd_stmt;
		       exit when cur_upd_stmt%notfound;
		       if rec_upd_stmt.col_data_type='DATE' then
		       	 vrec_upd:=vrec_upd||rec_upd_stmt.col_name||'=to_date('||rec_upd_stmt.col_value_old||','||''''||vformat||''''||')'||' and ';
		       else
		       	 vrec_upd:=vrec_upd||rec_upd_stmt.col_name||'='||rec_upd_stmt.col_value_old||' and ';
		       end if;
		  end loop;
		 close cur_upd_stmt;
		 vrec_upd:=substr(vrec_upd,1,length(vrec_upd)-5);
		 update temp_col_ins set upd_str=vrec||vrec_upd where session_id=userenv('sessionid') and rownum<2;
		 commit;

	End;
	 insert into test1(vstring) values (vrec||vrec_upd);commit;
    execute immediate vrec||vrec_upd;
    --insert into temp_col_ins1 values (vrec||vrec_upd);
	commit;
	   --delete from temp_col_ins where session_id=userenv('sessionid');commit;

End variable_update_stmt;

procedure variable_delete_stmt(
  ptable_name   in varchar2,
  pcond_colname in varchar2,
  pcond_colval  in varchar2,
  pdelimiter    in varchar2,
  pdateformat   in varchar2,
  pextra1       in varchar2,
  pextra2       in varchar2) as

  pstmt_str varchar2(4000);
cursor cur_stmt is select * from temp_col_ins  where session_id=userenv('sessionid') order by sqno;
	rec_stmt cur_stmt%rowtype;

cursor cur_upd_stmt is select * from temp_col_ins  where nvl(upd_flag,'N')='U' and session_id=userenv('sessionid');
	rec_upd_stmt cur_upd_stmt%rowtype;

	vlength     number(5);
	vcolval     varchar2(4000);
	vrunval     varchar2(1);
	vcol_name   varchar2(100);
	vno         number(5);
	vrec        varchar2(4000);
	vformat     varchar2(20);
Begin
	Begin
		delete from temp_col_ins where session_id=userenv('sessionid');
		vlength:=null;
		vcolval:=null;
		vrunval:=null;
		vcol_name:=null;
		vno:=null;
		vcolval:=replace(pcond_colname,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   insert into temp_col_ins (sqno,col_name,upd_flag,session_id,upd_str) values (vno,vcol_name,'U',userenv('sessionid'),pcond_colval);
		  	   vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		commit;
		vlength:=null;
		vcolval:=null;
		vrunval:=null;
		vcol_name:=null;
		vno:=null;
		if instr(pcond_colval,',')>0 then
		   vcolval:=replace(pcond_colval,',','~~~');
		else
			 vcolval:=pcond_colval;
		end if;
		vcolval:=replace(vcolval,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   --vcol_name:=replace(vcol_name,'~~~',',');
		       update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=userenv('sessionid');
		  	   vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		update temp_col_ins set temp_col_ins.col_data_type=(select col.coltype from col where col.tname = upper(ltrim(rtrim(ptable_name))) and cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=userenv('sessionid');
		commit;
		vrec:='delete from '||ptable_name||' where ';
		--select "date_format" into vformat from preferrences;
        vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||rec_stmt.col_name||'=to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||' and ';
		       else
		       	 vrec:=vrec||rec_stmt.col_name||'='||rec_stmt.col_value||' and ';
		       end if;
		  end loop;
		 vrec:=substr(vrec,1,length(vrec)-5);
		 --update temp_col_ins set upd_str=vrec where session_id=userenv('sessionid') and rownum<2;
		 --commit;

	End;
    --insert  into temp_col_ins_c (vstr) values (vrec);
    commit;
	execute immediate vrec;
	commit;
	delete from temp_col_ins where session_id=userenv('sessionid');
	commit;

End variable_delete_stmt;

procedure variable_execute_stmt(
  ptable_name   in varchar2,
  pcond_colname in varchar2,
  pcond_colval  in varchar2,
  pdelimiter    in varchar2,
  pdateformat   in varchar2,
  pextra1       in varchar2,
  pextra2       in varchar2,
  p_accounts    out t_accounts_type) as

  pstmt_str varchar2(4000);
cursor cur_stmt is select * from temp_col_ins  where session_id=userenv('sessionid');
	rec_stmt cur_stmt%rowtype;

/*cursor cur_upd_stmt is select * from temp_col_ins  where nvl(upd_flag,'N')='U' and session_id=userenv('sessionid');
	rec_upd_stmt cur_upd_stmt%rowtype;*/

	vlength     number(5);
	vcolval     varchar2(4000);
	vrunval     varchar2(1);
	vcol_name   varchar2(100);
	vno         number(5);
	vrec        varchar2(4000);
	vformat     varchar2(20);
Begin

delete from searchtbl;
insert into searchtbl values('table-'||ptable_name);
insert into searchtbl values('pcond_colname-'||pcond_colname);
insert into searchtbl values('pcond_colval-'||pcond_colval);
insert into searchtbl values('pdelimiter-'||pdelimiter);
insert into searchtbl values('pdateformat-'||pdateformat);
commit;
	 insert into temp_col_ins1 (sqno,col_name,upd_str,session_id) values (9999,'',sysdate||pcond_colname||'#'||pcond_colval||'#'||vrec,userenv('sessionid'));
    Begin
		delete from temp_col_ins where session_id=userenv('sessionid');
        delete from temp_col_ins1 where session_id=userenv('sessionid');
		vlength	:=null;	vcolval	:=null;	vrunval	:=null;	vcol_name	:=null;vno:=null;
		vcolval	:=replace(pcond_colname,pdelimiter,',');
		vlength	:=length(vcolval);vno:=1;

		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
		  else
		  	insert into temp_col_ins (sqno,col_name,upd_flag,session_id) values (vno,vcol_name,'U',userenv('sessionid'));
            insert into temp_col_ins1 (sqno,col_name,upd_flag,session_id) values (vno,vcol_name,'U',userenv('sessionid'));
            vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;
		commit;
		vlength:=null;
		vcolval:=null;
		vrunval:=null;
		vcol_name:=null;
		vno:=null;
		vcolval:=replace(pcond_colval,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		       update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=userenv('sessionid');
               vno:=vno+1;
		       vcol_name:='';
		  end if;
		end loop;
		update temp_col_ins set temp_col_ins.col_data_type=(select col.coltype from col where col.tname = upper(ltrim(rtrim(ptable_name))) and cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=userenv('sessionid');
       		delete from temp_col_ins where col_value=''''||'''' and session_id=userenv('sessionid');
		commit;
		vrec:='select * from '||ptable_name||' where ';
		--select "date_format" into vformat from preferrences;
          vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||rec_stmt.col_name||'=to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||' and   ';
		       else
		       	 --vrec:=vrec||rec_stmt.col_name||'='||rec_stmt.col_value||' and ';
		       	 vrec:=vrec||'(('||rec_stmt.col_name||'='||rec_stmt.col_value||') or ('||rec_stmt.col_name||' like '||rec_stmt.col_value||'))'||' and   ';
		       end if;
		  end loop;
          /*if substr(vrec,length(vrec)-5,5)=' and ' then
		     vrec:=substr(vrec,1,length(vrec)-4);
          elsif substr(vrec,length(vrec)-7,7)=' where ' then
             vrec:=substr(vrec,1,length(vrec)-6);
          end if;*/
             vrec:=substr(vrec,1,length(vrec)-7);
             --insert into test1(vstring) values(vrec);
		 update temp_col_ins set upd_str=vrec where session_id=userenv('sessionid') and rownum<2;
		 commit;

	End;
   -- delete from searchtbl;
    --insert into searchtbl values(pextra1);commit;

    if pextra1 is not null then
       vrec:=vrec||' order by '||pextra1;
       insert into temp_col_ins1 (sqno,col_name,upd_str,session_id) values (1234,'',pcond_colname||'#'||pcond_colval||'#'||vrec,userenv('sessionid'));
    else
       vrec:=vrec||' order by rowid ';
    end if;
   -- insert into searchtbl values(vrec);commit;

    --insert into temp_col_ins1 values (vrec);
    insert into temp_col_ins1 (sqno,col_name,upd_str,session_id) values (9999,'',pcond_colname||'#'||pcond_colval||'#'||vrec,userenv('sessionid'));
	open p_accounts for vrec;
      dbg(vrec);
	--delete from temp_col_ins where session_id=userenv('sessionid');
	commit;
End variable_execute_stmt;

--var a refcursor;
--exec CIR_DYNAMIC_DML.variable_order('','','','','ABC_CHARGE_MAST','CHG_CODE','ASC','','','',:A);

procedure variable_order(
 pcomp_code 	in varchar2,
 pcomp_val 		in varchar2,
 punit_code 	in varchar2,
 punit_val 		in varchar2,
 ptable_name 	in varchar2,
 pcolname 		in varchar2,
 porder 		in varchar2,
 pdateformat 	in varchar2,
 pextra1 		in varchar2,
 pextra2 		in varchar2,
 p_accounts 	out t_accounts) as
Begin


   if punit_code is null and pcomp_code is not null then
      open p_accounts for ' select * from '||ptable_name||' where '||pcomp_code||'='||''''||pcomp_val||''''||' order by '||pcolname||' '||porder;
   elsif pcomp_code is null and punit_code is not null then
      open p_accounts for ' select * from '||ptable_name||' where '||punit_code||'='||''''||punit_val||''''||' order by '||pcolname||' '||porder;
   elsif pcomp_code is null and punit_code is null then
      open p_accounts for ' select * from '||ptable_name||' order by '||pcolname||' '||porder;
   else
   	  open p_accounts for ' select * from '||ptable_name||' where '||pcomp_code||'='||''''||pcomp_val||''''||' and '||punit_code||'='||''''||punit_val||''''||' order by '||pcolname||' '||porder;
   end if;
End variable_order;

PROCEDURE variable_insert_stmt(
    ptable_name     in varchar2,
    pcolname        in varchar2,
    pcolvalue       in varchar2,
    pdelimiter      in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,
    p_error_text    out varchar2) as

    pstmt_str   varchar2(4000);
    v_sess_id   number;
cursor cur_stmt is
	select * from temp_col_ins  where session_id=v_sess_id order by sqno;
	rec_stmt cur_stmt%rowtype;
/*cursor cur_upd_stmt is
	select * from temp_col_ins  where nvl(upd_flag,'N')='I' and session_id=v_sess_id;
	rec_upd_stmt cur_upd_stmt%rowtype;*/
	vlength 	number(5);
	vcolval 	varchar2(4000);
	vrunval 	varchar2(1);
	vcol_name 	varchar2(100);
	vno 		number(5);
	vrec 		varchar2(4000);
	vrec_upd 	varchar2(4000);
	vformat 	varchar2(20);
	v_col_exists number(5);
Begin
	--insert into test1(vstring) values (pcolname||'33333'||pcolvalue);commit;
    Begin
		select userenv('sessionid') into v_sess_id from dual;
		delete from temp_col_ins where session_id=v_sess_id;
		vlength	:=null;	vcolval:=null;	vrunval:=null;	vcol_name:=null;vno:=null;

		vcolval	:=replace(pcolname,pdelimiter,',');
		vlength	:=length(vcolval);
		vno			:=1;

		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  	vcol_name:=vcol_name||vrunval;
		  else
            --insert into test1(vstring2) values (vno||','||upper(ltrim(rtrim(vcol_name)))||','||v_sess_id);
            --commit;
		  	insert into temp_col_ins (sqno,col_name,session_id) values (vno,upper(ltrim(rtrim(vcol_name))),v_sess_id);
		  	vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;
		/*select count(*) into v_col_exists from col where tname=upper(ltrim(rtrim(ptable_name))) and
				cname=upper(ltrim(rtrim(vcol_name)));*/
		select count(*) into v_col_exists from temp_col_ins where session_id=v_sess_id and
			col_name=upper(ltrim(rtrim(vcol_name)));
		if nvl(v_col_exists,0)=0 then
			insert into temp_col_ins(sqno,col_name,session_id) values (vno,upper(vcol_name),v_sess_id);
		end if;
		commit;
		vlength:=null;	vcolval:=null; 	vrunval:=null;	vcol_name:=null;	vno:=null;
		if instr(pcolvalue,',')>0 or instr(pcolvalue,'''')>0 then
		   vcolval:=replace(pcolvalue,',','~~~');
        else
			 vcolval:=pcolvalue;
		end if;
		vcolval:=replace(vcolval,pdelimiter,',');
		vlength:=length(vcolval);
		vno:=1;
		for i in 1.. vlength loop
		  vrunval			:=substr(vcolval,i,1);
		  if vrunval	!=',' then
		  	vcol_name	:=vcol_name||vrunval;
		  else
		  	vcol_name	:=replace(vcol_name,'~~~',',');
		    update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=v_sess_id;
		  	vno:=vno+1;
		    vcol_name:='';
		  end if;
		end loop;
		if vcol_name is not null then
			update temp_col_ins set col_value=vcol_name where sqno=vno and session_id=v_sess_id;
		end if;
		update temp_col_ins set col_data_type=(select coltype from col where tname = upper(ltrim(rtrim(ptable_name))) and cname = upper(ltrim(rtrim(temp_col_ins.col_name))))
			where session_id=v_sess_id;
		commit;
		vrec:='insert into '||ptable_name||'('||replace(pcolname,pdelimiter,',')||') values ( ';

		--select "date_format" into vformat from preferrences;
          vformat:=pdateformat;
		open cur_stmt;
		  loop
		    fetch cur_stmt into rec_stmt;
		       exit when cur_stmt%notfound;
		       if rec_stmt.col_data_type='DATE' then
		       	 vrec:=vrec||'to_date('||rec_stmt.col_value||','||''''||vformat||''''||')'||',';
		       else
		       	 vrec:=vrec||rec_stmt.col_value||',';
		       end if;
		  end loop;
		vrec		:=substr(vrec,1,length(vrec)-1)||')';
		vlength	:=null;
		vcolval	:=null;
		vrunval	:=null;
		vcol_name:=null;
		vno:=null;
		/*vcolval:=replace(pcond_colname,pdelimiter,',');
		vlength:=length(vcolval);
		for i in 1.. vlength loop
		  vrunval:=substr(vcolval,i,1);
		  if vrunval!=',' then
		  		 vcol_name:=vcol_name||vrunval;
		  else
		  	   update temp_col_ins set upd_flag='I' where col_name=vcol_name and session_id=userenv('sessionid');
		       vcol_name:='';
		  end if;
		end loop;
		commit;
	 close cur_stmt; */
     update temp_col_ins set upd_str=vrec where session_id=v_sess_id and rownum<2;
	 --update temp_col_ins1 set upd_str=vrec where session_id=v_sess_id and rownum<2;
     --insert into test1(vstring) values (pcolname||'33333'||vrec);
     commit;

	End;
	execute immediate vrec;
	commit;
	 --delete from temp_col_ins where session_id=userenv('sessionid');
	commit;
    exception
       when others then
            p_error_text := 'Error:'||sqlerrm;
End variable_insert_stmt;

END Cir_Dynamic_DML;
/





**********mimoh 24oct2011***********************0005364**********************************end***************************













************************************issue no 4763********************************************************
/////////////////////////////////////description//////////////////////////////////////////////////////////
CREATE OR REPLACE PACKAGE HT18JULY.cir_rep_supply IS
  type t_accounts is ref cursor;
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl                 in varchar2,
     pmainedtn             in varchar2,
     pedtn                 in varchar2,
     proute                in varchar2,
     pfrom_supdate         in varchar2,
     ptill_supdate         in varchar2,
     pdateformat         in varchar2,
     pextra1             in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts);

   procedure cir_rep_supply_po(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

  procedure cir_rep_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

  procedure cir_rep_dist_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);  
  
  procedure cir_rep_taluka_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);  
     
  procedure cir_rep_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

  procedure cir_rep_dist_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);     

  procedure cir_rep_taluka_day_daybook(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pedtn              in varchar2,
     pcitycd            in varchar2,
     pstatecd           in varchar2,
     pmonth             in varchar2,
     pyear              in number,
     pday               in varchar2,
     pdateformat        in varchar2,
     pbranch            in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pagtype            in varchar2,
     pagclass           in varchar2,
     pagcode            in varchar2,
     pdpcode            in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);
     
  procedure cir_rep_route_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

    procedure cir_rep_dist_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
     
    procedure cir_rep_taluka_challan(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pperiod            in number,
     prmode             in varchar2,
     psupdate           in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

     procedure cir_route_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);
     
     procedure cir_dist_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

     procedure cir_taluka_wise_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

     procedure cir_dist_taluka_wise_sup(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts);
     
    procedure cir_supply_comp(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     psupdate           in varchar2,
     psupdate1          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

    procedure cir_route_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_dist_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pdist              in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_taluka_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     ptaluka            in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_edition_supply_variance_p(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppublication       in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pfirstdate         in varchar2,
     pseconddate        in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts);

    procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts);

     procedure cir_dist_taluka_publ_wise(
     pcompcode          in varchar2,
     punitcode          in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pmainedtn          in varchar2,
     pedtncode          in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pagtypecode        in varchar2,
     pagclasscode       in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
        
procedure cir_datewise_resale(
     pcompcode          in varchar2,
     punitcode          in varchar2,
     pbrancode          in varchar2,
     ppublcode          in varchar2,
     pmainedtn          in varchar2,
     pedtncode          in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pagtypecode        in varchar2,
     pagclasscode       in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);              
END;
/


--------------------------------------------body------------------------------------------------------
CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_rep_supply IS
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts)
     As

     vfrom_supdate    date;
     vtill_supdate    date;
     cursor cur_sup_type is
         select 'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) "'||sup_ty_name||'",' vty,
         'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) +' vty_sum
      from cir_supply_type_mast
      where comp_code=pcomp_code /*and sup_ty_code in(select distinct sup_type_code from cir_dbksup
      where comp_code=pcomp_code and unit_code=punit_code and
                  ((publ=ppubl) or (ppubl is null)) and ((edtn=pedtn) or (pedtn is null)) and
                  supdate between vfrom_supdate and vtill_supdate)*/
      order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar         varchar2(4000);
     vvar_sum    varchar2(4000);
     vquery     varchar2(4000);
     vquery1     varchar2(4000);
     vquery2     varchar2(4000);
     vquery3     varchar2(4000);
     vquery4     varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);commit;

    vquery:=' select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,cir_get_edtn_name(comp_code,edtn) edtn_name,route_code,cir_get_route_name(comp_code,unit_code,route_code) route_name,agcd "AGENCY CODE",dpcd "AGENCY SUBCODE",
    substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",(select cir_get_city(m.comp_code,m.city_code) city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY NAME",
    (select nvl(CIR_GET_NAME.CIR_CITY(m.comp_code,m.city_code,2,'||''''||pdateformat||''''||','''',''''),''NA'') city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY ONAME",/*supdate,*/'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||') and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
               edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/ order by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/';
     ---insert into test1(vstring) values ('1'||vquery);commit;
      open p_accounts for vquery;

      vquery2:=' select comp_code,unit_code,publ,edtn,route_code, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
                edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code
                order by comp_code,unit_code,publ,edtn,route_code';
        --insert into test1(vstring) values ('22'||vquery2);commit;
      open p_accounts2 for vquery2;

      vquery3:=' select comp_code,unit_code,publ,edtn, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn
                order by comp_code,unit_code,publ,edtn';
      open p_accounts3 for vquery3;

      vquery4:=' select comp_code,unit_code,publ, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ
                order by comp_code,unit_code,publ';
      open p_accounts4 for vquery4;

      vquery1:=' select comp_code,unit_code,'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code';
        --insert into test1(vstring) values ('2'||vquery);commit;

     open p_accounts1 for vquery1;
  End cir_rep_supply1;

procedure cir_rep_supply_po(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts) as

     /*cursor cur_sup_type is
         /*select distinct 'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) "'||sup_ty_name||'",' vty,
             'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) +' vty_sum
             from cir_supply_type_mast s,cir_dbksup d
             where s.comp_code=d.comp_code and s.comp_code=pcomp_code and d.sup_type_code=s.sup_ty_code and
             d.unit_code=punit_code and (d.publ=ppubl or ppubl is null) and
             d.supdate=to_date(psupdate,''''||pdateformat||'''') order by sup_seq_no;*/
         /*select distinct s.sup_ty_code vty,s.sup_ty_name vty_name,s.sup_seq_no sup_seq_no
             from cir_supply_type_mast s,cir_dbksup d
             where s.comp_code=d.comp_code and s.comp_code=pcomp_code and d.sup_type_code=s.sup_ty_code and
             d.unit_code=punit_code and (d.publ=ppubl or ppubl is null) and
             d.supdate=to_date(psupdate,''''||pdateformat||'''') order by s.sup_seq_no;
     rec_sup_type cur_sup_type%rowtype;

     vvar       varchar2(4000);
     vvar1      varchar2(4000);
     vvar_sum   varchar2(4000);
     vquery     varchar2(4000);
     vquery1    varchar2(4000);
  Begin
    delete from test1;
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
        exit when cur_sup_type%notfound;
        if vvar is null then
            vvar    :=' case when d.sup_type_code='||''''||rec_sup_type.vty||''''||' then d.sup_copy else 0 end '||'"'||rec_sup_type.vty_name||'"';
            vvar1   :='sum("'||rec_sup_type.vty_name||'")'||' as "'||rec_sup_type.vty_name||'"';
            vvar_sum:=' sum('||'"'||rec_sup_type.vty_name||'"';
        else
            vvar    :=vvar||','||' case when d.sup_type_code='||''''||rec_sup_type.vty||''''||' then d.sup_copy else 0 end '||'"'||rec_sup_type.vty_name||'"';
            vvar1   :=vvar1||','||'sum("'||rec_sup_type.vty_name||'")'||' as "'||rec_sup_type.vty_name||'"';
            vvar_sum:=vvar_sum||'+'||'"'||rec_sup_type.vty_name||'"';
        end if;
    end loop;
    close cur_sup_type;

    --vvar    :=substr(vvar,1,length(vvar)-1);
    --vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    vvar_sum:=vvar_sum||') '||' as "TOTAL"';
    --insert into test1(vstring,vstring2) values ('PO Report ',vvar1||','||vvar_sum);commit;

    vquery:= 'select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,x.edtn edtn,
            x.edtn_name "EDITION NAME",x.supdate supdate,'||vvar1||','||vvar_sum||',x.mainedtn_name mainedtn_name,
            x.edtn_seqno edtn_seqno,x.main_edtn_seqno main_edtn_seqno FROM
            (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,
            cir_get_edtn_name(d.comp_code,d.edtn) edtn_name,to_char(d.supdate'||','||''''||pdateformat||''''||') supdate, '||vvar||',
            cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,d.edtn) edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno
            from cir_dbksup d,cir_edtn_mast e
            where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.unit_code='||''''||punit_code||''''||' and d.unit_code=e.unit_code and
            ((d.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and d.publ=e.publ and
            d.supdate='|| 'to_date('||''''||psupdate||''''||','||''''||pdateformat||''''||') and d.edtn=e.edtn) x
            group by x.comp_code,x.unit_code ,x.publ,x.publ_name,x.edtn,
            x.edtn_name ,x.supdate,x.mainedtn_name,x.edtn_seqno,x.main_edtn_seqno
            order by x.comp_code,x.unit_code,x.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,x.edtn,x.supdate';

        --insert into test1(vstring,vstring2) values ('PO Report vquery',vquery);commit;

    open p_accounts for vquery;


    vquery1:= 'select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,'||vvar1||','||vvar_sum||' FROM
            (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,
            cir_get_edtn_name(d.comp_code,d.edtn) edtn_name,to_char(d.supdate'||','||''''||pdateformat||''''||') supdate, '||vvar||',
            cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,d.edtn) edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno
            from cir_dbksup d,cir_edtn_mast e
            where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.unit_code='||''''||punit_code||''''||' and d.unit_code=e.unit_code and
            ((d.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and d.publ=e.publ and
            d.supdate='|| 'to_date('||''''||psupdate||''''||','||''''||pdateformat||''''||') and d.edtn=e.edtn) x
            group by x.comp_code,x.unit_code ,x.publ,x.publ_name
            order by x.comp_code,x.unit_code,x.publ,x.publ_name';

        --insert into test1(vstring,vstring2) values ('PO Report vquery1',vquery1);commit;
    open p_accounts1 for vquery1;*/
v_date             date;
     cursor cur_sup_type is
        select distinct 'sum(decode(d.agname,'||''''||agname||''''||',d.supply_copy,0)) "'||agname||'",' vty,
            'sum(decode(d.agname,'||''''||agname||''''||',d.supply_copy,0)) +' vty_sum,rec_amt sup_seq_no,agname supply_type_name
            from cir_temp_bill_collection
            where cur_sessionid=userenv('sessionid') 
        order by rec_amt,agname;
             
     rec_sup_type cur_sup_type%rowtype;

    cursor cur_dbk is
            select x.comp_code comp_code,x.unit_code unit_code,x.supdate supdate,x.publ_name publ_name,x.mainedtn_name mainedtn_name,
            x.main_edtn_seqno main_edtn_seqno,x.edtn_name||to_char(x.sup_rate,'990.99') edtn_name,x.edtn_seqno edtn_seqno,x.sup_ty_name sup_ty_name,
            x.sup_seqno sup_seqno,x.sup_rate sup_rate,x.supply_copy supply_copy,x.supl_name supl_name,x.pgno pgno from
            (select d.comp_code comp_code,d.unit_code unit_code,d.supdate supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seqno,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seqno,d.sup_rate sup_rate, sum(d.sup_copy) supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit_code,e.edtn,d.supdate,pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(d.supdate,'DY')='SUN' then min(nvl(e.main_issue_pgno_sun,0)+nvl(e.pullout_pgno_sun,0))
                when to_char(d.supdate,'DY')='MON' then min(nvl(e.main_issue_pgno_mon,0)+nvl(e.pullout_pgno_mon,0))
                when to_char(d.supdate,'DY')='TUE' then min(nvl(e.main_issue_pgno_tue,0)+nvl(e.pullout_pgno_tue,0))
                when to_char(d.supdate,'DY')='WED' then min(nvl(e.main_issue_pgno_wed,0)+nvl(e.pullout_pgno_wed,0))
                when to_char(d.supdate,'DY')='THU' then min(nvl(e.main_issue_pgno_thu,0)+nvl(e.pullout_pgno_thu,0))
                when to_char(d.supdate,'DY')='FRI' then min(nvl(e.main_issue_pgno_fri,0)+nvl(e.pullout_pgno_fri,0)) else min(nvl(e.main_issue_pgno_sat,0)+nvl(e.pullout_pgno_sat,0)) end pgno
            from cir_dbksup d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit_code=e.unit_code and (d.unit_code=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supdate =v_date and d.sup_type_code=t.sup_ty_code and upper(pextra1)!='U'
            group by d.comp_code,d.unit_code,d.supdate,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no,d.sup_rate
            union
            select d.comp_code comp_code,d.unit unit_code,v_date supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seqno,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seqno,
            cir_get_edtn_rate(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),'dd/mm/yyyy') sup_rate, 
            case when to_char(v_date,'DY')='SUN' then sum(nvl(d.base_supply,0)+nvl(d.supply_sun,0))
                 when to_char(v_date,'DY')='MON' then sum(nvl(d.base_supply,0)+nvl(d.supply_mon,0))
                 when to_char(v_date,'DY')='TUE' then sum(nvl(d.base_supply,0)+nvl(d.supply_tue,0))
                 when to_char(v_date,'DY')='WED' then sum(nvl(d.base_supply,0)+nvl(d.supply_wed,0))
                 when to_char(v_date,'DY')='THU' then sum(nvl(d.base_supply,0)+nvl(d.supply_thu,0))
                 when to_char(v_date,'DY')='FRI' then sum(nvl(d.base_supply,0)+nvl(d.supply_fri,0))
            else sum(nvl(d.base_supply,0)+nvl(d.supply_sat,0)) end supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit,e.edtn,v_date,pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(v_date,'DY')='SUN' then min(nvl(e.main_issue_pgno_sun,0)+nvl(e.pullout_pgno_sun,0))
                when to_char(v_date,'DY')='MON' then min(nvl(e.main_issue_pgno_mon,0)+nvl(e.pullout_pgno_mon,0))
                when to_char(v_date,'DY')='TUE' then min(nvl(e.main_issue_pgno_tue,0)+nvl(e.pullout_pgno_tue,0))
                when to_char(v_date,'DY')='WED' then min(nvl(e.main_issue_pgno_wed,0)+nvl(e.pullout_pgno_wed,0))
                when to_char(v_date,'DY')='THU' then min(nvl(e.main_issue_pgno_thu,0)+nvl(e.pullout_pgno_thu,0))
                when to_char(v_date,'DY')='FRI' then min(nvl(e.main_issue_pgno_fri,0)+nvl(e.pullout_pgno_fri,0)) else min(nvl(e.main_issue_pgno_sat,0)+nvl(e.pullout_pgno_sat,0)) end pgno
            from cir_supply d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit=e.unit_code and (d.unit=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supply_flag='Y' and d.supply_type_code=t.sup_ty_code and upper(pextra1)='U'
            group by d.comp_code,d.unit,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no) x
            order by comp_code,unit_code,supdate,publ_name,main_edtn_seqno,mainedtn_name,edtn_seqno,edtn_name,sup_seqno,sup_ty_name;
        
        rec_dbk cur_dbk%rowtype;
        
        cursor cur_main_edtn is
            select comp_code,unit_code,agcd,dpcd
            from cir_ledger_report where sess_id=userenv('sessionid') and remarks is null
            group by comp_code,unit_code,agcd,dpcd
            order by comp_code,unit_code,agcd,dpcd;
                    
        rec_main_edtn cur_main_edtn%rowtype;                                    
        
        cursor cur_supl is
            select chq_bank,sum(rec_seqno) sup_copy
            from cir_ledger_report where sess_id=userenv('sessionid') and comp_code=rec_main_edtn.comp_code and 
            unit_code=rec_main_edtn.unit_code and agcd=rec_main_edtn.agcd and dpcd=rec_main_edtn.dpcd and
            remarks is null
            group by chq_bank
            order by chq_bank;
                    
        rec_supl cur_supl%rowtype;        
    vvar        varchar2(4000);
    vvar_sum    varchar2(4000);
    vquery      varchar2(8000);
    v_count     number(5);
    vlength     number(7);
    vrunval     varchar2(8000);
    v_val       varchar2(800);
    v_name      varchar2(8000);
    vno         number:=0;
    v_remarks   varchar2(500);
  Begin
    if upper(pextra1)='U' then  
        v_date:=to_date(trunc(sysdate),''''||pdateformat||'''');
    else
        v_date:=to_date(psupdate,''''||pdateformat||'''');
    end if;    
    
    delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
    delete from cir_ledger_report where sess_id=userenv('sessionid');commit;
    --delete from test1;commit;
    open cur_dbk;
    loop
        fetch cur_dbk into rec_dbk;
        exit when cur_dbk%notfound;
        
        v_count:=nvl(v_count,0)+1;
        if rec_dbk.pgno=0 then
            rec_dbk.pgno:=null;
        end if;
        
        vlength :=null; v_val :=null; vrunval :=null; vno:=null;

        v_val   :=replace(rec_dbk.supl_name||'+','+',',');
        vlength :=length(v_val);
        vno:=1;

        for i in 1.. vlength loop
        vrunval:=substr(v_val,i,1);
        if vrunval!=',' then
            v_name:=v_name||vrunval;
        else
            insert into cir_ledger_report(comp_code, unit_code, recptdt,agcd, dpcd, recptno, chq_bank, rec_seqno,sess_id)
                    values (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,v_name,rec_dbk.supply_copy,userenv('sessionid'));
            vno:=vno+1;
            v_name:='';
        end if;
        end loop;
        
        insert into cir_temp_bill_collection
        (comp_code, unit_code, billdt, publ_code, agcd, dpcd, supply_copy, gross_amt, 
        cur_sessionid, agname,return_copy,remarks,dn_amt,cn_amt,rec_amt)
        values
        (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,rec_dbk.supply_copy,rec_dbk.sup_rate,
        userenv('sessionid'),rec_dbk.sup_ty_name,rec_dbk.pgno,rec_dbk.supl_name,rec_dbk.main_edtn_seqno,rec_dbk.edtn_seqno,rec_dbk.sup_seqno);
    end loop;
    close cur_dbk;
    
    open cur_main_edtn;
    loop
        fetch cur_main_edtn into rec_main_edtn;
        exit when cur_main_edtn%notfound;
         
        open cur_supl;
        loop
            fetch cur_supl into rec_supl;
            exit when cur_supl%notfound;

            if v_remarks is null then
                v_remarks:=rec_supl.chq_bank||' # '||rec_supl.sup_copy;
            else
                v_remarks:=v_remarks||','||rec_supl.chq_bank||' # '||rec_supl.sup_copy;
            end if;
            if rec_supl.chq_bank is null then
                v_remarks:=null;
            end if;             
        end loop;
        close cur_supl;

        insert into cir_ledger_report(comp_code, unit_code, recptdt,agcd, dpcd, remarks,sess_id)
                values (rec_main_edtn.comp_code,rec_main_edtn.unit_code,v_date,rec_main_edtn.agcd,rec_main_edtn.dpcd,v_remarks,userenv('sessionid'));        
       v_remarks:=null;
    end loop;
    close cur_main_edtn;    
    delete from cir_ledger_report where sess_id=userenv('sessionid') and remarks is null;
    delete from test1;commit;
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
        exit when cur_sup_type%notfound;

        if vvar is null then
            vvar       :='case when d.agname='||''''||rec_sup_type.supply_type_name||''''||' then d.supply_copy else 0 end "'||rec_sup_type.supply_type_name||'"';
            vvar_sum   :='sum("'||rec_sup_type.supply_type_name||'")'||' "'||rec_sup_type.supply_type_name||'"';
        else
            vvar       :=vvar||','||'case when d.agname='||''''||rec_sup_type.supply_type_name||''''||' then d.supply_copy else 0 end "'||rec_sup_type.supply_type_name||'"';
            vvar_sum   :=vvar_sum||','||'sum("'||rec_sup_type.supply_type_name||'")'||' "'||rec_sup_type.supply_type_name||'"';
        end if;            
    end loop;
    close cur_sup_type;

    --insert into test1(vstring) values (pextra1||' '||vquery);
    if vvar is null then            
        vquery:=' select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,x.edtn edtn,x.edtn_name "EDITION NAME",
                x.supdate supdate, sum(x.supply_copy) TOTAL,x.mainedtn_name mainedtn_name,x.supl_name supl_name,x.main_seqno main_seqno,x.edtn_seqno edtn_seqno,x.return_copy page_no,x.supl_detail supl_detail
                from
                (select d.comp_code comp_code,d.unit_code unit_code,d.publ_code publ,d.publ_code publ_name,d.dpcd edtn,d.dpcd edtn_name,
                to_char(d.billdt'||','||''''||pdateformat||''''||') supdate,d.agcd mainedtn_name,d.remarks supl_name,d.dn_amt main_seqno,d.cn_amt edtn_seqno,d.supply_copy supply_copy,
                (select remarks from cir_ledger_report where sess_id=userenv(''sessionid'') and remarks is not null and comp_code=d.comp_code and unit_code=d.unit_code and agcd=d.publ_code and dpcd=d.agcd and recptdt=d.billdt) supl_detail,d.RETURN_COPY return_copy from cir_temp_bill_collection d
                where d.cur_sessionid=userenv(''sessionid'')) x  group by x.comp_code,x.unit_code,x.publ,x.publ_name,x.edtn,x.edtn_name,x.supdate,x.mainedtn_name,x.supl_name,x.main_seqno,x.edtn_seqno,x.return_copy,x.supl_detail
                order by comp_code,unit_code,publ_name,main_seqno,edtn_seqno';                
    else
        vquery:=' select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,x.edtn edtn,x.edtn_name "EDITION NAME",
                x.supdate supdate,'||vvar_sum||', sum(x.supply_copy) TOTAL,x.mainedtn_name mainedtn_name,x.supl_name supl_name,x.main_seqno main_seqno,x.edtn_seqno edtn_seqno,x.return_copy page_no,x.supl_detail supl_detail
                from
                (select d.comp_code comp_code,d.unit_code unit_code,d.publ_code publ,d.publ_code publ_name,d.dpcd edtn,d.dpcd edtn_name,
                to_char(d.billdt'||','||''''||pdateformat||''''||') supdate,'||vvar||',d.agcd mainedtn_name,d.remarks supl_name,d.dn_amt main_seqno,d.cn_amt edtn_seqno,d.supply_copy supply_copy,
                (select remarks from cir_ledger_report where sess_id=userenv(''sessionid'') and remarks is not null and comp_code=d.comp_code and unit_code=d.unit_code and agcd=d.publ_code and dpcd=d.agcd and recptdt=d.billdt) supl_detail,d.RETURN_COPY return_copy from cir_temp_bill_collection d
                where d.cur_sessionid=userenv(''sessionid'')) x  group by x.comp_code,x.unit_code,x.publ,x.publ_name,x.edtn,x.edtn_name,x.supdate,x.mainedtn_name,x.supl_name,x.main_seqno,x.edtn_seqno,x.return_copy,x.supl_detail
                order by comp_code,unit_code,publ_name,main_seqno,edtn_seqno';
    end if;                    
    --insert into test1(vstring) values ('1 pextra1 '||vquery);commit;

    open p_accounts for vquery;
    if vvar is null then
        vquery:=' select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,
                 sum(x.supply_copy) TOTAL from
                (select d.comp_code comp_code,d.unit_code unit_code,d.publ_code publ,d.publ_code publ_name,d.dpcd edtn,d.dpcd edtn_name,
                to_char(d.billdt'||','||''''||pdateformat||''''||') supdate,d.agcd mainedtn_name,d.remarks supl_name,d.dn_amt main_seqno,d.cn_amt edtn_seqno,d.supply_copy supply_copy from cir_temp_bill_collection d
                where d.cur_sessionid=userenv(''sessionid'')) x group by x.comp_code,x.unit_code,x.publ,x.publ_name
                order by comp_code,unit_code,publ_name';                
    else
        vquery:=' select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,
                '||vvar_sum||', sum(x.supply_copy) TOTAL from
                (select d.comp_code comp_code,d.unit_code unit_code,d.publ_code publ,d.publ_code publ_name,d.dpcd edtn,d.dpcd edtn_name,
                to_char(d.billdt'||','||''''||pdateformat||''''||') supdate,'||vvar||',d.agcd mainedtn_name,d.remarks supl_name,d.dn_amt main_seqno,d.cn_amt edtn_seqno,d.supply_copy supply_copy from cir_temp_bill_collection d
                where d.cur_sessionid=userenv(''sessionid'')) x group by x.comp_code,x.unit_code,x.publ,x.publ_name
                order by comp_code,unit_code,publ_name';    
    end if;
    
    --insert into test1(vstring) values ('2 pextra1 '||vquery);commit;
    --delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
    --delete from cir_ledger_report where sess_id=userenv('sessionid');commit;
    open p_accounts1 for vquery;    

  End cir_rep_supply_po;

  procedure cir_rep_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",
       nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
            nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND
        A.PUBL=PPUBL AND A.EDTN=NVL(PEDTN,A.EDTN) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND 
        A.SUPDATE >= VFRDT AND A.SUPDATE <=VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,/*A.EDTN,*/B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<=VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_daybook;

  procedure cir_rep_dist_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt            date;
     vtodt            date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(DIST_CODE,'NA') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",
       STATE_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,'NA') DIST_CODE,nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",
       nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",STATE_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT  AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_dist_daybook;

  procedure cir_rep_taluka_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",
       STATE_CODE "STATE CODE",
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",
       nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",STATE_CODE "STATE CODE",
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_taluka_daybook;

  procedure cir_rep_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(12000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE';
insert into test1(vstring,vstring2) values('3 '||vquery3,VQUERY2);commit;
       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
        
insert into test1(vstring,vstring2) values('4 '||vquery3,VQUERY2);commit;        
       open p_accounts2 for vquery3||vquery2;

  End cir_rep_day_daybook;

  procedure cir_rep_dist_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
    substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",
       COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='  FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_dist_day_daybook;

  procedure cir_rep_taluka_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_taluka_day_daybook;

  Procedure cir_rep_route_challan(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     pperiod        in number,
     prmode         in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts)
  As
      vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vquery     varchar2(4000);
  Begin
    --insert into test1(vstring,vstring2) values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');
    --insert into test1(vstring,vstring2) values('2222 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
    --vvar:=substr(vvar,1,length(vvar)-1);
    --insert into test1(vstring,vstring2) values('1 '||vvar,' vsupdate '||vsupdate);commit;

        if vvar is null then
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        else
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('2 '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_route_challan;

procedure cir_rep_dist_challan(
   pcomp_code       in varchar2,
   punit_code       in varchar2,
   pperiod          in number,
   prmode           in varchar2,
   psupdate         in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2,
   p_accounts       out t_accounts)
   As
     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn_1--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
Begin
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');

    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
        if vvar is null then
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        else
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('DIST '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_dist_challan;

    procedure cir_rep_taluka_challan(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        pperiod        in number,
        prmode         in varchar2,
        psupdate       in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     As

     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
    Begin
        vsupdate:=to_date(psupdate,''''||pdateformat||'''');

        open cur_edtn;
        loop
            fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
                    if vvar is null then
                  vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    else
                        vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    end if;
        end loop;
        close cur_edtn;
        if vvar is null then
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        else
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        end if;
        --insert into tes t1(vstring,vstring2) values('TALUKA '||vquery,null);commit;
        open p_accounts for vquery;

    End cir_rep_taluka_challan;

    procedure cir_route_wise_supply(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        ppubl          in varchar2,
        pmainedtn      in varchar2,
        pedtn          in varchar2,
        proute         in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts,
        p_accounts1    out t_accounts,
        p_accounts2    out t_accounts,
        p_accounts3    out t_accounts)
     As
        vfrom_supdate    date;
        vtill_supdate    date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno,
               cir_get_supply_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,ppubl,pedtn,cir_dbksup.agcd,cir_dbksup.dpcd) supply_seqno,
               cir_get_name.cir_route(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,2,pdateformat,null,null) route_oth_name
               from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,
                           cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code,supply_seqno ,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               sum(sup_copy),cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno,
               cir_get_name.cir_route(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,2,pdateformat,null,null) route_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                       order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
    End cir_route_wise_supply;

    procedure cir_dist_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vfrom_supdate  date;
     vtill_supdate  date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.dist_code,cir_agmast.state_code,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy),
               cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_agmast.state_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
  End cir_dist_wise_supply;

    procedure cir_taluka_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vsupdate date;
     vsupdate1 date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_name.cir_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka,2,pdateformat,null,null) taluka_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               sum(sup_copy),
               cir_get_name.cir_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka,2,pdateformat,null,null) taluka_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.tehsil_taluka
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_taluka_wise_supply;


    procedure cir_dist_taluka_wise_sup(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts,
     p_accounts4    out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name,
               cir_get_name.cir_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka,2,pdateformat,null,null) taluka_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
        cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
        sum(sup_copy),
        cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name,
        cir_get_name.cir_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka,2,pdateformat,null,null) taluka_oth_name from cir_dbksup,cir_agmast
        where cir_dbksup.comp_code = cir_agmast.comp_code and
        cir_dbksup.unit_code = cir_agmast.unit and
        cir_dbksup.agcd = cir_agmast.agcd and
        cir_dbksup.dpcd = cir_agmast.dpcd and
        cir_dbksup.comp_code = pcomp_code and
        cir_dbksup.unit_code = punit_code and
        cir_dbksup.publ = ppubl and
        ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
        cir_dbksup.supdate between vsupdate and vsupdate1 and
        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
        group by cir_dbksup.comp_code,cir_dbksup.unit_code,
        cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka
        order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
               cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy),
               cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name
                from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.state_code,cir_agmast.dist_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts3 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts4 for
        select cir_dbksup.comp_code comp_code, sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_dist_taluka_wise_sup;

     procedure cir_supply_comp(
         pcomp_code     in varchar2,
         punit_code     in varchar2,
         ppublication   in varchar2,
         psupdate       in varchar2,
         psupdate1      in varchar2,
         pdateformat    in varchar2,
         pextra1        in varchar2,
         pextra2        in varchar2,
         p_accounts     out t_accounts,
         p_accounts1    out t_accounts,
         p_accounts2    out t_accounts,
         p_accounts3    out t_accounts)
     as
        vsupdate     date;
        vsupdate1    date;
     begin
        vsupdate    :=to_date(psupdate,''''||pdateformat||'''');
        vsupdate1   :=to_date(psupdate1,''''||pdateformat||'''');
        --insert into test1(vstring,vstring2) values(pcomp_code||','||punit_code||','||ppublication,psupdate||','||pdateformat||','||pextra1||','||','||pextra2); commit;
        open p_accounts for
             select comp_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"= unit_code) unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,edtn_name,edtn_name_oth_lang,
             main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             prev_sup,curr_sup,nvl(curr_sup,0)-nvl(prev_sup,0) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno,cir_get_edtn_seqno(comp_code,edtn) edtn_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               order by publ_seqno,publ_name,unit_code,mainedtn_seqno,main_edtn_name,edtn_seqno,edtn_name;

        open p_accounts1 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno
             from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code,main_edtn
                               order by publ_seqno,publ_name,unit_code,mainedtn_seqno,main_edtn_name;
        open p_accounts2 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code
                               order by publ_seqno,publ_name,unit_code;

             open p_accounts3 for
             select comp_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code=cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ
                               order by publ_seqno,publ_name;

     End cir_supply_comp;

    procedure cir_route_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    proute              in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,--it is use for finalised or unfinalised
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate     date;
     vseconddate    date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(base_supply),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        else
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and cir_supply.unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd                 =   a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn                     =      a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        else
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code                =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')                =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit     =   b.unit and cir_supply.agcd          =     a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          =     a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
                open p_accounts2 for----comp wise total
                     select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                     decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                     (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   pcomp_code and unit_code =   punit_code and
                                             publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                             supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                             (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and unit_code =    punit_code and
                                             publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                             supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                                 where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code;
        end if;

   End cir_route_supply_variance_p;

    procedure cir_dist_supply_variance_p(
        pcomp_code          in varchar2,
        punit_code          in varchar2,
        ppublication        in varchar2,
        pmainedtn           in varchar2,
        pedtn               in varchar2,
        pdist               in varchar2,
        pfirstdate          in varchar2,
        pseconddate         in varchar2,
        pdateformat         in varchar2,
        pextra1             in varchar2,--it is use for finalised or unfinalised
        pextra2             in varchar2,--it is used for supply type
        p_accounts          out t_accounts,
        p_accounts1         out t_accounts,
        p_accounts2         out t_accounts)
   As
     vfirstdate             date;
     vseconddate            date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                     cir_supply.agcd  =    a.agcd and
                                     cir_supply.dpcd  =    a.dpcd and
                                     cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                     (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         supdate      =    vseconddate and
                                     cir_dbksup.agcd  =    a.agcd and
                                     cir_dbksup.dpcd  =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                   order by comp_code,dist_code,ag_name;
        else
                open p_accounts for
                     select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                     cir_get_city(comp_code,city_code) "CITY NAME",
                     dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                            (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                       order by comp_code,dist_code,ag_name;            
        end if;
        
        if upper(pextra1)='U' then
        open p_accounts1 for----district wise total
             select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                          (select nvl(sum(sup_copy),0) from cir_supply
                               where comp_code    =    pcomp_code and
                                     unit    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     nvl(supply_flag,'N')=    'Y' and
                             cir_supply.agcd =    a.agcd and
                             cir_supply.dpcd =    a.dpcd and
                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     supdate        =    vseconddate and
                                 cir_dbksup.agcd                 =    a.agcd and
                                 cir_dbksup.dpcd                 =    a.dpcd and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                 (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_dist_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,dist_code,dist_name,dist_oname
                               order by comp_code,dist_code;
             else
                open p_accounts1 for----district wise total
                     select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ         =    ppublication and
                                             (edtn        =    pedtn or pedtn is null) and
                                             supdate      =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 
                                         where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,dist_code,dist_name,dist_oname
                                       order by comp_code,dist_code;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')      =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                         (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                         cir_dbksup.agcd                 =    a.agcd and
                         cir_dbksup.dpcd                 =    a.dpcd and
                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
            else
                open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                        cir_dbksup.agcd =    a.agcd and
                                        cir_dbksup.dpcd =    a.dpcd and
                                        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                        (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;

            end if;
   End cir_dist_supply_variance_p;

    procedure cir_taluka_supply_variance_p(
    pcomp_code       in varchar2,
    punit_code       in varchar2,
    ppublication     in varchar2,
    pmainedtn        in varchar2,
    pedtn            in varchar2,
    ptaluka          in varchar2,
    pfirstdate       in varchar2,
    pseconddate      in varchar2,
    pdateformat      in varchar2,
    pextra1          in varchar2,--it is use for finalised or unfinalised
    pextra2          in varchar2,--it is used for supply type
    p_accounts       out t_accounts,
    p_accounts1      out t_accounts,
    p_accounts2      out t_accounts)
   As
     vfirstdate      date;
     vseconddate     date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit    =    punit_code and
                                         cir_supply.publ    =    ppublication and
                                         (cir_supply.edtn   =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;
             else
                open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                            cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;             
             
             end if;
        if upper(pextra1)='U' then
            open p_accounts1 for----taluka wise total
                 select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit         =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                   order by comp_code,tehsil_taluka;
              else
                open p_accounts1 for----taluka wise total
                     select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                       order by comp_code,tehsil_taluka;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit        =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn         =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =    'Y' and
                                             cir_supply.agcd =    a.agcd and
                                             cir_supply.dpcd =    a.dpcd and
                                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
            open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
            (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ    =    ppublication and
                                     (edtn   =    pedtn or pedtn is null) and
                                     supdate =    vfirstdate and
                             cir_dbksup.agcd =    a.agcd and
                             cir_dbksup.dpcd =    a.dpcd and
                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn        =    pedtn or pedtn is null) and
                                     supdate      =    vseconddate and
                                     cir_dbksup.agcd                 =    a.agcd and
                                     cir_dbksup.dpcd                 =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;
        end if;
   End cir_taluka_supply_variance_p;

    procedure cir_edition_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate         date;
     vseconddate        date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate   :=to_date(pseconddate,''''||pdateformat||'''');
        open p_accounts for
             select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
             cir_get_city(comp_code,city_code) "CITY NAME",
             edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                         cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME",unit_code "UNIT CODE" from
                    (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                     c.station_code station_code,c.branch_code branch_code,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                    cir_dbksup.agcd =  a.agcd and
                                    cir_dbksup.dpcd =  a.dpcd and
                                    cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                 (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,edtn,edtn_name,edtn_name_oth_lang,station_code,branch_code
                               order by comp_code,unit_code,edtn_name,ag_name;

        open p_accounts1 for----Edition wise total
             select comp_code "COMP CODE",edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,edtn,edtn_name,edtn_name_oth_lang
                               order by comp_code,edtn_name;

        open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    d.edtn in(select distinct edtn from cir_edtn_mast where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;

   End cir_edition_supply_variance_p;

   procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts)
    as
     vfrom_supdate      date;
     vtill_supdate      date;
     cursor cur_sup_type is
         select distinct 'sum(decode(sup_type_code,'||''''||s.sup_ty_code||''''||',sup_copy,0)) "'||s.sup_ty_name||'",' vty,
        'sum(decode(sup_type_code,'||''''||s.sup_ty_code||''''||',sup_copy,0)) +' vty_sum,s.sup_seq_no sup_seq_no
        from cir_supply_type_mast s,cir_dbksup d
        where s.comp_code=d.comp_code and s.comp_code=pcomp_code and d.unit_code=nvl(punit_code,d.unit_code) and
            d.publ=nvl(ppubl,d.publ) and d.supdate between vfrom_supdate and vtill_supdate and
            s.sup_ty_code=d.sup_type_code
            order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar           varchar2(4000);
     vvar_sum       varchar2(4000);
     vquery         varchar2(4000);
     vquery1        varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar        :=substr(vvar,1,length(vvar)-1);
    vvar_sum    :=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);
    If vvar is null then
        vquery:=' select comp_code AS "COMP_CODE",(select distinct "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=unit_code) AS "UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS "PUBL_NAME",sup_rate as "SUP_RATE", supdate AS "SUPDATE",sum(sup_copy) AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by comp_code,unit_code,publ_name,supdate,sup_rate';
    Else
        vquery:=' select comp_code AS "COMP_CODE",(select distinct "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=unit_code) AS "UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS "PUBL_NAME",sup_rate as "SUP_RATE", supdate AS "SUPDATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by comp_code,unit_code,publ_name,supdate,sup_rate';
    End if;                                    
      --          insert into test1(vstring) values ('11'||vquery);commit;
    open p_accounts for vquery;
    
    If vvar is null then
        vquery1:=' select comp_code AS "COMP_CODE",sup_rate as "SUP_RATE",sum(sup_copy) AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    else
        vquery1:=' select comp_code AS "COMP_CODE",sup_rate as "SUP_RATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    end if;
    --insert into test1(vstring) values ('22'||vquery1);commit;
    open p_accounts1 for vquery1;
  End cir_rep_supply_unit;

procedure cir_dist_taluka_publ_wise(
     pcompcode      in varchar2,
     punitcode      in varchar2,
     pbrancode      in varchar2,
     ppublcode      in varchar2,
     pmainedtn      in varchar2,
     pedtncode      in varchar2,
     pdistcode      in varchar2,
     ptalukacode    in varchar2,
     pagtypecode    in varchar2,
     pagclasscode   in varchar2,
     pagcd          in varchar2,
     pdpcd          in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     plangtype      in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is used for agency supply type
     pextra2        in varchar2,--it is used for break on district/taluka wise or datewise(1/2)
     p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(32000);
      v_query1    varchar2(32000);
      
     cursor cur_edtn is
        select distinct d.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (m.agcd=pagcd or pagcd is null) and (m.dpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (d.edtn=pedtncode or pedtncode is null) and (e.main_edtn=pmainedtn or pmainedtn is null) and  
              (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
              (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='S' and nvl(sup_rate,0)>0
        union
        select p.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (d.billagcd=pagcd or pagcd is null) and (d.billdpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (d.edtn=pedtncode or pedtncode is null) and (e.main_edtn=pmainedtn or pmainedtn is null) and 
              (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='B' and nvl(sup_rate,0)>0
        order by publ_seqno,publ,edtn_seqno,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(8000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        --delete test1;insert into test1(vstring,vstring2)
        --values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;

        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            if vvar is null then
                --vvar        :='sum(decode(d.edtn||d.sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',d.sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar        :='case when d.edtn||d.sup_rate='||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||' then sum(d.sup_copy) else 0 end "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'case when d.edtn||d.sup_rate='||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||' then sum(d.sup_copy) else 0 end"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
                        
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
        --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise ',vvar||' , '||vvar_sum1);commit;
        if pextra2='2' then--for datewise
            if vvar is null then
                if upper(pextra1)='S' then
                    v_query:='select comp_code,unit_code,supdate,
                    station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.comp_code = '||''''||pcompcode||''''||' and d.unit_code = m.unit and   
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,m.dist_code,d.supdate,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
                else
                    v_query:='select comp_code,unit_code,supdate,
                    station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                    group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
                end if;    
            else
                if upper(pextra1)='S' then
                    v_query:='select comp_code,unit_code,supdate,
                    station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,supdate,agency_name';
                 else   
                    v_query:='select comp_code,unit_code,supdate,
                    station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||'
                    and nvl(d.sup_rate,0)>0 
                    group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,supdate,agency_name';
                 end if;
            end if;
        else--- for district/taluka wise
            if vvar is null then
                if upper(pextra1)='S' then
                    v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                    tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,dist_name,taluka_name,agcd,dpcd,agency_name';
                else    
                    v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                    tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,dist_name,taluka_name,agcd,dpcd,agency_name';
                 end if;   
            else
                if upper(pextra1)='S' then
                    v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                    tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,dist_name,taluka_name,agency_name';
                else    
                    v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                    tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,dist_name,taluka_name,agency_name';
                end if;    
            end if;


        end if;

        --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;

        open p_accounts for v_query;

    End cir_dist_taluka_publ_wise;

    procedure cir_datewise_resale(
        pcompcode      in varchar2,
        punitcode      in varchar2,
        pbrancode      in varchar2,
        ppublcode      in varchar2,
        pmainedtn      in varchar2,
        pedtncode      in varchar2,
        pdistcode      in varchar2,
        ptalukacode    in varchar2,
        pagtypecode    in varchar2,
        pagclasscode   in varchar2,
        pagcd          in varchar2,
        pdpcd          in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        plangtype      in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(8000);
     cursor cur_edtn is
        select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
         case when plangtype='1' then
          substr(p.edition_nick,1,15)
         else
          substr(p.edtn_name_oth_lang,1,20)
         end edtn_name,d.sup_rate sup_rate,p.main_edtn main_edtn
        from cir_agmast m,cir_dbksup_resale d ,cir_edtn_mast p
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and m.unit=d.unit_code and 
              m.unit=p.unit_code and d.unit_code = punitcode and
              d.supdate >= vsupdate and d.supdate <=vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and m.agcd=nvl(pagcd,m.agcd) and m.dpcd=nvl(pdpcd,m.dpcd) and d.publ=nvl(ppublcode,d.publ) and
              d.publ=p.publ and d.edtn=p.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
              (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (d.resale_branch=pbrancode or pbrancode is null)
        order by publ,main_edtn,edtn_seqno,edtn,sup_rate;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
     vquery     varchar2(8000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        --delete test1;insert into test1(vstring,vstring2)
        --values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;
        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            if vvar is null then
                --vvar    :='decode(u.edtn||u.copy_rate,'||''''||rec_edtn.edtn||rec_edtn.copy_rate||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                --tot_vvar:=',sum("'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'") "'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                
                vvar        :='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
        --insert into test1(vstring,vstring2) values('cir_datewise_resale ',vvar||' , '||vvar_sum1);commit;

        if vvar is null then
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.agcd agcd,d.dpcd dpcd,d.supdate supdate,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
        else
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate supdate,d.agcd agcd,d.dpcd dpcd,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name,'||vvar||' from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agency_name';
        end if;

        --insert into test1(vstring,vstring2) values('cir_datewise_resale v_query',v_query);commit;

        open p_accounts for v_query;

    End cir_datewise_resale;
END cir_rep_supply;
/
CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_rep_supply IS
  procedure cir_rep_supply1(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     proute             in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts4        out t_accounts)
     As

     vfrom_supdate    date;
     vtill_supdate    date;
     cursor cur_sup_type is
         select 'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) "'||sup_ty_name||'",' vty,
         'sum(decode(sup_type_code,'||''''||sup_ty_code||''''||',sup_copy,0)) +' vty_sum
      from cir_supply_type_mast
      where comp_code=pcomp_code /*and sup_ty_code in(select distinct sup_type_code from cir_dbksup
      where comp_code=pcomp_code and unit_code=punit_code and
                  ((publ=ppubl) or (ppubl is null)) and ((edtn=pedtn) or (pedtn is null)) and
                  supdate between vfrom_supdate and vtill_supdate)*/
      order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar         varchar2(4000);
     vvar_sum    varchar2(4000);
     vquery     varchar2(4000);
     vquery1     varchar2(4000);
     vquery2     varchar2(4000);
     vquery3     varchar2(4000);
     vquery4     varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar    :=substr(vvar,1,length(vvar)-1);
    vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);commit;

    vquery:=' select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,cir_get_edtn_name(comp_code,edtn) edtn_name,route_code,cir_get_route_name(comp_code,unit_code,route_code) route_name,agcd "AGENCY CODE",dpcd "AGENCY SUBCODE",
    substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",(select cir_get_city(m.comp_code,m.city_code) city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY NAME",
    (select nvl(CIR_GET_NAME.CIR_CITY(m.comp_code,m.city_code,2,'||''''||pdateformat||''''||','''',''''),''NA'') city_name from cir_agmast m where m.comp_code=cir_dbksup.comp_code and m.unit=cir_dbksup.unit_code and m.agcd=cir_dbksup.agcd and m.dpcd=cir_dbksup.dpcd) "CITY ONAME",/*supdate,*/'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||') and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
               edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/ order by comp_code,unit_code,publ,edtn,route_code,agcd,dpcd/*,supdate*/';
     ---insert into test1(vstring) values ('1'||vquery);commit;
      open p_accounts for vquery;

      vquery2:=' select comp_code,unit_code,publ,edtn,route_code, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and
                edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn,route_code
                order by comp_code,unit_code,publ,edtn,route_code';
        --insert into test1(vstring) values ('22'||vquery2);commit;
      open p_accounts2 for vquery2;

      vquery3:=' select comp_code,unit_code,publ,edtn, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ,edtn
                order by comp_code,unit_code,publ,edtn';
      open p_accounts3 for vquery3;

      vquery4:=' select comp_code,unit_code,publ, '||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code,publ
                order by comp_code,unit_code,publ';
      open p_accounts4 for vquery4;

      vquery1:=' select comp_code,unit_code,'||vvar||','||vvar_sum||' TOTAL from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and unit_code='||''''||punit_code||''''||' and ((publ='||''''||ppubl||''''||
                ') or ('||''''||ppubl||''''||' is null)) and ((edtn='||''''||pedtn||''''||'
               ) or ('||''''||pedtn||''''||' is null)) and supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                and ((route_code='||''''||proute||''''||') or ('||''''||proute||''''||' is null)) and edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and ((edtn = '||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))
                group by comp_code,unit_code';
        --insert into test1(vstring) values ('2'||vquery);commit;

     open p_accounts1 for vquery1;
  End cir_rep_supply1;

procedure cir_rep_supply_po(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts) as

     /*cursor cur_sup_type is
         /*select distinct 'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) "'||sup_ty_name||'",' vty,
             'sum(decode(d.sup_type_code,'||''''||sup_ty_code||''''||',d.sup_copy,0)) +' vty_sum
             from cir_supply_type_mast s,cir_dbksup d
             where s.comp_code=d.comp_code and s.comp_code=pcomp_code and d.sup_type_code=s.sup_ty_code and
             d.unit_code=punit_code and (d.publ=ppubl or ppubl is null) and
             d.supdate=to_date(psupdate,''''||pdateformat||'''') order by sup_seq_no;*/
         /*select distinct s.sup_ty_code vty,s.sup_ty_name vty_name,s.sup_seq_no sup_seq_no
             from cir_supply_type_mast s,cir_dbksup d
             where s.comp_code=d.comp_code and s.comp_code=pcomp_code and d.sup_type_code=s.sup_ty_code and
             d.unit_code=punit_code and (d.publ=ppubl or ppubl is null) and
             d.supdate=to_date(psupdate,''''||pdateformat||'''') order by s.sup_seq_no;
     rec_sup_type cur_sup_type%rowtype;

     vvar       varchar2(4000);
     vvar1      varchar2(4000);
     vvar_sum   varchar2(4000);
     vquery     varchar2(4000);
     vquery1    varchar2(4000);
  Begin
    delete from test1;
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
        exit when cur_sup_type%notfound;
        if vvar is null then
            vvar    :=' case when d.sup_type_code='||''''||rec_sup_type.vty||''''||' then d.sup_copy else 0 end '||'"'||rec_sup_type.vty_name||'"';
            vvar1   :='sum("'||rec_sup_type.vty_name||'")'||' as "'||rec_sup_type.vty_name||'"';
            vvar_sum:=' sum('||'"'||rec_sup_type.vty_name||'"';
        else
            vvar    :=vvar||','||' case when d.sup_type_code='||''''||rec_sup_type.vty||''''||' then d.sup_copy else 0 end '||'"'||rec_sup_type.vty_name||'"';
            vvar1   :=vvar1||','||'sum("'||rec_sup_type.vty_name||'")'||' as "'||rec_sup_type.vty_name||'"';
            vvar_sum:=vvar_sum||'+'||'"'||rec_sup_type.vty_name||'"';
        end if;
    end loop;
    close cur_sup_type;

    --vvar    :=substr(vvar,1,length(vvar)-1);
    --vvar_sum:=substr(vvar_sum,1,length(vvar_sum)-1);
    vvar_sum:=vvar_sum||') '||' as "TOTAL"';
    --insert into test1(vstring,vstring2) values ('PO Report ',vvar1||','||vvar_sum);commit;

    vquery:= 'select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,x.edtn edtn,
            x.edtn_name "EDITION NAME",x.supdate supdate,'||vvar1||','||vvar_sum||',x.mainedtn_name mainedtn_name,
            x.edtn_seqno edtn_seqno,x.main_edtn_seqno main_edtn_seqno FROM
            (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,
            cir_get_edtn_name(d.comp_code,d.edtn) edtn_name,to_char(d.supdate'||','||''''||pdateformat||''''||') supdate, '||vvar||',
            cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,d.edtn) edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno
            from cir_dbksup d,cir_edtn_mast e
            where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.unit_code='||''''||punit_code||''''||' and d.unit_code=e.unit_code and
            ((d.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and d.publ=e.publ and
            d.supdate='|| 'to_date('||''''||psupdate||''''||','||''''||pdateformat||''''||') and d.edtn=e.edtn) x
            group by x.comp_code,x.unit_code ,x.publ,x.publ_name,x.edtn,
            x.edtn_name ,x.supdate,x.mainedtn_name,x.edtn_seqno,x.main_edtn_seqno
            order by x.comp_code,x.unit_code,x.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,x.edtn,x.supdate';

        --insert into test1(vstring,vstring2) values ('PO Report vquery',vquery);commit;

    open p_accounts for vquery;


    vquery1:= 'select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,'||vvar1||','||vvar_sum||' FROM
            (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn edtn,
            cir_get_edtn_name(d.comp_code,d.edtn) edtn_name,to_char(d.supdate'||','||''''||pdateformat||''''||') supdate, '||vvar||',
            cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,d.edtn) edtn_seqno,cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno
            from cir_dbksup d,cir_edtn_mast e
            where d.comp_code='||''''||pcomp_code||''''||' and d.comp_code=e.comp_code and d.unit_code='||''''||punit_code||''''||' and d.unit_code=e.unit_code and
            ((d.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and d.publ=e.publ and
            d.supdate='|| 'to_date('||''''||psupdate||''''||','||''''||pdateformat||''''||') and d.edtn=e.edtn) x
            group by x.comp_code,x.unit_code ,x.publ,x.publ_name
            order by x.comp_code,x.unit_code,x.publ,x.publ_name';

        --insert into test1(vstring,vstring2) values ('PO Report vquery1',vquery1);commit;
    open p_accounts1 for vquery1;*/
v_date             date;
     cursor cur_sup_type is
        select distinct 'sum(decode(d.agname,'||''''||agname||''''||',d.supply_copy,0)) "'||agname||'",' vty,
            'sum(decode(d.agname,'||''''||agname||''''||',d.supply_copy,0)) +' vty_sum,rec_amt sup_seq_no,agname supply_type_name
            from cir_temp_bill_collection
            where cur_sessionid=userenv('sessionid') 
        order by rec_amt,agname;
             
     rec_sup_type cur_sup_type%rowtype;

    cursor cur_dbk is
            select x.comp_code comp_code,x.unit_code unit_code,x.supdate supdate,x.publ_name publ_name,x.mainedtn_name mainedtn_name,
            x.main_edtn_seqno main_edtn_seqno,x.edtn_name||to_char(x.sup_rate,'990.99') edtn_name,x.edtn_seqno edtn_seqno,x.sup_ty_name sup_ty_name,
            x.sup_seqno sup_seqno,x.sup_rate sup_rate,x.supply_copy supply_copy,x.supl_name supl_name,x.pgno pgno from
            (select d.comp_code comp_code,d.unit_code unit_code,d.supdate supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seqno,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seqno,d.sup_rate sup_rate, sum(d.sup_copy) supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit_code,e.edtn,d.supdate,pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(d.supdate,'DY')='SUN' then min(nvl(e.main_issue_pgno_sun,0)+nvl(e.pullout_pgno_sun,0))
                when to_char(d.supdate,'DY')='MON' then min(nvl(e.main_issue_pgno_mon,0)+nvl(e.pullout_pgno_mon,0))
                when to_char(d.supdate,'DY')='TUE' then min(nvl(e.main_issue_pgno_tue,0)+nvl(e.pullout_pgno_tue,0))
                when to_char(d.supdate,'DY')='WED' then min(nvl(e.main_issue_pgno_wed,0)+nvl(e.pullout_pgno_wed,0))
                when to_char(d.supdate,'DY')='THU' then min(nvl(e.main_issue_pgno_thu,0)+nvl(e.pullout_pgno_thu,0))
                when to_char(d.supdate,'DY')='FRI' then min(nvl(e.main_issue_pgno_fri,0)+nvl(e.pullout_pgno_fri,0)) else min(nvl(e.main_issue_pgno_sat,0)+nvl(e.pullout_pgno_sat,0)) end pgno
            from cir_dbksup d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit_code=e.unit_code and (d.unit_code=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supdate =v_date and d.sup_type_code=t.sup_ty_code and upper(pextra1)!='U'
            group by d.comp_code,d.unit_code,d.supdate,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no,d.sup_rate
            union
            select d.comp_code comp_code,d.unit unit_code,v_date supdate,p.publ_name publ_name,cir_get_edtn_name(d.comp_code,e.main_edtn) mainedtn_name,
            cir_get_edtn_seqno(d.comp_code,e.main_edtn) main_edtn_seqno,
            e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seqno,t.sup_ty_name sup_ty_name,t.sup_seq_no sup_seqno,
            cir_get_edtn_rate(d.comp_code,d.unit,e.edtn,to_char(v_date,'dd/mm/yyyy'),'dd/mm/yyyy') sup_rate, 
            case when to_char(v_date,'DY')='SUN' then sum(nvl(d.base_supply,0)+nvl(d.supply_sun,0))
                 when to_char(v_date,'DY')='MON' then sum(nvl(d.base_supply,0)+nvl(d.supply_mon,0))
                 when to_char(v_date,'DY')='TUE' then sum(nvl(d.base_supply,0)+nvl(d.supply_tue,0))
                 when to_char(v_date,'DY')='WED' then sum(nvl(d.base_supply,0)+nvl(d.supply_wed,0))
                 when to_char(v_date,'DY')='THU' then sum(nvl(d.base_supply,0)+nvl(d.supply_thu,0))
                 when to_char(v_date,'DY')='FRI' then sum(nvl(d.base_supply,0)+nvl(d.supply_fri,0))
            else sum(nvl(d.base_supply,0)+nvl(d.supply_sat,0)) end supply_copy,
            cir_get_edtn_supl(d.comp_code,d.unit,e.edtn,v_date,pdateformat,1,null,null,null,null,null) supl_name,
            case when to_char(v_date,'DY')='SUN' then min(nvl(e.main_issue_pgno_sun,0)+nvl(e.pullout_pgno_sun,0))
                when to_char(v_date,'DY')='MON' then min(nvl(e.main_issue_pgno_mon,0)+nvl(e.pullout_pgno_mon,0))
                when to_char(v_date,'DY')='TUE' then min(nvl(e.main_issue_pgno_tue,0)+nvl(e.pullout_pgno_tue,0))
                when to_char(v_date,'DY')='WED' then min(nvl(e.main_issue_pgno_wed,0)+nvl(e.pullout_pgno_wed,0))
                when to_char(v_date,'DY')='THU' then min(nvl(e.main_issue_pgno_thu,0)+nvl(e.pullout_pgno_thu,0))
                when to_char(v_date,'DY')='FRI' then min(nvl(e.main_issue_pgno_fri,0)+nvl(e.pullout_pgno_fri,0)) else min(nvl(e.main_issue_pgno_sat,0)+nvl(e.pullout_pgno_sat,0)) end pgno
            from cir_supply d,cir_edtn_mast e,cir_publ_mast p,cir_supply_type_mast t
            where d.comp_code=e.comp_code and d.comp_code=p.comp_code and d.comp_code=t.comp_code and d.comp_code=pcomp_code and
            d.unit=e.unit_code and (d.unit=punit_code or punit_code is null) and d.publ=p.publ and d.publ=e.publ and (d.publ=ppubl or ppubl is null) and 
            d.edtn=e.edtn and d.supply_flag='Y' and d.supply_type_code=t.sup_ty_code and upper(pextra1)='U'
            group by d.comp_code,d.unit,p.publ_name,e.main_edtn,e.edtn,e.edtn_name,e.edtn_seq_no,t.sup_ty_name,t.sup_seq_no) x
            order by comp_code,unit_code,supdate,publ_name,main_edtn_seqno,mainedtn_name,edtn_seqno,edtn_name,sup_seqno,sup_ty_name;
        
        rec_dbk cur_dbk%rowtype;
        
        cursor cur_main_edtn is
            select comp_code,unit_code,agcd,dpcd
            from cir_ledger_report where sess_id=userenv('sessionid') and remarks is null
            group by comp_code,unit_code,agcd,dpcd
            order by comp_code,unit_code,agcd,dpcd;
                    
        rec_main_edtn cur_main_edtn%rowtype;                                    
        
        cursor cur_supl is
            select chq_bank,sum(rec_seqno) sup_copy
            from cir_ledger_report where sess_id=userenv('sessionid') and comp_code=rec_main_edtn.comp_code and 
            unit_code=rec_main_edtn.unit_code and agcd=rec_main_edtn.agcd and dpcd=rec_main_edtn.dpcd and
            remarks is null
            group by chq_bank
            order by chq_bank;
                    
        rec_supl cur_supl%rowtype;        
    vvar        varchar2(4000);
    vvar_sum    varchar2(4000);
    vquery      varchar2(8000);
    v_count     number(5);
    vlength     number(7);
    vrunval     varchar2(8000);
    v_val       varchar2(800);
    v_name      varchar2(8000);
    vno         number:=0;
    v_remarks   varchar2(500);
  Begin
    if upper(pextra1)='U' then  
        v_date:=to_date(trunc(sysdate),''''||pdateformat||'''');
    else
        v_date:=to_date(psupdate,''''||pdateformat||'''');
    end if;    
    
    delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
    delete from cir_ledger_report where sess_id=userenv('sessionid');commit;
    --delete from test1;commit;
    open cur_dbk;
    loop
        fetch cur_dbk into rec_dbk;
        exit when cur_dbk%notfound;
        
        v_count:=nvl(v_count,0)+1;
        if rec_dbk.pgno=0 then
            rec_dbk.pgno:=null;
        end if;
        
        vlength :=null; v_val :=null; vrunval :=null; vno:=null;

        v_val   :=replace(rec_dbk.supl_name||'+','+',',');
        vlength :=length(v_val);
        vno:=1;

        for i in 1.. vlength loop
        vrunval:=substr(v_val,i,1);
        if vrunval!=',' then
            v_name:=v_name||vrunval;
        else
            insert into cir_ledger_report(comp_code, unit_code, recptdt,agcd, dpcd, recptno, chq_bank, rec_seqno,sess_id)
                    values (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,v_name,rec_dbk.supply_copy,userenv('sessionid'));
            vno:=vno+1;
            v_name:='';
        end if;
        end loop;
        
        insert into cir_temp_bill_collection
        (comp_code, unit_code, billdt, publ_code, agcd, dpcd, supply_copy, gross_amt, 
        cur_sessionid, agname,return_copy,remarks,dn_amt,cn_amt,rec_amt)
        values
        (rec_dbk.comp_code,rec_dbk.unit_code,v_date,rec_dbk.publ_name,rec_dbk.mainedtn_name,rec_dbk.edtn_name,rec_dbk.supply_copy,rec_dbk.sup_rate,
        userenv('sessionid'),rec_dbk.sup_ty_name,rec_dbk.pgno,rec_dbk.supl_name,rec_dbk.main_edtn_seqno,rec_dbk.edtn_seqno,rec_dbk.sup_seqno);
    end loop;
    close cur_dbk;
    
    open cur_main_edtn;
    loop
        fetch cur_main_edtn into rec_main_edtn;
        exit when cur_main_edtn%notfound;
         
        open cur_supl;
        loop
            fetch cur_supl into rec_supl;
            exit when cur_supl%notfound;

            if v_remarks is null then
                v_remarks:=rec_supl.chq_bank||' # '||rec_supl.sup_copy;
            else
                v_remarks:=v_remarks||','||rec_supl.chq_bank||' # '||rec_supl.sup_copy;
            end if;
            if rec_supl.chq_bank is null then
                v_remarks:=null;
            end if;             
        end loop;
        close cur_supl;

        insert into cir_ledger_report(comp_code, unit_code, recptdt,agcd, dpcd, remarks,sess_id)
                values (rec_main_edtn.comp_code,rec_main_edtn.unit_code,v_date,rec_main_edtn.agcd,rec_main_edtn.dpcd,v_remarks,userenv('sessionid'));        
       v_remarks:=null;
    end loop;
    close cur_main_edtn;    
    delete from cir_ledger_report where sess_id=userenv('sessionid') and remarks is null;
    delete from test1;commit;
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
        exit when cur_sup_type%notfound;

        if vvar is null then
            vvar       :='case when d.agname='||''''||rec_sup_type.supply_type_name||''''||' then d.supply_copy else 0 end "'||rec_sup_type.supply_type_name||'"';
            vvar_sum   :='sum("'||rec_sup_type.supply_type_name||'")'||' "'||rec_sup_type.supply_type_name||'"';
        else
            vvar       :=vvar||','||'case when d.agname='||''''||rec_sup_type.supply_type_name||''''||' then d.supply_copy else 0 end "'||rec_sup_type.supply_type_name||'"';
            vvar_sum   :=vvar_sum||','||'sum("'||rec_sup_type.supply_type_name||'")'||' "'||rec_sup_type.supply_type_name||'"';
        end if;            
    end loop;
    close cur_sup_type;

    --insert into test1(vstring) values (pextra1||' '||vquery);
    if vvar is null then            
        vquery:=' select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,x.edtn edtn,x.edtn_name "EDITION NAME",
                x.supdate supdate, sum(x.supply_copy) TOTAL,x.mainedtn_name mainedtn_name,x.supl_name supl_name,x.main_seqno main_seqno,x.edtn_seqno edtn_seqno,x.return_copy page_no,x.supl_detail supl_detail
                from
                (select d.comp_code comp_code,d.unit_code unit_code,d.publ_code publ,d.publ_code publ_name,d.dpcd edtn,d.dpcd edtn_name,
                to_char(d.billdt'||','||''''||pdateformat||''''||') supdate,d.agcd mainedtn_name,d.remarks supl_name,d.dn_amt main_seqno,d.cn_amt edtn_seqno,d.supply_copy supply_copy,
                (select remarks from cir_ledger_report where sess_id=userenv(''sessionid'') and remarks is not null and comp_code=d.comp_code and unit_code=d.unit_code and agcd=d.publ_code and dpcd=d.agcd and recptdt=d.billdt) supl_detail,d.RETURN_COPY return_copy from cir_temp_bill_collection d
                where d.cur_sessionid=userenv(''sessionid'')) x  group by x.comp_code,x.unit_code,x.publ,x.publ_name,x.edtn,x.edtn_name,x.supdate,x.mainedtn_name,x.supl_name,x.main_seqno,x.edtn_seqno,x.return_copy,x.supl_detail
                order by comp_code,unit_code,publ_name,main_seqno,edtn_seqno';                
    else
        vquery:=' select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,x.edtn edtn,x.edtn_name "EDITION NAME",
                x.supdate supdate,'||vvar_sum||', sum(x.supply_copy) TOTAL,x.mainedtn_name mainedtn_name,x.supl_name supl_name,x.main_seqno main_seqno,x.edtn_seqno edtn_seqno,x.return_copy page_no,x.supl_detail supl_detail
                from
                (select d.comp_code comp_code,d.unit_code unit_code,d.publ_code publ,d.publ_code publ_name,d.dpcd edtn,d.dpcd edtn_name,
                to_char(d.billdt'||','||''''||pdateformat||''''||') supdate,'||vvar||',d.agcd mainedtn_name,d.remarks supl_name,d.dn_amt main_seqno,d.cn_amt edtn_seqno,d.supply_copy supply_copy,
                (select remarks from cir_ledger_report where sess_id=userenv(''sessionid'') and remarks is not null and comp_code=d.comp_code and unit_code=d.unit_code and agcd=d.publ_code and dpcd=d.agcd and recptdt=d.billdt) supl_detail,d.RETURN_COPY return_copy from cir_temp_bill_collection d
                where d.cur_sessionid=userenv(''sessionid'')) x  group by x.comp_code,x.unit_code,x.publ,x.publ_name,x.edtn,x.edtn_name,x.supdate,x.mainedtn_name,x.supl_name,x.main_seqno,x.edtn_seqno,x.return_copy,x.supl_detail
                order by comp_code,unit_code,publ_name,main_seqno,edtn_seqno';
    end if;                    
    --insert into test1(vstring) values ('1 pextra1 '||vquery);commit;

    open p_accounts for vquery;
    if vvar is null then
        vquery:=' select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,
                 sum(x.supply_copy) TOTAL from
                (select d.comp_code comp_code,d.unit_code unit_code,d.publ_code publ,d.publ_code publ_name,d.dpcd edtn,d.dpcd edtn_name,
                to_char(d.billdt'||','||''''||pdateformat||''''||') supdate,d.agcd mainedtn_name,d.remarks supl_name,d.dn_amt main_seqno,d.cn_amt edtn_seqno,d.supply_copy supply_copy from cir_temp_bill_collection d
                where d.cur_sessionid=userenv(''sessionid'')) x group by x.comp_code,x.unit_code,x.publ,x.publ_name
                order by comp_code,unit_code,publ_name';                
    else
        vquery:=' select x.comp_code comp_code,x.unit_code unit_code,x.publ publ,x.publ_name publ_name,
                '||vvar_sum||', sum(x.supply_copy) TOTAL from
                (select d.comp_code comp_code,d.unit_code unit_code,d.publ_code publ,d.publ_code publ_name,d.dpcd edtn,d.dpcd edtn_name,
                to_char(d.billdt'||','||''''||pdateformat||''''||') supdate,'||vvar||',d.agcd mainedtn_name,d.remarks supl_name,d.dn_amt main_seqno,d.cn_amt edtn_seqno,d.supply_copy supply_copy from cir_temp_bill_collection d
                where d.cur_sessionid=userenv(''sessionid'')) x group by x.comp_code,x.unit_code,x.publ,x.publ_name
                order by comp_code,unit_code,publ_name';    
    end if;
    
    --insert into test1(vstring) values ('2 pextra1 '||vquery);commit;
    --delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
    --delete from cir_ledger_report where sess_id=userenv('sessionid');commit;
    open p_accounts1 for vquery;    

  End cir_rep_supply_po;

  procedure cir_rep_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",
       nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
            nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND
        A.PUBL=PPUBL AND A.EDTN=NVL(PEDTN,A.EDTN) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND 
        A.SUPDATE >= VFRDT AND A.SUPDATE <=VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,/*A.EDTN,*/B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,'NA') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),'NA') "STATE NAME",COUNTRY_CODE,
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE<=VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_daybook;

  procedure cir_rep_dist_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt            date;
     vtodt            date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(DIST_CODE,'NA') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",
       STATE_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT    AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,'NA') DIST_CODE,nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),'NA') "DISTRICT NAME",
       nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,pdateformat,'',''),'NA') "DISTRICT ONAME",STATE_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT  AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.DIST_CODE,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_dist_daybook;

  procedure cir_rep_taluka_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vfrdt          date;
     vtodt          date;

   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);

       open p_accounts for
       SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,pdateformat,'',''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'',EDTN,2,pdateformat,'',''),'NA') "EDITION ONAME",
       nvl(CITY_CODE,'NA') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),'NA') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,pdateformat,'',''),'NA') "CITY ONAME",
       nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",
       STATE_CODE "STATE CODE",
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
            nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD;

       open p_accounts1 for
       SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,'NA') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),'NA') "TALUKA NAME",
       nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,pdateformat,'',''),'NA') "TALUKA ONAME",STATE_CODE "STATE CODE",
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.STATE_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,TEHSIL_TALUKA;

       open p_accounts2 for
       SELECT COMP_CODE,UNIT_CODE,
       SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(nvl(p01,0)+nvl(p02,0)+nvl(p03,0)+nvl(p04,0)+nvl(p05,0)+nvl(p06,0)+nvl(p07,0)+nvl(p08,0)+nvl(p09,0)+nvl(p10,0)+
        nvl(p11,0)+nvl(p12,0)+nvl(p13,0)+nvl(p14,0)+nvl(p15,0)+nvl(p16,0)+nvl(p17,0)+nvl(p18,0)+nvl(p19,0)+nvl(p20,0)+
        nvl(p21,0)+nvl(p22,0)+nvl(p23,0)+nvl(p24,0)+nvl(p25,0)+nvl(p26,0)+nvl(p27,0)+nvl(p28,0)+nvl(p29,0)+nvl(p30,0)+nvl(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'01',SUM(nvl(A.SUP_COPY,0))) p01,DECODE(TO_CHAR(A.SUPDATE,'DD'),'02',SUM(nvl(A.SUP_COPY,0))) p02,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'03',SUM(nvl(A.SUP_COPY,0))) p03, DECODE(TO_CHAR(A.SUPDATE,'DD'),'04',SUM(nvl(A.SUP_COPY,0))) p04,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'05',SUM(nvl(A.SUP_COPY,0))) p05, DECODE(TO_CHAR(A.SUPDATE,'DD'),'06',SUM(nvl(A.SUP_COPY,0))) p06,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'07',SUM(nvl(A.SUP_COPY,0))) p07, DECODE(TO_CHAR(A.SUPDATE,'DD'),'08',SUM(nvl(A.SUP_COPY,0))) p08,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'09',SUM(nvl(A.SUP_COPY,0))) p09, DECODE(TO_CHAR(A.SUPDATE,'DD'),'10',SUM(nvl(A.SUP_COPY,0))) p10,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'11',SUM(nvl(A.SUP_COPY,0))) p11, DECODE(TO_CHAR(A.SUPDATE,'DD'),'12',SUM(nvl(A.SUP_COPY,0))) p12,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'13',SUM(nvl(A.SUP_COPY,0))) p13, DECODE(TO_CHAR(A.SUPDATE,'DD'),'14',SUM(nvl(A.SUP_COPY,0))) p14,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'15',SUM(nvl(A.SUP_COPY,0))) p15, DECODE(TO_CHAR(A.SUPDATE,'DD'),'16',SUM(nvl(A.SUP_COPY,0))) p16,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'17',SUM(nvl(A.SUP_COPY,0))) p17, DECODE(TO_CHAR(A.SUPDATE,'DD'),'18',SUM(nvl(A.SUP_COPY,0))) p18,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'19',SUM(nvl(A.SUP_COPY,0))) p19, DECODE(TO_CHAR(A.SUPDATE,'DD'),'20',SUM(nvl(A.SUP_COPY,0))) p20,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'21',SUM(nvl(A.SUP_COPY,0))) p21, DECODE(TO_CHAR(A.SUPDATE,'DD'),'22',SUM(nvl(A.SUP_COPY,0))) p22,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'23',SUM(nvl(A.SUP_COPY,0))) p23, DECODE(TO_CHAR(A.SUPDATE,'DD'),'24',SUM(nvl(A.SUP_COPY,0))) p24,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'25',SUM(nvl(A.SUP_COPY,0))) p25, DECODE(TO_CHAR(A.SUPDATE,'DD'),'26',SUM(nvl(A.SUP_COPY,0))) p26,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'27',SUM(nvl(A.SUP_COPY,0))) p27, DECODE(TO_CHAR(A.SUPDATE,'DD'),'28',SUM(nvl(A.SUP_COPY,0))) p28,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'29',SUM(nvl(A.SUP_COPY,0))) p29, DECODE(TO_CHAR(A.SUPDATE,'DD'),'30',SUM(nvl(A.SUP_COPY,0))) p30,
        DECODE(TO_CHAR(A.SUPDATE,'DD'),'31',SUM(nvl(A.SUP_COPY,0))) p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE=PCOMP_CODE AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE=PUNIT_CODE AND
        A.AGCD=B.AGCD AND A.AGCD=NVL(PAGCODE,A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=B.DPCD AND  A.DPCD=NVL(PDPCODE,A.DPCD) AND 
        A.PUBL=PPUBL AND (A.EDTN=PEDTN OR PEDTN IS NULL) AND (B.CITY_CODE=PCITYCD OR PCITYCD IS NULL) AND
        (B.STATE_CODE=PSTATECD OR PSTATECD IS NULL) AND (B.DIST_CODE=PDISTCODE OR PDISTCODE IS NULL) AND (B.TEHSIL_TALUKA=PTALUKA OR PTALUKA IS NULL) AND 
        (B.BRANCH_CODE=PBRANCH OR PBRANCH IS NULL) AND (B.AG_TYPE=PAGTYPE OR PAGTYPE IS NULL) AND (B.AG_CLASS=PAGCLASS OR PAGCLASS IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE=PEXTRA1 OR PEXTRA1 IS NULL) AND A.SUPDATE >= VFRDT AND A.SUPDATE <= VTODT AND NVL(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE;

  End cir_rep_taluka_daybook;

  procedure cir_rep_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(12000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(STATE_CODE,''NA'') "STATE CODE",nvl(CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE';
insert into test1(vstring,vstring2) values('3 '||vquery3,VQUERY2);commit;
       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0 AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
        
insert into test1(vstring,vstring2) values('4 '||vquery3,VQUERY2);commit;        
       open p_accounts2 for vquery3||vquery2;

  End cir_rep_day_daybook;

  procedure cir_rep_dist_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
    substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",
       COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(DIST_CODE,''NA'') "DIST CODE",nvl(CIR_GET_DIST(COMP_CODE,STATE_CODE,DIST_CODE),''NA'') "DISTRICT NAME",nvl(CIR_GET_NAME.CIR_DISTRICT(COMP_CODE,DIST_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "DISTRICT ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.DIST_CODE DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='  FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,STATE_CODE,DIST_CODE,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,DIST_CODE,STATE_CODE';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_dist_day_daybook;

  procedure cir_rep_taluka_day_daybook(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pedtn          in varchar2,
     pcitycd        in varchar2,
     pstatecd       in varchar2,
     pmonth         in varchar2,
     pyear          in number,
     pday           in varchar2,
     pdateformat    in varchar2,
     pbranch        in varchar2,
     pdistcode      in varchar2,
     ptaluka        in varchar2,
     pagtype        in varchar2,
     pagclass       in varchar2,
     pagcode        in varchar2,
     pdpcode        in varchar2,
     pextra1        in varchar2,--it is used for supply type
     pextra2        in varchar2,
     pextra3        in varchar2,
     pextra4        in varchar2,
     pextra5        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts)
    As
     vquery1        varchar2(4000);
     vquery2        varchar2(12000);
     vquery3        varchar2(12000);
     vdaysup        varchar2(2000);
     vtotsup        varchar2(1000);
     vfrdt          date;
     vtodt          date;
     v_dt           date;
     v_day          varchar2(3);
     v_cnt          number:=0;
       cursor c1 is
           select dt,upper(to_char(dt,'DY')) supply_day from cir_temp_dt order by sqno,dt;
   Begin
       vfrdt:=to_date('01/'||pmonth||'/'||pyear,pdateformat);
       vtodt:=last_day(vfrdt);
    delete from cir_temp_dt;
    loop
        if v_dt>=vtodt then
            exit;
        else
            if v_dt is null then
                v_dt:=vfrdt;
            else
                v_dt:=v_dt+1;
            end if;
        end if;
           if upper(to_char(v_dt,'DY'))=upper(pday) then
               insert into cir_temp_dt(sqno,dt) values(1,v_dt);
           else
               insert into cir_temp_dt(sqno,dt) values(2,v_dt);
           end if;
    end loop;

    open c1;
    loop
        fetch c1 into v_dt,v_day;
        exit when c1%notfound;
        v_cnt        := v_cnt+1;
        if vquery1 is null then
            vquery1:='DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:='SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:='NVL(P'||lpad(v_cnt,2,'0')||',0)';
        else
            vquery1:=vquery1||','||'DECODE(TO_CHAR(A.SUPDATE,''DD''),'''||to_char(v_dt,'dd')||''',SUM(nvl(A.SUP_COPY,0))) P'||lpad(v_cnt,2,'0');
            vdaysup:=vdaysup||','||'SUM(NVL(P'||lpad(v_cnt,2,'0')||',0)) AS '||'"'||lpad(v_cnt,2,'0')||'"';
            vtotsup:=vtotsup||'+'||'NVL(P'||lpad(v_cnt,2,'0')||',0)';
        end if;
    end loop;
    close c1;
    vtotsup:='SUM('||vtotsup||')';
    --insert into test1(vstring,vstring2) values('1 '||vquery1,vdaysup||','||vtotsup||'AS "TOTAL"');

    vquery3:='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substr(cir_get_agency(comp_code,unit_code,agcd,dpcd),1,50) "AGENCY NAME",
       substr(cir_get_name.cir_agname(comp_code,unit_code,agcd,dpcd,2,'||''''||pdateformat||''''||','''',''''),1,50) "AGENCY ONAME",
       EDTN,CIR_GET_EDTN_NAME(COMP_CODE,EDTN) "EDITION NAME",nvl(CIR_GET_NAME.CIR_EDTN(COMP_CODE,'''',EDTN,2,'||''''||pdateformat||''''||','''',''''),''NA'') "EDITION ONAME",
       nvl(CITY_CODE,''NA'') "CITY CODE",nvl(CIR_GET_CITY(COMP_CODE,CITY_CODE),''NA'') "CITY NAME",nvl(CIR_GET_NAME.CIR_CITY(COMP_CODE,CITY_CODE,2,'||''''||pdateformat||''''||','''',''''),''NA'') "CITY ONAME",
       nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
       ' FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,MIN(A.EDTN) EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE >= '''||VFRDT||''' AND A.SUPDATE <='''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,AGCD,DPCD,EDTN,CITY_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,CITY_CODE,EDTN,AGCD,DPCD';

       --insert into test1(vstring,vstring2) values('2 '||vquery3,VQUERY2);commit;
       open p_accounts for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,nvl(TEHSIL_TALUKA,''NA'') "TALUKA CODE",nvl(CIR_GET_TALUKA(COMP_CODE,TEHSIL_TALUKA),''NA'') "TALUKA NAME",nvl(CIR_GET_NAME.CIR_TALUKA(COMP_CODE,TEHSIL_TALUKA,2,'||''''||pdateformat||''''||','''',''''),''NA'') "TALUKA ONAME",COUNTRY_CODE "COUNTRY CODE",'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,'||vquery1;

        vquery2:='    FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND 
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.COUNTRY_CODE)
        GROUP BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA,COUNTRY_CODE
        ORDER BY COMP_CODE,UNIT_CODE,TEHSIL_TALUKA';

       open p_accounts1 for vquery3||vquery2;

        vquery3:='SELECT COMP_CODE,UNIT_CODE,'||vdaysup||','||vtotsup||'AS "TOTAL"'||
        ' FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,'||vquery1;
       vquery2:=' FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
       WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''||PCOMP_CODE||''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''||PUNIT_CODE||''' AND
        A.AGCD=B.AGCD AND A.AGCD=NVL('''||PAGCODE||''',A.AGCD) AND A.DPCD=B.DPCD AND A.DPCD=NVL('''||PDPCODE||''',A.DPCD) AND 
        A.PUBL='''||PPUBL||''' AND (A.EDTN='''||PEDTN||''' OR '''||PEDTN||''' IS NULL) AND (B.CITY_CODE='''||PCITYCD||''' OR '''||PCITYCD ||''' IS NULL) AND
        (B.STATE_CODE='''||PSTATECD||''' OR '''||PSTATECD||''' IS NULL) AND (B.DIST_CODE='''||PDISTCODE||''' OR '''||PDISTCODE||''' IS NULL) AND 
        (B.TEHSIL_TALUKA='''||PTALUKA||''' OR '''||PTALUKA||''' IS NULL) AND (B.BRANCH_CODE='''||PBRANCH||''' OR '''||PBRANCH||''' IS NULL) AND
        (B.AG_TYPE='''||PAGTYPE||''' OR '''||PAGTYPE||''' IS NULL) AND (B.AG_CLASS='''||PAGCLASS||''' OR '''||PAGCLASS||''' IS NULL) AND
         A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''||PEXTRA1||''' OR '''||PEXTRA1||''' IS NULL) AND 
        A.SUPDATE>= '''||VFRDT||''' AND A.SUPDATE <= '''||VTODT||''' AND NVL(A.SUP_COPY,0)>0  AND upper(to_char(A.SUPDATE,''DY''))=upper('''||pday||''')
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)
        GROUP BY COMP_CODE,UNIT_CODE
        ORDER BY COMP_CODE,UNIT_CODE';
       open p_accounts2 for vquery3||vquery2;

   End cir_rep_taluka_day_daybook;

  Procedure cir_rep_route_challan(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     pperiod        in number,
     prmode         in varchar2,
     psupdate       in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts)
  As
      vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vquery     varchar2(4000);
  Begin
    --insert into test1(vstring,vstring2) values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');
    --insert into test1(vstring,vstring2) values('2222 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate '||psupdate);commit;
    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
    --vvar:=substr(vvar,1,length(vvar)-1);
    --insert into test1(vstring,vstring2) values('1 '||vvar,' vsupdate '||vsupdate);commit;

        if vvar is null then
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        else
            vquery:='select a.route "ROUTE CODE",cir_get_route_name(a.comp_code,a.unit_code,a.route) "ROUTE NAME",a.subrt "SUB ROUTE",cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt) "SUBROUTE NAME",a.sub_subrt "SUB SUBROUTE",cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt) "SUB SUBROUTE NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by a.route,cir_get_route_name(a.comp_code,a.unit_code,a.route),a.subrt,cir_get_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt),a.sub_subrt,cir_get_sub_subroute_name(a.comp_code,a.unit_code,a.route,a.subrt,a.sub_subrt),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by a.route,a.subrt,a.sub_subrt,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('2 '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_route_challan;

procedure cir_rep_dist_challan(
   pcomp_code       in varchar2,
   punit_code       in varchar2,
   pperiod          in number,
   prmode           in varchar2,
   psupdate         in varchar2,
   pdateformat      in varchar2,
   pextra1          in varchar2,
   pextra2          in varchar2,
   p_accounts       out t_accounts)
   As
     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn_1--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
Begin
    vsupdate:=to_date(psupdate,''''||pdateformat||'''');

    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
                if vvar is null then
              vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                else
                    vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                end if;
    end loop;
    close cur_edtn;
        if vvar is null then
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        else
            vquery:='select b.dist_code "DISTRICT CODE",cir_get_dist(b.comp_code,b.state_code,b.dist_code) "DISTRICT NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
                where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.dist_code,cir_get_dist(b.comp_code,b.state_code,b.dist_code),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.dist_code,b.ag_name';--,'||vvar||'
        end if;
    --insert into test1(vstring,vstring2) values('DIST '||vquery,null);commit;
    open p_accounts for vquery;

  End cir_rep_dist_challan;

    procedure cir_rep_taluka_challan(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        pperiod        in number,
        prmode         in varchar2,
        psupdate       in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     As

     vsupdate date;
     cursor cur_edtn is
         select distinct edtn,edtn_seq_no from cir_edtn_mast where comp_code=pcomp_code and edtn in(select distinct edtn--'sum(decode(edtn,'||''''||edtn||''''||')) '||edtn||',' vty,
      from cir_lblmast where comp_code=pcomp_code and unit_code     = punit_code and
                  publ in (select publ from cir_publ_mast
                      where comp_code = pcomp_code and
                            period    = pperiod) and route in (select route_code from cir_route_mast
                            where comp_code = pcomp_code and
                                  unit_code = punit_code and
                                  ((route_mode = prmode) or (prmode is null))) and lbl_dt   = vsupdate)
      order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(4000);
     vquery     varchar2(4000);
    Begin
        vsupdate:=to_date(psupdate,''''||pdateformat||'''');

        open cur_edtn;
        loop
            fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
                    if vvar is null then
                  vvar:='sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';--'sum(decode(edtn,'||''''||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    else
                        vvar:=vvar||','||'sum(decode(edtn,'||''''||rec_edtn.edtn||''''||',supply_1,0))"'||cir_get_edtnnm_rate(pcomp_code,punit_code,rec_edtn.edtn,psupdate,pdateformat)||'"';
                    end if;
        end loop;
        close cur_edtn;
        if vvar is null then
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET" from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        else
        vquery:='select b.tehsil_taluka "TALUKA CODE",cir_get_taluka(b.comp_code,b.tehsil_taluka) "TALUKA NAME",a.agcd "AGENCY CODE",a.dpcd "AGENCY SUBCODE",b.ag_name "AGENCY NAME",b.city_code "CITY CODE",cir_get_city(b.comp_code,b.city_code) "CITY NAME",max(a.lbl_sno) "TOTAL PACKET",'||vvar||'from cir_lblmast a,cir_agmast b--sum(a.SUPPLY_1) "SUPPLY COPY",
            where a.comp_code = b.comp_code and a.unit_code = b.unit and a.agcd = b.agcd and a.dpcd = b.dpcd and a.comp_code = '||''''||pcomp_code||''''||' and a.unit_code = '||''''||punit_code||''''||' and a.publ in (select publ from cir_publ_mast where comp_code = '||''''||pcomp_code||''''||' and period = '||''''||pperiod||''''||') and a.route in (select route_code from cir_route_mast where comp_code = '||''''||pcomp_code||''''||' and ((route_mode = '||''''||prmode||''''||') or ('||''''||prmode||''''||' is null))) and a.lbl_dt = '||''''||vsupdate||''''||' group by b.tehsil_taluka,cir_get_taluka(b.comp_code,b.tehsil_taluka),a.agcd,a.dpcd,b.ag_name,b.city_code,cir_get_city(b.comp_code,b.city_code),a.edtn order by b.tehsil_taluka,b.ag_name';--,'||vvar||'
        end if;
        --insert into tes t1(vstring,vstring2) values('TALUKA '||vquery,null);commit;
        open p_accounts for vquery;

    End cir_rep_taluka_challan;

    procedure cir_route_wise_supply(
        pcomp_code     in varchar2,
        punit_code     in varchar2,
        ppubl          in varchar2,
        pmainedtn      in varchar2,
        pedtn          in varchar2,
        proute         in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts,
        p_accounts1    out t_accounts,
        p_accounts2    out t_accounts,
        p_accounts3    out t_accounts)
     As
        vfrom_supdate    date;
        vtill_supdate    date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno,
               cir_get_supply_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,ppubl,pedtn,cir_dbksup.agcd,cir_dbksup.dpcd) supply_seqno,
               cir_get_name.cir_route(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,2,pdateformat,null,null) route_oth_name
               from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,
                           cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code,supply_seqno ,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_dbksup.route_code,cir_get_route_name(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_name,
               sum(sup_copy),cir_get_route_seqno(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code) route_seqno,
               cir_get_name.cir_route(cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code,2,pdateformat,null,null) route_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_dbksup.route_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,route_seqno,cir_dbksup.route_code;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                       order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.route_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
    End cir_route_wise_supply;

    procedure cir_dist_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vfrom_supdate  date;
     vtill_supdate  date;
     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.dist_code,cir_agmast.state_code,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy),
               cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_agmast.state_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.dist_code = proute) or (proute is null)) and
                     cir_dbksup.supdate between vfrom_supdate and vtill_supdate and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
  End cir_dist_wise_supply;

    procedure cir_taluka_wise_supply(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts)
     as
     vsupdate date;
     vsupdate1 date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_name.cir_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka,2,pdateformat,null,null) taluka_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn         = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name,
                  cir_agmast.ag_name,cir_dbksup.agcd,cir_dbksup.dpcd;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               sum(sup_copy),
               cir_get_name.cir_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka,2,pdateformat,null,null) taluka_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.tehsil_taluka
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts3 for
        select cir_dbksup.comp_code comp_code,sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_taluka_wise_supply;


    procedure cir_dist_taluka_wise_sup(
     pcomp_code     in varchar2,
     punit_code     in varchar2,
     ppubl          in varchar2,
     pmainedtn      in varchar2,
     pedtn          in varchar2,
     proute         in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,
     pextra2        in varchar2,
     p_accounts     out t_accounts,
     p_accounts1    out t_accounts,
     p_accounts2    out t_accounts,
     p_accounts3    out t_accounts,
     p_accounts4    out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     Begin
       vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
       vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
       open p_accounts for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
               cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang,sum(sup_copy),
               cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name,
               cir_get_name.cir_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka,2,pdateformat,null,null) taluka_oth_name from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_dbksup.edtn       = pedtn) or (pedtn is null)) and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                            cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka,
                            cir_dbksup.agcd,cir_dbksup.dpcd,cir_agmast.ag_name,cir_agmast.ag_name_oth_lang
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts1 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
        cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,cir_agmast.tehsil_taluka,cir_get_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka) taluka_name,
        sum(sup_copy),
        cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name,
        cir_get_name.cir_taluka(cir_dbksup.comp_code,cir_agmast.tehsil_taluka,2,pdateformat,null,null) taluka_oth_name from cir_dbksup,cir_agmast
        where cir_dbksup.comp_code = cir_agmast.comp_code and
        cir_dbksup.unit_code = cir_agmast.unit and
        cir_dbksup.agcd = cir_agmast.agcd and
        cir_dbksup.dpcd = cir_agmast.dpcd and
        cir_dbksup.comp_code = pcomp_code and
        cir_dbksup.unit_code = punit_code and
        cir_dbksup.publ = ppubl and
        ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
        cir_dbksup.supdate between vsupdate and vsupdate1 and
        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
        group by cir_dbksup.comp_code,cir_dbksup.unit_code,
        cir_agmast.state_code,cir_agmast.dist_code,cir_agmast.tehsil_taluka
        order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name,taluka_name;

       open p_accounts2 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,cir_agmast.dist_code,
               cir_get_dist(cir_dbksup.comp_code,cir_agmast.state_code,cir_agmast.dist_code) dist_name,
               sum(sup_copy),
               cir_get_name.cir_district(cir_dbksup.comp_code,cir_agmast.dist_code,2,pdateformat,null,null) dist_oth_name
                from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate  between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code,
                           cir_agmast.state_code,cir_agmast.dist_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code,dist_name;

       open p_accounts3 for
        select cir_dbksup.comp_code,cir_dbksup.unit_code,
               sum(sup_copy) from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code,cir_dbksup.unit_code
                  order by cir_dbksup.comp_code,cir_dbksup.unit_code;

       open p_accounts4 for
        select cir_dbksup.comp_code comp_code, sum(sup_copy) sup_copy,max(sup_rate) copy_rate from cir_dbksup,cir_agmast
               where cir_dbksup.comp_code    = cir_agmast.comp_code and
                     cir_dbksup.unit_code    = cir_agmast.unit and
                     cir_dbksup.agcd         = cir_agmast.agcd and
                     cir_dbksup.dpcd         = cir_agmast.dpcd and
                     cir_dbksup.comp_code    = pcomp_code and
                     cir_dbksup.unit_code    = punit_code and
                     cir_dbksup.publ         = ppubl and
                     ((cir_agmast.tehsil_taluka = proute) or (proute is null)) and
                     cir_dbksup.supdate between vsupdate and vsupdate1 and
                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                  group by cir_dbksup.comp_code
                  order by comp_code;
     End cir_dist_taluka_wise_sup;

     procedure cir_supply_comp(
         pcomp_code     in varchar2,
         punit_code     in varchar2,
         ppublication   in varchar2,
         psupdate       in varchar2,
         psupdate1      in varchar2,
         pdateformat    in varchar2,
         pextra1        in varchar2,
         pextra2        in varchar2,
         p_accounts     out t_accounts,
         p_accounts1    out t_accounts,
         p_accounts2    out t_accounts,
         p_accounts3    out t_accounts)
     as
        vsupdate     date;
        vsupdate1    date;
     begin
        vsupdate    :=to_date(psupdate,''''||pdateformat||'''');
        vsupdate1   :=to_date(psupdate1,''''||pdateformat||'''');
        --insert into test1(vstring,vstring2) values(pcomp_code||','||punit_code||','||ppublication,psupdate||','||pdateformat||','||pextra1||','||','||pextra2); commit;
        open p_accounts for
             select comp_code,(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"= unit_code) unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,edtn,edtn_name,edtn_name_oth_lang,
             main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             prev_sup,curr_sup,nvl(curr_sup,0)-nvl(prev_sup,0) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno,cir_get_edtn_seqno(comp_code,edtn) edtn_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               order by publ_seqno,publ_name,unit_code,mainedtn_seqno,main_edtn_name,edtn_seqno,edtn_name;

        open p_accounts1 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,main_edtn,cir_get_edtn_name(comp_code,main_edtn) main_edtn_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,cir_get_publ_seqno(comp_code,publ) publ_seqno,
             cir_get_edtn_seqno(comp_code,main_edtn) mainedtn_seqno
             from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code =punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code,main_edtn
                               order by publ_seqno,publ_name,unit_code,mainedtn_seqno,main_edtn_name;
        open p_accounts2 for
             select comp_code,unit_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,main_edtn,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code  =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ       =cir_edtn_mast.publ and
                                     edtn       =cir_edtn_mast.edtn and
                                     supdate    =to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ,unit_code
                               order by publ_seqno,publ_name,unit_code;

             open p_accounts3 for
             select comp_code,publ,cir_get_publ_name(comp_code,publ) publ_name,
             sum(prev_sup) prev_sup,sum(curr_sup) curr_sup,sum(nvl(curr_sup,0)-nvl(prev_sup,0)) diff,
             cir_get_publ_seqno(comp_code,publ) publ_seqno from
                    (select distinct comp_code,unit_code,publ,edtn,edtn_name,edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code =cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=vsupdate1) prev_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code=cir_edtn_mast.comp_code and
                                     unit_code  =cir_edtn_mast.unit_code and
                                     publ=cir_edtn_mast.publ and
                                     edtn=cir_edtn_mast.edtn and
                                     supdate=to_date(vsupdate)) curr_sup
                         from cir_edtn_mast
                         where comp_code=pcomp_code and
                               (publ    =ppublication or ppublication is null) and
                               (unit_code=punit_code or punit_code is null) and
                               nvl(freeze_flag,'N')='N')
                               where nvl(prev_sup,0)+nvl(curr_sup,0)>0
                               group by comp_code,publ
                               order by publ_seqno,publ_name;

     End cir_supply_comp;

    procedure cir_route_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    proute              in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,--it is use for finalised or unfinalised
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate     date;
     vseconddate    date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(base_supply),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        else
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,route_code,route_name,route_name_oth_lang,station_code,branch_code
                                   order by comp_code,route_code,ag_name;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code     =   pcomp_code and cir_supply.unit =   punit_code and
                                         cir_supply.publ          =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit          =   b.unit and cir_supply.agcd                 =   a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn                     =      a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        else
            open p_accounts1 for----route wise total
                 select comp_code "COMP CODE",route_code "ROUTE CODE",route_name "ROUTE NAME",route_name_oth_lang "ROUTE NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   pcomp_code and unit_code =   punit_code and
                                         publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code        =     b.unit and cir_dbksup.agcd                 =   a.agcd and
                                         cir_dbksup.dpcd                 =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ                     =      a.publ and cir_dbksup.edtn                     =      a.edtn and
                                         (cir_dbksup.route_code   =      proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate         = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,route_code,route_name,route_name_oth_lang
                                   order by comp_code,route_code;
        end if;
        
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                 (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code                =   pcomp_code and unit =   punit_code and
                                         cir_supply.publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')                =   'Y' and cir_supply.comp_code =     b.comp_code and
                                         cir_supply.unit     =   b.unit and cir_supply.agcd          =     a.agcd and
                                         cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    =     b.route_code and
                                         cir_supply.publ          =   a.publ and cir_supply.edtn          =     a.edtn and
                                         (cir_supply.route_code   =   proute or proute is null) and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                         (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and unit_code =    punit_code and
                                         publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                         supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= proute or proute is null) and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and 
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                             where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
                open p_accounts2 for----comp wise total
                     select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                     decode(sum(first_sup),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                     (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                            d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                            (m.dist_code = proute or proute is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                            (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   pcomp_code and unit_code =   punit_code and
                                             publ                     =   ppublication and (edtn   =   pedtn or pedtn is null) and
                                             supdate                  =   vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and
                                             (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and unit_code =    punit_code and
                                             publ         =    ppublication and (edtn   =    pedtn or pedtn is null) and
                                             supdate      = vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= proute or proute is null) and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=proute or proute is null) and a.route_code=b.route_code )
                                 where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code;
        end if;

   End cir_route_supply_variance_p;

    procedure cir_dist_supply_variance_p(
        pcomp_code          in varchar2,
        punit_code          in varchar2,
        ppublication        in varchar2,
        pmainedtn           in varchar2,
        pedtn               in varchar2,
        pdist               in varchar2,
        pfirstdate          in varchar2,
        pseconddate         in varchar2,
        pdateformat         in varchar2,
        pextra1             in varchar2,--it is use for finalised or unfinalised
        pextra2             in varchar2,--it is used for supply type
        p_accounts          out t_accounts,
        p_accounts1         out t_accounts,
        p_accounts2         out t_accounts)
   As
     vfirstdate             date;
     vseconddate            date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                     cir_supply.agcd  =    a.agcd and
                                     cir_supply.dpcd  =    a.dpcd and
                                     cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                     (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         supdate      =    vseconddate and
                                     cir_dbksup.agcd  =    a.agcd and
                                     cir_dbksup.dpcd  =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                   order by comp_code,dist_code,ag_name;
        else
                open p_accounts for
                     select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                     cir_get_city(comp_code,city_code) "CITY NAME",
                     dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                            (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,dist_code,dist_name,dist_oname,station_code,branch_code
                                       order by comp_code,dist_code,ag_name;            
        end if;
        
        if upper(pextra1)='U' then
        open p_accounts1 for----district wise total
             select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                          (select nvl(sum(sup_copy),0) from cir_supply
                               where comp_code    =    pcomp_code and
                                     unit    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     nvl(supply_flag,'N')=    'Y' and
                             cir_supply.agcd =    a.agcd and
                             cir_supply.dpcd =    a.dpcd and
                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ                =    ppublication and
                                     (edtn            =    pedtn or pedtn is null) and
                                     supdate        =    vseconddate and
                                 cir_dbksup.agcd                 =    a.agcd and
                                 cir_dbksup.dpcd                 =    a.dpcd and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                 (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_dist_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,dist_code,dist_name,dist_oname
                               order by comp_code,dist_code;
             else
                open p_accounts1 for----district wise total
                     select comp_code "COMP CODE",dist_code "DISTRICT CODE",dist_name "DISTRICT NAME",dist_oname "DISTRICT NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ         =    ppublication and
                                             (edtn        =    pedtn or pedtn is null) and
                                             supdate      =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast 
                                         where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_dist_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code,dist_code,dist_name,dist_oname
                                       order by comp_code,dist_code;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where comp_code    =    pcomp_code and
                                         unit         =    punit_code and
                                         publ         =    ppublication and
                                         (edtn        =    pedtn or pedtn is null) and
                                         nvl(supply_flag,'N')      =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and 
                                         (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                         cir_dbksup.agcd                 =    a.agcd and
                         cir_dbksup.dpcd                 =    a.dpcd and
                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
            else
                open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.dist_code = pdist or pdist is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                        cir_dbksup.agcd =    a.agcd and
                                        cir_dbksup.dpcd =    a.dpcd and
                                        cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                        (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_dist_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.dist_code=    pdist or pdist is null) and c.dist_code=b.dist_code)
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;

            end if;
   End cir_dist_supply_variance_p;

    procedure cir_taluka_supply_variance_p(
    pcomp_code       in varchar2,
    punit_code       in varchar2,
    ppublication     in varchar2,
    pmainedtn        in varchar2,
    pedtn            in varchar2,
    ptaluka          in varchar2,
    pfirstdate       in varchar2,
    pseconddate      in varchar2,
    pdateformat      in varchar2,
    pextra1          in varchar2,--it is use for finalised or unfinalised
    pextra2          in varchar2,--it is used for supply type
    p_accounts       out t_accounts,
    p_accounts1      out t_accounts,
    p_accounts2      out t_accounts)
   As
     vfirstdate      date;
     vseconddate     date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate    :=to_date(pseconddate,''''||pdateformat||'''');
        if upper(pextra1)='U' then
            open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit    =    punit_code and
                                         cir_supply.publ    =    ppublication and
                                         (cir_supply.edtn   =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;
             else
                open p_accounts for
                 select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
                 cir_get_city(comp_code,city_code) "CITY NAME",
                 tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                             cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                            cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vfirstdate and
                                         cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,tehsil_taluka,talu_name,talu_oname,station_code,branch_code
                                   order by comp_code,tehsil_taluka,ag_name;             
             
             end if;
        if upper(pextra1)='U' then
            open p_accounts1 for----taluka wise total
                 select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit         =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn        =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N') =    'Y' and
                                         cir_supply.agcd =    a.agcd and
                                         cir_supply.dpcd =    a.dpcd and
                                         cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                   order by comp_code,tehsil_taluka;
              else
                open p_accounts1 for----taluka wise total
                     select comp_code "COMP CODE",tehsil_taluka "TALUKA CODE",nvl(talu_name,'(blank)') "TALUKA NAME",talu_oname "TALUKA NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                     decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                            (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vfirstdate and
                                             cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                                  (select nvl(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    pcomp_code and
                                             unit_code    =    punit_code and
                                             publ                =    ppublication and
                                             (edtn            =    pedtn or pedtn is null) and
                                             supdate        =    vseconddate and
                                             cir_dbksup.agcd                 =    a.agcd and
                                             cir_dbksup.dpcd                 =    a.dpcd and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                                 from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                                 where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                       a.unit_code=punit_code and a.unit_code=c.unit and
                                       (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                       where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                       group by comp_code ,tehsil_taluka,talu_name,talu_oname
                                       order by comp_code,tehsil_taluka;
        end if;
        if upper(pextra1)='U' then
            open p_accounts2 for----comp wise total
                 select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
                 decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                 decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                        (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                              (select nvl(sum(sup_copy),0) from cir_supply
                                   where cir_supply.comp_code    =    pcomp_code and
                                         cir_supply.unit        =    punit_code and
                                         cir_supply.publ         =    ppublication and
                                         (cir_supply.edtn         =    pedtn or pedtn is null) and
                                         nvl(cir_supply.supply_flag,'N')     =    'Y' and
                                             cir_supply.agcd =    a.agcd and
                                             cir_supply.dpcd =    a.dpcd and
                                             cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                             (cir_supply.supply_type_code = pextra2 or pextra2 is null)) first_sup,
                              (select nvl(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    pcomp_code and
                                         unit_code    =    punit_code and
                                         publ                =    ppublication and
                                         (edtn            =    pedtn or pedtn is null) and
                                         supdate        =    vseconddate and
                                         cir_dbksup.agcd                 =    a.agcd and
                                         cir_dbksup.dpcd                 =    a.dpcd and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                         (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                             from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                             where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                                   a.unit_code=punit_code and a.unit_code=c.unit and
                                   (a.supdate = vfirstdate or a.supdate = vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                                   where nvl(second_sup,0)-nvl(first_sup,0)<>0
                                   group by comp_code
                                   order by comp_code;
        else
            open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
             decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
            (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    (m.tehsil_taluka = ptaluka or ptaluka is null) and d.edtn in(select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply  from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ    =    ppublication and
                                     (edtn   =    pedtn or pedtn is null) and
                                     supdate =    vfirstdate and
                             cir_dbksup.agcd =    a.agcd and
                             cir_dbksup.dpcd =    a.dpcd and
                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                             (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn        =    pedtn or pedtn is null) and
                                     supdate      =    vseconddate and
                                     cir_dbksup.agcd                 =    a.agcd and
                                     cir_dbksup.dpcd                 =    a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null)) and
                                     (cir_dbksup.sup_type_code = pextra2 or pextra2 is null)) second_sup
                         from cir_dbksup a,cir_taluka_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    c.comp_code and b.comp_code(+)    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code=c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd and
                               (c.tehsil_taluka=    ptaluka or ptaluka is null) and c.tehsil_taluka=b.talu_code(+))
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;
        end if;
   End cir_taluka_supply_variance_p;

    procedure cir_edition_supply_variance_p(
    pcomp_code          in varchar2,
    punit_code          in varchar2,
    ppublication        in varchar2,
    pmainedtn           in varchar2,
    pedtn               in varchar2,
    pfirstdate          in varchar2,
    pseconddate         in varchar2,
    pdateformat         in varchar2,
    pextra1             in varchar2,
    pextra2             in varchar2,--it is used for supply type
    p_accounts          out t_accounts,
    p_accounts1         out t_accounts,
    p_accounts2         out t_accounts)
   As
     vfirstdate         date;
     vseconddate        date;
    Begin
        vfirstdate    :=to_date(pfirstdate,''''||pdateformat||'''');
        vseconddate   :=to_date(pseconddate,''''||pdateformat||'''');
        open p_accounts for
             select comp_code "COMP CODE",agcd "AGENCY CODE",dpcd "AGENCY SUB CODE",ag_name "AGENCY NAME",ag_name_oth_lang "AGENCY OTHER LANG",
             cir_get_city(comp_code,city_code) "CITY NAME",
             edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                         cir_get_drop_point_name(comp_code,unit_code,station_code,1) "DROP POINT NAME",
                 cir_get_drop_point_name(comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME",unit_code "UNIT CODE" from
                    (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                     c.station_code station_code,c.branch_code branch_code,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                    cir_dbksup.agcd =  a.agcd and
                                    cir_dbksup.dpcd =  a.dpcd and
                                    cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                 (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,unit_code,agcd,dpcd,ag_name,ag_name_oth_lang,city_code,edtn,edtn_name,edtn_name_oth_lang,station_code,branch_code
                               order by comp_code,unit_code,edtn_name,ag_name;

        open p_accounts1 for----Edition wise total
             select comp_code "COMP CODE",edtn "EDITION CODE",edtn_name "EDITION NAME",edtn_name_oth_lang "EDITION NAME OTHER LANG",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE" from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code,edtn,edtn_name,edtn_name_oth_lang
                               order by comp_code,edtn_name;

        open p_accounts2 for----comp wise total
             select comp_code "COMP CODE",sum(first_sup) "FIRST SUPPLY",sum(second_sup) "SECOND SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),-1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "INCREASE SUPPLY",
             decode(sign(nvl(sum(second_sup),0)-nvl(sum(first_sup),0)),1,0,(nvl(sum(second_sup),0)-nvl(sum(first_sup),0))) "DECREASE SUPPLY",
                         decode(nvl(sum(first_sup),0),0,100,round(((nvl(sum(second_sup),0)-nvl(sum(first_sup),0))*100)/decode(sign(sum(second_sup)-sum(first_sup)),-1,sum(first_sup),sum(second_sup)),2)) "PERCENT_VARIANCE",
                    (select nvl(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = pcomp_code and d.unit_code = m.unit and d.unit_code = punit_code and
                    d.publ = ppublication and (d.edtn = pedtn or pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = vfirstdate and
                    d.edtn in(select distinct edtn from cir_edtn_mast where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=pmainedtn or pmainedtn is null)) and
                    (d.sup_type_code = pextra2 or pextra2 is null)) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,a.edtn,b.edtn_name,b.edtn_name_oth_lang,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ            =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vfirstdate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) first_sup,
                          (select nvl(sum(sup_copy),0) from cir_dbksup
                               where comp_code    =    pcomp_code and
                                     unit_code    =    punit_code and
                                     publ         =    ppublication and
                                     (edtn           =    pedtn or pedtn is null) and
                                     cir_dbksup.publ =    b.publ and
                                     cir_dbksup.edtn =    b.edtn and
                                     supdate         =    vseconddate and
                                     cir_dbksup.agcd =  a.agcd and
                                     cir_dbksup.dpcd =  a.dpcd and
                                     cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and 
                                     (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))) second_sup
                         from cir_dbksup a,cir_edtn_mast b,cir_agmast c
                         where a.comp_code    =    pcomp_code and a.comp_code    =    b.comp_code and a.comp_code    =    c.comp_code and
                               a.unit_code=punit_code and a.unit_code    =    c.unit and
                               (a.supdate = vfirstdate or a.supdate = vseconddate) and
                               (a.publ=    b.publ) and (a.publ=    ppublication or ppublication is null) and
                               a.edtn=b.edtn and (a.edtn=    pedtn or pedtn is null) and
                               a.agcd=c.agcd and a.dpcd=c.dpcd)
                               where nvl(second_sup,0)-nvl(first_sup,0)<>0
                               group by comp_code
                               order by comp_code;

   End cir_edition_supply_variance_p;

   procedure cir_rep_supply_unit(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pfrom_supdate      in varchar2,
     ptill_supdate      in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts)
    as
     vfrom_supdate      date;
     vtill_supdate      date;
     cursor cur_sup_type is
         select distinct 'sum(decode(sup_type_code,'||''''||s.sup_ty_code||''''||',sup_copy,0)) "'||s.sup_ty_name||'",' vty,
        'sum(decode(sup_type_code,'||''''||s.sup_ty_code||''''||',sup_copy,0)) +' vty_sum,s.sup_seq_no sup_seq_no
        from cir_supply_type_mast s,cir_dbksup d
        where s.comp_code=d.comp_code and s.comp_code=pcomp_code and d.unit_code=nvl(punit_code,d.unit_code) and
            d.publ=nvl(ppubl,d.publ) and d.supdate between vfrom_supdate and vtill_supdate and
            s.sup_ty_code=d.sup_type_code
            order by sup_seq_no;

     rec_sup_type cur_sup_type%rowtype;
     vvar           varchar2(4000);
     vvar_sum       varchar2(4000);
     vquery         varchar2(4000);
     vquery1        varchar2(4000);

     Begin
       vfrom_supdate:=to_date(pfrom_supdate,''''||pdateformat||'''');
       vtill_supdate:=to_date(ptill_supdate,''''||pdateformat||'''');
    open cur_sup_type;
    loop
        fetch cur_sup_type into rec_sup_type;
      exit when cur_sup_type%notfound;
          vvar        :=vvar||rec_sup_type.vty;
          vvar_sum:=vvar_sum||rec_sup_type.vty_sum;
    end loop;
    close cur_sup_type;

    vvar        :=substr(vvar,1,length(vvar)-1);
    vvar_sum    :=substr(vvar_sum,1,length(vvar_sum)-1);
    --insert into test1(vstring) values (vquery);
    If vvar is null then
        vquery:=' select comp_code AS "COMP_CODE",(select distinct "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=unit_code) AS "UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS "PUBL_NAME",sup_rate as "SUP_RATE", supdate AS "SUPDATE",sum(sup_copy) AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by comp_code,unit_code,publ_name,supdate,sup_rate';
    Else
        vquery:=' select comp_code AS "COMP_CODE",(select distinct "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=unit_code) AS "UNIT_CODE",publ AS "PUBL",cir_get_publ_name(comp_code,publ)AS "PUBL_NAME",sup_rate as "SUP_RATE", supdate AS "SUPDATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||') and
                to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,unit_code,sup_rate,supdate,publ order by comp_code,unit_code,publ_name,supdate,sup_rate';
    End if;                                    
      --          insert into test1(vstring) values ('11'||vquery);commit;
    open p_accounts for vquery;
    
    If vvar is null then
        vquery1:=' select comp_code AS "COMP_CODE",sup_rate as "SUP_RATE",sum(sup_copy) AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    else
        vquery1:=' select comp_code AS "COMP_CODE",sup_rate as "SUP_RATE",'||vvar||','||vvar_sum||' AS "TOTAL" from cir_dbksup where comp_code='||
                ''''||pcomp_code||''''||' and
                ((unit_code='||''''||punit_code||''''||') or ('||''''||punit_code||''''||' is null)) and
                ((publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and
                supdate between '||'to_date('||''''||pfrom_supdate||''''||','||''''||pdateformat||''''||')
                and to_date('||''''||ptill_supdate||''''||','||''''||pdateformat||''''||')
                group by comp_code,sup_rate order by comp_code,sup_rate';
    end if;
    --insert into test1(vstring) values ('22'||vquery1);commit;
    open p_accounts1 for vquery1;
  End cir_rep_supply_unit;

procedure cir_dist_taluka_publ_wise(
     pcompcode      in varchar2,
     punitcode      in varchar2,
     pbrancode      in varchar2,
     ppublcode      in varchar2,
     pmainedtn      in varchar2,
     pedtncode      in varchar2,
     pdistcode      in varchar2,
     ptalukacode    in varchar2,
     pagtypecode    in varchar2,
     pagclasscode   in varchar2,
     pagcd          in varchar2,
     pdpcd          in varchar2,
     pfrom_supdate  in varchar2,
     ptill_supdate  in varchar2,
     plangtype      in varchar2,
     pdateformat    in varchar2,
     pextra1        in varchar2,--it is used for agency supply type
     pextra2        in varchar2,--it is used for break on district/taluka wise or datewise(1/2)
     p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(32000);
      v_query1    varchar2(32000);
      
     cursor cur_edtn is
        select distinct d.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (m.agcd=pagcd or pagcd is null) and (m.dpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (d.edtn=pedtncode or pedtncode is null) and (e.main_edtn=pmainedtn or pmainedtn is null) and  
              (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
              (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='S' and nvl(sup_rate,0)>0
        union
        select p.publ publ,p.publ_seqno publ_seqno,e. edtn edtn,e.EDTN_SEQ_NO edtn_seqno,
        substr(e.edition_nick,1,15) edtn_name,d.sup_rate sup_rate,e.main_edtn main_edtn
        from cir_agmast m,cir_dbksup d ,cir_publ_mast p,cir_edtn_mast e
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and m.unit=d.unit_code and d.unit_code = e.unit_code and d.unit_code = punitcode and
              d.supdate between vsupdate and vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and (d.billagcd=pagcd or pagcd is null) and (d.billdpcd=pdpcd or pdpcd is null) and (d.publ=ppublcode or ppublcode is null) and
              d.publ=p.publ and d.edtn=e.edtn and (d.edtn=pedtncode or pedtncode is null) and (e.main_edtn=pmainedtn or pmainedtn is null) and 
              (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
               (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (m.branch_code=pbrancode or pbrancode is null) and pextra1='B' and nvl(sup_rate,0)>0
        order by publ_seqno,publ,edtn_seqno,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(8000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        --delete test1;insert into test1(vstring,vstring2)
        --values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;

        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            if vvar is null then
                --vvar        :='sum(decode(d.edtn||d.sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',d.sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar        :='case when d.edtn||d.sup_rate='||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||' then sum(d.sup_copy) else 0 end "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'case when d.edtn||d.sup_rate='||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||' then sum(d.sup_copy) else 0 end"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
                        
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
        --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise ',vvar||' , '||vvar_sum1);commit;
        if pextra2='2' then--for datewise
            if vvar is null then
                if upper(pextra1)='S' then
                    v_query:='select comp_code,unit_code,supdate,
                    station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.comp_code = '||''''||pcompcode||''''||' and d.unit_code = m.unit and   
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,m.dist_code,d.supdate,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
                else
                    v_query:='select comp_code,unit_code,supdate,
                    station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
                    group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
                end if;    
            else
                if upper(pextra1)='S' then
                    v_query:='select comp_code,unit_code,supdate,
                    station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,supdate,agency_name';
                 else   
                    v_query:='select comp_code,unit_code,supdate,
                    station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||'
                    and nvl(d.sup_rate,0)>0 
                    group by d.comp_code,d.unit_code,d.supdate,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,supdate,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,supdate,agency_name';
                 end if;
            end if;
        else--- for district/taluka wise
            if vvar is null then
                if upper(pextra1)='S' then
                    v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                    tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,dist_name,taluka_name,agcd,dpcd,agency_name';
                else    
                    v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                    tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and 
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,d.supdate,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,dist_name,taluka_name,agcd,dpcd,agency_name';
                 end if;   
            else
                if upper(pextra1)='S' then
                    v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                    tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and '||''''||pextra1||''''||'=''S'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,dist_name,taluka_name,agency_name';
                else    
                    v_query:='select comp_code,unit_code,dist_code,cir_get_name.cir_district(comp_code,dist_code,''1'','||''''||pdateformat||''''||','''','''') dist_name,
                    tehsil_taluka,cir_get_name.cir_taluka(comp_code,tehsil_taluka,''1'','||''''||pdateformat||''''||','''','''') taluka_name,station_code,cir_get_name.cir_drop_point(comp_code,unit_code,station_code,''1'','||''''||pdateformat||''''||','''','''') drop_point,
                    agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd agcd,d.dpcd dpcd,
                    case when '||''''||plangtype||''''||'=''1'' then
                        substr(m.ag_name,1,25)
                    else
                        substr(m.ag_name_oth_lang,1,25)
                    end agency_name,'||vvar||' from cir_dbksup d,cir_agmast m,cir_edtn_mast e
                    where d.comp_code = m.comp_code and d.comp_code = e.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
                    d.unit_code = '||''''||punitcode||''''||' and (d.publ = '||''''||ppublcode||''''||' or '||''''||ppublcode||''''||' is null) and
                    d.edtn=e.edtn and (d.edtn = '||''''||pedtncode||''''||' or '||''''||pedtncode||''''||' is null) and (e.main_edtn = '||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null) and
                    d.agcd = m.agcd and d.dpcd = m.dpcd and d.billagcd=nvl('||''''||pagcd||''''||',d.billagcd) and d.billdpcd=nvl('||''''||pdpcd||''''||',d.billdpcd) and '||''''||pextra1||''''||'=''B'' and
                    (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                    (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
                    (m.branch_code='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
                    and nvl(d.sup_rate,0)>0
                    group by d.comp_code,d.unit_code,m.dist_code,m.tehsil_taluka,m.station_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,d.edtn,d.sup_rate)
                    group by comp_code,unit_code,dist_code,tehsil_taluka,station_code,agcd,dpcd,agency_name
                    order by comp_code,unit_code,dist_name,taluka_name,agency_name';
                end if;    
            end if;


        end if;

        --insert into test1(vstring,vstring2) values('cir_dist_taluka_publ_wise v_query',v_query||v_query1);commit;

        open p_accounts for v_query;

    End cir_dist_taluka_publ_wise;

    procedure cir_datewise_resale(
        pcompcode      in varchar2,
        punitcode      in varchar2,
        pbrancode      in varchar2,
        ppublcode      in varchar2,
        pmainedtn      in varchar2,
        pedtncode      in varchar2,
        pdistcode      in varchar2,
        ptalukacode    in varchar2,
        pagtypecode    in varchar2,
        pagclasscode   in varchar2,
        pagcd          in varchar2,
        pdpcd          in varchar2,
        pfrom_supdate  in varchar2,
        ptill_supdate  in varchar2,
        plangtype      in varchar2,
        pdateformat    in varchar2,
        pextra1        in varchar2,
        pextra2        in varchar2,
        p_accounts     out t_accounts)
     as
     vsupdate   date;
     vsupdate1  date;
     v_query    varchar2(8000);
     cursor cur_edtn is
        select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
         case when plangtype='1' then
          substr(p.edition_nick,1,15)
         else
          substr(p.edtn_name_oth_lang,1,20)
         end edtn_name,d.sup_rate sup_rate,p.main_edtn main_edtn
        from cir_agmast m,cir_dbksup_resale d ,cir_edtn_mast p
        where m.comp_code=pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and m.unit=d.unit_code and 
              m.unit=p.unit_code and d.unit_code = punitcode and
              d.supdate >= vsupdate and d.supdate <=vsupdate1 and
              m.agcd=d.agcd and m.dpcd=d.dpcd and m.agcd=nvl(pagcd,m.agcd) and m.dpcd=nvl(pdpcd,m.dpcd) and d.publ=nvl(ppublcode,d.publ) and
              d.publ=p.publ and d.edtn=p.edtn and (m.dist_code=pdistcode or pdistcode is null) and (m.tehsil_taluka=ptalukacode or ptalukacode is null) and
              (m.ag_type=pagtypecode or pagtypecode is null) and (m.ag_class=pagclasscode or pagclasscode is null) and
              (d.resale_branch=pbrancode or pbrancode is null)
        order by publ,main_edtn,edtn_seqno,edtn,sup_rate;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(4000);
     vvar_sum   varchar2(4000);
     vvar_sum1  varchar2(4000);
     vquery     varchar2(8000);
    Begin
        vsupdate :=to_date(pfrom_supdate,''''||pdateformat||'''');
        vsupdate1:=to_date(ptill_supdate,''''||pdateformat||'''');
        --delete test1;insert into test1(vstring,vstring2)
        --values('1111 '||vvar,' vsupdate '||vsupdate||' pdateformat '||pdateformat||' psupdate1 '||vsupdate1||' PEXTRA1 '||pextra1||' pagcd '||pagcd||' pdpcd '||pdpcd);commit;
        open cur_edtn;
        loop
          fetch cur_edtn into rec_edtn;
          exit when cur_edtn%notfound;
            if vvar is null then
                --vvar    :='decode(u.edtn||u.copy_rate,'||''''||rec_edtn.edtn||rec_edtn.copy_rate||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                --tot_vvar:=',sum("'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'") "'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
                
                vvar        :='sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :='sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            else
                vvar        :=vvar||','||'sum(decode(edtn||sup_rate,'||''''||rec_edtn.edtn||rec_edtn.sup_rate||''''||',sup_copy,0))"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum    :=vvar_sum||','||'sum('||'"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'") "'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
                vvar_sum1   :=vvar_sum1||'+"'||rec_edtn.edtn_name||'_'||rec_edtn.sup_rate||'"';
            end if;
        end loop;
        close cur_edtn;
        if vvar_sum1 is not null then
            vvar_sum1:=vvar_sum1||') Total';
        end if;
        --insert into test1(vstring,vstring2) values('cir_datewise_resale ',vvar||' , '||vvar_sum1);commit;

        if vvar is null then
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name from(select d.comp_code,d.unit_code,d.agcd agcd,d.dpcd dpcd,d.supdate supdate,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <='||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agcd,dpcd,agency_name';
        else
            v_query:='select comp_code,unit_code,supdate,
            agcd,dpcd,agency_name,'||vvar_sum||','||vvar_sum1||' from(select d.comp_code,d.unit_code,d.supdate supdate,d.agcd agcd,d.dpcd dpcd,
            case when '||''''||plangtype||''''||'=''1'' then
                substr(m.ag_name,1,25)
            else
                substr(m.ag_name_oth_lang,1,25)
            end agency_name,'||vvar||' from cir_dbksup_resale d,cir_agmast m
            where d.comp_code = m.comp_code and d.unit_code = m.unit and d.comp_code = '||''''||pcompcode||''''||' and
            d.unit_code = '||''''||punitcode||''''||' and d.publ = nvl('||''''||ppublcode||''''||',d.publ) and
            d.agcd = m.agcd and d.dpcd = m.dpcd and d.agcd=nvl('||''''||pagcd||''''||',d.agcd) and d.dpcd=nvl('||''''||pdpcd||''''||',d.dpcd) and 
            (m.dist_code = '||''''||pdistcode||''''||' or '||''''||pdistcode||''''||' is null) and (m.tehsil_taluka = '||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
            (m.ag_type='||''''||pagtypecode||''''||' or '||''''||pagtypecode||''''||' is null) and (m.ag_class='||''''||pagclasscode||''''||' or '||''''||pagclasscode||''''||' is null) and
            (d.resale_branch='||''''||pbrancode||''''||' or '||''''||pbrancode||''''||' is null) and d.supdate >= '||''''||vsupdate||''''||' and d.supdate <= '||''''||vsupdate1||''''||' 
            group by d.comp_code,d.unit_code,d.supdate,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang)
            group by comp_code,unit_code,supdate,agcd,dpcd,agency_name
            order by comp_code,unit_code,supdate,agency_name';
        end if;

        --insert into test1(vstring,vstring2) values('cir_datewise_resale v_query',v_query);commit;

        open p_accounts for v_query;

    End cir_datewise_resale;
END cir_rep_supply;
/
//////////////////////////////////////////////end of issue 4763////////////////////////////////////////////////////////




//////////////////////////////////////////////issue no. 4488 30/10/2011//////////////////////////////////////////////

////////////////////////////////////////description////////////////////////////////////////////////

CREATE OR REPLACE PACKAGE HT18JULY.cir_rep_unsold_supply IS
  type t_accounts is ref cursor;
  procedure cir_rep_unsold_detail(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type            in varchar2,
     ppubl                 in varchar2,
     pmainedtn             in varchar2,
     pedtn                 in varchar2,
     pcity                in varchar2,
     pagcode            in varchar2,
     pdepocode            in varchar2,
     pfrom_recdate         in varchar2,
     ptill_recdate      in varchar2,
     papproved_flag     in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

  procedure cir_rep_unsold_summary(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pcity              in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfrom_recdate      in varchar2,
     ptill_recdate      in varchar2,
     papproved_flag     in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);
     
   procedure cir_publ_unsold_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfromdate          in varchar2,
     ptilldate          in varchar2,
     papproved_flag     in varchar2,
     ptaluka            in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);
  
  procedure cir_edtn_unsold_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfromdate          in varchar2,
     ptilldate          in varchar2,
     papproved_flag     in varchar2,
     ptaluka            in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);

  procedure cir_edtn_unsold_supply_dist(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfromdate          in varchar2,
     ptilldate          in varchar2,
     papproved_flag     in varchar2,
     pdistcd            in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);
     
      procedure cir_monthly_net_paid_sale(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pfromdate          in varchar2,
     ptilldate          in varchar2,
     pagency_type       in varchar2,
     pagency_class      in varchar2,
     pstatecode         in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pbranch            in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     preptype           in number,--1 for Agency Wise,2 for Main Edition wise,3 for District Taluka wise
     pbreak_on          in varchar2,--Region R/State S/District D/Branch B
     preturn_based      in varchar2,--it is use for return date or supply date(R/S)
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts);
     
  procedure cir_rep_unsold_slip(
     pcompcode             in varchar2,
     punitcode             in varchar2,
     pbrancode             in varchar2,
     pdoctype            in varchar2,
     pdistcode            in varchar2,
     ptalukacode        in varchar2,
     pagcode            in varchar2,
     pagsubcode            in varchar2,
     pfrom_recdate         in varchar2,
     ptill_recdate      in varchar2,
     papproved_flag     in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);

  procedure cir_unsold_return_punya(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbran_code         in varchar2,
     pdoc_type            in varchar2,
     ppubl                 in varchar2,
     pmainedtn             in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pcitycode          in varchar2,
     pagcode            in varchar2,
     pdepocode            in varchar2,
     pfrom_recdate         in varchar2,
     ptill_recdate      in varchar2,
     papproved_flag     in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts5        out t_accounts,
     p_accounts6        out t_accounts);

    procedure cir_rep_unsold_challan(
     pcompcode             in varchar2,
     punitcode             in varchar2,
     pdoctype            in varchar2,
     pagcode            in varchar2,
     pagsubcode            in varchar2,
     pfrom_recdate         in varchar2,
     ptill_recdate      in varchar2,
     precptno           in varchar2,
     papproved_flag     in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts);     
END cir_rep_unsold_supply;
/
/////////////////////////////////////////////////////////body////////////////////////////////////////////////


CREATE OR REPLACE PACKAGE BODY HT18JULY.cir_rep_unsold_supply IS
  procedure cir_rep_unsold_detail(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pcity              in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfrom_recdate      in varchar2,
     ptill_recdate      in varchar2,
     papproved_flag     in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts)
  As
       v_frdt    date;
       v_todt    date;
  Begin  
       v_frdt:=to_date(pfrom_recdate,''''||pdateformat||'''');
       v_todt:=to_date(ptill_recdate,''''||pdateformat||'''');
       
           open p_accounts for
               select u.comp_code comp_code,u.unit_code unit_code,u.doctype doctype,u.recptno recptno,u.recptdt recptdt,
                    u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,u.city_name city_name,
                    u.supdate supdate,u.supply_copy supply_copy,
                    u.short_recpt short_recpt,u.late_recpt late_recpt,u.bnr bnr,u.unsold unsold,
                    u.copy_rate copy_rate,u.comm_rate comm_rate,u.waste_alw waste_alw,u.waste_rate waste_rate,u.copy_amt copy_amt,
                    u.comm_amt comm_amt,u.waste_amt waste_amt,u.total_amt total_amt from
               (select b.comp_code comp_code,b.unit_code unit_code,b.doctype doctype,b.recptno recptno,b.recptdt recptdt,
                    b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,cir_get_city(b.comp_code,a.city_code) city_name,
                    b.supdate supdate,sum(b.supply_copy) supply_copy,
                    sum(b.apr_short_recpt) short_recpt,sum(b.apr_late_recpt) late_recpt,sum(b.apr_bnr) bnr,sum(b.apr_unsold) unsold,
                    b.copy_rate copy_rate,b.comm_rate comm_rate,b.waste_alw waste_alw,b.waste_rate waste_rate,
                    sum(nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0))*b.copy_rate copy_amt,
                    sum(b.comm_amt) comm_amt,sum(b.waste_amt) waste_amt,sum(nvl(b.copy_amt,0)) total_amt 
               from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e
               where b.comp_code = a.comp_code and b.comp_code = e.comp_code and b.comp_code =pcomp_code and 
                     b.unit_code=a.unit and b.unit_code=e.unit_code and b.unit_code=punit_code and 
                     b.doctype=pdoc_type and b.app_dt between v_frdt and v_todt and 
                     a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd=pagcode) or (pagcode is null)) and b.dpcd=nvl(pdepocode,b.dpcd) and 
                     b.publ=e.publ and b.publ=nvl(ppubl,b.publ) and b.edtn=e.edtn and b.edtn=nvl(pedtn,b.edtn) and
                     a.city_code=nvl(pcity,a.city_code) and
                     (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and 
                     e.main_edtn=nvl(pmainedtn,e.main_edtn) and upper(nvl(papproved_flag,'N'))='Y'
                     group by b.comp_code,b.unit_code,b.doctype,b.recptno,b.recptdt,b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,
                     a.city_code,b.supdate,b.copy_rate,b.comm_rate,b.waste_alw,b.waste_rate
               union
               select b.comp_code comp_code,b.unit_code unit_code,b.doctype doctype,b.recptno recptno,b.recptdt recptdt,
                    b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,cir_get_city(b.comp_code,a.city_code) city_name,
                    b.supdate supdate,sum(b.supply_copy) supply_copy,
                    sum(b.short_recpt) short_recpt,sum(b.late_recpt) late_recpt,sum(b.bnr) bnr,sum(b.unsold) unsold,
                    b.copy_rate copy_rate,b.comm_rate comm_rate,b.waste_alw waste_alw,b.waste_rate waste_rate,
                    sum(nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0))*b.copy_rate copy_amt,
                    sum(b.comm_amt) comm_amt,sum(b.waste_amt) waste_amt,sum(nvl(b.copy_amt,0)) total_amt 
               from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e
               where b.comp_code = a.comp_code and b.comp_code = e.comp_code and b.comp_code =pcomp_code and 
                     b.unit_code=a.unit and b.unit_code=e.unit_code and b.unit_code=punit_code and 
                     b.doctype=pdoc_type and b.recptdt between v_frdt and v_todt and 
                     a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd=pagcode) or (pagcode is null)) and b.dpcd=nvl(pdepocode,b.dpcd) and 
                     b.publ=e.publ and b.publ=nvl(ppubl,b.publ) and b.edtn=e.edtn and b.edtn=nvl(pedtn,b.edtn) and
                     a.city_code=nvl(pcity,a.city_code) and
                     (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and 
                     e.main_edtn=nvl(pmainedtn,e.main_edtn) and upper(nvl(papproved_flag,'N'))='N'
                     group by b.comp_code,b.unit_code,b.doctype,b.recptno,b.recptdt,b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,
                     a.city_code,b.supdate,b.copy_rate,b.comm_rate,b.waste_alw,b.waste_rate) u 
                     order by u.comp_code,u.unit_code,u.recptdt,u.recptno,u.agname;
  End cir_rep_unsold_detail;

  procedure cir_rep_unsold_summary(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pcity              in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfrom_recdate      in varchar2,
     ptill_recdate      in varchar2,
     papproved_flag     in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts)
  As
     v_frdt     date;
     v_todt    date;
  Begin
       v_frdt:=to_date(pfrom_recdate,''''||pdateformat||'''');
       v_todt:=to_date(ptill_recdate,''''||pdateformat||'''');
       
       if upper(nvl(papproved_flag,'N'))='Y' then
           open p_accounts for
           select b.comp_code comp_code,b.unit_code unit_code,b.doctype doctype,b.recptno recptno,b.recptdt recptdt,
                        b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,cir_get_city(b.comp_code,a.city_code) city_name,
                        sum(b.apr_short_recpt) short_recpt,sum(b.apr_late_recpt) late_recpt,sum(b.apr_bnr) bnr,sum(b.apr_unsold) unsold,
                        sum(nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0))*b.copy_rate copy_amt,
                        sum(b.comm_amt) comm_amt,sum(b.waste_amt) waste_amt,sum(nvl(b.copy_amt,0)) total_amt 
               from cir_agmast a,cir_unsold_dtl b
               where b.comp_code    =a.comp_code and b.comp_code    =pcomp_code and 
                           b.unit_code=a.unit and b.unit_code=punit_code and 
                           b.doctype=pdoc_type and b.app_dt between v_frdt and v_todt and 
                           a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd=pagcode) or (pagcode is null)) and
                           ((b.dpcd=pdepocode) or (pdepocode is null)) and 
                           ((b.publ=ppubl) or (ppubl is null)) and ((b.edtn=pedtn) or (pedtn is null)) and
                           ((a.city_code=pcity) or (pcity is null)) and
                           (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                           b.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                           group by b.comp_code,b.unit_code,b.doctype,b.recptno,b.recptdt,b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.city_code
                           order by b.comp_code,b.unit_code,b.recptdt,b.recptno,city_name,agname;
       else
           open p_accounts for
           select b.comp_code comp_code,b.unit_code unit_code,b.doctype doctype,b.recptno recptno,b.recptdt recptdt,
                        b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,cir_get_city(b.comp_code,a.city_code) city_name,
                        sum(b.short_recpt) short_recpt,sum(b.late_recpt) late_recpt,sum(b.bnr) bnr,sum(b.unsold) unsold,
                        sum(nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0))*b.copy_rate copy_amt,
                        sum(b.comm_amt) comm_amt,sum(b.waste_amt) waste_amt,sum(nvl(b.copy_amt,0)) total_amt 
               from cir_agmast a,cir_unsold_dtl b
               where b.comp_code    =a.comp_code and b.comp_code    =pcomp_code and 
                           b.unit_code=a.unit and b.unit_code=punit_code and 
                           b.doctype=pdoc_type and b.recptdt between v_frdt and v_todt and 
                           a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd=pagcode) or (pagcode is null)) and
                           ((b.dpcd=pdepocode) or (pdepocode is null)) and
                           ((b.publ=ppubl) or (ppubl is null)) and ((b.edtn=pedtn) or (pedtn is null)) and
                           (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                           b.edtn in(select distinct edtn from cir_edtn_mast where comp_code=pcomp_code and (edtn = pedtn or pedtn is null) and (main_edtn=pmainedtn or pmainedtn is null))
                            group by b.comp_code,b.unit_code,b.doctype,b.recptno,b.recptdt,b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.city_code                           
                           order by b.comp_code,b.unit_code,b.recptdt,b.recptno,city_name,agname;
       end if;    
  End cir_rep_unsold_summary;
  
   procedure cir_publ_unsold_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfromdate          in varchar2,
     ptilldate          in varchar2,
     papproved_flag     in varchar2,
     ptaluka            in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,--for group based on State S,District D,Taluka T,Branch B
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts)
  As
       v_frdt    date;
       v_todt    date;
       v_query1     varchar2(8000);
      cursor cur_publ is
          select distinct p.publ publ,p.publ_name publ_name from cir_publ_mast p,cir_agmast a,cir_unsold_dtl b
               where b.comp_code    =a.comp_code and b.comp_code    =p.comp_code and b.comp_code = pcomp_code and 
                    b.unit_code=a.unit and b.unit_code=punit_code and 
                   b.doctype=pdoc_type and b.recptdt between v_frdt and v_todt and 
                   b.publ=p.publ and b.publ=nvl(ppubl,b.publ) and 
                   a.agcd=b.agcd and b.agcd=nvl(pagcode,b.agcd) and a.dpcd=b.dpcd and b.dpcd=nvl(pdepocode,b.dpcd) and 
                   ((a.tehsil_taluka=ptaluka) or (ptaluka is null)) and
                   (upper(nvl(papproved_flag,'N'))='Y' and (nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0))>0) or
                   (upper(nvl(papproved_flag,'N'))='N' and (nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0))>0)
                   order by publ;

     v1 cur_publ%rowtype;
     vvar       varchar2(4000);
     vvar1      varchar2(4000);
     vtot_publ  varchar2(2000);
     v_cnt      number:=0;
  Begin
       v_frdt:=to_date(pfromdate,''''||pdateformat||'''');
       v_todt:=to_date(ptilldate,''''||pdateformat||'''');
        --delete from test1;
    open cur_publ;
    loop
        fetch cur_publ into v1;
      exit when cur_publ%notfound;
          v_cnt :=nvl(v_cnt,0)+1;
          if vvar is null then
              vvar        :='decode(u.publ,'||''''||v1.publ||''''||','||''''||v1.publ_name||''''||')"'||v1.publ_name||'",decode(u.publ,'||''''||v1.publ||''''||',sum(u.supply_copy))"'||v1.publ||'_SUPPLY"';
              --vvar        :='decode(u.publ,'||''''||v1.publ||''''||',sum(u.supply_copy))"'||v1.publ||'_Supply"';
              vvar        :=vvar||',decode(u.publ,'||''''||v1.publ||''''||',sum(u.return_copy))"'||v1.publ||'_RETURN"';
              vvar        :=vvar||',round((decode(u.publ,'||''''||v1.publ||''''||',sum(u.return_copy))*100)/decode(u.publ,'||''''||v1.publ||''''||',sum(u.supply_copy)),2)"'||v1.publ||'_RETURN_PER"';
              --vvar1        :='"'||v1.publ_name||'"'||',sum("'||v1.publ||'_SUPPLY") "'||v1.publ||'_SUPPLY",sum("'||v1.publ||'_RETURN") "'||v1.publ||'_RETURN",sum("'||v1.publ||'_RETURN_PER") "'||v1.publ||'_RETURN_PER"';
              vvar1        :='sum("'||v1.publ||'_SUPPLY") "'||v1.publ||'_SUPPLY",sum("'||v1.publ||'_RETURN") "'||v1.publ||'_RETURN",sum("'||v1.publ||'_RETURN_PER") "'||v1.publ||'_RETURN_PER"';
              vtot_publ:=v1.publ_name;
          else
              vvar        :=vvar||',decode(u.publ,'||''''||v1.publ||''''||','||''''||v1.publ_name||''''||')"'||v1.publ_name||'",decode(u.publ,'||''''||v1.publ||''''||',sum(u.supply_copy))"'||v1.publ||'_SUPPLY"';
              --vvar        :=vvar||',decode(u.publ,'||''''||v1.publ||''''||',sum(u.supply_copy))"'||v1.publ||'_Supply"';
              vvar        :=vvar||',decode(u.publ,'||''''||v1.publ||''''||',sum(u.return_copy))"'||v1.publ||'_RETURN"';
              vvar        :=vvar||',round((decode(u.publ,'||''''||v1.publ||''''||',sum(u.return_copy))*100)/decode(u.publ,'||''''||v1.publ||''''||',sum(u.supply_copy)),2)"'||v1.publ||'_RETURN_PER"';
              --vvar1        :=vvar1||',"'||v1.publ_name||'"'||',sum("'||v1.publ||'_SUPPLY") "'||v1.publ||'_SUPPLY",sum("'||v1.publ||'_RETURN") "'||v1.publ||'_RETURN",sum("'||v1.publ||'_RETURN_PER") "'||v1.publ||'_RETURN_PER"';
              vvar1        :=vvar1||',sum("'||v1.publ||'_SUPPLY") "'||v1.publ||'_SUPPLY",sum("'||v1.publ||'_RETURN") "'||v1.publ||'_RETURN",sum("'||v1.publ||'_RETURN_PER") "'||v1.publ||'_RETURN_PER"';
              vtot_publ:=vtot_publ||''''||','||''''||v1.publ_name;
          end if;    
    end loop;
    close cur_publ;
        --insert into test1(vstring,vstring2) values('unsold var ',vvar);commit;
        --insert into test1(vstring,vstring2) values('unsold var1 ',vvar1);commit;
        --insert into test1(vstring,vstring2) values('unsold vtot_publ ',vtot_publ);commit;
       if vvar is not null and vvar1 is not null then
           If upper(nvl(papproved_flag,'N'))='Y' Then
               
               v_query1:='select comp_code,unit_code,agcd,dpcd,agname,agname_oth_lang,city_name,taluka_name,'||vvar1 ||' from (select u.comp_code comp_code,u.unit_code unit_code,
               u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
               nvl(cir_get_city(u.comp_code,u.city_code),''NA'') city_name,nvl(cir_get_taluka(u.comp_code,u.taluka_code),''NA'') taluka_name,
               u.publ publ,cir_get_publ_name(comp_code,publ) publ_name,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.tehsil_taluka taluka_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.agcd,u.dpcd,u.agname,u.agname_oth_lang,
                                                nvl(cir_get_city(u.comp_code,u.city_code),''NA''),nvl(cir_get_taluka(u.comp_code,u.taluka_code),''NA''))
                               group by comp_code,unit_code,agcd,dpcd,agname,agname_oth_lang,city_name,taluka_name 
                               order by comp_code,unit_code,taluka_name,agname';
                               --insert into test1(vstring,vstring2) values('unsold vquery1 ',v_query1);commit;
               Begin
                  open p_accounts for v_query1;           
                     exception when others then 
                          p_accounts:=null;
                  End;        
               v_query1:='select comp_code,unit_code,taluka_name,'||vvar1 ||' from (select u.comp_code comp_code,u.unit_code unit_code,
               nvl(cir_get_taluka(u.comp_code,u.taluka_code),''NA'') taluka_name,u.publ publ,cir_get_publ_name(comp_code,publ) publ_name,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.tehsil_taluka taluka_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,nvl(cir_get_taluka(u.comp_code,u.taluka_code),''NA''))
                               group by comp_code,unit_code,taluka_name
                               order by comp_code,unit_code,taluka_name';
                --insert into test1(vstring,vstring2) values('unsold vquery2 ',v_query1);commit;
               Begin
                  open p_accounts1 for v_query1;           
                     exception when others then
                          p_accounts1:=null;
                  End;  
               v_query1:='select comp_code,unit_code,'||vvar1 ||' from (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,cir_get_publ_name(comp_code,publ) publ_name,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.tehsil_taluka taluka_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ)
                               group by comp_code,unit_code 
                               order by comp_code,unit_code';
               --insert into test1(vstring,vstring2) values('unsold vquery3 ',v_query1);commit;
               --open p_accounts2 for v_query1;
               Begin
                  open p_accounts2 for v_query1;           
                     exception when others then 
                          p_accounts2:=null;
                  End;
           Else
               if vvar1 is not null then
                   v_query1:='select comp_code,unit_code,agcd,dpcd,agname,agname_oth_lang,city_name,taluka_name,'||vvar1 ||' from (select u.comp_code comp_code,u.unit_code unit_code,
                   u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
                   nvl(cir_get_city(u.comp_code,u.city_code),''NA'') city_name,nvl(cir_get_taluka(u.comp_code,u.taluka_code),''NA'') taluka_name,
                   u.publ publ,cir_get_publ_name(comp_code,publ) publ_name,'||vvar
                   ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,
                                b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                                a.city_code city_code,a.tehsil_taluka taluka_code,
                                (select sum(sup_copy) from cir_dbksup 
                                where comp_code=b.comp_code and unit_code=b.unit_code and 
                                            agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                                nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
                       from cir_agmast a,cir_unsold_dtl b
                       where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                                   b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                                   b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                                   ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                                   a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                                   ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                                   (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                                   b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                                   where u.supply_copy>0
                                   group by u.comp_code,u.unit_code,u.publ,u.agcd,u.dpcd,u.agname,u.agname_oth_lang,
                                            nvl(cir_get_city(u.comp_code,u.city_code),''NA''),nvl(cir_get_taluka(u.comp_code,u.taluka_code),''NA''))
                                   group by comp_code,unit_code,agcd,dpcd,agname,agname_oth_lang,city_name,taluka_name                  
                                   order by comp_code,unit_code,taluka_name,agname';
               end if;    
                --insert into test1(vstring,vstring2) values('unsold vquery1 ',v_query1);COMMIT;
               --open p_accounts for v_query1;
               Begin
                  open p_accounts for v_query1;           
                     exception when others then 
                          p_accounts:=null;
                  End;
                if vvar1 is not null then
                   v_query1:='select comp_code,unit_code,taluka_name,'||vvar1 ||' from (select u.comp_code comp_code,u.unit_code unit_code,
                   nvl(cir_get_taluka(u.comp_code,u.taluka_code),''NA'') taluka_name,'||vvar
                   ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,
                                b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                                a.city_code city_code,a.tehsil_taluka taluka_code,
                                (select sum(sup_copy) from cir_dbksup 
                                where comp_code=b.comp_code and unit_code=b.unit_code and 
                                            agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                                nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
                       from cir_agmast a,cir_unsold_dtl b
                       where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                                   b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                                   b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                                   ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                                   a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                                   ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                                   (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                                   b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                                   where u.supply_copy>0
                                   group by u.comp_code,u.unit_code,u.publ,cir_get_taluka(u.comp_code,u.taluka_code))
                                   group by comp_code,unit_code,taluka_name
                                   order by comp_code,unit_code,taluka_name';
                   --insert into test1(vstring,vstring2) values('unsold vquery2 ',v_query1);COMMIT;
              end if;
               --open p_accounts1 for v_query1;
               Begin
                  open p_accounts1 for v_query1;           
                     exception when others then 
                          p_accounts1:=null;
                  End; 
                if vvar1 is not null then
                   v_query1:='select comp_code,unit_code,'||vvar1 ||' from (select u.comp_code comp_code,u.unit_code unit_code,'||vvar
                   ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,
                                b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                                a.city_code city_code,a.tehsil_taluka taluka_code,
                                (select sum(sup_copy) from cir_dbksup 
                                where comp_code=b.comp_code and unit_code=b.unit_code and 
                                            agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                                nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
                       from cir_agmast a,cir_unsold_dtl b
                       where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                                   b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                                   b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                                   ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                                   a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                                   ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                                   (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                                   b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                                   where u.supply_copy>0
                                   group by u.comp_code,u.unit_code,u.publ)
                                   group by comp_code,unit_code
                                   order by comp_code,unit_code';--,'||vtot_publ;
                   end if;
                --insert into test1(vstring,vstring2) values('unsold vquery3 ',v_query1);COMMIT;
              --open p_accounts2 for v_query1;
              Begin
                  open p_accounts2 for v_query1;           
                     exception when others then 
                          p_accounts2:=null;
                  End;
           End if;
             v_query1:='select '||''''||vtot_publ||''''||' from dual';
             --open p_accounts3 for v_query1;
                    Begin
                  open p_accounts3 for v_query1;           
                     exception when others then 
                          p_accounts3:=null;
                  End;
        End if;

  End cir_publ_unsold_supply;


    procedure cir_edtn_unsold_supply(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfromdate          in varchar2,
     ptilldate          in varchar2,
     papproved_flag     in varchar2,
     ptaluka            in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts)
  As
       v_frdt    date;
       v_todt    date;
       v_query1  varchar2(32000);
      cursor cur_edtn is
          select distinct u.publ publ,u.edtn edtn,u.edtn_name edtn_name,u.edtn_seq_no edtn_seq_no from
          (select distinct e.publ publ,e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seq_no from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e 
          where b.comp_code = a.comp_code and b.comp_code = e.comp_code and b.comp_code=pcomp_code and
          b.unit_code = a.unit and b.unit_code = e.unit_code and b.unit_code = punit_code and 
          b.doctype=pdoc_type and b.recptdt>= v_frdt and b.recptdt <= v_todt and 
          b.publ=e.publ and b.publ=nvl(ppubl,e.publ) and b.edtn=e.edtn and b.edtn=nvl(pedtn,b.edtn) and 
          a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl(pagcode,b.agcd) and 
          b.dpcd=nvl(pdepocode,b.dpcd) and (a.tehsil_taluka=ptaluka or ptaluka is null) and
          nvl(papproved_flag,'N')='Y' and (nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0))>0
          union
          select distinct e.publ publ,e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seq_no from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e 
          where b.comp_code = a.comp_code and b.comp_code = e.comp_code and b.comp_code=pcomp_code and
          b.unit_code = a.unit and b.unit_code = e.unit_code and b.unit_code = punit_code and 
          b.doctype=pdoc_type and b.recptdt>= v_frdt and b.recptdt <= v_todt and 
          b.publ=e.publ and b.publ=nvl(ppubl,e.publ) and b.edtn=e.edtn and b.edtn=nvl(pedtn,b.edtn) and 
          a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl(pagcode,b.agcd) and 
          b.dpcd=nvl(pdepocode,b.dpcd) and (a.tehsil_taluka=ptaluka or ptaluka is null) and
          nvl(papproved_flag,'N')='N' and (nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0))>0) u
          order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(10000);
     tot_vvar   varchar2(10000);
     vtot_publ  varchar2(8000);
     v_cnt      number:=0;
  Begin
       v_frdt:=to_date(pfromdate,''''||pdateformat||'''');
       v_todt:=to_date(ptilldate,''''||pdateformat||'''');
    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
          v_cnt :=nvl(v_cnt,0)+1;
          if vvar is null then
              vvar        :='decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.supply_copy))"'||rec_edtn.edtn||'_SUPPLY"';
              vvar        :=vvar||',decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_RETURN"';
              vvar        :=vvar||',round((decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.return_copy))*100)/decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.supply_copy)),2)"'||rec_edtn.edtn||'_RETURN_PER"';
              tot_vvar:=',sum("'||rec_edtn.edtn||'_SUPPLY") "'||rec_edtn.edtn||'_SUPPLY"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_RETURN") "'||rec_edtn.edtn||'_RETURN"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_RETURN_PER") "'||rec_edtn.edtn||'_RETURN_PER"';
              vtot_publ:=rec_edtn.edtn_name;
          else
              vvar        :=vvar||',decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.supply_copy))"'||rec_edtn.edtn||'_SUPPLY"';
              vvar        :=vvar||',decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_RETURN"';
              vvar        :=vvar||',round((decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.return_copy))*100)/decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.supply_copy)),2)"'||rec_edtn.edtn||'_RETURN_PER"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_SUPPLY") "'||rec_edtn.edtn||'_SUPPLY"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_RETURN") "'||rec_edtn.edtn||'_RETURN"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_RETURN_PER") "'||rec_edtn.edtn||'_RETURN_PER"';
              vtot_publ:=vtot_publ||''''||','||''''||rec_edtn.edtn_name;
          end if;    
    end loop;
    close cur_edtn;
    
        --delete test1;
        --insert into test1(vstring,vstring2) values('unsold edtn vvar ',vvar);COMMIT;
        --insert into test1(vstring,vstring2) values('unsold edtn TOT_vvar ',tot_vvar);COMMIT;
        if vvar is not null then
           If nvl(papproved_flag,'N')='Y' Then
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code,c.agcd agcd,c.dpcd dpcd,c.agname agname,c.agname_oth_lang agname_oth_lang,
               nvl(cir_get_city(c.comp_code,c.city_code),''NA'') city_name,nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'') taluka_name '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,
               u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,u.city_code city_code,u.taluka_code taluka_code,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.tehsil_taluka taluka_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.agcd,u.dpcd,u.agname,u.agname_oth_lang,
                               u.city_code,u.taluka_code) c
                               group by c.comp_code,c.unit_code,c.agcd,c.dpcd,c.agname,c.agname_oth_lang,nvl(cir_get_city(c.comp_code,c.city_code),''NA''),
                               nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'')
                               order by c.comp_code,c.unit_code,nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA''),c.agname';
                                              
               --insert into test1(vstring,vstring2) values('unsold edtn YY ',v_query1);COMMIT;
               open p_accounts for v_query1;           
               
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code,
               nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'') taluka_name '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,
               u.taluka_code taluka_code,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.tehsil_taluka taluka_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                            agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.taluka_code) c
                               group by c.comp_code,c.unit_code,nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'')
                               order by c.comp_code,c.unit_code,nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'')';
                
                --insert into test1(vstring,vstring2) values('unsold edtn v_query2 ',v_query1);COMMIT;
                open p_accounts1 for v_query1;
               
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.tehsil_taluka taluka_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,cir_get_edtn_name(u.comp_code,u.edtn))c
                               group by c.comp_code,c.unit_code
                               order by c.comp_code,c.unit_code';
               --insert into test1(vstring,vstring2) values('unsold edtn v_query3 ',v_query1);COMMIT;
               open p_accounts2 for v_query1;
           Else
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code,c.agcd agcd,c.dpcd dpcd,c.agname agname,c.agname_oth_lang agname_oth_lang,
               nvl(cir_get_city(c.comp_code,c.city_code),''NA'') city_name,nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'') taluka_name '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,
               u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,u.city_code city_code,u.taluka_code taluka_code,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.tehsil_taluka taluka_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                               (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.agcd,u.dpcd,u.agname,u.agname_oth_lang,
                               u.city_code,u.taluka_code) c
                               group by c.comp_code,c.unit_code,c.agcd,c.dpcd,c.agname,c.agname_oth_lang,nvl(cir_get_city(c.comp_code,c.city_code),''NA''),
                               nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'')
                               order by c.comp_code,c.unit_code,nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA''),c.agname';
                    --insert into test1(vstring,vstring2) values('unsold edtn v_query1 ',v_query1);COMMIT;
               open p_accounts for v_query1;
    
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code,
               nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'') taluka_name '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,
               u.taluka_code taluka_code,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.tehsil_taluka taluka_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                               (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.taluka_code) c
                               group by c.comp_code,c.unit_code,nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'')
                               order by c.comp_code,c.unit_code,nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'')';
               --insert into test1(vstring,vstring2) values('unsold edtn v_query2 ',v_query1);COMMIT;
               open p_accounts1 for v_query1;
    
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.tehsil_taluka taluka_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.tehsil_taluka='||''''||ptaluka||''''||') or ('||''''||ptaluka||''''||' is null)) and
                               (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,cir_get_edtn_name(u.comp_code,u.edtn))c
                               group by c.comp_code,c.unit_code
                               order by c.comp_code,c.unit_code';
                --insert into test1(vstring,vstring2) values('unsold edtn v_query3 ',v_query1);COMMIT;
               open p_accounts2 for v_query1;
           End if;
                 v_query1:='select '||''''||vtot_publ||''''||' from dual';
                 open p_accounts3 for v_query1;
        Else
            v_query1:='select '||''''||pcomp_code||''''||' comp_code,'||''''||punit_code||''''||' unit_code,null agcd,null dpcd,null agname,null agname_oth_lang,null city_name,null taluka_name,0 supply_copy,0 return_copy from dual';
            --insert into test1(vstring,vstring2) values('unsold else edtn vquery ',v_query1);COMMIT;
            open p_accounts for v_query1;
            v_query1:='select '||''''||pcomp_code||''''||' comp_code,'||''''||punit_code||''''||' unit_code,null taluka_name,0 supply_copy,0 return_copy from dual';
            --insert into test1(vstring,vstring2) values('unsold else edtn vquery2 ',v_query1);COMMIT;
            open p_accounts1 for v_query1;
            v_query1:='select '||''''||pcomp_code||''''||' comp_code,'||''''||punit_code||''''||' unit_code,0 supply_copy,0 return_copy from dual';
            --insert into test1(vstring,vstring2) values('unsold else edtn vquery3 ',v_query1);COMMIT;
            open p_accounts2 for v_query1;
                 v_query1:='select null from dual';
            open p_accounts3 for v_query1;            
        End if;
  End cir_edtn_unsold_supply;
    
    procedure cir_edtn_unsold_supply_dist(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn             in varchar2,
     pedtn              in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfromdate          in varchar2,
     ptilldate          in varchar2,
     papproved_flag        in varchar2,
     pdistcd            in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3         out t_accounts)
  As
       v_frdt    date;
       v_todt    date;
       v_query1     varchar2(32000);
      cursor cur_edtn is
        select distinct u.publ publ,u.edtn edtn,u.edtn_name edtn_name,u.edtn_seqno edtn_seq_no from
        (select distinct e.publ publ,e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seqno
        from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e 
        where a.comp_code=b.comp_code and b.comp_code=e.comp_code and b.comp_code=pcomp_code and
        a.unit=b.unit_code and b.unit_code=e.unit_code and b.unit_code=punit_code and b.doctype=pdoc_type and 
        b.recptdt >= v_frdt and b.recptdt<=v_todt and b.publ=e.publ and b.publ=nvl(ppubl,b.publ) and 
        b.edtn=e.edtn and b.edtn=nvl(pedtn,b.edtn) and a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl(pagcode,b.agcd) and 
        b.dpcd=nvl(pdepocode,b.dpcd) and (a.dist_code=pdistcd or pdistcd is null) and
        nvl(papproved_flag,'N')='Y' and (nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0))>0
        union
        select distinct e.publ publ,e.edtn edtn,e.edtn_name edtn_name,e.edtn_seq_no edtn_seqno 
        from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e 
        where a.comp_code=b.comp_code and b.comp_code=e.comp_code and b.comp_code=pcomp_code and
        a.unit=b.unit_code and b.unit_code=e.unit_code and b.unit_code=punit_code and b.doctype=pdoc_type and 
        b.recptdt >= v_frdt and b.recptdt<=v_todt and b.publ=e.publ and b.publ=nvl(ppubl,b.publ) and 
        b.edtn=e.edtn and b.edtn=nvl(pedtn,b.edtn) and a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl(pagcode,b.agcd) and 
        b.dpcd=nvl(pdepocode,b.dpcd) and (a.dist_code=pdistcd or pdistcd is null) and
        nvl(papproved_flag,'N')='N' and (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0) u
        order by edtn_seq_no,edtn;

     rec_edtn cur_edtn%rowtype;
     vvar         varchar2(10000);
     tot_vvar varchar2(10000);
     vtot_publ varchar2(8000);
     v_cnt     number:=0;
  Begin
       v_frdt:=to_date(pfromdate,''''||pdateformat||'''');
       v_todt:=to_date(ptilldate,''''||pdateformat||'''');
    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
          v_cnt :=nvl(v_cnt,0)+1;
          if vvar is null then
              vvar        :='decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.supply_copy))"'||rec_edtn.edtn||'_SUPPLY"';
              vvar        :=vvar||',decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_RETURN"';
              vvar        :=vvar||',round((decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.return_copy))*100)/decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.supply_copy)),2)"'||rec_edtn.edtn||'_RETURN_PER"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_SUPPLY") "'||rec_edtn.edtn||'_SUPPLY"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_RETURN") "'||rec_edtn.edtn||'_RETURN"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_RETURN_PER") "'||rec_edtn.edtn||'_RETURN_PER"';
              vtot_publ:=rec_edtn.edtn_name;
          else
              vvar        :=vvar||',decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.supply_copy))"'||rec_edtn.edtn||'_SUPPLY"';
              vvar        :=vvar||',decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_RETURN"';
              vvar        :=vvar||',round((decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.return_copy))*100)/decode(u.edtn,'||''''||rec_edtn.edtn||''''||',sum(u.supply_copy)),2)"'||rec_edtn.edtn||'_RETURN_PER"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_SUPPLY") "'||rec_edtn.edtn||'_SUPPLY"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_RETURN") "'||rec_edtn.edtn||'_RETURN"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_RETURN_PER") "'||rec_edtn.edtn||'_RETURN_PER"';
              vtot_publ:=vtot_publ||''''||','||''''||rec_edtn.edtn_name;
          end if;    
    end loop;
    close cur_edtn;
    
        --delete test1;
        --insert into test1(vstring,vstring2) values('unsold edtn vvar ',vvar);COMMIT;
        --insert into test1(vstring,vstring2) values('unsold edtn TOT_vvar ',tot_vvar);COMMIT;
        if vvar is not null then
           If nvl(papproved_flag,'N')='Y' Then
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code,c.agcd agcd,c.dpcd dpcd,c.agname agname,c.agname_oth_lang agname_oth_lang,
               nvl(cir_get_city(c.comp_code,c.city_code),''NA'') city_name,nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'') dist_name '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,
               u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,u.city_code city_code,u.state_code state_code,u.dist_code dist_code,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.state_code state_code,a.dist_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.dist_code='||''''||pdistcd||''''||') or ('||''''||pdistcd||''''||' is null)) and
                               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.agcd,u.dpcd,u.agname,u.agname_oth_lang,
                               u.city_code,u.state_code,u.dist_code) c
                               group by c.comp_code,c.unit_code,c.agcd,c.dpcd,c.agname,c.agname_oth_lang,nvl(cir_get_city(c.comp_code,c.city_code),''NA''),
                               nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'')
                               order by c.comp_code,c.unit_code,nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA''),c.agname';
                                              
               --insert into test1(vstring,vstring2) values('unsold edtn p_accounts ',v_query1);COMMIT;
               open p_accounts for v_query1;           
               
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code,
               nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'') dist_name '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,
               u.state_code state_code,u.dist_code dist_code,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.state_code state_code,a.dist_code dist_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                            agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.dist_code='||''''||pdistcd||''''||') or ('||''''||pdistcd||''''||' is null)) and
                               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.state_code,u.dist_code) c
                               group by c.comp_code,c.unit_code,nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'')
                               order by c.comp_code,c.unit_code,nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'')';
                
                --insert into test1(vstring,vstring2) values('unsold edtn p_accounts1 ',v_query1);COMMIT;
                open p_accounts1 for v_query1;
               
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.state_code state_code,a.dist_code dist_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.dist_code='||''''||pdistcd||''''||') or ('||''''||pdistcd||''''||' is null)) and
                               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,cir_get_edtn_name(u.comp_code,u.edtn))c
                               group by c.comp_code,c.unit_code
                               order by c.comp_code,c.unit_code';
               --insert into test1(vstring,vstring2) values('unsold edtn p_accounts2 ',v_query1);COMMIT;
               open p_accounts2 for v_query1;
           Else
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code,c.agcd agcd,c.dpcd dpcd,c.agname agname,c.agname_oth_lang agname_oth_lang,
               nvl(cir_get_city(c.comp_code,c.city_code),''NA'') city_name,nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'') dist_name '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,
               u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,u.city_code city_code,u.state_code state_code,u.dist_code dist_code,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.state_code state_code,a.dist_code dist_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.dist_code='||''''||pdistcd||''''||') or ('||''''||pdistcd||''''||' is null)) and
                               (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.agcd,u.dpcd,u.agname,u.agname_oth_lang,
                               u.city_code,u.state_code,u.dist_code) c
                               group by c.comp_code,c.unit_code,c.agcd,c.dpcd,c.agname,c.agname_oth_lang,nvl(cir_get_city(c.comp_code,c.city_code),''NA''),
                               nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'')
                               order by c.comp_code,c.unit_code,nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA''),c.agname';
                    --insert into test1(vstring,vstring2) values('unsold edtn p_accounts',v_query1);COMMIT;
               open p_accounts for v_query1;
    
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code,
               nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'') dist_name '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,
               u.state_code state_code,u.dist_code dist_code,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.state_code state_code,a.dist_code dist_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.dist_code='||''''||pdistcd||''''||') or ('||''''||pdistcd||''''||' is null)) and
                               (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.state_code,u.dist_code) c
                               group by c.comp_code,c.unit_code,nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'')
                               order by c.comp_code,c.unit_code,nvl(cir_get_dist(c.comp_code,c.state_code,c.dist_code),''NA'')';
               --insert into test1(vstring,vstring2) values('unsold edtn p_accounts1 ',v_query1);COMMIT;
               open p_accounts1 for v_query1;
    
               v_query1:='select c.comp_code comp_code,c.unit_code unit_code '||tot_vvar||'
               from
               (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,'||vvar
               ||'    from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,b.edtn edtn,
                            b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                            a.city_code city_code,a.state_code state_code,a.dist_code dist_code,
                            (select sum(sup_copy) from cir_dbksup 
                            where comp_code=b.comp_code and unit_code=b.unit_code and 
                                        agcd=b.agcd and dpcd=b.dpcd and publ=b.publ and supdate=b.supdate) supply_copy,
                            nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
                   from cir_agmast a,cir_unsold_dtl b
                   where b.comp_code    =a.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                               b.unit_code=a.unit and b.unit_code='||''''||punit_code||''''||' and 
                               b.doctype='||''''||pdoc_type||''''||' and b.recptdt between '||''''||v_frdt||''''||' and '||''''||v_todt||''''||' and 
                               ((b.publ='||''''||ppubl||''''||') or ('||''''||ppubl||''''||' is null)) and 
                               ((b.edtn='||''''||pedtn||''''||') or ('||''''||pedtn||''''||' is null)) and 
                               a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd='||''''||pagcode||''''||') or ('||''''||pagcode||''''||' is null)) and 
                               ((b.dpcd='||''''||pdepocode||''''||') or ('||''''||pdepocode||''''||' is null)) and ((a.dist_code='||''''||pdistcd||''''||') or ('||''''||pdistcd||''''||' is null)) and
                               (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0 and
                               b.edtn in(select distinct edtn from cir_edtn_mast where comp_code='||''''||pcomp_code||''''||' and (edtn = '||''''||pedtn||''''||' or '||''''||pedtn||''''||' is null) and (main_edtn='||''''||pmainedtn||''''||' or '||''''||pmainedtn||''''||' is null))) u
                               where u.supply_copy>0
                               group by u.comp_code,u.unit_code,u.publ,u.edtn,cir_get_edtn_name(u.comp_code,u.edtn))c
                               group by c.comp_code,c.unit_code
                               order by c.comp_code,c.unit_code';
                --insert into test1(vstring,vstring2) values('unsold edtn p_accounts2 ',v_query1);COMMIT;
               open p_accounts2 for v_query1;
           End if;
                 v_query1:='select '||''''||vtot_publ||''''||' from dual';
                 open p_accounts3 for v_query1;
        Else
            v_query1:='select '||''''||pcomp_code||''''||' comp_code,'||''''||punit_code||''''||' unit_code,null agcd,null dpcd,null agname,null agname_oth_lang,null city_name,null taluka_name,0 supply_copy,0 return_copy from dual';
            --insert into test1(vstring,vstring2) values('unsold else edtn vquery p_accounts',v_query1);COMMIT;
            open p_accounts for v_query1;
            v_query1:='select '||''''||pcomp_code||''''||' comp_code,'||''''||punit_code||''''||' unit_code,null taluka_name,0 supply_copy,0 return_copy from dual';
            --insert into test1(vstring,vstring2) values('unsold else edtn p_accounts1 ',v_query1);COMMIT;
            open p_accounts1 for v_query1;
            v_query1:='select '||''''||pcomp_code||''''||' comp_code,'||''''||punit_code||''''||' unit_code,0 supply_copy,0 return_copy from dual';
            --insert into test1(vstring,vstring2) values('unsold else edtn p_accounts2 ',v_query1);COMMIT;
            open p_accounts2 for v_query1;
                 v_query1:='select null from dual';
             open p_accounts3 for v_query1;
        End if;
  End cir_edtn_unsold_supply_dist;  
  
   procedure cir_monthly_net_paid_sale(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pedtn              in varchar2,
     pfromdate          in varchar2,
     ptilldate          in varchar2,
     pagency_type       in varchar2,
     pagency_class      in varchar2,
     pstatecode         in varchar2,
     pdistcode          in varchar2,
     ptaluka            in varchar2,
     pbranch            in varchar2,
     pagcd              in varchar2,
     pdpcd              in varchar2,
     preptype           in number,--1 for Agency Wise,2 for Main Edition wise,3 for District Taluka wise
     pbreak_on          in varchar2,--Region R/State S/District D/Branch B
     preturn_based      in varchar2,--it is use for return date or supply date(R/S)
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     pextra3            in varchar2,
     pextra4            in varchar2,
     pextra5            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts)
  As
     v_frdt    date;
     v_todt    date;
     v_reg_code varchar2(200);
     v_avg_sale number(10);
cursor c1 is
    select u.comp_code,u.unit_code,
    u.branch_code branch_code,(select distinct "Branch_Name" from branch_mst where "Branch_Code"=u.branch_code) branch_name,
    u.publ,u.publ_name,u.main_edtn,
    cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
    u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
    u.state_code,cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
    u.dist_code ,cir_get_name.cir_district(u.comp_code,u.dist_code,plangtype,null,null,null) dist_name,
    u.city_code city_code,cir_get_name.cir_city(u.comp_code,u.city_code,plangtype,null,null,null) city_name,
    u.tehsil_taluka,cir_get_name.cir_taluka(u.comp_code,u.tehsil_taluka,plangtype,null,null,null) taluka_name,
    sum(supply_copy) supply_copy,sum(return_copy) return_copy,
    sum(supply_copy)-sum(return_copy) net_sale_copy,sum(no_of_days) no_of_days
    from (
    select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
    b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
    a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, 
    sum(nvl(b.sup_copy,0)) supply_copy,0 return_copy, count(distinct supdate) no_of_days
    from cir_agmast a,cir_dbksup b,cir_edtn_mast e,cir_publ_mast p
    where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
    b.comp_code =pcomp_code and 
    b.unit_code=a.unit and b.unit_code=punit_code and 
    b.publ=p.publ and b.publ=nvl(ppubl,b.publ) and b.edtn=e.edtn and b.edtn=nvl(pedtn,b.edtn) and
    a.agcd=b.agcd and b.agcd=nvl(pagcd,b.agcd) and a.dpcd=b.dpcd and b.dpcd=nvl(pdpcd,b.dpcd) and
    b.supdate >= v_frdt and b.supdate <=v_todt and 
    (a.ag_type=pagency_type or pagency_type is null) and(a.ag_class=pagency_class or pagency_class is null) and
    (a.branch_code=pbranch or pbranch is null) and (a.state_code=pstatecode or pstatecode is null) and
    (a.dist_code=pdistcode or pdistcode is null) and (a.tehsil_taluka=ptaluka or ptaluka is null) and
    (e.main_edtn=pmainedtn or pmainedtn is null)
    group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
    b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
    a.country_code,a.tehsil_taluka
    union all
    select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
    b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
    a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, 
    0 supply_copy,sum(nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0)) return_copy,0 no_of_days
    from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p
    where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =pcomp_code and 
    b.unit_code=a.unit and b.unit_code=punit_code and 
    b.doctype='UCN' and b.recptdt >= v_frdt and b.recptdt <=v_todt and 
    b.publ=e.publ and b.publ=p.publ and b.publ=nvl(ppubl,b.publ) and b.edtn=e.edtn and b.edtn=nvl(pedtn,b.edtn) and 
    a.agcd=b.agcd and b.agcd=nvl(pagcd,b.agcd) and a.dpcd=b.dpcd and b.dpcd=nvl(pdpcd,b.dpcd) and 
    (a.ag_type=pagency_type or pagency_type is null) and(a.ag_class=pagency_class or pagency_class is null) and
    (a.branch_code=pbranch or pbranch is null) and (a.state_code=pstatecode or pstatecode is null) and
    (a.dist_code=pdistcode or pdistcode is null) and (a.tehsil_taluka=ptaluka or ptaluka is null) and
    (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0 and
    (e.main_edtn=pmainedtn or pmainedtn is null)
    group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
    b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
    a.country_code,a.tehsil_taluka) u
    where (u.supply_copy+u.return_copy)>0
    group by u.comp_code,u.unit_code,
    u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
    u.agcd,u.dpcd,u.agname,u.agname_oth_lang,
    u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.country_code;
            
    v1 c1%rowtype;
   
  Begin
        
        v_frdt         :=to_date(pfromdate,''''||pdateformat||'''');
        v_todt         :=to_date(ptilldate,''''||pdateformat||'''');
        delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
        open c1;
        loop
            fetch c1 into v1;
            exit when c1%notfound;
            /*select count(*) into v_hdays from cir_holiday_mast 
                where comp_code=v1.comp_code and unit=v1.unit_code and (h_publ=ppubl or ppubl is null) and 
                    trunc(h_date,'mm')=v1.mon;*/
            if nvl(v1.no_of_days,0)>0 then
                v_avg_sale:=round(nvl(v1.net_sale_copy,0)/(nvl(v1.no_of_days,0)));
            else
                v_avg_sale:=nvl(v1.net_sale_copy,0);
            end if;
            begin
                select distinct region_code into v_reg_code from cir_city_mast where comp_code=v1.comp_code and city_code=v1.city_code;
            exception when others then
             v_reg_code:=null;
            end;
            
            v_reg_code:=cir_get_region_name(v1.comp_code,v_reg_code); 
            insert into cir_temp_bill_collection
            (comp_code, unit_code, billno, publ_code, agcd, dpcd,agname,agname_oth_lang, city_code, 
            taluka_code, dist_code, state_code, remarks,supply_copy, return_copy ,comm_amt,gross_amt,cur_sessionid)
            values(v1.comp_code,v1.unit_code,v1.branch_name,v1.publ_name,v1.main_edtn_name,v1.edtn_name,v1.agname,v1.agname_oth_lang,v1.city_name,
            v1.taluka_name,v1.dist_name,v1.state_name,v_reg_code,v1.supply_copy,v1.return_copy,v1.copy_rate,v1.no_of_days,userenv('sessionid'));

        end loop;
        close c1;
        commit;
        if preptype=1 then
            if pbreak_on='R' then
                open p_accounts for
                select comp_code AS "COMP_CODE", unit_code AS "UNIT",agname AS "AGNAME",agname_oth_lang AS "AGNAME_OTH_LANG",city_code as "CITY_NAME", 
                remarks AS "REGION_NAME",supply_copy AS "SUPPLY_COPY", return_copy AS "RETURN_COPY" ,(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                gross_amt AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') order by remarks,agname,city_name;

                open p_accounts1 for
                select comp_code AS "COMP_CODE",  
                remarks AS "REGION_NAME",sum(supply_copy) AS "SUPPLY_COPY", sum(return_copy) AS "RETURN_COPY" ,sum(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                0 AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') 
                group by comp_code,remarks order by region_name;            
            elsif pbreak_on='S' then
                open p_accounts for
                select comp_code AS "COMP_CODE", unit_code AS "UNIT",agname AS "AGNAME",agname_oth_lang AS "AGNAME_OTH_LANG",city_code as "CITY_NAME", 
                state_code AS "STATE_NAME",supply_copy AS "SUPPLY_COPY", return_copy AS "RETURN_COPY" ,(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                gross_amt AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') order by state_name,agname,city_name;

                open p_accounts1 for
                select comp_code AS "COMP_CODE",  
                state_code AS "STATE_NAME",sum(supply_copy) AS "SUPPLY_COPY", sum(return_copy) AS "RETURN_COPY" ,sum(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                0 AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') 
                group by comp_code,state_code order by state_name;                
            elsif pbreak_on='D' then
                open p_accounts for
                select comp_code AS "COMP_CODE", unit_code AS "UNIT",agname AS "AGNAME",agname_oth_lang AS "AGNAME_OTH_LANG",city_code as "CITY_NAME", 
                state_code AS "STATE_NAME",dist_code AS "DIST_NAME",supply_copy AS "SUPPLY_COPY", return_copy AS "RETURN_COPY" ,(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                gross_amt AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') order by state_name,dist_name,agname,city_name;

                open p_accounts1 for
                select comp_code AS "COMP_CODE",  
                state_code AS "STATE_NAME",dist_code AS "DIST_NAME",sum(supply_copy) AS "SUPPLY_COPY", sum(return_copy) AS "RETURN_COPY" ,sum(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                0 AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            elsif pbreak_on='B' then
                open p_accounts for
                select comp_code AS "COMP_CODE", unit_code AS "UNIT",agname AS "AGNAME",agname_oth_lang AS "AGNAME_OTH_LANG",city_code as "CITY_NAME", 
                billno AS "BRANCH_NAME",supply_copy AS "SUPPLY_COPY", return_copy AS "RETURN_COPY" ,(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                gross_amt AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') order by branch_name,agname,city_name;

                open p_accounts1 for
                select comp_code AS "COMP_CODE",  
                billno AS "BRANCH_NAME",sum(supply_copy) AS "SUPPLY_COPY", sum(return_copy) AS "RETURN_COPY" ,sum(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                0 AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') 
                group by comp_code,billno order by branch_name;                
            end if;
        elsif preptype=2 then--for edition wise
                open p_accounts for
                select comp_code AS "COMP_CODE",  publ_code AS "PUBL_NAME",agcd AS "MAIN_EDTN_NAME",dpcd AS "EDTN_NAME",sum(supply_copy) AS "SUPPLY_COPY", 
                sum(return_copy) AS "RETURN_COPY" ,sum(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                0 AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') group by comp_code,publ_code,agcd,dpcd order by publ_name,main_edtn_name,edtn_name;

                open p_accounts1 for
                select comp_code AS "COMP_CODE",  publ_code AS "PUBL_NAME",agcd AS "MAIN_EDTN_NAME",sum(supply_copy) AS "SUPPLY_COPY", 
                sum(return_copy) AS "RETURN_COPY" ,sum(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                0 AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') group by comp_code,publ_code,agcd order by publ_name,main_edtn_name;
        else
                open p_accounts for
                select comp_code AS "COMP_CODE", 
                state_code AS "STATE_NAME",dist_code AS "DIST_NAME",taluka_code AS "TALUKA_NAME",
                sum(supply_copy) AS "SUPPLY_COPY", sum(return_copy) AS "RETURN_COPY" ,sum(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                0 AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') 
                group by comp_code,state_code,dist_code,taluka_code order by state_name,dist_name,taluka_name;

                open p_accounts1 for
                select comp_code AS "COMP_CODE", 
                state_code AS "STATE_NAME",dist_code AS "DIST_NAME",
                sum(supply_copy) AS "SUPPLY_COPY", sum(return_copy) AS "RETURN_COPY" ,sum(supply_copy-return_copy) AS "NET_SALE",0 "NET_PER",
                0 AS "NO_OF_DAYS",0 AS "AVG_NET_SALE" 
                from cir_temp_bill_collection where cur_sessionid=userenv('sessionid') 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
        end if;
        
        --open p_accounts1 for select sysdate as "CUR_DATE" from dual;
        open p_accounts2 for select sysdate as "CUR_DATE" from dual;
        open p_accounts3 for select sysdate as "CUR_DATE" from dual;
        delete from cir_temp_bill_collection where cur_sessionid=userenv('sessionid');
    
  End cir_monthly_net_paid_sale;

  procedure cir_rep_unsold_slip(
    pcompcode       in varchar2,
    punitcode       in varchar2,
    pbrancode       in varchar2,
    pdoctype        in varchar2,
    pdistcode       in varchar2,
    ptalukacode     in varchar2,
    pagcode         in varchar2,
    pagsubcode      in varchar2,
    pfrom_recdate   in varchar2,
    ptill_recdate   in varchar2,
    papproved_flag  in varchar2,
    pdateformat     in varchar2,
    pextra1         in varchar2,
    pextra2         in varchar2,--Blank for Agency and 'D' for Distribution
    p_accounts      out t_accounts)
  As
       v_frdt    date;
       v_todt    date;
  Begin
       v_frdt:=to_date(pfrom_recdate,''''||pdateformat||'''');
       v_todt:=to_date(ptill_recdate,''''||pdateformat||'''');
       
        if upper(nvl(papproved_flag,'N'))='Y' then
            if pextra2='D' then
               open p_accounts for
               select b.comp_code comp_code,b.unit_code unit_code,b.doctype doctype,b.publ publ,cir_get_name.cir_publ(b.comp_code,b.publ,'1','dd/mm/yyyy','','') publ_name,
                      b.edtn edtn,cir_get_name.cir_edtn(b.comp_code,b.unit_code,b.edtn,'1','dd/mm/yyyy','','') edtn_name,
                      b.recptno recptno,b.recptdt recptdt,
                      b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,cir_get_city(b.comp_code,a.city_code) city_name,
                      b.copy_rate copy_rate,h.frdt frdt,h.todt todt,
                      sum(b.apr_short_recpt) short_recpt,sum(b.apr_late_recpt) late_recpt,sum(b.apr_bnr) bnr,sum(b.apr_unsold) unsold,
                      sum(nvl(b.copy_rate,0)*(nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0))) gross_amt,
                      sum(b.comm_amt) comm_amt,sum(b.waste_amt) waste_amt,nvl(sum(b.copy_amt),0) amount,
                      nvl(sum(b.copy_amt),0)-nvl(sum(b.waste_amt),0)net_amt 
                   from cir_agmast_dis a,cir_unsold_dtl_dis b,cir_unsold_hdr_dis h
                   where b.comp_code =a.comp_code and b.comp_code =pcompcode and b.comp_code =h.comp_code and 
                        b.unit_code=a.unit and b.unit_code=h.unit_code and b.unit_code=punitcode and 
                        b.doctype=pdoctype and b.doctype=h.doctype and b.recptdt between v_frdt and v_todt and
                        b.recptno=h.recptno and a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd=pagcode) or (pagcode is null)) and 
                        ((b.dpcd=pagsubcode) or (pagsubcode is null)) and ((a.dist_code=pdistcode) or (pdistcode is null)) and
                        ((a.tehsil_taluka=ptalukacode) or (ptalukacode is null)) and a.branch_code=nvl(pbrancode,a.branch_code) and
                        (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0
                        group by b.comp_code,b.unit_code,b.doctype,b.publ,b.edtn,b.recptno,b.recptdt,h.frdt,h.todt,
                                 b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.city_code,b.copy_rate 
                        order by b.agcd,b.dpcd,b.recptdt,b.recptno,b.publ,b.edtn;
            else
               open p_accounts for
               select b.comp_code comp_code,b.unit_code unit_code,b.doctype doctype,b.publ publ,cir_get_name.cir_publ(b.comp_code,b.publ,'1','dd/mm/yyyy','','') publ_name,
                      b.edtn edtn,cir_get_name.cir_edtn(b.comp_code,b.unit_code,b.edtn,'1','dd/mm/yyyy','','') edtn_name,
                      b.recptno recptno,b.recptdt recptdt,
                      b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,cir_get_city(b.comp_code,a.city_code) city_name,
                      b.copy_rate copy_rate,h.frdt frdt,h.todt todt,
                      sum(b.apr_short_recpt) short_recpt,sum(b.apr_late_recpt) late_recpt,sum(b.apr_bnr) bnr,sum(b.apr_unsold) unsold,
                      sum(nvl(b.copy_rate,0)*(nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0))) gross_amt,
                      sum(b.comm_amt) comm_amt,sum(b.waste_amt) waste_amt,nvl(sum(b.copy_amt),0) amount,
                      nvl(sum(b.copy_amt),0)-nvl(sum(b.waste_amt),0)net_amt 
                   from cir_agmast a,cir_unsold_dtl b,cir_unsold_hdr h
                   where b.comp_code =a.comp_code and b.comp_code =pcompcode and b.comp_code =h.comp_code and 
                        b.unit_code=a.unit and b.unit_code=h.unit_code and b.unit_code=punitcode and 
                        b.doctype=pdoctype and b.doctype=h.doctype and b.recptdt between v_frdt and v_todt and
                        b.recptno=h.recptno and a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd=pagcode) or (pagcode is null)) and 
                        ((b.dpcd=pagsubcode) or (pagsubcode is null)) and ((a.dist_code=pdistcode) or (pdistcode is null)) and
                        ((a.tehsil_taluka=ptalukacode) or (ptalukacode is null)) and a.branch_code=nvl(pbrancode,a.branch_code) and
                        (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0
                        group by b.comp_code,b.unit_code,b.doctype,b.publ,b.edtn,b.recptno,b.recptdt,h.frdt,h.todt,
                                 b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.city_code,b.copy_rate 
                        order by b.agcd,b.dpcd,b.recptdt,b.recptno,b.publ,b.edtn;            
            end if;            
        else
            if pextra2='D' then
               open p_accounts for
               select b.comp_code comp_code,b.unit_code unit_code,b.doctype doctype,b.publ publ,cir_get_name.cir_publ(b.comp_code,b.publ,'1','dd/mm/yyyy','','') publ_name,
                      b.edtn edtn,cir_get_name.cir_edtn(b.comp_code,b.unit_code,b.edtn,'1','dd/mm/yyyy','','') edtn_name,b.recptno recptno,b.recptdt recptdt,
                      b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,cir_get_city(b.comp_code,a.city_code) city_name,
                      b.copy_rate copy_rate,h.frdt frdt,h.todt todt,
                      sum(b.short_recpt) short_recpt,sum(b.late_recpt) late_recpt,sum(b.bnr) bnr,sum(b.unsold) unsold,
                      sum(nvl(b.copy_rate,0)*(nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0))) gross_amt,sum(b.comm_amt) comm_amt,
                      sum(b.waste_amt) waste_amt,nvl(sum(b.copy_amt),0) amount,
                      nvl(sum(b.copy_amt),0)-nvl(sum(b.waste_amt),0) net_amt 
                   from cir_agmast_dis a,cir_unsold_dtl_dis b,cir_unsold_hdr_dis h
                   where b.comp_code =a.comp_code and b.comp_code =pcompcode and b.comp_code =h.comp_code and 
                        b.unit_code=a.unit and b.unit_code=h.unit_code and b.unit_code=punitcode and 
                        b.doctype=pdoctype and b.doctype=h.doctype and b.recptdt between v_frdt and v_todt and
                        b.recptno=h.recptno and a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd=pagcode) or (pagcode is null)) and 
                        ((b.dpcd=pagsubcode) or (pagsubcode is null)) and ((a.dist_code=pdistcode) or (pdistcode is null)) and
                        ((a.tehsil_taluka=ptalukacode) or (ptalukacode is null)) and a.branch_code=nvl(pbrancode,a.branch_code) and
                        (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0
                        group by b.comp_code,b.unit_code,b.doctype,b.publ,b.edtn,b.recptno,b.recptdt,h.frdt,h.todt,
                                 b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.city_code,b.copy_rate 
                        order by b.agcd,b.dpcd,b.recptdt,b.recptno,b.publ,b.edtn;
            else
               open p_accounts for
               select b.comp_code comp_code,b.unit_code unit_code,b.doctype doctype,b.publ publ,cir_get_name.cir_publ(b.comp_code,b.publ,'1','dd/mm/yyyy','','') publ_name,
                      b.edtn edtn,cir_get_name.cir_edtn(b.comp_code,b.unit_code,b.edtn,'1','dd/mm/yyyy','','') edtn_name,b.recptno recptno,b.recptdt recptdt,
                      b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,cir_get_city(b.comp_code,a.city_code) city_name,
                      b.copy_rate copy_rate,h.frdt frdt,h.todt todt,
                      sum(b.short_recpt) short_recpt,sum(b.late_recpt) late_recpt,sum(b.bnr) bnr,sum(b.unsold) unsold,
                      sum(nvl(b.copy_rate,0)*(nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0))) gross_amt,sum(b.comm_amt) comm_amt,
                      sum(b.waste_amt) waste_amt,nvl(sum(b.copy_amt),0) amount,
                      nvl(sum(b.copy_amt),0)-nvl(sum(b.waste_amt),0) net_amt 
                   from cir_agmast a,cir_unsold_dtl b,cir_unsold_hdr h
                   where b.comp_code =a.comp_code and b.comp_code =pcompcode and b.comp_code =h.comp_code and 
                        b.unit_code=a.unit and b.unit_code=h.unit_code and b.unit_code=punitcode and 
                        b.doctype=pdoctype and b.doctype=h.doctype and b.recptdt between v_frdt and v_todt and
                        b.recptno=h.recptno and a.agcd=b.agcd and a.dpcd=b.dpcd and ((b.agcd=pagcode) or (pagcode is null)) and 
                        ((b.dpcd=pagsubcode) or (pagsubcode is null)) and ((a.dist_code=pdistcode) or (pdistcode is null)) and
                        ((a.tehsil_taluka=ptalukacode) or (ptalukacode is null)) and a.branch_code=nvl(pbrancode,a.branch_code) and
                        (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0
                        group by b.comp_code,b.unit_code,b.doctype,b.publ,b.edtn,b.recptno,b.recptdt,h.frdt,h.todt,
                                 b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.city_code,b.copy_rate 
                        order by b.agcd,b.dpcd,b.recptdt,b.recptno,b.publ,b.edtn;            
            end if;             
       end if;
  End cir_rep_unsold_slip;

/*
var v1 refcursor;
var v2 refcursor;
var v3 refcursor;
var v4 refcursor;
var v5 refcursor;
var v6 refcursor;
exec cir_rep_unsold_supply.cir_unsold_return_punya('SP002','AUR','','UCN','','','','','','','','01-jun-2010','30-sep-2010','N','1','dd/mm/yyyy','','',:v1,:v2,:v3,:v4,:v5,:v6);
*/

    procedure cir_unsold_return_punya(
     pcomp_code         in varchar2,
     punit_code         in varchar2,
     pbran_code         in varchar2,
     pdoc_type          in varchar2,
     ppubl              in varchar2,
     pmainedtn          in varchar2,
     pdistcode          in varchar2,
     ptalukacode        in varchar2,
     pcitycode          in varchar2,
     pagcode            in varchar2,
     pdepocode          in varchar2,
     pfrom_recdate      in varchar2,
     ptill_recdate      in varchar2,
     papproved_flag     in varchar2,
     plangtype          in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts,
     p_accounts1        out t_accounts,
     p_accounts2        out t_accounts,
     p_accounts3        out t_accounts,
     p_accounts5        out t_accounts,
     p_accounts6        out t_accounts)
   As
    v_frdt     date;
    v_todt    date;
    v_query1  varchar2(32000); 
       cursor cur_edtn is
           select distinct u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.main_edtn edtn,u.copy_rate copy_rate,
            cir_get_edtn_seqno(u.comp_code,u.main_edtn) edtn_seqno from
         (select distinct b.comp_code comp_code,b.unit_code unit_code,c.publ publ,c.main_edtn main_edtn,b.copy_rate copy_rate 
         from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast c
         where b.comp_code = a.comp_code and b.comp_code = c.comp_code and b.comp_code = pcomp_code and 
         b.unit_code = a.unit and b.unit_code = punit_code and 
         b.doctype=pdoc_type and b.recptdt <=v_todt and 
         b.publ=nvl(ppubl,b.publ) and c.main_edtn=nvl(pmainedtn,c.main_edtn) and
         b.publ=c.publ and b.edtn=c.edtn and     
         a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl(pagcode,b.agcd) and 
         b.dpcd=nvl(pdepocode,b.dpcd) and (a.tehsil_taluka=ptalukacode or ptalukacode is null) and
         (a.dist_code=pdistcode or pdistcode is null) and a.city_code=nvl(pcitycode,a.city_code) and
         b.branch_code=nvl(pbran_code,b.branch_code)
         union
         select distinct b.comp_code comp_code,b.unit_code unit_code,b.publ_code publ,c.main_edtn main_edtn,b.edtn_rate copy_rate 
         from cir_agmast a,cir_branch_return_det b,cir_edtn_mast c 
         where a.comp_code=b.comp_code and a.comp_code=c.comp_code and b.comp_code = pcomp_code and 
         a.unit=b.unit_code and a.unit=c.unit_code and b.unit_code = punit_code and 
         b.recptdt >= v_frdt and b.recptdt<=v_todt and b.publ_code=nvl(ppubl,b.publ_code) and 
         c.main_edtn=nvl(pmainedtn,c.main_edtn) and b.publ_code=c.publ and b.edtn_code=c.edtn and     
         (a.tehsil_taluka=ptalukacode or ptalukacode is null) and
         (a.dist_code=pdistcode or pdistcode is null) and a.city_code=nvl(pcitycode,a.city_code) and
         b.branch_code=nvl(pbran_code,b.branch_code)
         union
         select distinct b.comp_code comp_code,b.unit_code unit_code,c.publ publ,c.main_edtn main_edtn,b.copy_rate copy_rate 
         from cir_agmast_dis a,cir_unsold_dtl_dis b,cir_edtn_mast c
         where b.comp_code = a.comp_code and b.comp_code = c.comp_code and b.comp_code = pcomp_code and 
         b.unit_code = a.unit and b.unit_code = punit_code and 
         b.doctype=pdoc_type and b.recptdt <=v_todt and 
         b.publ=nvl(ppubl,b.publ) and c.main_edtn=nvl(pmainedtn,c.main_edtn) and
         b.publ=c.publ and b.edtn=c.edtn and     
         a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl(pagcode,b.agcd) and 
         b.dpcd=nvl(pdepocode,b.dpcd) and (a.tehsil_taluka=ptalukacode or ptalukacode is null) and
         (a.dist_code=pdistcode or pdistcode is null) and a.city_code=nvl(pcitycode,a.city_code) and
         b.branch_code=nvl(pbran_code,b.branch_code)
         union
         select distinct b.comp_code comp_code,b.unit_code unit_code,b.publ_code publ,c.main_edtn main_edtn,b.edtn_rate copy_rate 
         from cir_agmast a,cir_return_sale_det b,cir_edtn_mast c 
         where a.comp_code=b.comp_code and a.comp_code=c.comp_code and b.comp_code = pcomp_code and 
         a.unit=b.unit_code and a.unit=c.unit_code and b.unit_code = punit_code and 
         b.doctype='RET' and b.recptdt >= v_frdt and b.recptdt<=v_todt and b.publ_code=nvl(ppubl,b.publ_code) and 
         c.main_edtn=nvl(pmainedtn,c.main_edtn) and b.publ_code=c.publ and b.edtn_code=c.edtn and     
         (a.tehsil_taluka=ptalukacode or ptalukacode is null) and
         (a.dist_code=pdistcode or pdistcode is null) and a.city_code=nvl(pcitycode,a.city_code) and
         b.branch_code=nvl(pbran_code,b.branch_code)
         union
         select distinct b.comp_code comp_code,b.unit_code unit_code,b.publ_code publ,c.main_edtn main_edtn,b.edtn_rate copy_rate 
         from cir_physical_ver_det b,cir_edtn_mast c
            where b.comp_code = pcomp_code and 
            b.unit_code=c.unit_code and b.unit_code = punit_code and 
         b.recptdt<=v_todt and b.publ_code=nvl(ppubl,b.publ_code) and 
         c.main_edtn=nvl(pmainedtn,c.main_edtn) and b.publ_code=c.publ and b.edtn_code=c.edtn and     
         b.branch_code=nvl(pbran_code,b.branch_code)
         union
         select distinct b.comp_code comp_code,b.unit_code unit_code,b.publ publ,c.main_edtn main_edtn,b.sup_rate copy_rate 
         from cir_agmast a,cir_dbksup_resale b,cir_edtn_mast c
            where b.comp_code = a.comp_code and b.comp_code = c.comp_code and b.comp_code = pcomp_code and 
                  b.unit_code = a.unit and b.unit_code = punit_code and 
                  b.publ=nvl(ppubl,b.publ) and 
                  c.main_edtn=nvl(pmainedtn,c.main_edtn) and
                  b.publ=c.publ and b.edtn=c.edtn and
                  b.supdate >= v_frdt and b.supdate<=v_todt and 
                  a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl(pagcode,b.agcd) and 
                  b.dpcd=nvl(pdepocode,b.dpcd) and (a.tehsil_taluka=ptalukacode or ptalukacode is null) and
                  (a.dist_code=pdistcode or pdistcode is null) and a.city_code=nvl(pcitycode,a.city_code) and
                  b.resale_branch=nvl(pbran_code,b.resale_branch) and
                  nvl(b.sup_copy,0)>0 and nvl(b.return_copy_sale,'N')='Y') u                  
         order by publ,edtn_seqno,edtn,copy_rate;
     rec_edtn cur_edtn%rowtype;
     vvar       varchar2(8000);
     tot_vvar   varchar2(8000);
     vtot_publ  varchar2(4000);
     v_cnt      number:=0;
     v_opbal_unsold    number(10):=0;v_op_branch_rec   number(10):=0;v_op_branch_trf   number(10):=0;v_op_sale number(10):=0;
      v_op_resale number(10):=0;v_op_comp_ret number(10):=0;v_op_short_excess number(10):=0;
      
      v_opbal           number(10):=0;

  Begin
       --insert into aaa_test values (pcomp_code||'-'||punit_code ||'-'||pbran_code||'-'||pdoc_type||'-'||ppubl||'-'||pmainedtn||'-'||pdistcode||'-'||ptalukacode||'-'||pcitycode||'-'||pagcode||'-'||pdepocode||'-'||pfrom_recdate||'-'||ptill_recdate||'-'||papproved_flag||'-'||plangtype||'-'||pdateformat||'-'||pextra1||'-'||pextra2||'*'||'pcomp_code'||'-'||'punit_code'||'-'||'pbran_code'||'-'||'pdoc_type'||'-'||'ppubl'||'-'||'pmainedtn'||'-'||'pdistcode'||'-'||'ptalukacode'||'-'||'pcitycode'||'-'||'pagcode'||'-'||'pdepocode'||'-'||'pfrom_recdate'||'-'||'ptill_recdate'||'-'||'papproved_flag'||'-'||'plangtype'||'-'||'pdateformat'||'-'||'pextra1'||'-'||'pextra2');commit;
       --delete from test1;
       delete from cir_temp_unsold_stock where sess_id=userenv('sessionid');
       
       v_frdt:=to_date(pfrom_recdate,''''||pdateformat||'''');
       v_todt:=to_date(ptill_recdate,''''||pdateformat||'''');
    open cur_edtn;
    loop
        fetch cur_edtn into rec_edtn;
      exit when cur_edtn%notfound;
          v_cnt :=nvl(v_cnt,0)+1;
          if vvar is null then
              vvar    :='decode(u.edtn||u.copy_rate,'||''''||rec_edtn.edtn||rec_edtn.copy_rate||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
              tot_vvar:=',sum("'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'") "'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
          else
              vvar    :=vvar||',decode(u.edtn||u.copy_rate,'||''''||rec_edtn.edtn||rec_edtn.copy_rate||''''||',sum(u.return_copy))"'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
              tot_vvar:=tot_vvar||',sum("'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'") "'||rec_edtn.edtn||'_'||rec_edtn.copy_rate||'"';
          end if;    
    
            select nvl(sum(nvl(a.apr_short_recpt,0)+nvl(a.apr_late_recpt,0)+nvl(a.apr_bnr,0)+nvl(a.apr_unsold,0)),0) into v_opbal_unsold 
            from cir_unsold_dtl a,cir_edtn_mast b 
            where a.comp_code=b.comp_code and a.comp_code=pcomp_code and a.unit_code=b.unit_code and a.unit_code=punit_code and 
            a.doctype='UCN' and a.recptdt<v_frdt and a.publ=b.publ and a.publ=rec_edtn.publ and a.edtn=b.edtn and b.main_edtn=rec_edtn.edtn and
            a.copy_rate=rec_edtn.copy_rate and a.branch_code=NVL(pbran_code,a.branch_code);

            select nvl(sum(a.edtn_copy),0) into v_op_branch_rec from cir_branch_return_det a,cir_edtn_mast b 
                where a.comp_code=b.comp_code and a.comp_code=pcomp_code and a.unit_code=b.unit_code and a.unit_code=punit_code and 
                a.doctype='TI' and a.recptdt<v_frdt and
                a.publ_code=b.publ and a.publ_code=rec_edtn.publ and a.edtn_code=b.edtn and b.main_edtn=rec_edtn.edtn and 
                a.edtn_rate=rec_edtn.copy_rate and (a.branch_code=pbran_code or pbran_code is null);

            select nvl(sum(a.edtn_copy),0) into v_op_branch_trf from cir_branch_return_det a,cir_edtn_mast b 
                where a.comp_code=b.comp_code and a.comp_code=pcomp_code and a.unit_code=b.unit_code and a.unit_code=punit_code and a.doctype='TRF' and a.recptdt<v_frdt and
                a.publ_code=b.publ and a.publ_code=rec_edtn.publ and a.edtn_code=b.edtn and b.main_edtn=rec_edtn.edtn and a.edtn_rate=rec_edtn.copy_rate and (a.branch_code=pbran_code or pbran_code is null);
            
            select nvl(sum(nvl(a.no_of_copy,0)),0) into v_op_sale from cir_return_sale_det a,cir_edtn_mast b
                where a.comp_code=b.comp_code and a.comp_code=pcomp_code and a.unit_code=b.unit_code and a.unit_code=punit_code and 
                a.doctype='RET' and a.recptdt<v_frdt and
                a.publ_code=b.publ and a.publ_code=rec_edtn.publ and a.edtn_code=b.edtn and b.main_edtn=rec_edtn.edtn and a.edtn_rate=rec_edtn.copy_rate and (branch_code=pbran_code or pbran_code is null);

            select nvl(sum(nvl(a.apr_short_recpt,0)+nvl(a.apr_late_recpt,0)+nvl(a.apr_bnr,0)+nvl(a.apr_unsold,0)),0) into v_op_comp_ret
            from cir_unsold_dtl_dis a,cir_edtn_mast b 
            where a.comp_code=b.comp_code and a.comp_code=pcomp_code and a.unit_code=b.unit_code and a.unit_code=punit_code and 
            a.doctype='UCN' and a.recptdt<v_frdt and a.publ=b.publ and a.publ=rec_edtn.publ and a.edtn=b.edtn and b.main_edtn=rec_edtn.edtn and
            a.copy_rate=rec_edtn.copy_rate and a.branch_code=NVL(pbran_code,a.branch_code);

            select nvl(sum(a.sup_copy),0) into v_op_resale from cir_dbksup_resale a,cir_edtn_mast b,cir_agmast c
                where a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=pcomp_code and a.unit_code=b.unit_code and a.unit_code=c.unit and a.unit_code=punit_code and 
                a.agcd=c.agcd and a.dpcd=c.dpcd and a.publ=b.publ and a.publ=rec_edtn.publ and a.edtn=b.edtn and b.main_edtn=rec_edtn.edtn and
                      supdate<v_todt and sup_rate=rec_edtn.copy_rate and nvl(return_copy_sale,'N')='Y' and (a.resale_branch=pbran_code or pbran_code is null); 
            
            select nvl(sum(nvl(a.short_excess,1)*nvl(a.no_of_copy,0)),0) into v_op_short_excess from cir_physical_ver_det a,cir_edtn_mast b
                where a.comp_code=b.comp_code and a.comp_code=pcomp_code and a.unit_code=b.unit_code and a.unit_code=punit_code and a.doctype='VR' and a.recptdt<v_frdt and
                a.publ_code=b.publ and a.publ_code=rec_edtn.publ and a.edtn_code=b.edtn and b.main_edtn=rec_edtn.edtn and a.edtn_rate=rec_edtn.copy_rate and (a.branch_code=pbran_code or pbran_code is null);
            /*-------for opening balance ----------*/

            
            v_opbal:=nvl(v_opbal_unsold,0)+nvl(v_op_branch_rec,0)-nvl(v_op_comp_ret,0)-nvl(v_op_branch_trf,0)-nvl(v_op_sale,0)-nvl(v_op_resale,0)+nvl(v_op_short_excess,0);

            insert into cir_temp_unsold_stock(comp_code,unit_code,branch_code,publ_code,edtn_code,ason_dt,copy_rate,
                    opbal,sess_id)
                    values(pcomp_code,punit_code,pbran_code,rec_edtn.publ,rec_edtn.edtn,v_todt,rec_edtn.copy_rate,v_opbal,userenv('sessionid'));
    end loop;
    close cur_edtn;
    commit;
   -- insert into test1(vstring,vstring2) values(' vvar '||vvar,'tot_vvar '||tot_vvar); --commit;
    if vvar is not null then
       If nvl(papproved_flag,'N')='Y' Then
           v_query1:='select c.comp_code comp_code,c.unit_code unit_code,c.agcd agcd,c.dpcd dpcd,c.agname agname,c.agname_oth_lang agname_oth_lang,
           nvl(cir_get_name.cir_city(c.comp_code,c.city_code,'||''||plangtype||''||','''','''',''''),''NA'') city_name,
           nvl(cir_get_name.cir_taluka(c.comp_code,c.taluka_code,'||''||plangtype||''||','''','''',''''),''NA'') taluka_name '||tot_vvar||'
           from
           (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,
           u.copy_rate copy_rate,u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,u.city_code city_code,u.taluka_code taluka_code,'||vvar
           ||' from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,e.main_edtn edtn,b.copy_rate copy_rate,
               b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
               a.city_code city_code,a.tehsil_taluka taluka_code,
               nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
               from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e
               where b.comp_code =a.comp_code and b.comp_code =e.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                   b.unit_code=a.unit and b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
                   b.doctype='||''''||pdoc_type||''''||' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
                   a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl('||''''||pagcode||''''||',b.agcd) and 
                   b.dpcd=nvl('||''''||pdepocode||''''||',b.dpcd) and b.publ=nvl('||''''||ppubl||''''||',b.publ) and
                   b.publ=e.publ and b.edtn=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
                   (a.tehsil_taluka='||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                   b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code) and
                   (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0) u
                   where u.return_copy>0
                   group by u.comp_code,u.unit_code,u.publ,u.edtn,u.agcd,u.dpcd,u.agname,u.agname_oth_lang,
                   u.city_code,u.taluka_code,u.copy_rate) c
                   group by c.comp_code,c.unit_code,c.agcd,c.dpcd,c.agname,c.agname_oth_lang,c.city_code,c.taluka_code
                   order by c.comp_code,c.unit_code,taluka_name,c.agname';
                                              
           --insert into test1(vstring,vstring2) values('unsold edtn YY ',v_query1);COMMIT;
           open p_accounts for v_query1;           
               
           v_query1:='select c.comp_code comp_code,c.unit_code unit_code,
           nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'') taluka_name '||tot_vvar||'
           from
           (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,u.copy_rate copy_rate,
           u.taluka_code taluka_code,'||vvar
           ||'  from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,e.main_edtn edtn,b.copy_rate copy_rate,
                b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                a.city_code city_code,a.tehsil_taluka taluka_code,
                nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
               from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e
               where b.comp_code =a.comp_code and b.comp_code =e.comp_code and b.comp_code ='||''''||pcomp_code||''''||' and 
               b.unit_code=a.unit and b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
               b.doctype='||''''||pdoc_type||''''||' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
               a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl('||''''||pagcode||''''||',b.agcd) and 
               b.dpcd=nvl('||''''||pdepocode||''''||',b.dpcd) and b.publ=nvl('||''''||ppubl||''''||',b.publ) and
               b.publ=e.publ and b.edtn=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
               (a.tehsil_taluka='||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
               b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code) and
               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0) u
               where u.return_copy>0
               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.copy_rate,u.taluka_code) c
               group by c.comp_code,c.unit_code,c.taluka_code
               order by c.comp_code,c.unit_code,taluka_name';
                
            --insert into test1(vstring,vstring2) values('unsold edtn v_query2 ',v_query1);COMMIT;
            open p_accounts1 for v_query1;
               
           v_query1:='select c.comp_code comp_code,c.unit_code unit_code '||tot_vvar||'
           from
           (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,u.copy_rate copy_rate,'||vvar
           ||' from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,e.main_edtn edtn,b.copy_rate copy_rate,
                b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                a.city_code city_code,a.tehsil_taluka taluka_code,
                nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
               from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e
               where b.comp_code =a.comp_code and b.comp_code =e.comp_code and b.comp_code ='||''''||pcomp_code||''''||' and 
               b.unit_code=a.unit and b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
               b.doctype='||''''||pdoc_type||''''||' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
               a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl('||''''||pagcode||''''||',b.agcd) and 
               b.dpcd=nvl('||''''||pdepocode||''''||',b.dpcd) and b.publ=nvl('||''''||ppubl||''''||',b.publ) and
               b.publ=e.publ and b.edtn=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
               (a.tehsil_taluka='||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
               b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code) and
               (nvl(apr_short_recpt,0)+nvl(apr_late_recpt,0)+nvl(apr_bnr,0)+nvl(apr_unsold,0))>0) u
               where u.return_copy>0
               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.copy_rate)c
               group by c.comp_code,c.unit_code
               order by c.comp_code,c.unit_code';
           --insert into test1(vstring,vstring2) values('unsold edtn v_query3 ',v_query1);COMMIT;
           open p_accounts2 for v_query1;
       Else
           v_query1:='select c.comp_code comp_code,c.unit_code unit_code,c.agcd agcd,c.dpcd dpcd,c.agname agname,c.agname_oth_lang agname_oth_lang,
           nvl(cir_get_name.cir_city(c.comp_code,c.city_code,'||''||plangtype||''||','''','''',''''),''NA'') city_name,
           nvl(cir_get_name.cir_taluka(c.comp_code,c.taluka_code,'||''||plangtype||''||','''','''',''''),''NA'') taluka_name '||tot_vvar||'
           from
           (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,
           u.copy_rate copy_rate,u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,u.city_code city_code,u.taluka_code taluka_code,'||vvar
           ||' from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,e.main_edtn edtn,b.copy_rate copy_rate,
               b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
               a.city_code city_code,a.tehsil_taluka taluka_code,
               nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
               from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e
               where b.comp_code =a.comp_code and b.comp_code =e.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                   b.unit_code=a.unit and b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
                   b.doctype='||''''||pdoc_type||''''||' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
                   a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl('||''''||pagcode||''''||',b.agcd) and 
                   b.dpcd=nvl('||''''||pdepocode||''''||',b.dpcd) and b.publ=nvl('||''''||ppubl||''''||',b.publ) and
                   b.publ=e.publ and b.edtn=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
                   (a.tehsil_taluka='||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
                   b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code) and
                   (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0) u
                   where u.return_copy>0
                   group by u.comp_code,u.unit_code,u.publ,u.edtn,u.agcd,u.dpcd,u.agname,u.agname_oth_lang,
                   u.city_code,u.taluka_code,u.copy_rate) c
                   group by c.comp_code,c.unit_code,c.agcd,c.dpcd,c.agname,c.agname_oth_lang,c.city_code,c.taluka_code
                   order by c.comp_code,c.unit_code,taluka_name,c.agname';
                --insert into test1(vstring,vstring2) values('unsold edtn v_query1 ',v_query1);COMMIT;
           open p_accounts for v_query1;
    
           v_query1:='select c.comp_code comp_code,c.unit_code unit_code,
           nvl(cir_get_taluka(c.comp_code,c.taluka_code),''NA'') taluka_name '||tot_vvar||'
           from
           (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,cir_get_edtn_name(u.comp_code,u.edtn) edtn_name,u.copy_rate copy_rate,
           u.taluka_code taluka_code,'||vvar
           ||'  from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,e.main_edtn edtn,b.copy_rate copy_rate,
                b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                a.city_code city_code,a.tehsil_taluka taluka_code,
                nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
               from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e
               where b.comp_code =a.comp_code and b.comp_code =e.comp_code and b.comp_code ='||''''||pcomp_code||''''||' and 
               b.unit_code=a.unit and b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
               b.doctype='||''''||pdoc_type||''''||' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
               a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl('||''''||pagcode||''''||',b.agcd) and 
               b.dpcd=nvl('||''''||pdepocode||''''||',b.dpcd) and b.publ=nvl('||''''||ppubl||''''||',b.publ) and
               b.publ=e.publ and b.edtn=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
               (a.tehsil_taluka='||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
               b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code) and
               (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0) u
               where u.return_copy>0
               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.copy_rate,u.taluka_code) c
               group by c.comp_code,c.unit_code,c.taluka_code
               order by c.comp_code,c.unit_code,taluka_name';
           --insert into test1(vstring,vstring2) values('unsold edtn v_query2 ',v_query1);COMMIT;
           open p_accounts1 for v_query1;
    
           v_query1:='select c.comp_code comp_code,c.unit_code unit_code '||tot_vvar||'
           from
           (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,u.copy_rate copy_rate,'||vvar
           ||' from (select b.comp_code comp_code,b.unit_code unit_code,b.publ publ,e.main_edtn edtn,b.copy_rate copy_rate,
                b.agcd agcd,b.dpcd dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
                a.city_code city_code,a.tehsil_taluka taluka_code,
                nvl(b.short_recpt,0)+nvl(b.late_recpt,0)+nvl(b.bnr,0)+nvl(b.unsold,0) return_copy
               from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e
               where b.comp_code =a.comp_code and b.comp_code =e.comp_code and b.comp_code ='||''''||pcomp_code||''''||' and 
               b.unit_code=a.unit and b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
               b.doctype='||''''||pdoc_type||''''||' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
               a.agcd=b.agcd and a.dpcd=b.dpcd and b.agcd=nvl('||''''||pagcode||''''||',b.agcd) and 
               b.dpcd=nvl('||''''||pdepocode||''''||',b.dpcd) and b.publ=nvl('||''''||ppubl||''''||',b.publ) and
               b.publ=e.publ and b.edtn=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
               (a.tehsil_taluka='||''''||ptalukacode||''''||' or '||''''||ptalukacode||''''||' is null) and
               b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code) and
               (nvl(short_recpt,0)+nvl(late_recpt,0)+nvl(bnr,0)+nvl(unsold,0))>0) u
               where u.return_copy>0
               group by u.comp_code,u.unit_code,u.publ,u.edtn,u.copy_rate)c
               group by c.comp_code,c.unit_code
               order by c.comp_code,c.unit_code';
            --insert into test1(vstring,vstring2) values('unsold edtn v_query3 ',v_query1);COMMIT;
           open p_accounts2 for v_query1;
       End if;

            /*Branch Received */
           v_query1:='select c.comp_code comp_code,c.unit_code unit_code,c.branch_code branch_code,d."Branch_Name" branch_name'||tot_vvar||'
           from
           (select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,u.copy_rate copy_rate,u.branch_code branch_code,'||vvar
           ||' from (select b.comp_code comp_code,b.unit_code unit_code,b.publ_code publ,e.main_edtn edtn,b.edtn_rate copy_rate,
               b.oth_branch_code branch_code,nvl(b.edtn_copy,0) return_copy
               from cir_branch_return_det b,cir_edtn_mast e
               where b.comp_code =e.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                   b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
                   b.doctype=''TI'' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
                   b.publ_code=nvl('||''''||ppubl||''''||',b.publ_code) and
                   b.publ_code=e.publ and b.edtn_code=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
                   b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code)) u
                   where u.return_copy>0
                   group by u.comp_code,u.unit_code,u.publ,u.edtn,u.branch_code,u.copy_rate) c,branch_mst d
                   where c.branch_code=d."Branch_Code"
                   group by c.comp_code,c.unit_code,c.branch_code,d."Branch_Name"
                   order by c.comp_code,c.unit_code,c.branch_code, branch_name';
            
            --insert into test1(vstring,vstring2) values('unsold edtn branch received v_query4 ',v_query1);COMMIT;
            
            open p_accounts3 for v_query1;

            v_query1:='select c.comp_code comp_code,c.unit_code unit_code,c.rec_type rec_type,c.branch_name branch_name '||tot_vvar||'
           from
           (select u.comp_code comp_code,u.unit_code unit_code,u.branch_name branch_name,u.publ publ,u.edtn edtn,u.copy_rate copy_rate,u.rec_type,'||vvar
           ||' from (select b.comp_code comp_code,b.unit_code unit_code,b.branch_code branch_code,f."Branch_Name" branch_name, b.publ_code publ,e.main_edtn edtn,b.edtn_rate copy_rate,
               1 rec_type,nvl(b.edtn_copy,0) return_copy
               from cir_branch_return_det b,cir_edtn_mast e,branch_mst f
               where b.comp_code =e.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                   b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
                   b.doctype=''TRF'' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
                   b.publ_code=nvl('||''''||ppubl||''''||',b.publ_code) and
                   b.publ_code=e.publ and b.edtn_code=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
                   b.branch_code=f."Branch_Code" and b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code)
                   union all
                   select b.comp_code comp_code,b.unit_code unit_code,NULL branch_code,''Company Return'' branch_name,b.publ publ,e.main_edtn edtn,b.copy_rate copy_rate,
                    2 rec_type,nvl(b.apr_short_recpt,0)+nvl(b.apr_late_recpt,0)+nvl(b.apr_bnr,0)+nvl(b.apr_unsold,0) return_copy
                    from cir_unsold_dtl_dis b,cir_edtn_mast e
                    where b.comp_code =e.comp_code and b.comp_code ='||''''||pcomp_code||''''||' and 
                    b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
                    b.doctype='||''''||pdoc_type||''''||' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
                    b.publ=nvl('||''''||ppubl||''''||',b.publ) and
                    b.publ=e.publ and b.edtn=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
                    b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code)
                   union all
                   select b.comp_code comp_code,b.unit_code unit_code,NULL branch_code,''Raddi Sale'' branch_name,b.publ_code publ,e.main_edtn edtn,b.edtn_rate copy_rate,
                   3 rec_type,nvl(b.no_of_copy,0) return_copy
                   from cir_return_sale_det b,cir_edtn_mast e
                   where b.comp_code =e.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                   b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
                   b.doctype=''RET'' and b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
                   b.publ_code=nvl('||''''||ppubl||''''||',b.publ_code) and
                   b.publ_code=e.publ and b.edtn_code=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
                   b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code)
                   union all
                   select b.comp_code comp_code,b.unit_code unit_code,NULL branch_code,''Resale Supply'' branch_name,b.publ publ,e.main_edtn edtn,b.sup_rate copy_rate,
                    4 rec_type,nvl(b.sup_copy,0) return_copy
                    from cir_agmast a,cir_dbksup_resale b,cir_edtn_mast e
                    where b.comp_code =a.comp_code and b.comp_code =e.comp_code and b.comp_code ='||''''||pcomp_code||''''||' and 
                    b.unit_code=a.unit and b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
                    b.supdate >= '||''''||v_frdt||''''||' and b.supdate<='||''''||v_todt||''''||' and a.agcd=b.agcd and a.dpcd=b.dpcd and
                    b.publ=nvl('||''''||ppubl||''''||',b.publ) and
                    b.publ=e.publ and b.edtn=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
                    b.resale_branch=nvl('||''''||pbran_code||''''||',b.resale_branch)
                   union all
                   select b.comp_code comp_code,b.unit_code unit_code,NULL branch_code,''Short\Excess'' branch_name,b.publ_code publ,e.main_edtn edtn,b.edtn_rate copy_rate,
                   5 rec_type,nvl(b.short_excess,1)*nvl(b.no_of_copy,0) return_copy
                   from cir_physical_ver_det b,cir_edtn_mast e
                   where b.comp_code =e.comp_code and b.comp_code    ='||''''||pcomp_code||''''||' and 
                   b.unit_code=e.unit_code and b.unit_code='||''''||punit_code||''''||' and 
                   b.recptdt >= '||''''||v_frdt||''''||' and b.recptdt<='||''''||v_todt||''''||' and 
                   b.publ_code=nvl('||''''||ppubl||''''||',b.publ_code) and
                   b.publ_code=e.publ and b.edtn_code=e.edtn and e.main_edtn=nvl('||''''||pmainedtn||''''||',e.main_edtn) and
                   b.branch_code=nvl('||''''||pbran_code||''''||',b.branch_code)
                   union all
                   select b.comp_code comp_code,b.unit_code unit_code,NULL branch_code,''Privious Balance'' branch_name,b.publ_code publ,e.main_edtn edtn,b.copy_rate copy_rate,
                   6 rec_type,nvl(b.opbal,0) return_copy
                   from cir_temp_unsold_stock b,cir_edtn_mast e
                   where b.comp_code =e.comp_code and b.unit_code=e.unit_code and  
                   b.publ_code=e.publ and b.edtn_code=e.edtn and sess_id=userenv(''sessionid'')) u
                   where u.return_copy<>0
                   group by u.comp_code,u.unit_code,u.branch_name,u.publ,u.edtn,u.rec_type,u.copy_rate) c
                   group by c.comp_code,c.unit_code,c.rec_type,c.branch_name
                   order by c.comp_code,c.unit_code,c.rec_type,c.branch_name';
                   
             --insert into test1(vstring,vstring2) values('unsold edtn branch comp return v_query5 ',v_query1);COMMIT;
            
            open p_accounts5 for v_query1; 
        
            open p_accounts6 for select sysdate from dual;
    Else
        v_query1:='select '||''''||pcomp_code||''''||' comp_code,'||''''||punit_code||''''||' unit_code,null agcd,null dpcd,null agname,null agname_oth_lang,null city_name,null taluka_name,0 supply_copy,0 return_copy from dual';
        --insert into test1(vstring,vstring2) values('unsold else edtn vquery ',v_query1);COMMIT;
        
        open p_accounts for v_query1;
        v_query1:='select '||''''||pcomp_code||''''||' comp_code,'||''''||punit_code||''''||' unit_code,null taluka_name,0 supply_copy,0 return_copy from dual';
        --insert into test1(vstring,vstring2) values('unsold else edtn vquery2 ',v_query1);COMMIT;
        
        open p_accounts1 for v_query1;
        v_query1:='select '||''''||pcomp_code||''''||' comp_code,'||''''||punit_code||''''||' unit_code,0 supply_copy,0 return_copy from dual';
        --insert into test1(vstring,vstring2) values('unsold else edtn vquery3 ',v_query1);COMMIT;
        
        open p_accounts2 for v_query1;
             v_query1:='select null from dual';
        open p_accounts3 for v_query1;    
        
        open p_accounts5 for select sysdate from dual; 
        
        open p_accounts6 for select sysdate from dual;         
    End if;
    delete from cir_temp_unsold_stock where sess_id=userenv('sessionid');commit;
   End cir_unsold_return_punya; 
   
  procedure cir_rep_unsold_challan(
     pcompcode             in varchar2,
     punitcode             in varchar2,
     pdoctype            in varchar2,
     pagcode            in varchar2,
     pagsubcode            in varchar2,
     pfrom_recdate         in varchar2,
     ptill_recdate      in varchar2,
     precptno           in varchar2,
     papproved_flag     in varchar2,
     pdateformat        in varchar2,
     pextra1            in varchar2,
     pextra2            in varchar2,
     p_accounts         out t_accounts)
  As
    v_frdt date;
    v_todt date;
  Begin
    v_frdt:=to_date(pfrom_recdate,''''||pdateformat||'''');
    v_todt:=to_date(ptill_recdate,''''||pdateformat||'''');
    
    open p_accounts for
    select u.comp_code as comp_code,u.unit_code as unit_code,u.branch_code branch_code,
    u.branch_name branch_name,u.agcd agcd,u.dpcd dpcd,
    u.ag_name AS ag_name,u.recptdt recptdt,u.recptno recptno ,u.publ publ,u.publ_name publ_name, 
    u.main_edtn main_edtn, u.main_edtnname main_edtnname,u.edtn edtn,u.edtn_name edtn_name,
    u.copy_rate copy_rate,
    u.return_copy return_copy 
    from(select d.comp_code as comp_code,d.unit_code as unit_code,d.branch_code branch_code,
    get_branch_name(d.branch_code) branch_name,d.agcd agcd,d.dpcd dpcd,
    m.ag_name AS ag_name,d.recptdt recptdt,d.recptno recptno ,d.publ publ,cir_get_name.cir_publ(d.comp_code,d.publ,1,'','','') publ_name, 
    e.main_edtn main_edtn,cir_get_name.cir_edtn(d.comp_code,d.unit_code,e.main_edtn,1,'','','') main_edtnname,d.edtn edtn,e.edtn_name edtn_name,
    d.copy_rate copy_rate,
    sum(nvl(d.short_recpt,0)+nvl(d.late_recpt,0)+nvl(d.bnr,0)+nvl(d.unsold,0)) return_copy
    from cir_agmast_dis m, cir_unsold_hdr_dis h,cir_unsold_dtl_dis d,cir_edtn_mast e
    where m.comp_code=d.comp_code and d.comp_code=h.comp_code and m.comp_code=e.comp_code and m.comp_code=pcompcode and 
    m.unit=d.unit_code and d.unit_code=h.unit_code and m.unit=e.unit_code and m.unit=punitcode and 
    m.agcd=d.agcd and m.agcd=nvl(pagcode,m.agcd) and m.dpcd=d.dpcd and m.dpcd=nvl(pagsubcode,m.dpcd) and 
    d.doctype=h.doctype and d.doctype=nvl(pdoctype,d.doctype) and d.recptdt=h.recptdt and d.recptdt between v_frdt and v_todt and 
    d.recptno=h.recptno and d.recptno =nvl(precptno,d.recptno) and 
    d.publ=e.publ and d.edtn=e.edtn and pextra2='D'
    group by d.comp_code,d.unit_code,d.agcd,d.dpcd ,m.ag_name,d.recptdt,d.recptno ,d.publ,d.edtn,
    d.copy_rate,e.main_edtn,d.branch_code,e.edtn_name
    union
    select d.comp_code as comp_code,d.unit_code as unit_code,d.branch_code branch_code,
    get_branch_name(d.branch_code) branch_name,d.agcd agcd,d.dpcd dpcd,
    m.ag_name ag_name,d.recptdt recptdt,d.recptno recptno ,d.publ publ,cir_get_name.cir_publ(d.comp_code,d.publ,1,'','','') publ_name, 
    e.main_edtn main_edtn,cir_get_name.cir_edtn(d.comp_code,d.unit_code,e.main_edtn,1,'','','') main_edtnname,d.edtn edtn,e.edtn_name edtn_name,
    d.copy_rate copy_rate,
    sum(nvl(d.short_recpt,0)+nvl(d.late_recpt,0)+nvl(d.bnr,0)+nvl(d.unsold,0)) return_copy
    from cir_agmast m, cir_unsold_hdr h,cir_unsold_dtl d,cir_edtn_mast e
    where m.comp_code=d.comp_code and d.comp_code=h.comp_code and m.comp_code=e.comp_code and m.comp_code=pcompcode and 
    m.unit=d.unit_code and d.unit_code=h.unit_code and m.unit=e.unit_code and m.unit=punitcode and 
    m.agcd=d.agcd and m.agcd=nvl(pagcode,m.agcd) and m.dpcd=d.dpcd and m.dpcd=nvl(pagsubcode,m.dpcd) and 
    d.doctype=h.doctype and d.doctype=nvl(pdoctype,d.doctype) and d.recptdt=h.recptdt and d.recptdt between v_frdt and v_todt and 
    d.recptno=h.recptno and d.recptno =nvl(precptno,d.recptno) and 
    d.publ=e.publ and d.edtn=e.edtn and (pextra2!='D' or pextra2='' or pextra2 is null)
    group by d.comp_code,d.unit_code,d.agcd,d.dpcd ,m.ag_name,d.recptdt,d.recptno ,d.publ,d.edtn,
    d.copy_rate,e.main_edtn,d.branch_code,e.edtn_name) u
    order by comp_code,unit_code,recptdt,recptno,publ_name,main_edtnname,edtn_name;
    
  End cir_rep_unsold_challan;     
END cir_rep_unsold_supply;
/
/////////////////////////////////////////////end of issue 4488////////////////////////////////////////
