//////////////////////issue no 7424////////////////////////////

USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[wesp_updatedate1]    Script Date: 05/05/2012 12:23:06 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO











ALTER PROCEDURE   [dbo].[wesp_updatedate1]

@compcode as varchar(15),
@userid as varchar(15),
@dateformat as varchar(15),
@code as varchar(4),
@curr as varchar(8),
@ratecode as varchar(8),
@solo as varchar(15),
@breakup as varchar(2),
@bwcode as varchar(8),
@rostatus as varchar(2),
@filename as varchar(2),
@tfn as VARCHAR(4),
@insertbreak as varchar(2),
@prem as varchar(8),
@dealtype as varchar(2),
@pre as varchar(5),
@suff as varchar(5),
@financestatus as  char(2),
@voucherst as varchar(30),
@adcode as varchar(100),
@rodatetime as varchar(8),
@spacearea as varchar(8),
@vat as varchar(50),
@bookstat as varchar(25),
@cio_id as varchar(8),
@receipt_no as varchar(50),
@uom as varchar(8),
@bgcolor as varchar(10),
@validdate as varchar(10),
@agencyratecode as varchar(10),
@audit as varchar(8),
@book_insert_date as varchar(8),
@agencycomm as varchar(8),
@rateaudit as varchar(8),
@billaudit as varchar(8),
@billtype as varchar(8),
@invoice_no as varchar(50),
@copybooking as varchar(8),
@ratecompany as varchar(50),
@addagenycomm as varchar(50),
@agencycommlinkretainer as varchar(50),
@subeditionr as varchar(50),
@displaybilltype as varchar(50),
@classifiedbilltype as varchar(50),
@billformat as varchar(50),
@ratechk as varchar(50),
@allpkg as varchar(50),
@dayrate1 as varchar(50),
@schemetype as varchar(50),
@PIncludeclassi as varchar(50),
@receiptformat as varchar(50),
@cash_receipt as varchar(50),
@bill_orderwiselast as varchar(50),
@floor_chk as varchar(50),
@Unsoldflag as varchar(1),
@Supplystopper as varchar(10),
@drpRokeychk as varchar(1),
@Agencycomm_seq as varchar(1),
@creditreciept as varchar(1),
@cashindisplay as varchar(8),
@cashinclassified as varchar(8),
@rate_audit_pref as varchar(25),
@v_barcoding_allow as varchar(25),
@v_fmgbills AS VARCHAR(25),
@v_billed_cashdis as varchar(25),
@v_billed_cashcls as varchar(25),
@v_drpbackdate as varchar(25),
@dockitbooking as varchar(1),
@allowprevbooking as varchar(1),
@ro_wisecashbill as varchar(50),
@chkval as varchar(5),
@approval1 as varchar(50),
@pckstatus as varchar(3),
@cash_disc as varchar(1),
@cash_amt as varchar(10),
@seperate_cashier1 as varchar(10),
@disp_bill as varchar(1),
@clas_bill as varchar(1),
@mantimepost as varchar(1),
@bkdaypost as int,
@maxterutn as int,
@cir_return as varchar(1),
@noofchkbounc as int,
@noofdaychkrec as int,
@retday as int,
@chngsuppord as int,
@max_publishday as int,
@p_billno_period as varchar(15),
@spl_trans_edit as varchar(5),
@spl_dis_trans_editable as varchar(5),
@mul_pac_sel_trans as varchar(5),
@shmon_minword	as varchar(1),
@tradon_spcrg	as varchar(1),
@rateauth       as varchar(1),
@f2day as int,
@rateauditmodify as varchar(1),
@bindrevenuecenter as varchar(1),
@p_led_allow as varchar(2),
@p_clear_allow as varchar(2),
@repeatday as varchar(2),
@premiumedit as varchar(2),
@P_BILL_GENERATION as varchar(20),
@P_PUBLICATION_CENTER as varchar(50),
@P_allow_discount_prem as varchar(1),
@P_SCHEME_BILLING as varchar(50),
@P_ALLOW_PDC as varchar(50),
@PAD_TYPE_FOR_MANUL_BILL AS VARCHAR(20),
@RO_OUTSTAND_P AS VARCHAR(5),
@genrate_agency_code AS VARCHAR(5),
@p_dispauditbk AS VARCHAR(5),
@p_aotosupply  AS VARCHAR(5),
@p_Authorization as VARCHAR(1),
@p_CIR_AUTO_APPROVAL_UNSOLD AS VARCHAR(5),
@p_CIR_AUTO_PHYSICAL_UNSOLD AS VARCHAR(5),
@p_CIR_UNSOLD_INCLUDE_INCT AS VARCHAR(5),
@p_CIR_UNSOLD_INCLUDE_INSFEE AS VARCHAR(5),
@p_CIR_UNSOLD_ON_RECEIVED_DT AS VARCHAR(5),
@p_AGENCY_UNBLOCK_APPROVAL AS VARCHAR(5),
@p_UNBLOCK_APPROVAL_OUTSIDE_LIMIT AS VARCHAR(5),
@p_CIR_BILL_PUBLWISE AS VARCHAR(5),
@paging         AS VARCHAR(4000) ,
@print          AS VARCHAR(4000) ,
@allowpage      AS VARCHAR(4000) ,
@agency_req     AS VARCHAR(4000) ,
@region_req     AS VARCHAR(4000) ,
@p_ALLOW_FOLLOW_DT_BOOOK as varchar(1),
@p_CRM_SUPPLY_TYPE_PAID   as varchar(10),
@p_CRM_SUPPLY_TYPE_FREE   as varchar(10),
@p_CURRENCY_MEASUREMENT   as varchar(5),

@p_EDITABLE_AGENCY_COMM as varchar(1),
@p_CANCELLATION_CHARGE as varchar(1),
@P_taxi_entry_type     as VARCHAR(1),
@P_ApprovalWith          as VARCHAR(1),
@p_Auto_TDS_Credit_Note as varchar(1),
@p_TDS_Reason as varchar(10),
@p_Debit_Account_Head as varchar(10),
@p_credit_Account_Head as varchar(10),
@p_service_tax_credit_note as varchar(1),
@p_Tax_Reason as varchar(10),
@p_Debit_Account_Service_Tax as varchar(10),
@p_Credit_Account_Service_Tax as varchar(10),
@p_Auto_Patrakar_Credit_Note as varchar(1),
@p_Patrakar_Reason as varchar(10),
@p_Debit_Account_Patrakar as varchar(10),
@p_Credit_Account_Patrakar as varchar(10),
@p_Auto_Bank_Credit_Note as varchar(1),
@p_Bank_Reason as VARCHAR(10),
@p_Debit_Account_Bank as varchar(10),
@p_Credit_Account_Bank as varchar(10),
@P_BAR_CODE as VARCHAR(5),
@P_GEN_RCT_NO as VARCHAR(5),

@P_WEIGHT_CAL as VARCHAR(5)

AS
declare @query as varchar(8000)
declare @query1 as varchar(8000)
/*
set @query='update login set date_format='''+@dateformat+''' , Autogenerate='''+@code+''',curr_code='''+@curr+''' where com_code='''+@compcode+'''   '
exec(@query)

set @query1='update preferrences set RATE_COMPANY_AGENCY='''+@ratecompany+''',ADDITIONAL_AGENCY_COMM='''+@addagenycomm+''',
AGENCY_RETAINER_COMM='''+@agencycommlinkretainer+''',SUBEDITIONRATE='''+@subeditionr+''',DIS_BILLTYPE='''+@displaybilltype+''',
CLS_BILLTYPE='''+@classifiedbilltype+''',autogenerated='''+@code+''',currency_code='''+@curr+''' ,rate_gr_code='''+@ratecode+''' , 
date_format='''+@dateformat+''',solo='''+@solo+''',breakup='''+@breakup+''' ,blackwhitecode='''+@bwcode+''',  rostatus='''+@rostatus+''',
File_name='''+@filename+''',Tfn='''+@tfn+''',Insert_breakup='''+@insertbreak+''',Premium_type='''+@prem+''',Deal_type='''+@dealtype+'''  ,    
prefix='''+@pre+''', suffix='''+@suff+'''  ,     financestatus='''+ @financestatus+''' , voucherst='''+@voucherst+''',Ad_category='''+@adcode+''' ,
Ro_datetime='''+@rodatetime+''' ,Space_area='''+@spacearea+''',Vat='''+@vat+''' ,Booking_status='''+@bookstat+''' ,Cio_id='''+@cio_id+''',
Receipt_no='''+@receipt_no+''' ,uom_code='''+@uom+''',Bgcolor_publication='''+@bgcolor+''' ,chkfor_valid_pubdates='''+@validdate+''', 
Agency_ratecode='''+@agencyratecode+''',   audit='''+@audit+''', book_insert_date='''+@book_insert_date+''',agencycomm='''+@agencycomm+''',
rate_audit='''+@rateaudit+''',bill_audit='''+@billaudit+''', billtype='''+@billtype+''', invoice_no='''+@invoice_no+''' , 
copy_booking='''+@copybooking+''', BILLING_FORMAT='''+@billformat+''' , RATE_CHECK='''+@ratechk+''', ALL_PACKAGE='''+@allpkg+''',
DAYRATE='''+@dayrate1+''' ,SCHEME_TYPE='''+@schemetype+'''    ,DISP_CLSBILL='''+@PIncludeclassi+ '''  , RECEIPT_FORMAT ='''+@receiptformat+''',
CASH_RECEIPT_BILL='''+@cash_receipt+''', BILL_ORDERWSLAST='''+@bill_orderwiselast+''',FLOOR_CHK='''+@floor_chk+''' ,
Unsold_Entry_Flag='''+@Unsoldflag+''' ,Supply_Stop_Percentage='''+@Supplystopper+''',ROKEYCHECK='''+@drpRokeychk+''',
AGENCYCOMM_SEQ_COM='''+@Agencycomm_seq+''' ,CREDIT_RECIPT='''+@creditreciept+''',DISP_CASHBILL='''+@cashindisplay+''',
CLA_CASHBILL='''+@cashinclassified+''',RATE_AUDIT_PREF='''+@rate_audit_pref+''',BARCODING_ALLOWED='''+@v_barcoding_allow+''', 
FMG_BILL_DIS='''+@v_fmgbills+''',BILL_DISP_CASHBILL='''+@v_billed_cashdis +''',BILL_CLA_CASHBILL ='''+@v_billed_cashcls+''',
BACKDATERECEIPT='''+@v_drpbackdate+''',DOCKIT_BOOKING='''+@dockitbooking+''',Allowed_old_date='''+@allowprevbooking+''',
ROWISE_CASHBOOKING='''+@ro_wisecashbill+''' where    comp_code='''+@compcode+'''   ' 
*/
/*********************************************************************************************************/
UPDATE LOGIN SET date_format=@dateformat, Autogenerate=@code,curr_code=@curr WHERE COM_CODE=@compcode

UPDATE PREFERRENCES SET  autogenerated=@code,
currency_code=@curr ,
rate_gr_code=@ratecode,
date_format=@dateformat,solo=@solo,breakup=@breakup,
blackwhitecode=@bwcode,rostatus=@rostatus,File_name=@filename,Tfn=@tfn,
Insert_breakup=@insertbreak,Premium_type=@prem,Deal_type=@dealtype  ,
 prefix=@pre, suffix=@suff, financestatus=@financestatus , voucherst=@voucherst,
 Ad_category=@adcode ,Ro_datetime=@rodatetime ,Space_area=@spacearea,Vat=@vat,
 Booking_status=@bookstat,Cio_id=@cio_id,Receipt_no=@receipt_no,uom_code=@uom,
 Bgcolor_publication=@bgcolor ,chkfor_valid_pubdates=@validdate, Agency_ratecode=@agencyratecode,
  audit=@AUDIT,book_insert_date=@book_insert_date,agencycomm=@agencycomm,
  rate_audit=@rateaudit,bill_audit=@billaudit,billtype=@billtype,invoice_no=@invoice_no,
  copy_booking=@copybooking,RATE_COMPANY_AGENCY=@ratecompany, ADDITIONAL_AGENCY_COMM=@addagenycomm ,
  AGENCY_RETAINER_COMM=@agencycommlinkretainer,SUBEDITIONRATE=@subeditionr,
  CLS_BILLTYPE=@classifiedbilltype,DIS_BILLTYPE=@displaybilltype,BILLING_FORMAT=@billformat,
  RATE_CHECK=@ratechk,ALL_PACKAGE=@allpkg,dayrate=@dayrate1,SCHEME_TYPE=@schemetype,DISP_CLSBILL=@PIncludeclassi   ,
  CASH_RECEIPT_BILL=@cash_receipt, BILL_ORDERWSLAST=@bill_orderwiselast, FLOOR_CHK=@floor_chk ,
  Unsold_Entry_Flag=@Unsoldflag ,Supply_Stop_Percentage=@Supplystopper,ROKEYCHECK=@drpRokeychk ,
  AGENCYCOMM_SEQ_COM=@Agencycomm_seq ,CREDIT_RECIPT=@creditreciept,DISP_CASHBILL=@cashindisplay,
  CLA_CASHBILL=@cashinclassified,RATE_AUDIT_PREF=@rate_audit_pref,BARCODING_ALLOWED=@v_barcoding_allow,
  FMG_BILL_DIS =@v_fmgbills, BILL_DISP_CASHBILL=@v_billed_cashdis , BILL_CLA_CASHBILL=@v_billed_cashcls,BACKDATERECEIPT=@v_drpbackdate,DOCKIT_BOOKING=@dockitbooking,Allowed_old_date=@allowprevbooking,ROWISE_CASHBOOKING=@ro_wisecashbill,CUTOFFTIME=@chkval,APPROVAL=@approval1,back_days=@pckstatus,CASH_DISCOUNT=@cash_amt,CASH_DISCOUNTTYPE=@cash_disc,SEPRATE_CASHIER=@seperate_cashier1,
 CIR_MANY_TIME_POSTING=@mantimepost, CIR_BACKDAYS_POSTING=@bkdaypost, CIR_MAX_RETURN_ALLOW=@maxterutn, CIR_RETURN_LIMIT_ALLOW=@cir_return, CIR_NO_OF_CHQBOUNCE=@noofchkbounc, CIR_DAYS_CHQBOUNCE=@noofdaychkrec, CIR_RETURN_DAYS=@retday, CIR_SUP_ORDER_LIMIT=@chngsuppord, DISP_BILLING_CRITERIA=@disp_bill, CLSD_BILLING_CRITERIA=@clas_bill,MAX_PUBLISHDAYS=@max_publishday,
 BILLNO_PERIODICITY=@p_billno_period,SPECIALDISC_TRANS_EDIT=@spl_trans_edit, SHARING_TRANS=@spl_dis_trans_editable, MULTIPACKAGE_SEL_TRANS=@mul_pac_sel_trans,SCHEME_MINWORD=@shmon_minword, TRADE_SPLCHARGE=@tradon_spcrg,RATE_AUTHORIZATION=@rateauth
  ,F2_RECORD=@f2day,PUBLISHAD_EDIT_RATEAUDIT=@rateauditmodify,BINDREVENUE_CENTER=@bindrevenuecenter,
FA_LEDGER_ALLOW=@p_led_allow,CLEARANCE_TYPE_ALLOW=@p_clear_allow,REPEAT_DAY_TYPE=@repeatday,PREMIUM_EDIT=@premiumedit,

BILL_GENERATION_PRIOR=@P_BILL_GENERATION,PUBLICATION_HO=@P_PUBLICATION_CENTER,

SPLDISC_ALLOWPREM=@P_allow_discount_prem,BILL_SCHEME=@P_SCHEME_BILLING,

ALLOWED_PDC_DAYS_RECEIPT=@P_ALLOW_PDC,AD_TYPE_MANUL_BILL=@PAD_TYPE_FOR_MANUL_BILL,OUTSTANDING_AMT_CRITERIA=@RO_OUTSTAND_P,GENRATE_CIR_AGCD=@genrate_agency_code,DISP_AUDITBKG=@p_dispauditbk,CIR_DIS_AUTO_POSTING=@p_aotosupply,RELAUTHREQON=@p_Authorization,
CIR_AUTO_APPROVAL_UNSOLD=@p_CIR_AUTO_APPROVAL_UNSOLD,CIR_AUTO_PHYSICAL_UNSOLD=@p_CIR_AUTO_PHYSICAL_UNSOLD,CIR_UNSOLD_INCLUDE_INCT=@p_CIR_UNSOLD_INCLUDE_INCT,
CIR_UNSOLD_INCLUDE_INSFEE=@p_CIR_UNSOLD_INCLUDE_INSFEE,CIR_UNSOLD_ON_RECEIVED_DT=@p_CIR_UNSOLD_ON_RECEIVED_DT,AGENCY_UNBLOCK_APPROVAL=@p_AGENCY_UNBLOCK_APPROVAL,UNBLOCK_APPROVAL_OUTSIDE_LIMIT=@p_UNBLOCK_APPROVAL_OUTSIDE_LIMIT,CIR_BILL_PUBLWISE=@p_CIR_BILL_PUBLWISE,
RECORDS_ON_PAGE = @paging,RECORDS_ON_PRINT = @print,HEADER_ON_PAGE = @allowpage,AGENCY_REQUIRED = @agency_req,REGION_REQUIRED = @region_req,ALLOW_FOLLOW_DT_BOOOK=@p_ALLOW_FOLLOW_DT_BOOOK,CRM_SUPPLY_TYPE_PAID=@p_CRM_SUPPLY_TYPE_PAID,CRM_SUPPLY_TYPE_FREE=@p_CRM_SUPPLY_TYPE_FREE,CURRENCY_MEASUREMENT=@p_CURRENCY_MEASUREMENT,EDITABLE_AGENCY_COMM =@p_EDITABLE_AGENCY_COMM,CANCELLATION_CHARGE =@p_CANCELLATION_CHARGE,taxi_entry_type=@P_taxi_entry_type,APPROVAL_WITH =@P_ApprovalWith,

TDS_AUTO_CN=@p_Auto_TDS_Credit_Note,
TDS_AUTO_REASON=@p_TDS_Reason ,TDS_DB_CDP=@p_Debit_Account_Head,TDS_CR_CDP=@p_credit_Account_Head,SER_TAX_AUTO_CN=@p_service_tax_credit_note,SER_TAX_AUTO_REASON=@p_Tax_Reason,SER_TAX_DB_CDP=@p_Debit_Account_Service_Tax,SER_TAX_CR_CDP=@p_Credit_Account_Service_Tax,PKK_AUTO_CN=@p_Auto_Patrakar_Credit_Note,PKK_AUTO_REASON=@p_Patrakar_Reason ,PKK_DB_CDP=@p_Debit_Account_Patrakar,PKK_CR_CDP=@p_Credit_Account_Patrakar ,BANK_CHG_AUTO_CN=@p_Auto_Bank_Credit_Note ,
BANK_CHG_AUTO_REASON=@p_Bank_Reason ,BANK_CHG_DB_CDP=@p_Debit_Account_Bank ,BANK_CHG_CR_CDP=@p_Credit_Account_Bank,

 CIR_BARCODE= @P_BAR_CODE,CIR_WIEGHT_CALC_REQ= @P_WEIGHT_CAL,GEN_RCT_TYP = @P_GEN_RCT_NO

 
 WHERE comp_code=@compcode




/* ,
',Unsold_Entry_Flag='''+@Unsoldflag+''',Supply_Stop_Percentage='''+@Supplystopper+'''

,ROKEYCHECK='''+@drpRokeychk+''',AGENCYCOMM_SEQ_COM='''+@Agencycomm_seq+''' ,CREDIT_RECIPT='''+@creditreciept+''' where    comp_code='''+@compcode+'''   ' 



--,DISP_CASHBILL='''+@cashindisplay+''',CLA_CASHBILL='''+@cashinclassified+'''
*/

print(@query1)
exec(@query1)





///////////////////////////////end of issue no 7424////////


----------------------------------------------------NAMAN (05-05-2012)----------------------------------------------------







ALTER procedure [dbo].[cir_route_editionwise_print](
    @pcompcode      as varchar(500),
    @punitcode      as varchar(500),
    @ppublcode      as varchar(500),
    @pmainedtn      as varchar(500),
    @pedtncode      as varchar(500),
    @proute         as varchar(500),
    @pfrom_supdate  as datetime,
    @ptill_supdate  as datetime,
    @plangtype      as varchar(500),
    @pdateformat    as varchar(500),
    @pextra1        as varchar(500),
    @pextra2        as varchar(500),
    @pextra3        as varchar(500),--------supply posted final and un final
    @pextra4        as varchar(500),
    @pextra5        as varchar(500),
    @pextra6        as varchar(500),
    @pextra7        as varchar(500),
    @pextra8        as varchar(500),
    @pextra9        as varchar(500),
    @pextra10       as varchar(500)

)
as
SET CONCAT_NULL_YIELDS_NULL OFF
--CREATE TABLE #CIR_TEMP_DT
--(
--  SQNO  NUMeric,
--  DT    DATEtime
--)
declare @vsupdate  as  datetime;
declare @vsupdate1  as datetime;
declare @vvar    as varchar(max);
declare @vvar_sum   as  varchar(max);
declare @vvar_sum1  as  varchar(max);
declare @v_query  as  varchar(max);
declare @v_query1  as  varchar(max);

set @vsupdate =@pfrom_supdate
set @vsupdate1=@ptill_supdate

declare cur_edtn cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(p.edition_nick,1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,d.sup_rate sup_rate,p.main_edtn main_edtn
    from cir_route_mast m,cir_dbksup d ,cir_edtn_mast p ,cir_supply_type_mast k
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and m.unit=d.unit_code and
    d.comp_code=k.comp_code  and d.sup_type_code=k.sup_ty_code and 
    m.unit=p.unit_code and d.unit_code = @punitcode and
    d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
    m.route_code=d.route_code and (m.route_code=@proute or @proute is null)
    and d.publ=isnull(@ppublcode,d.publ) and
    d.publ=p.publ and d.edtn=p.edtn and k.bill_pay='Y'
    order by publ,main_edtn,edtn_seqno,edtn,sup_rate
print('a')
-- cursor variable for cur_edtn
declare @rec_edtn_publ as varchar(200)
declare @rec_edtn_edtn as varchar(200)
declare @rec_edtn_edtn_seqno as numeric(5)
declare @rec_edtn_edtn_name as varchar(500)
declare @rec_edtn_sup_rate as numeric(14,2)
declare @rec_edtn_main_edtn as varchar(200)
-- end here --

OPEN cur_edtn 
    fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_edtn_name+'"';
            end
                
                
    fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
END     
close cur_edtn
DEALLOCATE cur_edtn

if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end
print(@vvar)
 if @vvar is null or @vvar ='' begin
    set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name from(select d.comp_code,d.unit_code,d.route_code,
            case '''+@plangtype+''' when ''1'' then substring(m.route_name,1,45)
            else substring(m.route_name_oth_lang,1,45) end route_name 
            from cir_dbksup d,cir_route_mast m ,cir_supply_type_mast k
            where d.comp_code = m.comp_code and d.unit_code = m.unit 
            and d.comp_code=k.comp_code  and d.sup_type_code=k.sup_ty_code and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
            d.route_code = m.route_code  and 
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            and k.bill_pay=''Y'' 
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
            group by d.comp_code,d.unit_code,d.route_code,m.route_name) x
            group by x.comp_code,x.unit_code,x.route_code,x.route_name
            order by x.comp_code,x.unit_code,x.route_code,x.route_name';
end
else
begin        
    set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name,'+@vvar_sum+','+@vvar_sum1+' from(select d.comp_code,d.unit_code,d.route_code route_code,
            case '''+@plangtype+''' when ''1'' then substring(m.route_name,1,45) 
            else substring(m.route_name_oth_lang,1,45) end route_name
            ,'+@vvar+' from cir_dbksup d,cir_route_mast m,cir_supply_type_mast k
            where d.comp_code = m.comp_code and d.unit_code = m.unit 
            and d.comp_code=k.comp_code  and d.sup_type_code=k.sup_ty_code  and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
            d.route_code = m.route_code  and
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
            and k.bill_pay=''Y'' 
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
            group by d.comp_code,d.unit_code,m.route_name,d.route_code) x
            group by x.comp_code,x.unit_code,x.route_code,x.route_name
            order by x.comp_code,x.unit_code,x.route_code,x.route_name';       
end
print(@v_query)
exec(@v_query)  
print('q')
-- for free supply
    set @vvar=null
    set @vvar_sum=null
    set @vvar_sum1=null
    
declare cur_edtn_free cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(p.edition_nick,1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,d.sup_rate sup_rate,p.main_edtn main_edtn
    from cir_supply_type_mast m,cir_dbksup d ,cir_edtn_mast p 
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and 
      d.comp_code=m.comp_code  and d.sup_type_code=m.sup_ty_code and 
      d.unit_code=p.unit_code and d.unit_code = @punitcode and
      d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
      d.publ=isnull(@ppublcode,d.publ) and
      d.publ=p.publ and d.edtn=p.edtn and m.bill_pay='N'
      order by publ,main_edtn,edtn_seqno,edtn,sup_rate
-- cursor variable for cur_edtn_free
declare @rec_edtn_free_publ as varchar(200)
declare @rec_edtn_free_edtn as varchar(200)
declare @rec_edtn_free_edtn_seqno as numeric(5)
declare @rec_edtn_free_edtn_name as varchar(500)
declare @rec_edtn_free_sup_rate as numeric(14,2)
declare @rec_edtn_free_main_edtn as varchar(200)
-- end here --

OPEN cur_edtn_free 
    fetch NEXT FROM cur_edtn_free INTO @rec_edtn_free_publ , @rec_edtn_free_edtn,@rec_edtn_free_edtn_seqno,@rec_edtn_free_edtn_name,@rec_edtn_free_sup_rate,@rec_edtn_free_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_free_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_free_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_free_edtn_name+'") "'+@rec_edtn_free_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_free_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_free_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_free_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_free_edtn_name+'") "'+@rec_edtn_free_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_free_edtn_name+'"';
            end
                
                
    fetch NEXT FROM cur_edtn_free INTO @rec_edtn_free_publ , @rec_edtn_free_edtn,@rec_edtn_free_edtn_seqno,@rec_edtn_free_edtn_name,@rec_edtn_free_sup_rate,@rec_edtn_free_main_edtn
END     
close cur_edtn_free
DEALLOCATE cur_edtn_free
if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end

        if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,d.unit_code,m.sup_ty_code,
            substring(m.sup_ty_name,1,45) supply_name
            from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code 
            and d.sup_type_code=m.sup_ty_code
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            and m.bill_pay=''N'' 
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
            group by d.comp_code,d.unit_code,m.sup_ty_code,m.sup_ty_name) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit_code,m.sup_ty_code sup_ty_code,
            substring(m.sup_ty_name,1,45) supply_name
            ,'+@vvar+' from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code
             and d.sup_type_code=m.sup_ty_code 
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
             d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
             and m.bill_pay=''N'' and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' = '''')
            group by d.comp_code,d.unit_code,m.sup_ty_code,m.sup_ty_name) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end

print(@v_query1)
exec(@v_query1)




 set @vvar=null
    set @vvar_sum=null
    set @vvar_sum1=null


-------------------for edition total


declare cur_edtn_total cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(p.edition_nick,1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,d.sup_rate sup_rate,p.main_edtn main_edtn
    from cir_supply_type_mast m,cir_dbksup d ,cir_edtn_mast p 
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and 
      d.comp_code=m.comp_code  and d.sup_type_code=m.sup_ty_code and 
      d.unit_code=p.unit_code and d.unit_code = @punitcode and
      d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
      d.publ=isnull(@ppublcode,d.publ) and
      d.publ=p.publ and d.edtn=p.edtn 
      order by publ,main_edtn,edtn_seqno,edtn,sup_rate
    
-- cursor variable for cur_edtn_free
declare @rec_edtn_total_publ as varchar(200)
declare @rec_edtn_total_edtn as varchar(200)
declare @rec_edtn_total_edtn_seqno as numeric(5)
declare @rec_edtn_total_edtn_name as varchar(500)
declare @rec_edtn_total_sup_rate as numeric(14,2)
declare @rec_edtn_total_main_edtn as varchar(200)
-- end here --

OPEN cur_edtn_total 
    fetch NEXT FROM cur_edtn_total INTO @rec_edtn_total_publ , @rec_edtn_total_edtn,@rec_edtn_total_edtn_seqno,@rec_edtn_total_edtn_name,@rec_edtn_total_sup_rate,@rec_edtn_total_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_total_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_total_edtn_name+'") "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_total_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_total_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_total_edtn_name+'") "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_total_edtn_name+'"';
            end
                
                
    fetch NEXT FROM cur_edtn_total INTO @rec_edtn_total_publ , @rec_edtn_total_edtn,@rec_edtn_total_edtn_seqno,@rec_edtn_total_edtn_name,@rec_edtn_total_sup_rate,@rec_edtn_total_main_edtn
END     
close cur_edtn_total
DEALLOCATE cur_edtn_total
if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end

        if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,unit_code,null as sup_ty_code, null as supply_name
            from cir_dbksup d
            where d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
            group by d.comp_code,d.unit_code) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit_code   ,null as sup_ty_code, null as supply_name
            ,'+@vvar+' from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code
             and d.sup_type_code=m.sup_ty_code 
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
             d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
              and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' = '''')
            group by d.comp_code,d.unit_code) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end

print(@v_query1)
exec(@v_query1)











                                                                     
                                                                     
                                                                     
                                             
create procedure cir_exec_editionwise_print
    @pcompcode      as varchar(500),
    @punitcode      as varchar(500),
    @ppublcode      as varchar(500),
    @pmainedtn      as varchar(500),
    @pedtncode      as varchar(500),
    @proute         as varchar(500),
    @pfrom_supdate  as datetime,
    @ptill_supdate  as datetime,
    @plangtype      as varchar(500),
    @pdateformat    as varchar(500),
    @pextra1        as varchar(500),
    @pextra2        as varchar(500),
    @pextra3        as varchar(500),--------supply posted final and un final
    @pextra4        as varchar(500),
    @pextra5        as varchar(500),
    @pextra6        as varchar(500),
    @pextra7        as varchar(500),
    @pextra8        as varchar(500),
    @pextra9        as varchar(500),
    @pextra10       as varchar(500)
as
SET CONCAT_NULL_YIELDS_NULL OFF

declare @vsupdate	as  datetime;
declare @vsupdate1  as datetime;
declare @vvar		as varchar(max);
declare @vvar_sum   as  varchar(max);
declare @vvar_sum1  as  varchar(max);
declare @v_query	as  varchar(max);
declare @v_query1	as  varchar(max);

set @vsupdate =@pfrom_supdate
set @vsupdate1=@ptill_supdate

declare cur_edtn cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(isnull(p.edition_nick,p.edtn_name),1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,d.sup_rate sup_rate,p.main_edtn main_edtn
    from cir_route_mast m,cir_dbksup d ,cir_edtn_mast p ,cir_supply_type_mast k,cir_agmast a
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=a.comp_code and 
    d.comp_code=k.comp_code  and m.unit=d.unit_code and a.unit=d.unit_code and m.unit=p.unit_code and 
    d.unit_code = @punitcode and d.sup_type_code=k.sup_ty_code and d.agcd=a.agcd and d.dpcd=a.dpcd and
    d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
    m.route_code=d.route_code and (m.route_code=@proute or @proute is null)
    and d.publ=isnull(@ppublcode,d.publ) and
    d.publ=p.publ and d.edtn=p.edtn and k.bill_pay='Y'
    order by publ,main_edtn,edtn_seqno,edtn,sup_rate
print('a')
-- cursor variable for cur_edtn
declare @rec_edtn_publ as varchar(200)
declare @rec_edtn_edtn as varchar(200)
declare @rec_edtn_edtn_seqno as numeric(5)
declare @rec_edtn_edtn_name as varchar(500)
declare @rec_edtn_sup_rate as numeric(14,2)
declare @rec_edtn_main_edtn as varchar(200)
-- end here --

OPEN cur_edtn 
    fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_edtn_name+'"';
            end
                
                
    fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
END     
close cur_edtn
DEALLOCATE cur_edtn

if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end
print(@vvar)
 if @vvar is null or @vvar ='' begin
    set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name from(select d.comp_code,d.unit_code,a.executive_code route_code,
            case '''+@plangtype+''' when ''1'' then substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25)
            else substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25) end route_name 
            from cir_dbksup d,cir_route_mast m ,cir_supply_type_mast k,cir_agmast a
            where d.comp_code = m.comp_code and d.unit_code = m.unit 
            and d.comp_code=k.comp_code  and d.comp_code=a.comp_code and d.sup_type_code=k.sup_ty_code and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = a.unit and d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
            d.route_code = m.route_code  and 
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            and k.bill_pay=''Y'' 
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') and
            d.agcd=d.agcd and d.dpcd=d.dpcd
            group by d.comp_code,d.unit_code,a.executive_code) x
            group by x.comp_code,x.unit_code,x.route_code,x.route_name
            order by x.comp_code,x.unit_code,x.route_code,x.route_name';
end
else
begin        
    set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name,'+@vvar_sum+','+@vvar_sum1+' from(select d.comp_code,d.unit_code,a.executive_code route_code,
            case '''+@plangtype+''' when ''1'' then substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25)
            else substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25) end route_name
            ,'+@vvar+' from cir_dbksup d,cir_route_mast m,cir_supply_type_mast k,cir_agmast a
            where d.comp_code = m.comp_code and d.unit_code = a.unit and d.unit_code = m.unit 
            and d.comp_code=k.comp_code  and d.comp_code=a.comp_code and d.sup_type_code=k.sup_ty_code  and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
            d.route_code = m.route_code  and
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
            and k.bill_pay=''Y'' 
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') and
            d.agcd=d.agcd and d.dpcd=d.dpcd
            group by d.comp_code,d.unit_code,a.executive_code) x
            group by x.comp_code,x.unit_code,x.route_code,x.route_name
            order by x.comp_code,x.unit_code,x.route_code,x.route_name';       
end
print(@v_query)
exec(@v_query)  
print('q')
-- for free supply
    set @vvar=null
    set @vvar_sum=null
    set @vvar_sum1=null
    
declare cur_edtn_free cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(p.edition_nick,1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,d.sup_rate sup_rate,p.main_edtn main_edtn
    from cir_supply_type_mast m,cir_dbksup d ,cir_edtn_mast p 
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and 
      d.comp_code=m.comp_code  and d.sup_type_code=m.sup_ty_code and 
      d.unit_code=p.unit_code and d.unit_code = @punitcode and
      d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
      d.publ=isnull(@ppublcode,d.publ) and
      d.publ=p.publ and d.edtn=p.edtn and m.bill_pay='N'
      order by publ,main_edtn,edtn_seqno,edtn,sup_rate
-- cursor variable for cur_edtn_free
declare @rec_edtn_free_publ as varchar(200)
declare @rec_edtn_free_edtn as varchar(200)
declare @rec_edtn_free_edtn_seqno as numeric(5)
declare @rec_edtn_free_edtn_name as varchar(500)
declare @rec_edtn_free_sup_rate as numeric(14,2)
declare @rec_edtn_free_main_edtn as varchar(200)
-- end here --

OPEN cur_edtn_free 
    fetch NEXT FROM cur_edtn_free INTO @rec_edtn_free_publ , @rec_edtn_free_edtn,@rec_edtn_free_edtn_seqno,@rec_edtn_free_edtn_name,@rec_edtn_free_sup_rate,@rec_edtn_free_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_free_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_free_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_free_edtn_name+'") "'+@rec_edtn_free_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_free_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_free_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_free_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_free_edtn_name+'") "'+@rec_edtn_free_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_free_edtn_name+'"';
            end
                
                
    fetch NEXT FROM cur_edtn_free INTO @rec_edtn_free_publ , @rec_edtn_free_edtn,@rec_edtn_free_edtn_seqno,@rec_edtn_free_edtn_name,@rec_edtn_free_sup_rate,@rec_edtn_free_main_edtn
END     
close cur_edtn_free
DEALLOCATE cur_edtn_free
if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end

        if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,d.unit_code,m.sup_ty_code,
            substring(m.sup_ty_name,1,25) supply_name
            from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code 
            and d.sup_type_code=m.sup_ty_code
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            and m.bill_pay=''N'' 
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
            group by d.comp_code,d.unit_code,m.sup_ty_code,m.sup_ty_name) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit_code,m.sup_ty_code sup_ty_code,
            substring(m.sup_ty_name,1,25) supply_name
            ,'+@vvar+' from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code
             and d.sup_type_code=m.sup_ty_code 
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
             d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
             and m.bill_pay=''N'' and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' = '''')
            group by d.comp_code,d.unit_code,m.sup_ty_code,m.sup_ty_name) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end

print(@v_query1)
exec(@v_query1)




 set @vvar=null
    set @vvar_sum=null
    set @vvar_sum1=null


-------------------for edition total


declare cur_edtn_total cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(p.edition_nick,1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,d.sup_rate sup_rate,p.main_edtn main_edtn
    from cir_supply_type_mast m,cir_dbksup d ,cir_edtn_mast p 
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and 
      d.comp_code=m.comp_code  and d.sup_type_code=m.sup_ty_code and 
      d.unit_code=p.unit_code and d.unit_code = @punitcode and
      d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
      d.publ=isnull(@ppublcode,d.publ) and
      d.publ=p.publ and d.edtn=p.edtn 
      order by publ,main_edtn,edtn_seqno,edtn,sup_rate
    
-- cursor variable for cur_edtn_free
declare @rec_edtn_total_publ as varchar(200)
declare @rec_edtn_total_edtn as varchar(200)
declare @rec_edtn_total_edtn_seqno as numeric(5)
declare @rec_edtn_total_edtn_name as varchar(500)
declare @rec_edtn_total_sup_rate as numeric(14,2)
declare @rec_edtn_total_main_edtn as varchar(200)
-- end here --

OPEN cur_edtn_total 
    fetch NEXT FROM cur_edtn_total INTO @rec_edtn_total_publ , @rec_edtn_total_edtn,@rec_edtn_total_edtn_seqno,@rec_edtn_total_edtn_name,@rec_edtn_total_sup_rate,@rec_edtn_total_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_total_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_total_edtn_name+'") "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_total_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_total_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_total_edtn_name+'") "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_total_edtn_name+'"';
            end
                
                
    fetch NEXT FROM cur_edtn_total INTO @rec_edtn_total_publ , @rec_edtn_total_edtn,@rec_edtn_total_edtn_seqno,@rec_edtn_total_edtn_name,@rec_edtn_total_sup_rate,@rec_edtn_total_main_edtn
END     
close cur_edtn_total
DEALLOCATE cur_edtn_total
if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end

        if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,unit_code,null as sup_ty_code, null as supply_name
            from cir_dbksup d
            where d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
            group by d.comp_code,d.unit_code) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit_code   ,null as sup_ty_code, null as supply_name
            ,'+@vvar+' from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code
             and d.sup_type_code=m.sup_ty_code 
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
             d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
              and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' = '''')
            group by d.comp_code,d.unit_code) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end

print(@v_query1)
exec(@v_query1)















                                                                     
                                                                     
                                                                     
                                             
ALTER procedure cir_rep_bill_detail_p
    @pcomp_code    as varchar(20),
    @punit_code    as varchar(20),
    @ppubl         as varchar(20),
    @repty         as varchar(20),
    @pbill_freq    as varchar(20),
    @pfrom_billdt  as datetime,
    @ptill_billdt  as datetime,
    @pbillagcd     as varchar(20),
    @pbilldpcd     as varchar(20),
    @pdateformat   as varchar(20),
    @pextra1       as varchar(200),
    @pextra2       as varchar(200)
As

Begin
if @pbilldpcd='' Begin
	set @pbilldpcd=null
end	

SELECT X.COMP_CODE COMP_CODE,X.UNIT_CODE UNIT_CODE,X.BILLNO BILLNO,X.BILLDT BILLDT,X.AGCD AGCD,X.DPCD DPCD,
        X.AG_NAME AG_NAME,X.AG_NAME_OTH_LANG AG_NAME_OTH_LANG,
        X.STATE_CODE STATE_CODE,X.DIST_CODE,X.TALUKA_CODE TALUKA_CODE,X.CITY_CODE,
		DBO.CIR_GET_CITY(X.COMP_CODE,X.CITY_CODE) CITY_NAME,
        SUM(X.TOT_COPY) TOT_COPY,SUM(X.TOT_COPY)-SUM(X.BILL_COPY) UNPAID_COPY,
        SUM(X.BILL_COPY) NET_COPY, SUM(X.GROSS_AMOUNT) GROSS_AMOUNT, SUM(X.COMM_AMT) COMM_AMT, 
        SUM(X.BILL_AMOUNT) BILL_AMOUNT, SUM(X.SUR_AMT) SUR_AMT
        from (select b.comp_code,b.unit_code,b.billno,b.billdt,b.agcd,b.dpcd,m.ag_name,m.ag_name_oth_lang,
        m.state_code,m.dist_code,m.tehsil_taluka taluka_code,m.city_code,
        b.bill_copy bill_copy, b.gross_amount gross_amount, b.comm_amt comm_amt, 
        b.bill_amount bill_amount, b.sur_amt sur_amt,
        (select isnull(sum(a.sup_copy),0) from cir_dbksup a where b.comp_code=a.comp_code and a.unit_code=b.unit_code and 
        a.supdate between @pfrom_billdt and @ptill_billdt and b.publ=a.publ and
        a.edtn =b.edtn and b.agcd =a.billagcd and b.dpcd=a.billdpcd) tot_copy
        from cir_bill_det b,cir_agmast m
        where m.comp_code=b.comp_code and m.unit=b.unit_code and m.agcd=b.agcd and m.dpcd=b.dpcd and 
        b.comp_code   = @pcomp_code and b.unit_code = isnull(@punit_code,b.unit_code) and
        b.billdt >= @pfrom_billdt and b.billdt <=@ptill_billdt and
        b.agcd = isnull(@pbillagcd,b.agcd) and b.dpcd = isnull(@pbilldpcd,b.dpcd) and
        (b.publ      = @ppubl or @ppubl is null)) x
        group by x.comp_code,x.unit_code,x.billno,x.billdt,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,
        x.state_code,x.dist_code,x.taluka_code,x.city_code
        order by billdt,billno
    
    SELECT X.COMP_CODE COMP_CODE,X.UNIT_CODE UNIT_CODE,X.BILLNO BILLNO,X.BILLDT BILLDT,X.AGCD AGCD,X.DPCD DPCD,X.CITY_CODE,X.STATE_CODE STATE_CODE,X.COUNTRY_CODE COUNTRY_CODE,
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        from
        (select a.comp_code comp_code,a.unit_code unit_code,b.billno billno,b.billdt billdt,a.billagcd agcd,a.billdpcd dpcd,m.city_code,m.state_code state_code,m.country_code country_code,
        case when day(a.supdate)='1' then sum(a.sup_copy) else 0 end p01,case when day(a.supdate)='2' then sum(a.sup_copy) else 0 end p02,
        case when day(a.supdate)='3' then sum(a.sup_copy) else 0 end p03,case when day(a.supdate)='4' then sum(a.sup_copy) else 0 end p04,
        case when day(a.supdate)='5' then sum(a.sup_copy) else 0 end p05,case when day(a.supdate)='6' then sum(a.sup_copy) else 0 end p06,
        case when day(a.supdate)='7' then sum(a.sup_copy) else 0 end p07,case when day(a.supdate)='8' then sum(a.sup_copy) else 0 end p08,
        case when day(a.supdate)='9' then sum(a.sup_copy) else 0 end p09,case when day(a.supdate)='10' then sum(a.sup_copy) else 0 end p10,
        case when day(a.supdate)='11' then sum(a.sup_copy) else 0 end p11,case when day(a.supdate)='12' then sum(a.sup_copy) else 0 end p12,
        case when day(a.supdate)='13' then sum(a.sup_copy) else 0 end p13,case when day(a.supdate)='14' then sum(a.sup_copy) else 0 end p14,
        case when day(a.supdate)='15' then sum(a.sup_copy) else 0 end p15,case when day(a.supdate)='16' then sum(a.sup_copy) else 0 end p16,
        case when day(a.supdate)='17' then sum(a.sup_copy) else 0 end p17,case when day(a.supdate)='18' then sum(a.sup_copy) else 0 end p18,
        case when day(a.supdate)='19' then sum(a.sup_copy) else 0 end p19,case when day(a.supdate)='20' then sum(a.sup_copy) else 0 end p20,
        case when day(a.supdate)='21' then sum(a.sup_copy) else 0 end p21,case when day(a.supdate)='22' then sum(a.sup_copy) else 0 end p22,
        case when day(a.supdate)='23' then sum(a.sup_copy) else 0 end p23,case when day(a.supdate)='24' then sum(a.sup_copy) else 0 end p24,
        case when day(a.supdate)='25' then sum(a.sup_copy) else 0 end p25,case when day(a.supdate)='26' then sum(a.sup_copy) else 0 end p26,
        case when day(a.supdate)='27' then sum(a.sup_copy) else 0 end p27,case when day(a.supdate)='28' then sum(a.sup_copy) else 0 end p28,
        case when day(a.supdate)='29' then sum(a.sup_copy) else 0 end p29,case when day(a.supdate)='30' then sum(a.sup_copy) else 0 end p30,
        case when day(a.supdate)='31' then sum(a.sup_copy) else 0 end p31
        from cir_dbksup a,cir_agmast m,cir_supply_type_mast c,cir_bill b
        where a.comp_code=m.comp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=@pcomp_code and 
        a.unit_code=m.unit and a.unit_code=b.unit_code and a.unit_code=@punit_code and
        a.billagcd=m.agcd and a.billdpcd=m.dpcd and a.billagcd=b.agcd and a.billdpcd=m.dpcd and
        (a.publ=@ppubl or @ppubl is null) and a.sup_type_code=c.sup_ty_code and 
        b.billdt >= @pfrom_billdt and b.billdt <=@ptill_billdt and a.supdate between bill_frdt and bill_todt and 
        b.agcd = isnull(@pbillagcd,b.agcd) and b.dpcd = isnull(@pbilldpcd,b.dpcd) and isnull(a.sup_copy,0)>0
        group by a.comp_code,a.unit_code,b.billno,b.billdt,a.billagcd,a.billdpcd,a.supdate,m.city_code,m.state_code,m.country_code) x
        group by x.comp_code,x.unit_code,x.billno,x.billdt,x.agcd,x.dpcd,x.city_code,x.state_code,x.country_code
		order by billdt,billno
    
End











                                                                     
                                                                     
                                                                     
                                             
ALTER PROCEDURE CIR_SUPPLY_POST_FOR_NEXT_DAY_cir_supply_posting_p
	@pcomp_code			VARCHAR(20) ,
	@punit_code			VARCHAR(20) ,
	@ppubl_code         VARCHAR(20) ,
	@pedtn_code         VARCHAR(20) ,
	@pagcd				VARCHAR(20) ,
	@pdpcd				VARCHAR(20) ,
	@puserid			VARCHAR(20) ,
	@psup_date			varchar(500) ,
	--@psup_date1       VARCHAR(20),
	@psup_ty			VARCHAR(20) ,
	@pdateformat		VARCHAR(20) ,
	@pextra1			VARCHAR(20) ,
	@pextra2			VARCHAR(20), --issue date
	@pper_copy_wt		numeric(15,3)
AS 
DECLARE  @vsup_date   DATETIME
DECLARE  @vh_date1    DATETIME
DECLARE  @vh_name1    VARCHAR(500)

DECLARE cur_holiday cursor  LOCAL FOR 
		select h_date,h_name from cir_holiday_mast
			where comp_code=@pcomp_code and unit=@punit_code and 
				h_publ=@ppubl_code and h_date=@vsup_date and 
				ISNULL(freeze_flag,'N')='N';

DECLARE @vedtn1			VARCHAR(500)
DECLARE @vedtn_name1    VARCHAR(500)

DECLARE	@v_spl_rate    NUMERIC(10,4)
SET @v_spl_rate = 0

   
/*************        DECLARE VARIABLES FOR cur_supply  CURSOR        *****************/

DECLARE  @vunit1				VARCHAR(500)
DECLARE  @vagcd1				VARCHAR(500)
DECLARE  @vdpcd1				VARCHAR(500)
DECLARE  @vpubl1				VARCHAR(500)
DECLARE  @vedtn11				VARCHAR(500)
DECLARE  @vsupply_type_code1	VARCHAR(500)
DECLARE  @vbase_supply1			numeric(7,0)
DECLARE  @vsupply_sun1			numeric(7,0)
DECLARE  @vsupply_mon1			numeric(7,0)
DECLARE  @vsupply_tue1			numeric(7,0)
DECLARE  @vsupply_wed1			numeric(7,0)
DECLARE  @vsupply_thu1			numeric(7,0)
DECLARE  @vsupply_fri1			numeric(7,0)
DECLARE  @vsupply_sat1			numeric(7,0)
DECLARE  @vsupply_spl11			numeric(7,0)
DECLARE  @vsupply_spl21			numeric(7,0)
DECLARE  @vag_type1				VARCHAR(500)
DECLARE  @vsupply_start_dt1		VARCHAR(500)
DECLARE  @vsuspend_date1		VARCHAR(500)
DECLARE  @vpacket_size1			VARCHAR(500)
DECLARE  @vcomm_code1			VARCHAR(500)
DECLARE  @vcomm_flag1			VARCHAR(500)
DECLARE  @vbill_agcd1			VARCHAR(500)
DECLARE  @vroute_code1			VARCHAR(500)
DECLARE  @vsubroute_code1		VARCHAR(500)
DECLARE  @vsub_subroute_code1	VARCHAR(500)
DECLARE  @vsurch_cd1			VARCHAR(500)
DECLARE  @vwaste_catg_code		VARCHAR(500)

DECLARE  @vbill_dpcd1			VARCHAR(500)
DECLARE @v_supply_copy_dt		varchar(20)
/*****************************************************************************************/

set @psup_date	=dbo.convert_user_date('/',@psup_date,@pdateformat)
set @pextra2	=dbo.convert_user_date('/',@pextra2,@pdateformat)

if @pextra1 is not null begin
	set @v_supply_copy_dt=dbo.convert_user_date('/',@pextra1,@pdateformat)
end


DECLARE cur_surcharge cursor LOCAL FOR 
            select * from cir_surcharge_mast 
            where comp_code  =@pcomp_code and 
                  unit       =@punit_code and
                  publ       =@ppubl_code and
                  edtn       =@vedtn1 and
                  surch_cd   =@vsurch_cd1 and 
                  valid_from = (select max(valid_from) from cir_surcharge_mast 
                                            where comp_code  =@pcomp_code and 
                                                  unit       =@punit_code and
                                                  publ       =@ppubl_code and
                                                  edtn       =@vedtn1 and
                                                  surch_cd   =@vsurch_cd1 and
                                                  valid_from<=@psup_date);
DECLARE	@v_sup_copy			NUMERIC(7)
DECLARE @v_edtn_rate		NUMERIC(10,4)
DECLARE @vreccnt			NUMERIC(5,0)
DECLARE @v_old_sup_copy		NUMERIC(7)

   
/*********************       SEND CONVERTED DATE FROM SQL CLASS     ************/
-- vsup_date:=to_date(psup_date,''''||pdateformat||'''');
SET  @vsup_date = @psup_date

/*******************************************************************************/

open cur_holiday;
fetch NEXT FROM cur_holiday into @vh_date1 , @vh_name1
close cur_holiday
    
if (@vsup_date=@vh_date1) BEGIN
	PRINT('Please Check The  Holiday Today Is  '+' '+   @vh_name1)
	PRINT('Please Check The  Holiday Today Is  '+' '+   @vh_name1)
end 
    
if ((@vsup_date<>@vh_date1) or @vh_date1 is null) BEGIN

	DECLARE cir_edtn_cur cursor LOCAL FOR 
          select distinct edtn,edtn_name from cir_edtn_mast 
			where comp_code=@pcomp_code and publ = @ppubl_code and
		     ((ISNULL(main_edtn,edtn) = @pedtn_code) or (@pedtn_code is null) or (@pedtn_code='')) and ISNULL(freeze_flag,'N')='N'
  
		open cir_edtn_cur
		fetch NEXT FROM cir_edtn_cur into @vedtn1 , @vedtn_name1
		WHILE @@FETCH_STATUS = 0 BEGIN
              
        delete from cir_dbksup where comp_code=@pcomp_code and unit_code=@punit_code and
			publ=@ppubl_code and edtn=@vedtn1 and supdate=@vsup_date and 
			(agcd=@pagcd or @pagcd is null OR @pagcd='') and (dpcd=@pdpcd or @pdpcd is null OR @pdpcd='')


		/*****************************************************************************************/     
					        
		DECLARE cur_spl_rate cursor LOCAL FOR
			select spl_day_rate from cir_special_rate_mast
			where comp_code=@pcomp_code and unit=@punit_code and
				publ=@ppubl_code and edtn=@vedtn1 and spl_day_date=@vsup_date;


		open cur_spl_rate
			fetch NEXT FROM cur_spl_rate into @v_spl_rate;
		close cur_spl_rate;
        
        deallocate cur_spl_rate
        
  		if (ISNULL(@v_spl_rate,0)=0 )BEGIN

			 DECLARE  @vsun_rate1   FLOAT
			 DECLARE  @vmon_rate1   FLOAT
			 DECLARE  @vtue_rate1   FLOAT
			 DECLARE  @vwed_rate1   FLOAT
			 DECLARE  @vthu_rate1   FLOAT
			 DECLARE  @vfri_rate1   FLOAT
			 DECLARE  @vsat_rate1   FLOAT
							 

			DECLARE cur_rate cursor LOCAL FOR 
				select sun_rate,mon_rate,tue_rate,wed_rate,thu_rate,fri_rate,sat_rate from cir_rate_mast
				where comp_code=@pcomp_code and unit=@punit_code and publ=@ppubl_code and edtn=@vedtn1 and
				valid_from=(select max(valid_from) from cir_rate_mast where comp_code=@pcomp_code and
				unit=@punit_code and publ=@ppubl_code and edtn=@vedtn1 and valid_from<=@vsup_date and 
				ISNULL(freeze_flag,'N')='N');
			
			open cur_rate;
			fetch NEXT FROM cur_rate into @vsun_rate1, @vmon_rate1, @vtue_rate1, @vwed_rate1, @vthu_rate1, @vfri_rate1, @vsat_rate1
			close cur_rate;
					
			deallocate  cur_rate;
                  
			DECLARE @SUP_DAY11    varchar(20)
			SET @SUP_DAY11 = CONVERT(VARCHAR(20) , DATENAME(WEEKDAY, @psup_date),20)

			if (@SUP_DAY11 = 'Sunday' )begin          
				set  @v_edtn_rate      =    @vsun_rate1 ;
            end

			else if (@SUP_DAY11 = 'Monday') begin
				set  @v_edtn_rate      =    @vmon_rate1;
			end
			else if (@SUP_DAY11 = 'Tuesday')begin 
				set  @v_edtn_rate      =    @vtue_rate1;
			end
			else if (@SUP_DAY11 = 'Wednesday') begin
				set  @v_edtn_rate      =    @vwed_rate1;
            end
			else if (@SUP_DAY11 = 'Thursday')begin
				set  @v_edtn_rate      =    @vthu_rate1;
			end
			else if (@SUP_DAY11 = 'Friday' )begin
				set  @v_edtn_rate      =    @vfri_rate1;
			end
			else if (@SUP_DAY11 = 'Saturday')begin
				set  @v_edtn_rate      =    @vsat_rate1;
			end
			else begin
				set @v_edtn_rate        =    0
			end 
		end
		else begin
			set @v_edtn_rate  =  @v_spl_rate;
		end 
		
		if (@v_edtn_rate=0)begin
			print('Please Check,The Rate Today Is not Define for '+' '+  @vedtn_name1)
		end 

		DECLARE  cur_supply cursor LOCAL FOR 
		select a.unit unit,a.agcd agcd,a.dpcd dpcd,a.publ publ,a.edtn edtn,a.supply_type_code supply_type_code,a.base_supply base_supply,a.supply_sun supply_sun,
		a.supply_mon supply_mon,a.supply_tue supply_tue,a.supply_wed supply_wed,
		a.supply_thu supply_thu,a.supply_fri supply_fri,a.supply_sat supply_sat,a.supply_spl1 supply_spl1,
		a.supply_spl2 supply_spl2, b.ag_type ag_type,b.supply_start_dt    supply_start_dt,b.suspend_date suspend_date, ISNULL(a.packet_size,0) packet_size,
		a.comm_code comm_code,a.comm_flag comm_flag,b.bill_agcd bill_agcd,b.bill_dpcd bill_dpcd,
		a.route_code route_code,a.subroute_code subroute_code,a.sub_subroute_code sub_subroute_code,
		a.surch_cd surch_cd,a.waste_catg_code waste_catg_code
		from cir_supply a,cir_agmast b
		where a.comp_code=b.comp_code and a.unit=b.unit and 
				  a.agcd=b.agcd and a.dpcd=b.dpcd and (a.agcd=@pagcd or @pagcd is null or @pagcd='') 
				  and (a.dpcd=@pdpcd or @pdpcd is null OR @pdpcd='') and 
				  a.unit=@punit_code and (a.publ=@ppubl_code) and
				  /*ISNULL(base_supply,0)>0 and*/
				  a.edtn=@vedtn1 and
				  ISNULL(a.supply_flag,'N')='Y' and ISNULL(b.suspend,'N')='N'
		order by a.agcd,a.dpcd,a.edtn,a.supply_type_code;


		 open cur_supply 

		 fetch next from cur_supply into @vunit1 ,@vagcd1 ,@vdpcd1 ,@vpubl1 ,@vedtn11 ,@vsupply_type_code1,@vbase_supply1,
		 @vsupply_sun1 ,@vsupply_mon1 ,@vsupply_tue1 ,@vsupply_wed1 ,@vsupply_thu1 ,@vsupply_fri1,@vsupply_sat1 ,@vsupply_spl11,
		 @vsupply_spl21, @vag_type1 ,@vsupply_start_dt1, @vsuspend_date1 ,@vpacket_size1 ,@vcomm_code1 ,@vcomm_flag1 ,@vbill_agcd1 ,@vbill_dpcd1,
		 @vroute_code1 ,@vsubroute_code1 ,@vsub_subroute_code1 ,@vsurch_cd1 ,@vwaste_catg_code
	       
         
		SET @vsup_date= CONVERT(VARCHAR(10),@vsup_date,10)
                 
		WHILE @@FETCH_STATUS = 0 begin
			
			DECLARE @SUP_DAY112    varchar(20)
 
            SET  @SUP_DAY112 = CONVERT(VARCHAR(20) , DATENAME(WEEKDAY, @vsup_date),20)
			
			if (@vsup_date>=@vsupply_start_dt1 or @vsupply_start_dt1 is null) and (@vsup_date<=@vsuspend_date1 or @vsuspend_date1 is null) begin 
				if (@psup_ty='R' and @SUP_DAY112 = 'Sunday' ) begin   
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_sun1,0)>0  begin
					
						set @v_sup_copy   =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_sun1,0);
													    
                    end
					else begin
						set @v_sup_copy   = 0;
					end 
				end
				else if (@psup_ty='R' and @SUP_DAY112 = 'Monday') begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_mon1,0)>0 begin
					
						set @v_sup_copy    =     ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_mon1,0);
					
					end
					else begin
						set @v_sup_copy    = 0
					end
				end
				else if (@psup_ty='R' and @SUP_DAY112 = 'Tuesday')begin  
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_tue1,0)>0 begin
						set  @v_sup_copy  =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_tue1,0);
					end
					else begin
						set @v_sup_copy       = 0;
                    end 
				end
				else if (@psup_ty='R' and @SUP_DAY112 = 'Wednesday') begin   
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_wed1,0)>0 begin 
						
						set @v_sup_copy =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_wed1,0)
						
	                end
					else begin
						set @v_sup_copy  = 0
					end 
				end 
				else if (@psup_ty='R' and @SUP_DAY112 = 'Thursday')begin   
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_thu1,0)>0 begin
						set @v_sup_copy  = ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_thu1,0)
					end
                    else begin
						set @v_sup_copy  = 0
                    end 
				end   
				else if (@psup_ty='R' and @SUP_DAY112 = 'Friday' )begin   
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_fri1,0)>0 begin
				
						set @v_sup_copy   =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_fri1,0);
                
                    end                
					else
						set @v_sup_copy   = 0
                    end 
				else if (@psup_ty='R' and @SUP_DAY112 = 'Saturday') begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_sat1,0)>0 begin
						set @v_sup_copy   =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_sat1,0);
                    end
					else begin
						set @v_sup_copy   = 0
					end
				end 
				else if @psup_ty='S1' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_spl11,0)>0 begin
						
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_spl11,0);
                                                              
					end
					else begin
						set @v_sup_copy   = 0
                                                               													end
					end 
				else if @psup_ty='S2' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_spl21,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_spl21,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
				end

			--------change for supply copy--------
					           
            if @psup_ty='R' and @v_supply_copy_dt is not null begin
                set @v_old_sup_copy=0;
                select @v_old_sup_copy = sum(sup_copy) from cir_dbksup where comp_code=@pcomp_code and unit_code=@punit_code and publ=@ppubl_code and edtn=@vedtn11 and
                    agcd=@vagcd1 and dpcd=@vdpcd1 and supdate=@v_supply_copy_dt and sup_type_code=@vsupply_type_code1;
   
            end

            if isnull(@v_old_sup_copy,0)>0 begin
                set @v_sup_copy=@v_old_sup_copy;
            end
           
            --------change for supply copy--------
					            
			if ISNULL(@v_sup_copy,0)>0 Begin
				print('22tytr')
				print( @v_sup_copy)
				
				insert into cir_dbksup (comp_code,unit_code,publ,edtn,agcd,dpcd,supdate,sup_type_code,sup_copy,agency_ty_code,
										agency_pkt_size,comm_code,comm_fix_auto_spl,sup_rate,billagcd,billdpcd,
										route_code,subroute_code,subsubroute_code,userid,surch_cd,issue_date,per_copy_weight,waste_catg_code)
								values (@pcomp_code,@punit_code,@ppubl_code,@vedtn11,@vagcd1,@vdpcd1,@vsup_date,
									 @vsupply_type_code1,
									 @v_sup_copy,@vag_type1,@vpacket_size1,@vcomm_code1,@vcomm_flag1,
									 @v_edtn_rate,@vbill_agcd1,@vbill_dpcd1,@vroute_code1,
									 @vsubroute_code1,@vsub_subroute_code1,@puserid,@vsurch_cd1,@pextra2,@pper_copy_wt,isnull(@vwaste_catg_code,0));

				select @vreccnt	= count(*)  from cir_dbksup where comp_code=@pcomp_code and unit_code=@punit_code 
				and publ=@ppubl_code and edtn=@vedtn1 and supdate=@vsup_date and (agcd=@pagcd or @pagcd is null) and (dpcd=@pdpcd or @pdpcd is null);
					               
			End;                     
		end 
    

         fetch next from cur_supply into @vunit1 ,@vagcd1 ,@vdpcd1 ,@vpubl1 ,@vedtn11 ,@vsupply_type_code1,@vbase_supply1,
		 @vsupply_sun1 ,@vsupply_mon1 ,@vsupply_tue1 ,@vsupply_wed1 ,@vsupply_thu1 ,@vsupply_fri1,@vsupply_sat1 ,@vsupply_spl11,
		 @vsupply_spl21, @vag_type1 ,@vsupply_start_dt1, @vsuspend_date1 ,@vpacket_size1 ,@vcomm_code1 ,@vcomm_flag1 ,@vbill_agcd1 ,@vbill_dpcd1,
		 @vroute_code1 ,@vsubroute_code1 ,@vsub_subroute_code1 ,@vsurch_cd1,@vwaste_catg_code 

	end 
	close cur_supply;
	deallocate cur_supply
	   
	set @v_edtn_rate = 0;
	set @v_spl_rate  =0;
	set @vedtn1=NULL;

fetch NEXT FROM cir_edtn_cur into @vedtn1 , @vedtn_name1
end
close cir_edtn_cur
deallocate  cir_edtn_cur  
end 
  
    select case b.bill_pay
              when 'Y' then 'PAID'
              when 'N' then 'UNPAID'
              else  'UNPAID' 
              end  BILL_PAY,
   sum(a.sup_copy) SUP_COPY
    from cir_dbksup a,cir_supply_type_mast b,CIR_EDTN_MAST e
    where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=e.comp_code and  a.unit_code=@punit_code and 
          a.publ=@ppubl_code and a.publ = e.publ and a.edtn= e.edtn and 
          (ISNULL(e.main_edtn,e.edtn) = @pedtn_code or @pedtn_code is null OR  @pedtn_code='') and 
          a.sup_type_code=b.sup_ty_code and a.supdate=@vsup_date and 
          (a.agcd=@pagcd or @pagcd is null OR @pagcd='') and (a.dpcd=@pdpcd or @pdpcd is null or @pdpcd ='')
    group by b.bill_pay
    order by b.bill_pay desc
  
deallocate cur_holiday
deallocate cur_surcharge 







                                                                     
                                                                     
                                                                     
                                             
ALTER PROCEDURE cir_rep_supply_temp
@pcomp_code         as varchar(200),
@punit_code         as varchar(200),
@ppubl              as varchar(200),
@pmainedtn          as varchar(200),
@pedtn              as varchar(200),
@proute             as varchar(200),
@pfrom_supdate      as datetime,
@ptill_supdate      as datetime,
@pdateformat        as varchar(200),
@pextra1            as varchar(200),--for branch
@pextra2            as varchar(200),--for State
@pextra3            as varchar(200),--this is use to final and unfinal po
@pextra4            as varchar(200),--for zone,
@pextra5            as varchar(200),--for region
@pextra6            as varchar(200),--for district
@pextra7            as varchar(200),--for taluka
@pextra8            as varchar(200),--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,other than statewise
@pextra9            as varchar(200),
@pextra10           as varchar(200)

AS

declare @vfrom_supdate    varchar(20);
declare @vtill_supdate    varchar(20);
declare @rec_sup_type		as varchar(200) 
declare @rec_sup_type_sum	as varchar(200) 
declare @rec_sup_seq_no		as int

DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.sup_type_code and
    (d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;

	declare @vvar		varchar(4000)
	declare @vvar_sum	varchar(4000)
	declare @vquery		varchar(8000)

	set @vvar=''
	set @vvar_sum=''
 
	set @vfrom_supdate=convert(varchar(20),@pfrom_supdate,101)
	set @vtill_supdate=convert(varchar(20),@ptill_supdate,101)

	print('@vfrom_supdate')print(@vfrom_supdate);
	print('@vtill_supdate')print(@vtill_supdate);

	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type

	print('@vvar')print(@vvar)
	print('@vvar_sum')print(@vvar_sum)

if @vvar='' or @vvar is null begin
	set @vvar=null
end
else begin
	set @vvar    =substring(@vvar,1,len(@vvar)-1)
	set @vvar_sum=substring(@vvar_sum,1,len(@vvar_sum)-1)
end	
	print('@vvar2')print(@vvar)
	print('@vvar_sum2')print(@vvar_sum)
   
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @vvar='' or @vvar is null begin
	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
		d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
		dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.route_code
		order by d.comp_code,d.unit_code,d.publ,route_name';

end
else begin
if @pextra8='1' begin----for route 

	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
		d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
		dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.route_code
		order by d.comp_code,d.unit_code,d.publ,route_name';

end ------ route	
else if @pextra8='2' begin----for  branch
	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.branch_code branch_code,
dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
 '+@vvar+' ,'+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
 group by d.comp_code,d.unit_code,m.branch_code
order by d.comp_code,d.unit_code,branch_name'

end ---- branch		
else if @pextra8='3' begin----for  zone  
 
set @vquery=' select d.comp_code comp_code,d.unit_code unit_code,c.zone_code,
	dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
	'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	group by d.comp_code,d.unit_code,c.zone_code
	order by d.comp_code,d.unit_code,zone_name';

end  ---- zone
else if @pextra8='4' begin----for  region   
	set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,c.region_code,
	dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
	'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	group by d.comp_code,d.unit_code,c.region_code
	order by d.comp_code,d.unit_code,region_name';

end ---- end  region
else if @pextra8='5' begin----for  district

	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
	dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,m.state_code,m.dist_code
		order by d.comp_code,d.unit_code,m.state_code,district_name	'

end  ---- district
else if @pextra8='6' begin----for  tehsil_taluka

	set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,m.tehsil_taluka tehsil_taluka,
	dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
	dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
	'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	group by d.comp_code,d.unit_code,m.tehsil_taluka
	order by d.comp_code,d.unit_code,taluka_name';
end  ----for  tehsil_taluka

else begin
	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.country_code country_code,
	m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
	 ,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	group by d.comp_code,d.unit_code,m.country_code,m.state_code
	order by d.comp_code,d.unit_code,m.country_code,state_name';
end
end

print(@vquery)
exec(@vquery)




---------------------------------------------------------------------NAMAN (05-05-2012)--------------------------------------------------------------------------




/////////////////////////////////////////add by  08/05/2012///////////////////////////////////

                                                                     
                                                                     
                                                                     
                                             
ALTER PROCEDURE cir_rep_supply_cir_rep_supply1
	@pcomp_code			VARCHAR(40) ,
	@punit_code         VARCHAR(40) ,
	@ppubl              VARCHAR(40) ,
	@pmainedtn          VARCHAR(40) ,
	@pedtn              VARCHAR(40) ,
	@proute             VARCHAR(40) ,
	@pfrom_supdate      DATETIME ,
	@ptill_supdate      DATETIME ,
	@pdateformat        VARCHAR(40) ,
    @pextra1            VARCHAR(40) ,--for branch
    @pextra2            VARCHAR(40) ,--for state,
	@pextra3			VARCHAR(40) ,--this is use to final and unfinal po
	@pextra4            VARCHAR(40) ,--for zone,
	@pextra5            VARCHAR(40) ,--for region
	@pextra6            VARCHAR(40) ,--for district
	@pextra7            VARCHAR(40) ,--for taluka
	@pextra8            VARCHAR(40) ,--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,other than statewise
	@pextra9            VARCHAR(40) ,--for publication type
	@pextra10           VARCHAR(40)--for executive
AS 
BEGIN
	DECLARE @vfrom_supdate	varchar(20);
	DECLARE @vtill_supdate  varchar(20);
	declare @vsup_seq_no	int
	
	DECLARE cur_sup_type cursor LOCAL FOR 
	select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e,cir_publ_mast p
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.comp_code=p.comp_code and s.sup_ty_code =d.sup_type_code and
    (d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ and d.publ=p.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='') and (p.pro_type=@pextra9 or @pextra9  is null or @pextra9 ='')
    order by sup_seq_no;

	
	DECLARE @supply_type_name	VARCHAR(4000)
	DECLARE @supply_sum			VARCHAR(4000) 
	DECLARE @vvar               VARCHAR(4000) 
	DECLARE @vvar_sum           VARCHAR(4000) 
	DECLARE @vquery             VARCHAR(8000) 
	DECLARE @vquery1            VARCHAR(8000) 
	DECLARE @vquery2            VARCHAR(8000) 
	DECLARE @vquery3            VARCHAR(8000) 
	DECLARE @vquery4            VARCHAR(8000) 

	SET @vfrom_supdate  = convert(varchar(20),@pfrom_supdate,101)
	SET @vtill_supdate  = convert(varchar(20),@ptill_supdate,101)
		
	OPEN cur_sup_type 
	fetch NEXT FROM cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
		while(@@FETCH_STATUS = 0) BEGIN
			set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@supply_type_name + '', SPACE(0))
			set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@supply_sum + '', SPACE(0))

	fetch NEXT from cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
	end
	close cur_sup_type
		
	SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
	SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)
		
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9=null begin
	set @pextra9=''
end
if @pextra10=null begin
	set @pextra10=''
end

if @pextra8='1' Begin--for route
	set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) ROUTE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		,dbo.cir_get_mode_name(d.comp_code,d.unit_code+d.route_code) as "MODE_NAME"
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
			order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd'
                
		print @vquery 
		EXEC (@vquery)
end
if @pextra8='2' Begin----for  branch
	set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,dbo.cir_get_branch(d.comp_code,m.branch_code) BRANCH_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		    group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
		    order by d.comp_code,d.unit_code,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'
                
		print @vquery 
		EXEC (@vquery)
end

if @pextra8='3' Begin----for  zone
	set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,
	dbo.cir_get_zone_name(d.comp_code,c.zone_code) ZONE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
			order by d.comp_code,d.unit_code,d.publ,d.edtn,zone_code,d.agcd,d.dpcd'
                
		print @vquery 
		EXEC (@vquery)
end

if @pextra8='4' Begin----for  region
	set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,dbo.cir_get_region_name(d.comp_code,c.region_code) REGION_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
        group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'
                
		print @vquery 
		EXEC (@vquery)
end

if @pextra8='5' Begin----for  district
	set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''1'',null,null,null) DIST_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
        group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,dist_code,d.agcd,d.dpcd'
                
		print @vquery 
		EXEC (@vquery)
end

if @pextra8='6' Begin----for Taluka
	set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) TALUKA_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
        group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,taluka_code,d.agcd,d.dpcd'
                
		print @vquery 
		EXEC (@vquery)
end
if @pextra8='7' Begin----for State
	set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,dbo.cir_get_state1(d.comp_code,m.state_code) STATE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
		c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
        group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd'
                
		print @vquery 
		EXEC (@vquery)
end

if @pextra8='8' Begin----for Executive
	set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,dbo.cir_get_executive(d.comp_code,m.executive_code) EXECUTIVE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
		c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
        group by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname order by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd'
                
		print @vquery 
		EXEC (@vquery)
end
		SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code order by d.comp_code,d.unit_code'
		print @vquery1
		EXEC (@vquery1)
		
if @pextra8='1' Begin--for route
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code'
		print @vquery2
		EXEC (@vquery2)
end

if @pextra8='2' Begin--for branch
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code'
		print @vquery2
		EXEC (@vquery2)
end

if @pextra8='3' Begin--for Zone
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code'
		print @vquery2
		EXEC (@vquery2)
end

if @pextra8='4' Begin--for region
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='5' Begin--for District
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code'
		print @vquery2
		EXEC (@vquery2)
end

if @pextra8='6' Begin--for Taluka
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka order by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='7' Begin--for state
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='8' Begin--for executive
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code'
	print @vquery2
	EXEC (@vquery2)
end

SET @vquery3  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.edtn order by d.comp_code,d.unit_code,d.publ,d.edtn'
print @vquery3
EXEC (@vquery3)

SET @vquery4  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ'
print @vquery4
EXEC (@vquery4)


DEALLOCATE cur_sup_type

END


///////////////////////////

                                                                     
                                                                     
                                                                     
                                             
ALTER PROCEDURE [dbo].[cir_rep_supply_temp]
@pcomp_code         as varchar(200),
@punit_code         as varchar(200),
@ppubl              as varchar(200),
@pmainedtn          as varchar(200),
@pedtn              as varchar(200),
@proute             as varchar(200),
@pfrom_supdate      as datetime,
@ptill_supdate      as datetime,
@pdateformat        as varchar(200),
@pextra1            as varchar(200),--for branch
@pextra2            as varchar(200),--for State
@pextra3            as varchar(200),--this is use to final and unfinal po
@pextra4            as varchar(200),--for zone,
@pextra5            as varchar(200),--for region
@pextra6            as varchar(200),--for district
@pextra7            as varchar(200),--for taluka
@pextra8            as varchar(200),--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,7 for statewise,8 for executive
@pextra9            as varchar(200),--for publication type
@pextra10           as varchar(200)--for executive

AS

declare @vfrom_supdate    varchar(20);
declare @vtill_supdate    varchar(20);
declare @rec_sup_type		as varchar(200) 
declare @rec_sup_type_sum	as varchar(200) 
declare @rec_sup_seq_no		as int

DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.sup_type_code and
    (d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;

	declare @vvar		varchar(4000)
	declare @vvar_sum	varchar(4000)
	declare @vquery		varchar(8000)

	set @vvar=''
	set @vvar_sum=''
 
	set @vfrom_supdate=convert(varchar(20),@pfrom_supdate,101)
	set @vtill_supdate=convert(varchar(20),@ptill_supdate,101)

	print('@vfrom_supdate')print(@vfrom_supdate);
	print('@vtill_supdate')print(@vtill_supdate);

	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type

	print('@vvar')print(@vvar)
	print('@vvar_sum')print(@vvar_sum)

if @vvar='' or @vvar is null begin
	set @vvar=null
end
else begin
	set @vvar    =substring(@vvar,1,len(@vvar)-1)
	set @vvar_sum=substring(@vvar_sum,1,len(@vvar_sum)-1)
end	
	print('@vvar2')print(@vvar)
	print('@vvar_sum2')print(@vvar_sum)
   
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9=null begin
	set @pextra9=''
end
if @pextra10=null begin
	set @pextra10=''
end

if @vvar='' or @vvar is null begin
	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
		d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
		dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.route_code
		order by d.comp_code,d.unit_code,d.publ,route_name';
end
else begin
if @pextra8='1' begin----for route 

	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
		d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
		dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.route_code
		order by d.comp_code,d.unit_code,d.publ,route_name';

end ------ route	
else if @pextra8='2' begin----for  branch
	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.branch_code branch_code,
dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
 '+@vvar+' ,'+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
 group by d.comp_code,d.unit_code,m.branch_code
order by d.comp_code,d.unit_code,branch_name'

end ---- branch		
else if @pextra8='3' begin----for  zone  
 
set @vquery=' select d.comp_code comp_code,d.unit_code unit_code,c.zone_code,
	dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
	'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit_code,c.zone_code
	order by d.comp_code,d.unit_code,zone_name';

end  ---- zone
else if @pextra8='4' begin----for  region   
	set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,c.region_code,
	dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
	'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit_code,c.region_code
	order by d.comp_code,d.unit_code,region_name';

end ---- end  region
else if @pextra8='5' begin----for  district

	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
	dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,m.state_code,m.dist_code
		order by d.comp_code,d.unit_code,m.state_code,district_name	'

end  ---- district
else if @pextra8='6' begin----for  tehsil_taluka

	set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,m.tehsil_taluka tehsil_taluka,
	dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
	dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
	'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit_code,m.tehsil_taluka
	order by d.comp_code,d.unit_code,taluka_name';
end  ----for  tehsil_taluka

else if @pextra8='7' begin----for  State

	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.country_code country_code,
	m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
	 ,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit_code,m.country_code,m.state_code
	order by d.comp_code,d.unit_code,m.country_code,state_name';
end  ----for  state

else begin--for executive
	set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.country_code country_code,
	m.executive_code executive_code,dbo.cir_get_executive(d.comp_code,m.executive_code) executive_name
	 ,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
    where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
            m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
            and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
            and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
            and m.agcd=d.agcd and m.dpcd=d.dpcd 
            and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
            and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
            and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
            and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
            and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
            and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
            and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
            and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
            and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
            and m.city_code=c.city_code 
            and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
            and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
            and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit_code,m.country_code,m.executive_code
	order by d.comp_code,d.unit_code,m.country_code,executive_name';
end
end

print(@vquery)
exec(@vquery)



//////////////////////////////////////////////////////////////////end///////////////////////////////////////////////////

/////////////////////////add by deepika 09/05/2012 issue no. 7425/////////////////////////////////////////////////

                                                                     
                                                                     
                                                                     
                                             
ALTER PROCEDURE cir_billing_p
	@pcomp_code			VARCHAR(20) ,
	@punit_code         VARCHAR(20) ,
	@pbill_freq         VARCHAR(20) ,
	@ppubl_freq         VARCHAR(20) ,--for publication type
	@ppubl              VARCHAR(20) ,--for publication 
	@pfrdt              DATETIME ,
	@ptodt              DATETIME ,
	@pbilldt            DATETIME ,
	@pdateformat        VARCHAR(20) ,
	@puserid            VARCHAR(20) ,
	@pextra1            VARCHAR(400) ,
	@pextra2            VARCHAR(400) 
AS 
	DECLARE @vbill_publwise			varchar(1)
	set @vbill_publwise='N'
    DECLARE @vrec_publ				varchar(20);
    DECLARE @v_bill_publwise		varchar(20);
	DECLARE @ln_count               NUMERIC(10)
	DECLARE @vsrch_amt              FLOAT 
	DECLARE @daily_gross_amount     NUMERIC(12,2)
	DECLARE @daily_net_amount       NUMERIC(12,2) 
	DECLARE @tot_surcharge_amt      NUMERIC(12,2) 
	DECLARE @vcomm_per              FLOAT 
	DECLARE @vcomm_amt              NUMERIC(12,2) 
	DECLARE @curr_bilagcd           VARCHAR(30)                     
	SET @curr_bilagcd = 'DUMMY_CURR' 
	DECLARE @prev_bilagcd           VARCHAR(30)                     
	SET @prev_bilagcd = 'DUMMY_PREV' 
	DECLARE @curr_record            VARCHAR(100)                    
	SET @curr_record = 'DUMMY_CURR' 
	--new add

	DECLARE @prev_record            VARCHAR(100)                    
	SET @prev_record = 'DUMMY_PREV' 
	--new add
	
	DECLARE @SUP_DAY				varchar(25)

	DECLARE @tot_copy               NUMERIC(12)                     
	SET @tot_copy = 0 
	DECLARE @vbill_no               VARCHAR(20) 
	DECLARE @vid                    NUMERIC(10)
	DECLARE @v_frdt                 DATETIME 
	DECLARE @v_todt                 DATETIME 
	DECLARE @v_billdt               DATETIME 
	DECLARE @v_agcd_sec_per         FLOAT                           
	SET @v_agcd_sec_per = 0 
	DECLARE @v_agcd_sec_amt_limt    FLOAT                           
	SET @v_agcd_sec_amt_limt = 0 
	DECLARE @v_sec_limit            NUMERIC(10,2) 
	DECLARE @v_bill_dbn_amt         NUMERIC(10,2) 
	DECLARE @v_bill_sec_amt         NUMERIC(10,2) 
	DECLARE @v_remark               VARCHAR(200) 
	DECLARE @v_reptno               VARCHAR(25) 
	DECLARE @v_rec_no               NUMERIC(10) 
	DECLARE @v_daily_comm_amt       NUMERIC(10,2) 
	DECLARE @v_daily_sur_amt        NUMERIC(10,2) 
	DECLARE @v_daily_gross_amt      NUMERIC(10,2) 
	DECLARE @v_daily_bill_amt       NUMERIC(10,2) 

	DECLARE @vcomp_code1			varchar(20)
	DECLARE @vunit1					varchar(20)
	DECLARE @vbill_agcd1			varchar(20)
	DECLARE @vbill_dpcd1			varchar(20)
	DECLARE @vbranch_code1			varchar(20)
	DECLARE @vcity_name1			varchar(400)
	DECLARE @vag_name1				varchar(400)
	DECLARE @vprint_seqno1			float
	DECLARE @vagbill_publ1			varchar(20)
	
	DECLARE @vcomp_code11			varchar(20)
	DECLARE @vunit_code11			varchar(20)
	DECLARE @vpubl11				varchar(20)
	DECLARE @vedtn11				varchar(20)
	DECLARE @vcomm_fix_auto_spl11	varchar(20)
	DECLARE @vcomm_code11			varchar(400)
	DECLARE @vsup_rate11			float
	DECLARE @vsupdate11				datetime
	DECLARE @vsurch_cd11			varchar(400)
	DECLARE @sup_copy11				float
	DECLARE @avg_sup                FLOAT 
	DECLARE @vcomm_catg_type2       varchar(10)
	DECLARE @vsun_comm_rate2        float
	DECLARE @vsun_comm_rate1        float
	DECLARE @vmon_comm_rate1        float
	DECLARE @vtue_comm_rate1        float
	DECLARE @vwed_comm_rate1        float
	DECLARE @vthu_comm_rate1        float
	DECLARE @vfri_comm_rate1        float
	DECLARE @vsat_comm_rate1        float
	DECLARE @vcomm_catg_type1       varchar(10)
	DECLARE @vsun_rate1				float
	DECLARE @vmon_rate1				float
	DECLARE @vtue_rate1				float
	DECLARE @vwed_rate1				float
	DECLARE @vthu_rate1				float
	DECLARE @vfri_rate1				float
	DECLARE @vsat_rate1				float
	
	declare @v_bill_exist			numeric(10)

	SET @v_frdt		=	@pfrdt
	SET @v_todt		=	@ptodt
	SET @v_billdt	=	@v_todt
	
	create table #temp_dual
	(temp_publ	varchar(20))
	
	insert into #temp_dual(temp_publ) values(null)
	
	CREATE TABLE #CIR_BILL_DET_TEMP
	(COMP_CODE    VARCHAR(8),
	UNIT_CODE     VARCHAR(8),
	BILLNO        VARCHAR(20),
	BILLDT        DATETIME,
	AGCD          VARCHAR(8),
	DPCD          VARCHAR(8),
	PUBL          VARCHAR(3),
	EDTN          VARCHAR(3),
	BILL_COPY     NUMERIC(7),
	COPY_RATE     NUMERIC(10,4),
	COMM_FLAG     VARCHAR(1),
	COMM_RATE     NUMERIC(10,4),
	COMM_AMT      NUMERIC(10,4),
	SUR_RATE      NUMERIC(10,4),
	SUR_AMT       NUMERIC(10,4),
	GROSS_AMOUNT  NUMERIC(14,2),
	BILL_AMOUNT   NUMERIC(14,2),
	FROMDT        DATETIME,
	TODT          DATETIME,
	COAG          VARCHAR(8),
	CODP          VARCHAR(8),
	SESSIONID     NUMERIC(15),
	COMM_TYPE     VARCHAR(1))
    
    select @vbill_publwise=cir_bill_publwise from preferrences where "comp_code"=@pcomp_code

    select @v_bill_exist=count(*) from cir_bill_det d,cir_publ_mast p
        where d.comp_code = p.comp_code and d.comp_code=@pcomp_code and d.unit_code=@punit_code and
        d.billdt between @v_frdt and @v_todt and d.publ=p.publ and (p.pro_type = @ppubl_freq or @ppubl_freq is null);
	PRINT('@v_bill_exist')PRINT(@v_bill_exist)PRINT('@vbill_publwise')PRINT(@vbill_publwise)
    declare cur_publ cursor for
        select x.publ publ from 
        (select distinct publ from cir_publ_mast 
        where comp_code=@pcomp_code and publ = isnull(@ppubl,publ) and (pro_type=@ppubl_freq or @ppubl_freq is null) and 
        @vbill_publwise='Y' 
        union
        select null publ from #temp_dual where isnull(@vbill_publwise,'N')='N')x 
        order by publ
		PRINT('OPEN cur_publ')
		OPEN cur_publ 
		fetch NEXT FROM cur_publ INTO @vrec_publ
		WHILE (@@FETCH_STATUS = 0) BEGIN                
			
			PRINT('@vrec_publ')PRINT(@vrec_publ)
			
			DECLARE agency_cur cursor LOCAL FOR 
			select a.comp_code comp_code,a.unit unit,a.bill_agcd bill_agcd,a.bill_dpcd bill_dpcd,
			m.branch_code branch_code,dbo.cir_get_city(a.comp_code,m.city_code) city_name,
			m.ag_name ag_name,m.print_seq print_seqno,@vrec_publ agbill_publ from
			(select distinct a.comp_code,a.unit,a.bill_agcd,a.bill_dpcd
			from cir_agmast a,cir_supply s
			where  a.comp_code = @pcomp_code and a.comp_code = s.comp_code and a.unit  = s.unit and a.unit  = @punit_code and
			a.agcd=s.agcd and a.dpcd=s.dpcd and a.agcd+a.dpcd in (select distinct CAST(x.agcddpcd AS VARCHAR) from
			(select distinct CAST(d.agcd AS VARCHAR) + CAST(d.dpcd AS VARCHAR)as agcddpcd from cir_dbksup d,cir_publ_mast p
			where d.comp_code = @pcomp_code and d.comp_code = p.comp_code and d.unit_code = @punit_code and
			d.publ = isnull(@vrec_publ,d.publ) and d.publ = p.publ and
			d.supdate between @v_frdt  and  @v_todt and isnull(d.sup_copy,0)>0 
			union
			select distinct CAST(d.agcd AS VARCHAR) + CAST(d.dpcd AS VARCHAR) as agcddpcd from cir_dbksup_resale d,cir_publ_mast p
			where d.comp_code = @pcomp_code and d.comp_code = p.comp_code and d.unit_code = @punit_code and
			d.publ = isnull(@vrec_publ,d.publ) and d.publ = p.publ and
			d.supdate between @v_frdt  and  @v_todt and isnull(d.sup_copy,0)>0 ) x) and
			a.bill_agcd is not null and a.bill_agcd<>'' and a.bill_dpcd is not null and a.bill_dpcd<>'' and 
			--bill_agcd = 'A0002' and bill_dpcd = '0001' and
			isnull(a.to_bill,'N')='Y' and
			--isnull(a.unsold_valid_flag,'M')=@pbill_freq
			isnull(s.billing_cycle,'M')=@pbill_freq
			) a,cir_agmast m
			where a.comp_code=m.comp_code and a.unit=m.unit and a.bill_agcd=m.agcd and a.bill_dpcd=m.dpcd and
			@v_bill_exist=0
			order by comp_code,unit,branch_code,print_seqno,city_name,ag_name
           
		/*SELECT a.comp_code comp_code, a.unit unit, a.bill_agcd bill_agcd, a.bill_dpcd bill_dpcd, m.branch_code branch_code,
		dbo.cir_get_name_cir_city(a.comp_code, m.city_code, '1', '', '', '') city_name,m.ag_name ag_name, m.print_seq print_seqno
		FROM (	SELECT DISTINCT a.comp_code, a.unit, a.bill_agcd, a.bill_dpcd FROM  cir_agmast a WHERE	 a.comp_code  = @pcomp_code
		AND	a.unit  = @punit_code AND	a.agcd + a.dpcd  in(SELECT DISTINCT CAST(agcd AS VARCHAR) + CAST(dpcd AS VARCHAR)
		FROM  cir_dbksup WHERE	 comp_code  = @pcomp_code AND	unit_code  = @punit_code AND (publ  = @ppubl OR @ppubl  is null OR @ppubl='')
        AND	supdate  between @v_frdt  and  @v_todt AND	isnull(sup_copy, 0)  > 0) AND	a.bill_agcd  is not null AND	a.bill_dpcd  is not null
		AND	isnull(a.to_bill, 'N')  = 'Y' and isnull(a.unsold_valid_flag,'M')=@pbill_freq) a, cir_agmast m 
		WHERE	 a.comp_code  = m.comp_code AND	a.unit  = m.unit AND	a.bill_agcd  = m.agcd AND	a.bill_dpcd  = m.dpcd
		ORDER BY comp_code, unit, branch_code, print_seqno, city_name, ag_name */

		OPEN agency_cur 
		fetch NEXT FROM agency_cur INTO @vcomp_code1 , @vunit1 ,@vbill_agcd1, @vbill_dpcd1 , @vbranch_code1, @vcity_name1, @vag_name1,@vprint_seqno1,@vagbill_publ1
		WHILE (@@FETCH_STATUS = 0) BEGIN
			print('cursor_Agency_open')
			SET @curr_bilagcd  =  @vbill_agcd1 +  @vbill_dpcd1 
			SET @curr_record  =  @vbill_agcd1 +  @vbill_dpcd1 
			---------------------------------------------- add new code ------------------------------------------------------
					
			IF @curr_record <> @prev_record BEGIN 
				SET @daily_gross_amount  = 0 
				SET @tot_copy  = 0 
				SET @tot_surcharge_amt  = 0 
				SET @vsrch_amt  = 0 
				SET @vcomm_amt  = 0 
			END
			print('BILLING1')
            print(@vcomp_code1)
            print(@vunit1)
            print(@vbill_agcd1)
            print(@vbill_dpcd1)
            print(@vrec_publ)
            print(@v_frdt)
            print(@v_todt)
			
			        
			DECLARE cur_supply cursor LOCAL FOR
			select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,u.comm_fix_auto_spl comm_fix_auto_spl,
			u.comm_code comm_code,u.sup_rate sup_rate,u.supdate supdate,u.surch_cd surch_cd,sum(u.sup_copy) sup_copy from
			(select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,d.edtn edtn,d.comm_fix_auto_spl comm_fix_auto_spl,
			d.comm_code comm_code,d.sup_rate sup_rate,d.supdate supdate,d.surch_cd surch_cd,d.agcd agcd,d.dpcd dpcd,d.sup_copy sup_copy
			from cir_dbksup d,cir_supply_type_mast s,cir_publ_mast p
			where d.comp_code = @vcomp_code1 and d.comp_code = s.comp_code and d.comp_code = p.comp_code and
			d.unit_code = @vunit1 and d.sup_type_code=s.sup_ty_code and isnull(s.bill_pay,'N') = 'Y' and
			d.publ = isnull(@vrec_publ,d.publ) and d.publ =p.publ and
			d.supdate between @v_frdt and @v_todt and isnull(d.sup_copy,0)>0
			union all
			select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,d.edtn edtn,d.comm_fix_auto_spl comm_fix_auto_spl,
			d.comm_code comm_code,d.sup_rate sup_rate,d.supdate supdate,d.surch_cd surch_cd,d.agcd agcd,d.dpcd dpcd,d.sup_copy sup_copy
			from cir_dbksup_resale d,cir_supply_type_mast s,cir_publ_mast p
			where d.comp_code = @vcomp_code1 and d.comp_code = s.comp_code and d.comp_code = p.comp_code and
			d.unit_code = @vunit1 and d.sup_type_code=s.sup_ty_code and isnull(s.bill_pay,'N') = 'Y' and
			d.publ = isnull(@vrec_publ,d.publ) and d.publ =p.publ and 
			d.supdate between @pfrdt and @ptodt and isnull(d.sup_copy,0)>0) u
			where u.agcd+u.dpcd in (select CAST(agcd AS VARCHAR) + CAST(dpcd AS VARCHAR) from cir_agmast
			where comp_code = @vcomp_code1 and unit = @vunit1 and bill_agcd = @vbill_agcd1 and bill_dpcd = @vbill_dpcd1)
			group by u.comp_code,u.unit_code,u.publ,u.edtn,u.comm_fix_auto_spl,u.comm_code,u.sup_rate,u.supdate,u.surch_cd;
       
			/*SELECT comp_code, unit_code, publ, edtn, comm_fix_auto_spl, comm_code, sup_rate, supdate, surch_cd, SUM(CONVERT(FLOAT, sup_copy)) sup_copy
			FROM  cir_dbksup WHERE comp_code  = @pcomp_code AND	unit_code  = @punit_code AND	sup_type_code  in(
			SELECT sup_ty_code FROM cir_supply_type_mast 	WHERE	 comp_code  = @pcomp_code AND	isnull(bill_pay, 'N')  = 'Y') AND	publ  in
			(SELECT publ	FROM  cir_publ_mast WHERE	 comp_code  = @pcomp_code )AND	agcd + dpcd  in(SELECT CAST(agcd AS VARCHAR) + CAST(dpcd AS VARCHAR)
			FROM  cir_agmast WHERE comp_code  = @vcomp_code1 AND	unit  = @vunit1 AND	bill_agcd  = @vbill_agcd1 AND	bill_dpcd  = @vbill_dpcd1)
			AND	supdate  between @v_frdt and @v_todt AND	isnull(sup_copy, 0)  > 0 GROUP BY comp_code, unit_code, publ, edtn, comm_fix_auto_spl, comm_code,sup_rate, supdate,  surch_cd */

			OPEN cur_supply 
			fetch NEXT FROM cur_supply INTO @vcomp_code11 , @vunit_code11,@vpubl11 , @vedtn11,@vcomm_fix_auto_spl11 , @vcomm_code11 ,@vsup_rate11 ,@vsupdate11 , @vsurch_cd11,@sup_copy11
			WHILE (@@FETCH_STATUS = 0) begin
				print 'cursor_supply_open'
				SET @tot_copy			= isnull(@tot_copy, 0)+ isnull(@sup_copy11, 0)
				SET @daily_gross_amount = isnull(@daily_gross_amount, 0)+ isnull(@sup_copy11, 0)* isnull( @vsup_rate11, 0)
				SET @v_daily_gross_amt  = isnull(@sup_copy11, 0)* isnull( @vsup_rate11, 0)
				SET	@SUP_DAY = CONVERT(VARCHAR(20) , DATENAME(WEEKDAY, @vsupdate11),20)
				
				IF  @vcomm_fix_auto_spl11 != 'A'  BEGIN 
					DECLARE comm_fix_spl cursor LOCAL FOR 
					select sun_comm_rate,mon_comm_rate,tue_comm_rate,wed_comm_rate,thu_comm_rate,fri_comm_rate,sat_comm_rate,comm_catg_type
					from cir_comm_mast  where comp_code = @pcomp_code and  unit_code = @punit_code and  publ = @vpubl11 and
					edtn = @vedtn11 and comm_type = @vcomm_fix_auto_spl11 and  comm_catg_code = @vcomm_code11 and  
					valid_from = (select max(valid_from) from cir_comm_mast where comp_code = @pcomp_code and unit_code = @punit_code and
					publ = @vpubl11 and  edtn = @vedtn11 and comm_type = @vcomm_fix_auto_spl11 and comm_catg_code = @vcomm_code11 and 
					valid_from <= @vsupdate11)	 
											
						OPEN comm_fix_spl
						fetch NEXT FROM comm_fix_spl INTO @vsun_comm_rate1,@vmon_comm_rate1 ,@vtue_comm_rate1,@vwed_comm_rate1,@vthu_comm_rate1,@vfri_comm_rate1 ,@vsat_comm_rate1 ,@vcomm_catg_type1

						IF (@SUP_DAY = 'Sunday' )BEGIN 
							SET @vcomm_per  =  @vsun_comm_rate1 
						END
						ELSE IF (@SUP_DAY = 'Monday') BEGIN 
							SET @vcomm_per  =   @vmon_comm_rate1
						END
						ELSE IF (@SUP_DAY = 'Tuesday')BEGIN 
							SET @vcomm_per  =   @vtue_comm_rate1
						END
						ELSE IF (@SUP_DAY = 'Wednesday') BEGIN 
							SET @vcomm_per  =   @vwed_comm_rate1 
						END
						ELSE IF (@SUP_DAY = 'Thursday') BEGIN 
							SET @vcomm_per  =   @vthu_comm_rate1 
						END
						ELSE IF (@SUP_DAY = 'Friday' )BEGIN 
							SET @vcomm_per  =   @vfri_comm_rate1
						END
						ELSE IF (@SUP_DAY = 'Saturday') BEGIN 
							SET @vcomm_per  =   @vsat_comm_rate1
						END
						ELSE BEGIN 
							SET @vcomm_per  = 0 
						END

						IF isnull( @vcomm_catg_type1, 'N')= 'P' BEGIN 
							SET @vcomm_amt			= isnull(@vcomm_amt, 0)+ ( isnull( @sup_copy11, 0)* isnull( @vsup_rate11, 0)) * isnull(@vcomm_per, 0)/ 100 
							SET @v_daily_comm_amt	= ( isnull(@sup_copy11, 0)* isnull(@vsup_rate11, 0)) * isnull(@vcomm_per, 0)/ 100 
						END
						ELSE IF isnull(@vcomm_catg_type1, 'N')= 'C' BEGIN 
							SET @vcomm_amt			= isnull(@vcomm_amt, 0)+ isnull(@sup_copy11, 0)* isnull(@vcomm_per, 0)
							SET @v_daily_comm_amt	= isnull(@sup_copy11, 0)* isnull(@vcomm_per, 0)
						END
						ELSE BEGIN 
							SET @vcomm_amt  = 0 
							SET @v_daily_comm_amt	= 0 
						END

						close comm_fix_spl
						DEALLOCATE comm_fix_spl
					END

					DECLARE cur_surcharge cursor LOCAL FOR 
					SELECT sun_rate,mon_rate,tue_rate,wed_rate,thu_rate,fri_rate,sat_rate FROM  cir_surcharge_mast WHERE	 comp_code  = @pcomp_code AND	unit  = @punit_code AND	publ  = @vpubl11
					AND	edtn  = @vedtn11 AND	surch_cd  = @vsurch_cd11 AND	valid_from  =(SELECT MAX(valid_from)FROM  cir_surcharge_mast 
					WHERE comp_code  = @pcomp_code AND	unit  = @punit_code AND	publ  = @vpubl11 AND	edtn  = @vedtn11
					AND	surch_cd = @vsurch_cd11 AND	valid_from <= @vsupdate11)
		
					OPEN cur_surcharge 
					fetch NEXT FROM cur_surcharge INTO @vsun_rate1 ,@vmon_rate1,@vtue_rate1 ,@vwed_rate1,@vthu_rate1,@vfri_rate1,@vsat_rate1
					print('cursor_surcharge')
					
					IF (@SUP_DAY = 'Sunday' ) BEGIN 
						SET @vsrch_amt  =    @vsun_rate1
					END
					ELSE IF (@SUP_DAY = 'Monday') BEGIN 
						SET @vsrch_amt  =    @vmon_rate1
					END
					ELSE IF (@SUP_DAY = 'Tuesday') BEGIN 
						SET @vsrch_amt  =   @vtue_rate1
					END
					ELSE IF (@SUP_DAY = 'Wednesday')BEGIN 
						SET @vsrch_amt  =    @vwed_rate1
					END
					ELSE IF (@SUP_DAY = 'Thursday') BEGIN 
						SET @vsrch_amt  =   @vthu_rate1
					END
					ELSE IF (@SUP_DAY = 'Friday' )BEGIN 
						SET @vsrch_amt  =   @vfri_rate1
					END
					ELSE IF (@SUP_DAY = 'Saturday') BEGIN 
						SET @vsrch_amt  =    @vsat_rate1
					END
					ELSE BEGIN 
						SET @vsrch_amt  = 0 
					END
					
					close cur_surcharge
							
					DEALLOCATE cur_surcharge

					SET @tot_surcharge_amt  = isnull(@tot_surcharge_amt, 0)+ isnull( @sup_copy11, 0)* isnull(@vsrch_amt, 0)
					SET @v_daily_sur_amt	= isnull( @sup_copy11, 0)* isnull(@vsrch_amt, 0)
					SET @v_daily_bill_amt	= isnull(@v_daily_gross_amt, 0)+ isnull(@v_daily_sur_amt, 0)- isnull(@v_daily_comm_amt, 0)
										 

					INSERT INTO  #cir_bill_det_temp ( comp_code , unit_code , billdt , agcd , dpcd , publ , edtn , bill_copy , copy_rate , 
										comm_flag , comm_rate , comm_amt , sur_rate , sur_amt , gross_amount , bill_amount , fromdt , todt , coag , codp ,comm_type )  
										VALUES ( @vcomp_code11 ,@vunit_code11 , @v_billdt , @vbill_agcd1,@vbill_dpcd1 ,@vpubl11 , @vedtn11,@sup_copy11, 
										@vsup_rate11, @vcomm_fix_auto_spl11 , isnull(@vcomm_per, 0) , isnull(@v_daily_comm_amt, 0) , isnull(@vsrch_amt, 0) , isnull(@v_daily_sur_amt, 0) , 
										isnull(@v_daily_gross_amt, 0) , isnull(@v_daily_bill_amt, 0) , @vsupdate11 , @vsupdate11 , @vbill_agcd1 , @vbill_dpcd1 ,@vcomm_catg_type1)							
					fetch NEXT FROM cur_supply INTO @vcomp_code11 , @vunit_code11,@vpubl11 , @vedtn11,@vcomm_fix_auto_spl11 , @vcomm_code11 ,@vsup_rate11 ,@vsupdate11 , @vsurch_cd11,@sup_copy11
				END 
						
				SET @avg_sup  = isnull(@tot_copy, 0)
						
				IF   @vcomm_fix_auto_spl11 = 'A' BEGIN 
					IF @tot_copy > 0 BEGIN 

               			DECLARE comm_auto cursor LOCAL FOR 
						select sun_comm_rate,comm_catg_type from cir_comm_mast where comp_code = @pcomp_code and unit_code = @punit_code and publ = @vpubl11 and
						edtn = @vedtn11 and comm_type = @vcomm_fix_auto_spl11 and comm_catg_code = @vcomm_code11 and  valid_from = (select max(valid_from) from cir_comm_mast
						where comp_code = @pcomp_code and unit_code = @punit_code and  publ = @vpubl11 and  edtn = @vedtn11 and comm_type = @vcomm_fix_auto_spl11 and
						comm_catg_code = @vcomm_code11 and   valid_from <= @v_billdt and @avg_sup between isnull(sup_copy_from,0) and isnull(sup_copy_to,0)) and
						@avg_sup between isnull(sup_copy_from,0) and isnull(sup_copy_to,0);

						OPEN comm_auto 
						fetch NEXT FROM comm_auto INTO  @vsun_comm_rate2  ,@vcomm_catg_type2 

						SET @vcomm_per  =  @vsun_comm_rate2 
															
						IF isnull( @vcomm_catg_type2, 'N')= 'P' BEGIN 
							SET @vcomm_amt  = isnull(@daily_gross_amount, 0)* isnull(@vcomm_per, 0)/ 100 
						END
						ELSE IF isnull( @vcomm_catg_type2, 'N')= 'C' BEGIN 
							SET @vcomm_amt  = isnull(@tot_copy, 0)* isnull(@vcomm_per, 0)
						END
						ELSE BEGIN 
							SET @vcomm_amt  = 0 
						END
		
						close comm_auto
					    DEALLOCATE comm_auto
					END
				END
   
				close cur_supply
                DEALLOCATE  cur_supply 

				SET @daily_net_amount  = isnull(@daily_gross_amount, 0)+ isnull(@tot_surcharge_amt, 0)- isnull(@vcomm_amt, 0)

				SET @vbill_no  = DBO.cir_generate_billno( @vcomp_code1, @vunit1, @v_billdt, @pdateformat, '', '')

                IF isnull(@tot_copy, 0)> 0 Begin	
					SELECT @v_sec_limit  =  ABS(SUM(CONVERT(FLOAT, amount))) FROM  cir_rcphdr WHERE	 comp_code  =@vcomp_code1
					AND	unit_code  = @vunit1 AND	agcd  = @vbill_agcd1 AND	dpcd  = @vbill_dpcd1 AND	achd  = 'SC'
											
					SET @v_sec_limit  = 0 
									
					DECLARE @v_bran_code VARCHAR(8)

					SELECT DISTINCT @v_agcd_sec_per  =  security_per, @v_agcd_sec_amt_limt  =  sec_amt_limt, @v_bran_code  =  branch_code
					FROM  cir_agmast WHERE comp_code  = @pcomp_code AND	unit  = @punit_code AND	agcd  = @vbill_agcd1 AND dpcd  = @vbill_dpcd1
							
					PRINT(@v_agcd_sec_per)
                    PRINT(@v_agcd_sec_amt_limt)
							
					IF isnull(@v_agcd_sec_amt_limt, 0)> isnull(@v_sec_limit, 0)and isnull(@v_agcd_sec_per, 0)> 0 BEGIN 
						SET @v_bill_dbn_amt  = isnull(@v_agcd_sec_per, 0)* isnull(@daily_net_amount, 0)/ 100 
					END
			   
					IF isnull(@v_agcd_sec_amt_limt, 0)- isnull(@v_sec_limit, 0)< isnull(@v_bill_dbn_amt, 0)BEGIN 
						SET @v_bill_sec_amt  = isnull(@v_agcd_sec_amt_limt, 0)- isnull(@v_sec_limit, 0)
					END
					ELSE BEGIN 
						SET @v_bill_sec_amt  = isnull(@v_bill_dbn_amt, 0)
					END

					INSERT INTO  cir_bill   ( comp_code , unit_code ,billno , 	billdt , agcd , dpcd , publ , bill_copy , gross_amount , 
					sur_amount , comm_amount , bill_amount , bill_frdt ,bill_todt , bill_flag , bill_remark , userid , creation_date , bill_sec_amt , branch_code,sec_per_rate )  
					VALUES ( @vcomp_code1 , @vunit1 , @vbill_no , @v_billdt , @vbill_agcd1 , @vbill_dpcd1 ,@vpubl11 , isnull(@tot_copy, 0) , 
					isnull(@daily_gross_amount, 0) , isnull(@tot_surcharge_amt, 0) , isnull(@vcomm_amt, 0) , @daily_net_amount , 
					@v_frdt , @v_todt , @pbill_freq , CAST(CONVERT(VARCHAR(23), @v_billdt) AS VARCHAR) + ' Billing' , @puserid , 
					GETDATE() , isnull(@v_bill_sec_amt, 0) , @v_bran_code,@v_agcd_sec_per ) 

					INSERT INTO  cir_outmast   ( comp_code , unit_code , agcd , dpcd , doctyp , billno , billdt , publ , amount , 
					remark , voucherno , usrid , creation_date , bill_sec_amt , branch_code )  
					VALUES ( @vcomp_code1 , @vunit1, @vbill_agcd1 , @vbill_dpcd1 , 'BIL' , @vbill_no , @v_billdt , @vpubl11 , 
					@daily_net_amount , CAST(CONVERT(VARCHAR(23), @v_billdt) AS VARCHAR) + ' Billing' , @vbill_no , @puserid , 
					GETDATE() , isnull(@v_bill_sec_amt, 0) , @v_bran_code )  
					
					INSERT INTO  cir_bill_det   ( comp_code , unit_code , billno , billdt ,agcd , dpcd ,coag , 	codp , publ , edtn , 
					copy_rate , comm_flag , comm_rate , sur_rate , fromdt , todt , bill_copy , gross_amount , comm_amt , sur_amt , 
					bill_amount , bill_flag , branch_code,comm_type )  
					SELECT comp_code, unit_code, @vbill_no billno, billdt, agcd, dpcd, agcd, dpcd, publ, edtn, copy_rate, comm_flag,
					comm_rate, sur_rate, MIN(fromdt) fromdt, MAX(todt) todt, SUM(bill_copy) bill_copy,
					SUM(CONVERT(FLOAT, gross_amount)) gross_amount,SUM(CONVERT(FLOAT, comm_amt)) comm_amt,SUM(CONVERT(FLOAT, sur_amt)) sur_amt,
					SUM(CONVERT(FLOAT, bill_amount)) bill_amount, @pbill_freq, @v_bran_code,comm_type
					FROM  #cir_bill_det_temp 
					GROUP BY comp_code, unit_code, billdt, agcd, dpcd, publ, edtn, copy_rate, comm_flag, comm_rate,  sur_rate ,comm_type

					IF isnull(@v_bill_sec_amt, 0)> 0 BEGIN 
                                 
						SET @v_remark  = 'Being amount auto debited against security deposit against bill number' + @vbill_no + ' dated' + CONVERT(VARCHAR(23), @v_billdt)
									
						SELECT @v_rec_no  =  max(convert(int,SUBSTRING(RECPTNO,(len(RECPTNO) -7),len(RECPTNO)))) + 1 FROM cir_rcphdr 
							WHERE comp_code = @vcomp_code1 AND	doctype  = 'DN'
					
						IF @v_rec_no is null or @v_rec_no = '0' BEGIN 
							SET @v_reptno  =   @v_bran_code + '-' + REPLACE(CONVERT(VARCHAR(5), GETDATE(), 2), '.', '')+ '0001'   --'DN' + '0001' 
						END
						ELSE BEGIN 
							SET @v_reptno  =   @v_bran_code + '-' + dbo.fnPadLeft('0',8,@v_rec_no)   -- 'DN ' + CASE WHEN LEN(@v_rec_no) >= 4 THEN SUBSTRING(CONVERT(VARCHAR(4000), @v_rec_no),1,4) ELSE SUBSTRING(REPLICATE('0',4),1,4-LEN(@v_rec_no)) + CONVERT(VARCHAR(4000),@v_rec_no) END  
						END

                        insert into cir_rcphdr(comp_code,unit_code,agcd,dpcd,doctype,
                         recptno,recptdt,amount,reason,remark,
                         achd,voucherno,voucherdt,userid,creation_date,branch_code)
                         values( @vcomp_code1 , @vunit1  , @vbill_agcd1 , @vbill_dpcd1 , 'DN' , @v_reptno , @v_billdt , 
							isnull(@v_bill_sec_amt, 0) , 'SEC DEBIT',@v_remark,
                         'NM',@v_reptno,@v_billdt,@puserid,GETDATE(),@v_bran_code);
							
							
						insert into cir_rcpdet(comp_code,unit_code,agcd,dpcd,doctyp,
							recptno,recptdt,payfor,achd,amount,
							reason,remark,voucherno,voucherdt,usrid,
							creation_date,branch_code)
						values(@vcomp_code1, @vunit1,@vbill_agcd1 , @vbill_dpcd1 ,'DN',
							@v_reptno,@v_billdt,@vunit1,'NM',isnull(@v_bill_sec_amt, 0),
							'SEC DEBIT',@v_remark,@v_reptno,@v_billdt,@puserid,
							GETDATE(),@v_bran_code);    
							
							PRINT('25')

							INSERT INTO  cir_outmast ( comp_code , unit_code , agcd , dpcd , doctyp , recptno , recptdt , achd , amount , 
							reason , remark , voucherno , voucherdt , usrid , creation_date , branch_code )  
							VALUES ( @vcomp_code1 ,  @vunit1 , @vbill_agcd1, @vbill_dpcd1 , 'DN' , @v_reptno , @v_billdt , 'NM' , 
							isnull(@v_bill_sec_amt, 0) , 'SEC DEBIT' , @v_remark , @v_reptno , @v_billdt , @puserid , GETDATE() , @v_bran_code )  
								
							SET @v_remark  = 'Being amount auto credited against security deposit against bill number' + @vbill_no + ' dated' + CONVERT(VARCHAR(23), @v_billdt)+ ' and debit note number' + @v_reptno 
								
							SELECT @v_rec_no  =  max(convert(int,SUBSTRING(RECPTNO,(len(RECPTNO) -7),len(RECPTNO)))) + 1  FROM  cir_rcphdr 	WHERE	 comp_code  = @vcomp_code1 AND	doctype  = 'CN'
						
							IF @v_rec_no is null or @v_rec_no = '0' BEGIN 
								SET @v_reptno  =   @v_bran_code + '-' + REPLACE(CONVERT(VARCHAR(5), GETDATE(), 2), '.', '')+ '0001'   --'DN' + '0001' 
							END
							ELSE BEGIN 
								SET @v_reptno  =   @v_bran_code + '-' + dbo.fnPadLeft('0',8,@v_rec_no)   -- 'DN ' + CASE WHEN LEN(@v_rec_no) >= 4 THEN SUBSTRING(CONVERT(VARCHAR(4000), @v_rec_no),1,4) ELSE SUBSTRING(REPLICATE('0',4),1,4-LEN(@v_rec_no)) + CONVERT(VARCHAR(4000),@v_rec_no) END  
							END

							INSERT INTO  cir_rcphdr ( comp_code , unit_code , agcd , dpcd , doctype , recptno , recptdt , amount , reason , remark , 
							achd , voucherno , voucherdt , userid , creation_date , branch_code )  
							 VALUES ( @vcomp_code1 , @vunit1 , @vbill_agcd1, @vbill_dpcd1, 'CN' , @v_reptno , @v_billdt , 
							- 1 * isnull(@v_bill_sec_amt, 0) , 'SEC DEBIT' , @v_remark , 'SC' , @v_reptno , @v_billdt , @puserid , GETDATE() , @v_bran_code )  
								
							INSERT INTO  cir_rcpdet( comp_code , unit_code , agcd , dpcd , doctyp , recptno , recptdt , payfor , achd , amount , reason , 
							remark , voucherno , voucherdt , usrid , creation_date , branch_code )  
							VALUES 	( @vcomp_code1 , @vunit1 , @vbill_agcd1 , @vbill_dpcd1 , 'CN' , @v_reptno , @v_billdt , 
							@vunit1 , 'SC' , - 1 * isnull(@v_bill_sec_amt, 0) , 'SEC DEBIT' , @v_remark , @v_reptno , @v_billdt , @puserid , GETDATE() , @v_bran_code )  

							INSERT INTO  cir_outmast   ( comp_code , unit_code , agcd , dpcd , doctyp , recptno , recptdt , achd , amount , 
							reason , remark , voucherno , voucherdt , usrid , creation_date , branch_code )  
							VALUES 	( @vcomp_code1 , @vunit1 , @vbill_agcd1 , @vbill_dpcd1 , 'CN' , @v_reptno , @v_billdt , 'SC' , - 1 * isnull(@v_bill_sec_amt, 0) , 
							'SEC DEBIT' , @v_remark , @v_reptno , @v_billdt , @puserid , GETDATE() , @v_bran_code )  
			
				        END
   
						SET @v_sec_limit  = 0 
						SET @v_bill_dbn_amt  = 0 
						SET @v_bill_sec_amt  = 0 
						SET @v_remark  = '' 
						SET @v_reptno  = '' 
						SET @v_rec_no  = 0 
						SET @v_daily_comm_amt  = 0 
						SET @v_daily_sur_amt  = 0 
						SET @v_daily_gross_amt  = 0 
						SET @v_daily_bill_amt  = 0 
			    END
   
			fetch NEXT FROM agency_cur INTO @vcomp_code1 , @vunit1 ,@vbill_agcd1, @vbill_dpcd1 , @vbranch_code1, @vcity_name1, @vag_name1,@vprint_seqno1,@vagbill_publ1	
		
END
close agency_cur
DEALLOCATE agency_cur
	set @vrec_publ=null
	fetch NEXT FROM cur_publ into @vrec_publ
	END
close cur_publ


DEALLOCATE cur_publ
DROP TABLE #cir_bill_det_temp;
DROP TABLE #temp_dual;


/////////////////////////////////////////////////////end//////////////////////////////////////////////////////////

*************************** executive(Distributor)supply wise **(10/5/12,Rikkee)****************************

set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
go


ALTER PROCEDURE [dbo].[cir_rep_supply_cir_executive_wise_supply]
	@pcomp_code			as VARCHAR(20) ,
	@punit_code         as VARCHAR(20) ,
	@ppubl              as VARCHAR(20) ,
	@pmainedtn          as VARCHAR(20) ,
	@pedtn              as VARCHAR(20) ,
	@proute             as VARCHAR(20) ,
	@pfrom_supdate      as DATETIME ,
	@ptill_supdate      as DATETIME ,
	@pdateformat        as VARCHAR(20) ,
	@pextra1            as varchar(200),--for login user id
    @pextra2            as varchar(200),--supply type
    @pextra3            as varchar(200),--agency type
    @pextra4            as varchar(200),--agency class
    @pextra5            as varchar(200), 
    @pextra6            as varchar(200)
AS 

	if(@ppubl = '') begin
	  set @ppubl = null
	end
	if(@pmainedtn = '') begin
	  set @pmainedtn = null
	end
	if(@pedtn = '') begin
	  set @pedtn = null
	end
	if(@proute = '') begin
	  set @proute = null
	end
	if(@pextra1 = '') begin
	  set @pextra1 = null
	end
	if(@pextra2 = '') begin
	  set @pextra2 = null
	end
	if(@pextra3 = '') begin
	  set @pextra3 = null
	end
	if(@pextra4 = '') begin
	  set @pextra4 = null
	end

	
select d.comp_code as "COMP_CODE",d.unit_code AS "UNIT_CODE",
m.EXECUTIVE_CODE as "EXECUTIVE_CODE",
(Select executive_desc from cir_executive_mast 
	where COMP_CODE=d.COMP_CODE and EXECUTIVE_CODE=m.executive_code) as "EXECUTIVE_NAME",
	d.agcd AS "AGCD",d.dpcd AS "DPCD",m.ag_name AS "AG_NAME",m.ag_name_oth_lang AS "AG_NAME_OTH_LANG",sum(d.sup_copy) AS "SUP_COPY",
	dbo.cir_get_supply_seqno(d.comp_code,d.unit_code,@ppubl,@pedtn,d.agcd,d.dpcd) AS "SUPPLY_SEQNO",
	dbo.cir_get_city(d.comp_code,m.city_code) as "CITY_NAME",
	dbo.cir_get_name_cir_city(d.comp_code,m.city_code,2,null,null,null) as "CITY_ONAME",
	dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) as "DROP_POINT_NAME",
	dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) as "DROP_POINT_ONAME"
	
	from cir_dbksup d,cir_agmast m,cir_edtn_mast e
	where d.comp_code    = m.comp_code and d.comp_code    = e.comp_code and
		 d.unit_code    = m.unit and
		 d.agcd         = m.agcd and
		 d.dpcd         = m.dpcd and
		 d.comp_code    = @pcomp_code and
		 d.unit_code    = @punit_code and
		 d.publ         = e.publ and d.publ         = @ppubl and
		 d.edtn=e.edtn and (d.edtn       = @pedtn or @pedtn is null) and
		 (d.route_code = @proute or @proute is null) and
		 d.supdate between @pfrom_supdate and @ptill_supdate and
		 (e.main_edtn=@pmainedtn or @pmainedtn is null)
		 and (d.sup_type_code=@pextra2 or @pextra2 is null or @pextra2 ='') and 
         (m.ag_type=@pextra3 or @pextra3 is null or @pextra3 ='') and 
         (m.ag_class=@pextra4 or @pextra4 is null or @pextra4 ='')
	  group by d.comp_code,d.unit_code,m.executive_code,
			   d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code
	  order by d.comp_code,d.unit_code,executive_code,supply_seqno ,d.agcd,d.dpcd
        
		select d.comp_code as "COMP_CODE",d.unit_code AS "UNIT_CODE",
		
		m.EXECUTIVE_CODE as "EXECUTIVE_CODE",(Select executive_desc from cir_executive_mast 
		where COMP_CODE=d.COMP_CODE and EXECUTIVE_CODE=m.executive_code) as "EXECUTIVE_NAME",
		sum(d.sup_copy) AS "SUP_COPY"
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e
		where d.comp_code    = m.comp_code and d.comp_code    = e.comp_code and
			 d.unit_code    = m.unit and
			 d.agcd         = m.agcd and
			 d.dpcd         = m.dpcd and
			 d.comp_code    = @pcomp_code and
			 d.unit_code    = @punit_code and
			 d.publ         = e.publ and d.publ         = @ppubl and
			 d.edtn=e.edtn and (d.edtn       = @pedtn or @pedtn is null) and
			 (d.route_code = @proute or @proute is null) and
			 d.supdate between @pfrom_supdate and @ptill_supdate and
			 (e.main_edtn=@pmainedtn or @pmainedtn is null)
			 and (m.ag_type=@pextra3 or @pextra3 is null or @pextra3 ='') and 
					(m.ag_class=@pextra4 or @pextra4 is null or @pextra4 ='')
		  group by d.comp_code,d.unit_code,m.executive_code
		  order by d.comp_code,d.unit_code,m.executive_code
		
		select d.comp_code as "COMP_CODE",d.unit_code AS "UNIT_CODE",sum(d.sup_copy) AS "SUP_COPY"
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e
			where d.comp_code    = m.comp_code and d.comp_code    = e.comp_code and
				 d.unit_code    = m.unit and
				 d.agcd         = m.agcd and
				 d.dpcd         = m.dpcd and
				 d.comp_code    = @pcomp_code and
				 d.unit_code    = @punit_code and
				 d.publ         = e.publ and d.publ         = @ppubl and
				 d.edtn=e.edtn and (d.edtn       = @pedtn or @pedtn is null) and
				 (d.route_code = @proute or @proute is null) and
				 d.supdate between @pfrom_supdate and @ptill_supdate and
				 (e.main_edtn=@pmainedtn or @pmainedtn is null)
				 and (m.ag_type=@pextra3 or @pextra3 is null or @pextra3 ='') and 
					(m.ag_class=@pextra4 or @pextra4 is null or @pextra4 ='')
			  group by d.comp_code,d.unit_code
			  order by d.comp_code,d.unit_code
		
		select d.comp_code as "COMP_CODE",sum(d.sup_copy) AS "SUP_COPY",max(sup_rate) as "COPY_RATE"
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e
			where d.comp_code    = m.comp_code and d.comp_code    = e.comp_code and
				 d.unit_code    = m.unit and
				 d.agcd         = m.agcd and
				 d.dpcd         = m.dpcd and
				 d.comp_code    = @pcomp_code and
				 d.unit_code    = @punit_code and
				 d.publ         = e.publ and d.publ         = @ppubl and
				 d.edtn=e.edtn and (d.edtn       = @pedtn or @pedtn is null) and
				 (d.route_code = @proute or @proute is null) and
				 d.supdate between @pfrom_supdate and @ptill_supdate and
				 (e.main_edtn=@pmainedtn or @pmainedtn is null)
				 and (m.ag_type=@pextra3 or @pextra3 is null or @pextra3 ='') and 
					(m.ag_class=@pextra4 or @pextra4 is null or @pextra4 ='')
			  group by d.comp_code
			  order by d.comp_code
		





******************* end of executive(Distributor)supply wise ***************************************************

//////////////////////////////////add by Deepika 11/04/2012 sent by Amit Tomer Sir////////////////////////////


ALTER PROCEDURE [dbo].[cir_rep_supply_cir_rep_supply1]
	@pcomp_code			VARCHAR(40) ,
	@punit_code         VARCHAR(40) ,
	@ppubl              VARCHAR(40) ,
	@pmainedtn          VARCHAR(40) ,
	@pedtn              VARCHAR(40) ,
	@proute             VARCHAR(40) ,
	@pfrom_supdate      DATETIME ,
	@ptill_supdate      DATETIME ,
	@pdateformat        VARCHAR(40) ,
    @pextra1            VARCHAR(40) ,--for branch
    @pextra2            VARCHAR(40) ,--for state,
	@pextra3			VARCHAR(40) ,--this is use to final and unfinal po Y for Final And N for unfinal
	@pextra4            VARCHAR(40) ,--for zone,
	@pextra5            VARCHAR(40) ,--for region
	@pextra6            VARCHAR(40) ,--for district
	@pextra7            VARCHAR(40) ,--for taluka
	@pextra8            VARCHAR(40) ,--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,other than statewise
	@pextra9            VARCHAR(40) , -- it is using for standing order / posting
	@pextra10           VARCHAR(40)
AS 
BEGIN
	DECLARE @vfrom_supdate	varchar(20);
	DECLARE @vtill_supdate  varchar(20);
	declare @vsup_seq_no	int
	
	
	DECLARE @supply_type_name	VARCHAR(4000)
	DECLARE @supply_sum			VARCHAR(4000) 
	DECLARE @vvar               VARCHAR(4000) 
	DECLARE @vvar_sum           VARCHAR(4000) 
	DECLARE @vquery             VARCHAR(8000) 
	DECLARE @vquery1            VARCHAR(8000) 
	DECLARE @vquery2            VARCHAR(8000) 
	DECLARE @vquery3            VARCHAR(8000) 
	DECLARE @vquery4            VARCHAR(8000) 
	
	SET @vfrom_supdate  =@pfrom_supdate
	SET @vtill_supdate  = @ptill_supdate
	
	if @pextra9 = '2' begin
	DECLARE cur_sup_type cursor LOCAL FOR 
		select distinct ' sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) "'+sup_ty_name+'",' vty,
		'sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) +' vty_sum,sup_seq_no
		from cir_supply_type_mast s, cir_supply d,cir_edtn_mast e
		where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code 
		and s.sup_ty_code =d.supply_type_code and
		(d.unit=isnull(@punit_code,d.unit) or @punit_code='') and d.publ=e.publ and 
		(d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
		d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
		(e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
		order by sup_seq_no;
		
		OPEN cur_sup_type 
		fetch NEXT FROM cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
			while(@@FETCH_STATUS = 0) BEGIN
				set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@supply_type_name + '', SPACE(0))
				set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@supply_sum + '', SPACE(0))

		fetch NEXT from cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
		end
		close cur_sup_type
		
		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)
	end
	else
	begin
		DECLARE cur_sup_type cursor LOCAL FOR 
		select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
		'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
		from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
		where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code 
		and s.sup_ty_code =d.sup_type_code and
		(d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ 
		and (d.publ=isnull(@ppubl,d.publ) or @ppubl='') 
		and d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
		d.supdate between @pfrom_supdate and @ptill_supdate and
		(e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
		order by sup_seq_no;
		
		OPEN cur_sup_type 
		fetch NEXT FROM cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
			while(@@FETCH_STATUS = 0) BEGIN
				set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@supply_type_name + '', SPACE(0))
				set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@supply_sum + '', SPACE(0))

		fetch NEXT from cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
		end
		close cur_sup_type
		
		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)
	end	
		
	
	
	print('here')
	print(@vvar)
	print(@vvar_sum)	
	print('close')
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9 = '1' 
begin

		if @pextra8='1' Begin--for route
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) ROUTE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		if @pextra8='2' Begin----for  branch
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,dbo.cir_get_branch(d.comp_code,m.branch_code) BRANCH_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit_code,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end

		if @pextra8='3' Begin----for  zone
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,
			dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,
			d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,
			c.zone_code ZONE_CODE,
			dbo.cir_get_zone_name(d.comp_code,c.zone_code) ZONE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit_code,d.publ,d.edtn,zone_code,d.agcd,d.dpcd'                
				print @vquery 
				EXEC (@vquery)
		end
		print('ch2')
		if @pextra8='4' Begin----for  region
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,
			dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,
			dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,
			c.region_code REGION_CODE,dbo.cir_get_region_name(d.comp_code,c.region_code) REGION_NAME,
			d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		print('ch3')
		if @pextra8='5' Begin----for  district
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''1'',null,null,null) DIST_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+'''
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,dist_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end

		if @pextra8='6' Begin----for Taluka
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) TALUKA_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,taluka_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		if @pextra8='7' Begin----for State
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE
			--,dbo.cir_get_state1(d.comp_code,m.state_code) STATE_NAME
			,dbo.cir_get_state(d.comp_code,m.COUNTRY_CODE,m.state_code) STATE_NAME
			,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
				c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname ,m.COUNTRY_CODE
				order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
				SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code order by d.comp_code,d.unit_code'
				print @vquery1
				EXEC (@vquery1)
				
		if @pextra8='1' Begin--for route
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
					from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
					where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='2' Begin--for branch
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+'''
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='3' Begin--for Zone
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='4' Begin--for region
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+'''
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code'
			print('r1')
			print @vquery2
			EXEC (@vquery2)
		end

		if @pextra8='5' Begin--for District
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='6' Begin--for Taluka
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka order by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka'
			print @vquery2
			EXEC (@vquery2)
		end

		if @pextra8='7' Begin--for state
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code'
			print @vquery2
			EXEC (@vquery2)
		end

		SET @vquery3  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit_code,d.publ,d.edtn order by d.comp_code,d.unit_code,d.publ,d.edtn'
		print @vquery3
		EXEC (@vquery3)

		SET @vquery4  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ'
		print @vquery4
		EXEC (@vquery4)
end
else
begin
print('new') print(@vvar)
		if @pextra8='1' Begin--for route
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) ROUTE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT"
				, '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		if @pextra8='2' Begin----for  branch
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,dbo.cir_get_branch(d.comp_code,m.branch_code) BRANCH_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end

		if @pextra8='3' Begin----for  zone
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,
			dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,
			d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,
			c.zone_code ZONE_CODE,
			dbo.cir_get_zone_name(d.comp_code,c.zone_code) ZONE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit,d.publ,d.edtn,zone_code,d.agcd,d.dpcd'                
				print @vquery 
				EXEC (@vquery)
		end
		print('ch2')
		if @pextra8='4' Begin----for  region
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,
			dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,
			dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,
			c.region_code REGION_CODE,dbo.cir_get_region_name(d.comp_code,c.region_code) REGION_NAME,
			d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		print('ch3')
		if @pextra8='5' Begin----for  district
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''1'',null,null,null) DIST_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+'''
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,dist_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end

		if @pextra8='6' Begin----for Taluka
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) TALUKA_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,taluka_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		if @pextra8='7' Begin----for State
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE
			--,dbo.cir_get_state1(d.comp_code,m.state_code) STATE_NAME
			,dbo.cir_get_state(d.comp_code,m.COUNTRY_CODE,m.state_code) STATE_NAME
			,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
				c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname ,m.COUNTRY_CODE
				order by d.comp_code,d.unit,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
				SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit order by d.comp_code,d.unit'
				print @vquery1
				EXEC (@vquery1)
				
		if @pextra8='1' Begin--for route
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
					from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
					where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,d.route_code order by d.comp_code,d.unit,d.publ,d.edtn,d.route_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='2' Begin--for branch
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+'''
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code order by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='3' Begin--for Zone
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code order by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='4' Begin--for region
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+'''
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,d.publ,d.edtn,c.region_code order by d.comp_code,d.unit,d.publ,d.edtn,c.region_code'
			print('r1')
			print @vquery2
			EXEC (@vquery2)
		end

		if @pextra8='5' Begin--for District
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code order by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='6' Begin--for Taluka
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka order by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka'
			print @vquery2
			EXEC (@vquery2)
		end

		if @pextra8='7' Begin--for state
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,d.publ,d.edtn,m.state_code order by d.comp_code,d.unit,d.publ,d.edtn,m.state_code'
			print @vquery2
			EXEC (@vquery2)
		end

		SET @vquery3  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit,d.publ,d.edtn order by d.comp_code,d.unit,d.publ,d.edtn'
		print @vquery3
		EXEC (@vquery3)

		SET @vquery4  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ order by d.comp_code,d.unit,d.publ'
		print @vquery4
		EXEC (@vquery4)
end


DEALLOCATE cur_sup_type

END

/////////////////////////////////////

alter procedure [dbo].[cir_exec_editionwise_print]
    @pcompcode      as varchar(500),
    @punitcode      as varchar(500),
    @ppublcode      as varchar(500),
    @pmainedtn      as varchar(500),
    @pedtncode      as varchar(500),
    @proute         as varchar(500),
    @pfrom_supdate  as datetime,
    @ptill_supdate  as datetime,
    @plangtype      as varchar(500),
    @pdateformat    as varchar(500),
    @pextra1        as varchar(500),
    @pextra2        as varchar(500),
    @pextra3        as varchar(500),--------supply posted final and un final
    @pextra4        as varchar(500),
    @pextra5        as varchar(500),
    @pextra6        as varchar(500),
    @pextra7        as varchar(500),
    @pextra8        as varchar(500),
    @pextra9        as varchar(500),
    @pextra10       as varchar(500)
as
SET CONCAT_NULL_YIELDS_NULL OFF

declare @vsupdate    as  datetime;
declare @vsupdate1  as datetime;
declare @vvar        as varchar(max);
declare @vvar_sum   as  varchar(max);
declare @vvar_sum1  as  varchar(max);
declare @v_query    as  varchar(max);
declare @v_query1    as  varchar(max);

set @vsupdate =@pfrom_supdate
set @vsupdate1=@ptill_supdate

if @pextra2 = '2' begin
declare cur_edtn cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(isnull(p.edition_nick,p.edtn_name),1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,0 sup_rate,p.main_edtn main_edtn
    from cir_route_mast m,cir_supply d ,cir_edtn_mast p ,cir_supply_type_mast k,cir_agmast a
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=a.comp_code and 
    d.comp_code=k.comp_code  and m.unit=d.unit and a.unit=d.unit and m.unit=p.unit_code and 
    d.unit = @punitcode and d.supply_type_code=k.sup_ty_code and d.agcd=a.agcd and d.dpcd=a.dpcd and
    --d.supdate >= @pfrom_supdate and d.supdate <=@ptill_supdate and
    m.route_code=d.route_code and (m.route_code=@proute or @proute is null)
    and d.publ=isnull(@ppublcode,d.publ) and
    d.publ=p.publ and d.edtn=p.edtn --and k.bill_pay='Y'
    order by publ,main_edtn,edtn_seqno,edtn,sup_rate
end
else
begin
declare cur_edtn cursor for
	select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(isnull(p.edition_nick,p.edtn_name),1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,d.sup_rate sup_rate,p.main_edtn main_edtn
    from cir_route_mast m,cir_dbksup d ,cir_edtn_mast p ,cir_supply_type_mast k,cir_agmast a
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and d.comp_code=a.comp_code and 
    d.comp_code=k.comp_code  and m.unit=d.unit_code and a.unit=d.unit_code and m.unit=p.unit_code and 
    d.unit_code = @punitcode and d.sup_type_code=k.sup_ty_code and d.agcd=a.agcd and d.dpcd=a.dpcd and
    d.supdate >= @pfrom_supdate and d.supdate <=@ptill_supdate and
    m.route_code=d.route_code and (m.route_code=@proute or @proute is null)
    and d.publ=isnull(@ppublcode,d.publ) and
    d.publ=p.publ and d.edtn=p.edtn --and k.bill_pay='Y'
    order by publ,main_edtn,edtn_seqno,edtn,sup_rate
end
print('a')
-- cursor variable for cur_edtn
declare @rec_edtn_publ as varchar(200)
declare @rec_edtn_edtn as varchar(200)
declare @rec_edtn_edtn_seqno as numeric(5)
declare @rec_edtn_edtn_name as varchar(500)
declare @rec_edtn_sup_rate as numeric(14,2)
declare @rec_edtn_main_edtn as varchar(200)
-- end here --
if @pextra2 = '2' begin
	OPEN cur_edtn 
		fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
			WHILE (@@FETCH_STATUS = 0) 
			BEGIN
				if (@vvar is null or @vvar = '') begin 
					set @vvar        ='sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then base_supply else 0 end) "'+@rec_edtn_edtn_name+'"';
					set @vvar_sum    ='sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
					set @vvar_sum1   ='sum('+'"'+@rec_edtn_edtn_name+'"';
				end
				else
				begin
					set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then base_supply else 0 end) "'+@rec_edtn_edtn_name+'"';
					set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
					set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_edtn_name+'"';
				end
	                
	                
		fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
	END     
	close cur_edtn
	DEALLOCATE cur_edtn
end
else
begin
	OPEN cur_edtn 
		fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
			WHILE (@@FETCH_STATUS = 0) 
			BEGIN
				if (@vvar is null or @vvar = '') begin 
					set @vvar        ='sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_edtn_name+'"';
					set @vvar_sum    ='sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
					set @vvar_sum1   ='sum('+'"'+@rec_edtn_edtn_name+'"';
				end
				else
				begin
					set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_edtn_name+'"';
					set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
					set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_edtn_name+'"';
				end
	                
	                
		fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
	END     
	close cur_edtn
	DEALLOCATE cur_edtn
end
if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end
print(@vvar)

if @pextra2 = '2' begin
	 if @vvar is null or @vvar ='' begin
		set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name from(select d.comp_code,d.unit as unit_code ,a.executive_code route_code,
				case '''+@plangtype+''' when ''1'' then substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25)
				else substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25) end route_name 
				from cir_supply d,cir_route_mast m ,cir_supply_type_mast k,cir_agmast a
				where d.comp_code = m.comp_code and d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
				d.comp_code = '+''''+@pcompcode+''''+' and 
				d.unit = m.unit and d.unit = a.unit and d.unit = '+''''+@punitcode+''''+' and 
				d.supply_type_code=k.sup_ty_code and 
				d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and d.route_code = m.route_code   
				/* and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+'  */
				and k.bill_pay=''Y'' 
				-- and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') 
				and d.agcd=a.agcd and d.dpcd=a.dpcd
				group by d.comp_code,d.unit,a.executive_code) x
				group by x.comp_code,x.unit_code,x.route_code,x.route_name
				order by x.comp_code,x.unit_code,x.route_code,x.route_name';
	end
	else
	begin        
		set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name,'+@vvar_sum+','+@vvar_sum1+' from(select d.comp_code,d.unit as unit_code ,a.executive_code route_code,
				case '''+@plangtype+''' when ''1'' then substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25)
				else substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25) end route_name
				,'+@vvar+' from cir_supply d,cir_route_mast m,cir_supply_type_mast k,cir_agmast a
				where d.comp_code = m.comp_code and d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
				d.comp_code = '+''''+@pcompcode+''''+' and 
				d.unit = m.unit and d.unit = a.unit and d.unit = '+''''+@punitcode+''''+' and 
				d.supply_type_code=k.sup_ty_code and 
				d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and d.route_code = m.route_code   
				/* and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' */
				and k.bill_pay=''Y'' 
				--and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') 
				and d.agcd=a.agcd and d.dpcd=a.dpcd
				group by d.comp_code,d.unit,a.executive_code) x
				group by x.comp_code,x.unit_code,x.route_code,x.route_name
				order by x.comp_code,x.unit_code,x.route_code,x.route_name';       
	end
end 
else
begin
	if @vvar is null or @vvar ='' begin
		set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name from(select d.comp_code,d.unit_code,a.executive_code route_code,
				case '''+@plangtype+''' when ''1'' then substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25)
				else substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25) end route_name 
				from cir_dbksup d,cir_route_mast m ,cir_supply_type_mast k,cir_agmast a
				where d.comp_code = m.comp_code and d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
				d.comp_code = '+''''+@pcompcode+''''+' and 
				d.unit_code = m.unit and d.unit_code = a.unit and d.unit_code = '+''''+@punitcode+''''+' and 
				d.sup_type_code=k.sup_ty_code and 
				d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and d.route_code = m.route_code  and 
				d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
				and k.bill_pay=''Y'' 
				and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') and
				d.agcd=a.agcd and d.dpcd=a.dpcd
				group by d.comp_code,d.unit_code,a.executive_code) x
				group by x.comp_code,x.unit_code,x.route_code,x.route_name
				order by x.comp_code,x.unit_code,x.route_code,x.route_name';
	end
	else
	begin        
		set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name,'+@vvar_sum+','+@vvar_sum1+' from(select d.comp_code,d.unit_code,a.executive_code route_code,
				case '''+@plangtype+''' when ''1'' then substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25)
				else substring(isnull((select executive_desc from cir_executive_mast where comp_code=d.comp_code and executive_code=a.executive_code),''NOT DEFINE''),1,25) end route_name
				,'+@vvar+' from cir_dbksup d,cir_route_mast m,cir_supply_type_mast k,cir_agmast a
				where d.comp_code = m.comp_code and d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
				d.comp_code = '+''''+@pcompcode+''''+' and 
				d.unit_code = m.unit and d.unit_code = a.unit and d.unit_code = '+''''+@punitcode+''''+' and 
				d.sup_type_code=k.sup_ty_code and 
				d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and d.route_code = m.route_code  and 
				d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
				and k.bill_pay=''Y'' 
				and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') and
				d.agcd=a.agcd and d.dpcd=a.dpcd
				group by d.comp_code,d.unit_code,a.executive_code) x
				group by x.comp_code,x.unit_code,x.route_code,x.route_name
				order by x.comp_code,x.unit_code,x.route_code,x.route_name';       
	end
end
print(@v_query)
exec(@v_query)  
print('q')
-- for free supply
if @pextra2 = '2' begin
    if @vvar is null or @vvar ='' begin
        set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,d.unit as unit_code ,k.sup_ty_code,
        substring(k.sup_ty_name,1,25) supply_name
        from cir_supply d,cir_supply_type_mast k,cir_agmast a
        where d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
        d.comp_code = '+''''+@pcompcode+''''+' and 
        d.unit = a.unit and d.unit = '+''''+@punitcode+''''+' and 
        d.supply_type_code=k.sup_ty_code and 
        d.publ = isnull('+''''+@ppublcode+''''+',d.publ)  
        /* and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' */
        and k.bill_pay=''N'' 
        --and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') 
        and d.agcd=a.agcd and d.dpcd=a.dpcd
        group by d.comp_code,d.unit,k.sup_ty_code,k.sup_ty_name) x
        group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
        order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
    end
    else
    begin
        set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
        (select d.comp_code,d.unit as unit_code ,k.sup_ty_code sup_ty_code,
        substring(k.sup_ty_name,1,25) supply_name
        ,'+@vvar+' from cir_supply d,cir_supply_type_mast k,cir_agmast a
        where d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
        d.comp_code = '+''''+@pcompcode+''''+' and 
        d.unit = a.unit and d.unit = '+''''+@punitcode+''''+' and 
        d.supply_type_code=k.sup_ty_code and 
        d.publ = isnull('+''''+@ppublcode+''''+',d.publ) 
        /*and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' */
        and k.bill_pay=''N'' 
        --and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') 
        and d.agcd=a.agcd and d.dpcd=a.dpcd
        group by d.comp_code,d.unit,k.sup_ty_code,k.sup_ty_name) x
        group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
        order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
    end
end
else
begin
	if @vvar is null or @vvar ='' begin
        set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,d.unit_code,k.sup_ty_code,
        substring(k.sup_ty_name,1,25) supply_name
        from cir_dbksup d,cir_supply_type_mast k,cir_agmast a
        where d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
        d.comp_code = '+''''+@pcompcode+''''+' and 
        d.unit_code = a.unit and d.unit_code = '+''''+@punitcode+''''+' and 
        d.sup_type_code=k.sup_ty_code and 
        d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and 
        d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
        and k.bill_pay=''N'' 
        and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') and
        d.agcd=a.agcd and d.dpcd=a.dpcd
        group by d.comp_code,d.unit_code,k.sup_ty_code,k.sup_ty_name) x
        group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
        order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
    end
    else
    begin
        set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
        (select d.comp_code,d.unit_code,k.sup_ty_code sup_ty_code,
        substring(k.sup_ty_name,1,25) supply_name
        ,'+@vvar+' from cir_dbksup d,cir_supply_type_mast k,cir_agmast a
        where d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
        d.comp_code = '+''''+@pcompcode+''''+' and 
        d.unit_code = a.unit and d.unit_code = '+''''+@punitcode+''''+' and 
        d.sup_type_code=k.sup_ty_code and 
        d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
        d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
        and k.bill_pay=''N'' 
        and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') and
        d.agcd=a.agcd and d.dpcd=a.dpcd
        group by d.comp_code,d.unit_code,k.sup_ty_code,k.sup_ty_name) x
        group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
        order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
    end
end
print(@v_query1)
exec(@v_query1)
if @pextra2 = '2' begin
        if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from
            (select d.comp_code,d.unit as unit_code,null as sup_ty_code, null as supply_name
            from cir_supply d,cir_supply_type_mast k,cir_agmast a
            where d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
            d.comp_code = '+''''+@pcompcode+''''+' and 
            d.unit = a.unit and d.unit = '+''''+@punitcode+''''+' and 
            d.supply_type_code=k.sup_ty_code and 
            d.publ = isnull('+''''+@ppublcode+''''+',d.publ) 
            --and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            and k.bill_pay=''Y'' 
            -- and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') 
            and d.agcd=a.agcd and d.dpcd=a.dpcd
            group by d.comp_code,d.unit) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit as unit_code   ,null as sup_ty_code, null as supply_name
            ,'+@vvar+' from cir_supply d,cir_supply_type_mast k,cir_agmast a
            where d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
            d.comp_code = '+''''+@pcompcode+''''+' and 
            d.unit = a.unit and d.unit = '+''''+@punitcode+''''+' and 
            d.supply_type_code=k.sup_ty_code and 
            d.publ = isnull('+''''+@ppublcode+''''+',d.publ)  
            --and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            --and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') 
            and d.agcd=a.agcd and d.dpcd=a.dpcd
            group by d.comp_code,d.unit) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
end

else
begin
	if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,unit_code,null as sup_ty_code, null as supply_name
            from cir_dbksup d,cir_supply_type_mast k,cir_agmast a
            where d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
            d.comp_code = '+''''+@pcompcode+''''+' and 
            d.unit_code = a.unit and d.unit_code = '+''''+@punitcode+''''+' and 
            d.sup_type_code=k.sup_ty_code and 
            d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            and k.bill_pay=''Y'' 
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') and
            d.agcd=a.agcd and d.dpcd=a.dpcd
            group by d.comp_code,d.unit_code) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit_code   ,null as sup_ty_code, null as supply_name
            ,'+@vvar+' from cir_dbksup d,cir_supply_type_mast k,cir_agmast a
            where d.comp_code=k.comp_code  and d.comp_code=a.comp_code and 
            d.comp_code = '+''''+@pcompcode+''''+' and 
            d.unit_code = a.unit and d.unit_code = '+''''+@punitcode+''''+' and 
            d.sup_type_code=k.sup_ty_code and 
            d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and 
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''') and
            d.agcd=a.agcd and d.dpcd=a.dpcd
            group by d.comp_code,d.unit_code) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
end
print(@v_query1)
exec(@v_query1)

SET CONCAT_NULL_YIELDS_NULL On

//////////////////////////////////////////

ALTER PROCEDURE [dbo].[cir_rep_supply_temp]
@pcomp_code         as varchar(200),
@punit_code         as varchar(200),
@ppubl              as varchar(200),
@pmainedtn          as varchar(200),
@pedtn              as varchar(200),
@proute             as varchar(200),
@pfrom_supdate      as datetime,
@ptill_supdate      as datetime,
@pdateformat        as varchar(200),
@pextra1            as varchar(200),--for branch
@pextra2            as varchar(200),--for State
@pextra3            as varchar(200),--this is use to final and unfinal po
@pextra4            as varchar(200),--for zone,
@pextra5            as varchar(200),--for region
@pextra6            as varchar(200),--for district
@pextra7            as varchar(200),--for taluka
@pextra8            as varchar(200),--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,other than statewise
@pextra9            as varchar(200),
@pextra10           as varchar(200)

AS

declare @vfrom_supdate    varchar(20);
declare @vtill_supdate    varchar(20);
declare @rec_sup_type		as varchar(200) 
declare @rec_sup_type_sum	as varchar(200) 
declare @rec_sup_seq_no		as int

if @pextra9 ='2' begin
	DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_supply d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.supply_type_code and
    (d.unit=isnull(@punit_code,d.unit) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    --d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;
end
else
begin
	DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.sup_type_code and
    (d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;
end
	declare @vvar		varchar(4000)
	declare @vvar_sum	varchar(4000)
	declare @vquery		varchar(8000)

	set @vvar=''
	set @vvar_sum=''
 
	set @vfrom_supdate=convert(varchar(20),@pfrom_supdate,101)
	set @vtill_supdate=convert(varchar(20),@ptill_supdate,101)

	print('@vfrom_supdate')print(@vfrom_supdate);
	print('@vtill_supdate')print(@vtill_supdate);

if @pextra9 ='2' begin
	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type
end
else
begin
	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type
end
	print('@vvar')print(@vvar)
	print('@vvar_sum')print(@vvar_sum)

	set @vvar    =substring(@vvar,1,len(@vvar)-1)
	set @vvar_sum=substring(@vvar_sum,1,len(@vvar_sum)-1)
	print('@vvar2')print(@vvar)
	print('@vvar_sum2')print(@vvar_sum)
   
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9 ='2' begin
	if @pextra8='1' begin----for route 
		set @vquery='select d.comp_code comp_code,d.unit unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
			d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) route_name,
			dbo.cir_get_name_cir_route(d.comp_code,d.unit,d.route_code,''2'',null,null,null) route_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 								
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,d.publ,d.route_code
			order by d.comp_code,d.unit,d.publ,route_name';

	end ------ route	
	else if @pextra8='2' begin----for  branch
		set @vquery='select d.comp_code comp_code,d.unit unit_code,m.branch_code branch_code,
	dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
	 '+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 								
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	 group by d.comp_code,d.unit,m.branch_code
	order by d.comp_code,d.unit,branch_name'

	end ---- branch		
	else if @pextra8='3' begin----for  zone  
	 
	set @vquery=' select d.comp_code comp_code,d.unit unit_code,c.zone_code,
		dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 				
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit,c.zone_code
		order by d.comp_code,d.unit,zone_name';

	end  ---- zone
	else if @pextra8='4' begin----for  region   
		set @vquery='  select d.comp_code comp_code,d.unit unit_code,c.region_code,
		dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 				
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit,c.region_code
		order by d.comp_code,d.unit,region_name';

	end ---- end  region
	else if @pextra8='5' begin----for  district

		set @vquery='select d.comp_code comp_code,d.unit unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
		dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
					from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 				
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,m.state_code,m.dist_code
			order by d.comp_code,d.unit,m.state_code,district_name	'

	end  ---- district
	else if @pextra8='6' begin----for  tehsil_taluka

		set @vquery='  select d.comp_code comp_code,d.unit unit_code,m.tehsil_taluka tehsil_taluka,
		dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
		dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit,m.tehsil_taluka
		order by d.comp_code,d.unit,taluka_name';
	end  ----for  tehsil_taluka

	else begin
		set @vquery='select d.comp_code comp_code,d.unit unit_code,m.country_code country_code,
		m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
		 ,'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 				
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit,m.country_code,m.state_code
		order by d.comp_code,d.unit,m.country_code,state_name';
	end
end
else
begin
		if @pextra8='1' begin----for route 
		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
			d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
			dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.route_code
			order by d.comp_code,d.unit_code,d.publ,route_name';

	end ------ route	
	else if @pextra8='2' begin----for  branch
		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.branch_code branch_code,
	dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
	 '+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	 group by d.comp_code,d.unit_code,m.branch_code
	order by d.comp_code,d.unit_code,branch_name'

	end ---- branch		
	else if @pextra8='3' begin----for  zone  
	 
	set @vquery=' select d.comp_code comp_code,d.unit_code unit_code,c.zone_code,
		dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,c.zone_code
		order by d.comp_code,d.unit_code,zone_name';

	end  ---- zone
	else if @pextra8='4' begin----for  region   
		set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,c.region_code,
		dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,c.region_code
		order by d.comp_code,d.unit_code,region_name';

	end ---- end  region
	else if @pextra8='5' begin----for  district

		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
		dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
					from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,m.state_code,m.dist_code
			order by d.comp_code,d.unit_code,m.state_code,district_name	'

	end  ---- district
	else if @pextra8='6' begin----for  tehsil_taluka

		set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,m.tehsil_taluka tehsil_taluka,
		dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
		dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,m.tehsil_taluka
		order by d.comp_code,d.unit_code,taluka_name';
	end  ----for  tehsil_taluka

	else begin
		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.country_code country_code,
		m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
		 ,'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,m.country_code,m.state_code
		order by d.comp_code,d.unit_code,m.country_code,state_name';
	end
end
print(@vquery)
exec(@vquery)


//////////////////////////////////////////////

ALTER PROCEDURE [dbo].[cir_rep_supply_cir_rep_supply_po]
	@pcomp_code                               VARCHAR(20) ,
	@punit_code                               VARCHAR(20) ,
	@ppubl                                    VARCHAR(20) ,
	@pedtn                                    VARCHAR(20) ,
	@psupdate                                 VARCHAR(20) ,
	@pdateformat                              VARCHAR(20) ,
	@pextra1                                  VARCHAR(4000),--it is use for finalised or unfinalised
	@pextra2                                  VARCHAR(4000),
	@pextra3                                  VARCHAR(4000)  
AS
	DECLARE @vvty11				VARCHAR(2000)  
	DECLARE @vvty_sum11         VARCHAR(2000)  
	DECLARE @vvar               VARCHAR(4000) 
	DECLARE @vvar_sum           VARCHAR(4000) 
	DECLARE @vquery             VARCHAR(4000) 
	DECLARE @vquery1            VARCHAR(4000) 	
	DECLARE @vquery2            VARCHAR(4000) 
	DECLARE @vquery3            VARCHAR(4000) 	
    DECLARE @user_pfrom			VARCHAR(100)
	DECLARE @vsup_seq_no			INT
	
	if @pextra2 = '2' begin
	DECLARE cur_sup_type cursor LOCAL FOR 
		select z.vty vty,z.vty_sum vty_sum,z.sup_seq_no sup_seq_no from 
		(SELECT 'SUM(CASE SUPPLY_TYPE_CODE WHEN  '+''''+sup_ty_code+''''+' then base_supply else 0 end) "'+sup_ty_name+'",' vty,
		'sum(case SUPPLY_TYPE_CODE	when '+''''+sup_ty_code+''''+' then '+' base_supply '+' else 0 end) +' vty_sum,sup_seq_no from cir_supply_type_mast 
		WHERE comp_code  = @pcomp_code)z
		order by sup_seq_no
		
		OPEN cur_sup_type 
			fetch NEXT FROM cur_sup_type INTO @vvty11 , @vvty_sum11,@vsup_seq_no
				WHILE (@@FETCH_STATUS = 0) 
				  BEGIN 
				   set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@vvty11 + '', SPACE(0))
				   set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@vvty_sum11 + '', SPACE(0))					
			fetch NEXT FROM cur_sup_type INTO @vvty11 , @vvty_sum11,@vsup_seq_no
		 END 
		close cur_sup_type

		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)

        set @user_pfrom=(select dbo.convert_user_date('/',@psupdate,@pdateformat))
	end
	else
	begin
		DECLARE cur_sup_type cursor LOCAL FOR 
		select z.vty vty,z.vty_sum vty_sum,z.sup_seq_no sup_seq_no from 
		(SELECT 'SUM(CASE SUP_TYPE_CODE WHEN  '+''''+sup_ty_code+''''+' then sup_copy else 0 end) "'+sup_ty_name+'",' vty,
		'sum(case sup_type_code	when '+''''+sup_ty_code+''''+' then '+' sup_copy '+' else 0 end) +' vty_sum,sup_seq_no from cir_supply_type_mast 
		WHERE comp_code  = @pcomp_code)z
		order by sup_seq_no
		
		OPEN cur_sup_type 
			fetch NEXT FROM cur_sup_type INTO @vvty11 , @vvty_sum11,@vsup_seq_no
				WHILE (@@FETCH_STATUS = 0) 
				  BEGIN 
				   set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@vvty11 + '', SPACE(0))
				   set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@vvty_sum11 + '', SPACE(0))					
			fetch NEXT FROM cur_sup_type INTO @vvty11 , @vvty_sum11,@vsup_seq_no
		 END 
		close cur_sup_type

		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)

        set @user_pfrom=(select dbo.convert_user_date('/',@psupdate,@pdateformat))
	end
print(@psupdate)
print(@user_pfrom)
print(@pdateformat)
		
if @pextra2 ='2' begin
	SET @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,
         dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn EDTN,
         dbo.cir_get_edtn_name(d.comp_code,d.edtn) "EDITION NAME",
         DBO.CONVERT_USER_DATE(''/'','''+@psupdate+''','''+@pdateformat+''') SUPDATE,' + @vvar + ',' 
         
	SET @vquery2=  @vvar_sum +' TOTAL,
         dbo.cir_get_edtn_name(d.comp_code,e.main_edtn) MAINEDTN_NAME,'''' SUPL_NAME,
         dbo.cir_get_edtn_seqno(d.comp_code,e.main_edtn) MAIN_EDTN_SEQNO,
         dbo.cir_get_edtn_seqno(d.comp_code,d.edtn) EDTN_SEQNO,'''' PAGE_NO,'''' AS SUPL_DETAIL from cir_supply d,cir_edtn_mast e
         where d.comp_code=' + '''' + @pcomp_code + '''' + ' and d.comp_code=e.comp_code 
         and d.unit=' + '''' + @punit_code + '''' + ' and d.unit=e.unit_code AND 
         (d.publ='+''''+@ppubl+''''+' OR '+''''+@ppubl+''''+' IS NULL OR '+''''+@ppubl+''''+' ='''')  and d.publ=e.publ 
         and d.edtn=e.edtn 
         group by d.comp_code,d.unit,d.publ,e.main_edtn,d.edtn 
         order by d.comp_code,d.unit,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn' 
         
         SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,
         dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,' + @vvar + ',' 
	
		SET @vquery3  = @vvar_sum + 'TOTAL from cir_supply d where 
         d.comp_code=' + '''' + @pcomp_code + '''' + ' and d.unit=' + '''' + @punit_code + '''' + ' 
         and (d.publ='+''''+@ppubl+''''+' OR '+''''+@ppubl+''''+' IS NULL OR '+''''+@ppubl+''''+' ='''')             
         group by d.comp_code,d.unit,d.publ order by d.comp_code,d.unit,d.publ' 
end
else
begin
	SET @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,
         dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,d.edtn EDTN,
         dbo.cir_get_edtn_name(d.comp_code,d.edtn) "EDITION NAME", 
         DBO.CONVERT_USER_DATE(''/'',d.supdate,'''+@pdateformat+''') SUPDATE,' + @vvar + ',' 
         
	SET @vquery2=  @vvar_sum +' TOTAL,
         dbo.cir_get_edtn_name(d.comp_code,e.main_edtn) MAINEDTN_NAME,'''' SUPL_NAME,
         dbo.cir_get_edtn_seqno(d.comp_code,e.main_edtn) MAIN_EDTN_SEQNO,
         dbo.cir_get_edtn_seqno(d.comp_code,d.edtn) EDTN_SEQNO,'''' PAGE_NO,'''' AS SUPL_DETAIL from cir_dbksup d,cir_edtn_mast e
         where d.comp_code=' + '''' + @pcomp_code + '''' + ' and d.comp_code=e.comp_code 
         and d.unit_code=' + '''' + @punit_code + '''' + ' and d.unit_code=e.unit_code AND 
         (d.publ='+''''+@ppubl+''''+' OR '+''''+@ppubl+''''+' IS NULL OR '+''''+@ppubl+''''+' ='''')  and d.publ=e.publ 
         and d.supdate='+''''+@user_pfrom+''''+' and 
         d.edtn=e.edtn and (isnull(final_supply_flag,''N'') = '''+@pextra1+'''  or '''+@pextra1+''' is null or '''+@pextra1+'''='''')  
         group by d.comp_code,d.unit_code,d.publ,e.main_edtn,d.edtn,d.supdate 
         order by d.comp_code,d.unit_code,d.publ,main_edtn_seqno,mainedtn_name,edtn_seqno,d.edtn,d.supdate' 
         
         
         SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,
         dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,' + @vvar + ',' 
	
	SET @vquery3  = @vvar_sum + 'TOTAL from cir_dbksup d where 
         d.comp_code=' + '''' + @pcomp_code + '''' + ' and d.unit_code=' + '''' + @punit_code + '''' + ' 
         and (d.publ='+''''+@ppubl+''''+' OR '+''''+@ppubl+''''+' IS NULL OR '+''''+@ppubl+''''+' ='''')
        and d.supdate='+''''+@user_pfrom+''''+'   
        and (isnull(final_supply_flag,''N'') = '''+@pextra1+'''  or '''+@pextra1+''' is null or '''+@pextra1+'''='''')     
         group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ' 
end
        --SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,
        -- dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,' + @vvar + ',' + @vvar_sum + 'TOTAL from cir_dbksup d where 
        -- d.comp_code=' + '''' + @pcomp_code + '''' + ' and d.unit_code=' + '''' + @punit_code + '''' + ' 
        -- and (d.publ='+''''+@ppubl+''''+' OR '+''''+@ppubl+''''+' IS NULL OR '+''''+@ppubl+''''+' ='''')
        --and d.supdate='+''''+@user_pfrom+''''+'         
        -- group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ' 
        
	
 
		print (@vquery + @vquery2)
		print (@vquery1 + @vquery3) 
		EXEC (@vquery + @vquery2)
		EXEC (@vquery1 + @vquery3) 

DEALLOCATE cur_sup_type
 


/////////////////////////////////////////////
ALTER procedure [dbo].[cir_route_editionwise_print](
    @pcompcode      as varchar(500),
    @punitcode      as varchar(500),
    @ppublcode      as varchar(500),
    @pmainedtn      as varchar(500),
    @pedtncode      as varchar(500),
    @proute         as varchar(500),
    @pfrom_supdate  as datetime,
    @ptill_supdate  as datetime,
    @plangtype      as varchar(500),
    @pdateformat    as varchar(500),
    @pextra1        as varchar(500),
    @pextra2        as varchar(500), --------- it is used for posting and standing order 1/2
    @pextra3        as varchar(500),--------supply posted final and un final  Y/N
    @pextra4        as varchar(500),
    @pextra5        as varchar(500),
    @pextra6        as varchar(500),
    @pextra7        as varchar(500),
    @pextra8        as varchar(500),
    @pextra9        as varchar(500),
    @pextra10       as varchar(500)

)
as
SET CONCAT_NULL_YIELDS_NULL OFF
--CREATE TABLE #CIR_TEMP_DT
--(
--  SQNO  NUMeric,
--  DT    DATEtime
--)
declare @vsupdate  as  datetime;
declare @vsupdate1  as datetime;
declare @vvar    as varchar(max);
declare @vvar_sum   as  varchar(max);
declare @vvar_sum1  as  varchar(max);
declare @v_query  as  varchar(max);
declare @v_query1  as  varchar(max);

set @vsupdate =@pfrom_supdate
set @vsupdate1=@ptill_supdate

if @pextra2 = '2' begin
declare cur_edtn cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(p.edition_nick,1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,0 sup_rate,p.main_edtn main_edtn
    from cir_route_mast m,cir_supply d ,cir_edtn_mast p ,cir_supply_type_mast k
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and m.unit=d.unit and
    d.comp_code=k.comp_code  and d.supply_type_code=k.sup_ty_code and 
    m.unit=p.unit_code and d.unit = @punitcode and
    --d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
    m.route_code=d.route_code and (m.route_code=@proute or @proute is null)
    and d.publ=isnull(@ppublcode,d.publ) and
    d.publ=p.publ and d.edtn=p.edtn and k.bill_pay='Y'
    order by publ,main_edtn,edtn_seqno,edtn,sup_rate
    
 end
	else
	begin
	declare cur_edtn cursor for
	 select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(p.edition_nick,1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,d.sup_rate sup_rate,p.main_edtn main_edtn
    from cir_route_mast m,cir_dbksup d ,cir_edtn_mast p ,cir_supply_type_mast k
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and m.unit=d.unit_code and
    d.comp_code=k.comp_code  and d.sup_type_code=k.sup_ty_code and 
    m.unit=p.unit_code and d.unit_code = @punitcode and
    d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
    m.route_code=d.route_code and (m.route_code=@proute or @proute is null)
    and d.publ=isnull(@ppublcode,d.publ) and
    d.publ=p.publ and d.edtn=p.edtn and k.bill_pay='Y'
    order by publ,main_edtn,edtn_seqno,edtn,sup_rate
	end   
print('a')
-- cursor variable for cur_edtn
declare @rec_edtn_publ as varchar(200)
declare @rec_edtn_edtn as varchar(200)
declare @rec_edtn_edtn_seqno as numeric(5)
declare @rec_edtn_edtn_name as varchar(500)
declare @rec_edtn_sup_rate as numeric(14,2)
declare @rec_edtn_main_edtn as varchar(200)
-- end here --

if @pextra2 = '2' begin
OPEN cur_edtn 
    fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then base_supply else 0 end) "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then base_supply else 0 end) "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_edtn_name+'"';
            end
                
                
		fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
	END     
	close cur_edtn
	DEALLOCATE cur_edtn
end
else
begin
	OPEN cur_edtn 
    fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_edtn_name+'") "'+@rec_edtn_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_edtn_name+'"';
            end
                
                
		fetch NEXT FROM cur_edtn INTO @rec_edtn_publ , @rec_edtn_edtn,@rec_edtn_edtn_seqno,@rec_edtn_edtn_name,@rec_edtn_sup_rate,@rec_edtn_main_edtn
	END     
	close cur_edtn
	DEALLOCATE cur_edtn
end

if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end
print(@vvar)
 
 if @pextra2 = '2' begin
	 if @vvar is null or @vvar ='' begin
		set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name from(select d.comp_code,d.unit as unit_code,d.route_code,
				case '''+@plangtype+''' when ''1'' then substring(m.route_name,1,25)
				else substring(m.route_name_oth_lang,1,25) end route_name 
				from cir_supply d,cir_route_mast m ,cir_supply_type_mast k
				where d.comp_code = m.comp_code and d.unit = m.unit 
				and d.comp_code=k.comp_code  and d.supply_type_code=k.sup_ty_code and d.comp_code = '+''''+@pcompcode+''''+' and
				d.unit = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
				d.route_code = m.route_code  
				/* and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+'  */
				and k.bill_pay=''Y'' 
				--and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
				group by d.comp_code,d.unit,d.route_code,m.route_name) x
				group by x.comp_code,x.unit_code,x.route_code,x.route_name
				order by x.comp_code,x.unit_code,x.route_code,x.route_name';
	end
	else
	begin        
		set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name,'+@vvar_sum+','+@vvar_sum1+' from(
		select d.comp_code,d.unit as unit_code,d.route_code route_code,
				case '''+@plangtype+''' when ''1'' then substring(m.route_name,1,25) 
				else substring(m.route_name_oth_lang,1,25) end route_name
				,'+@vvar+' from cir_supply d,cir_route_mast m,cir_supply_type_mast k
				where d.comp_code = m.comp_code and d.unit = m.unit 
				and d.comp_code=k.comp_code  and d.supply_type_code=k.sup_ty_code  and d.comp_code = '+''''+@pcompcode+''''+' and
				d.unit = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
				d.route_code = m.route_code  
				/* and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' */
				and k.bill_pay=''Y'' 
				--and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
				group by d.comp_code,d.unit,m.route_name,d.route_code) x
				group by x.comp_code,x.unit_code,x.route_code,x.route_name
				order by x.comp_code,x.unit_code,x.route_code,x.route_name';       
	end
end
else
begin
if @vvar is null or @vvar ='' begin
		set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name from(select d.comp_code,d.unit_code,d.route_code,
				case '''+@plangtype+''' when ''1'' then substring(m.route_name,1,25)
				else substring(m.route_name_oth_lang,1,25) end route_name 
				from cir_dbksup d,cir_route_mast m ,cir_supply_type_mast k
				where d.comp_code = m.comp_code and d.unit_code = m.unit 
				and d.comp_code=k.comp_code  and d.sup_type_code=k.sup_ty_code and d.comp_code = '+''''+@pcompcode+''''+' and
				d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
				d.route_code = m.route_code  and 
				d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
				and k.bill_pay=''Y'' 
				and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
				group by d.comp_code,d.unit_code,d.route_code,m.route_name) x
				group by x.comp_code,x.unit_code,x.route_code,x.route_name
				order by x.comp_code,x.unit_code,x.route_code,x.route_name';
	end
	else
	begin        
		set @v_query='select x.comp_code,x.unit_code,x.route_code,x.route_name,'+@vvar_sum+','+@vvar_sum1+' from(select d.comp_code,d.unit_code,d.route_code route_code,
				case '''+@plangtype+''' when ''1'' then substring(m.route_name,1,25) 
				else substring(m.route_name_oth_lang,1,25) end route_name
				,'+@vvar+' from cir_dbksup d,cir_route_mast m,cir_supply_type_mast k
				where d.comp_code = m.comp_code and d.unit_code = m.unit 
				and d.comp_code=k.comp_code  and d.sup_type_code=k.sup_ty_code  and d.comp_code = '+''''+@pcompcode+''''+' and
				d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and
				d.route_code = m.route_code  and
				d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
				and k.bill_pay=''Y'' 
				and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
				group by d.comp_code,d.unit_code,m.route_name,d.route_code) x
				group by x.comp_code,x.unit_code,x.route_code,x.route_name
				order by x.comp_code,x.unit_code,x.route_code,x.route_name';       
	end
end



print(@v_query)
exec(@v_query)  
print('q')
-- for free supply
    set @vvar=null
    set @vvar_sum=null
    set @vvar_sum1=null

if @pextra2 = '2' begin  
	declare cur_edtn_free cursor for
		select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
		case @plangtype when '1' then substring(p.edition_nick,1,15)
		else substring(p.edtn_name_oth_lang,1,20) end edtn_name
		,0 sup_rate,p.main_edtn main_edtn
		from cir_supply_type_mast m,cir_supply d ,cir_edtn_mast p 
		where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and 
		  d.comp_code=m.comp_code  and d.supply_type_code=m.sup_ty_code and 
		  d.unit=p.unit_code and d.unit = @punitcode and
		  --d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
		  d.publ=isnull(@ppublcode,d.publ) and
		  d.publ=p.publ and d.edtn=p.edtn and m.bill_pay='N'
		  order by publ,main_edtn,edtn_seqno,edtn,sup_rate
end
else
begin
	declare cur_edtn_free cursor for
		select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
		case @plangtype when '1' then substring(p.edition_nick,1,15)
		else substring(p.edtn_name_oth_lang,1,20) end edtn_name
		,d.sup_rate sup_rate,p.main_edtn main_edtn
		from cir_supply_type_mast m,cir_dbksup d ,cir_edtn_mast p 
		where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and 
		  d.comp_code=m.comp_code  and d.sup_type_code=m.sup_ty_code and 
		  d.unit_code=p.unit_code and d.unit_code = @punitcode and
		  d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
		  d.publ=isnull(@ppublcode,d.publ) and
		  d.publ=p.publ and d.edtn=p.edtn and m.bill_pay='N'
		  order by publ,main_edtn,edtn_seqno,edtn,sup_rate
end
-- cursor variable for cur_edtn_free
declare @rec_edtn_free_publ as varchar(200)
declare @rec_edtn_free_edtn as varchar(200)
declare @rec_edtn_free_edtn_seqno as numeric(5)
declare @rec_edtn_free_edtn_name as varchar(500)
declare @rec_edtn_free_sup_rate as numeric(14,2)
declare @rec_edtn_free_main_edtn as varchar(200)
-- end here --

if @pextra2 = '2' begin  
	OPEN cur_edtn_free 
		fetch NEXT FROM cur_edtn_free INTO @rec_edtn_free_publ , @rec_edtn_free_edtn,@rec_edtn_free_edtn_seqno,@rec_edtn_free_edtn_name,@rec_edtn_free_sup_rate,@rec_edtn_free_main_edtn
			WHILE (@@FETCH_STATUS = 0) 
			BEGIN
				if (@vvar is null or @vvar = '') begin 
					set @vvar        ='sum(case edtn when '+''''+@rec_edtn_free_edtn+''''+' then base_supply else 0 end) "'+@rec_edtn_free_edtn_name+'"';
					set @vvar_sum    ='sum('+'"'+@rec_edtn_free_edtn_name+'") "'+@rec_edtn_free_edtn_name+'"';
					set @vvar_sum1   ='sum('+'"'+@rec_edtn_free_edtn_name+'"';
				end
				else
				begin
					set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_free_edtn+''''+' then base_supply else 0 end) "'+@rec_edtn_free_edtn_name+'"';
					set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_free_edtn_name+'") "'+@rec_edtn_free_edtn_name+'"';
					set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_free_edtn_name+'"';
				end
	                
	                
		fetch NEXT FROM cur_edtn_free INTO @rec_edtn_free_publ , @rec_edtn_free_edtn,@rec_edtn_free_edtn_seqno,@rec_edtn_free_edtn_name,@rec_edtn_free_sup_rate,@rec_edtn_free_main_edtn
	END     
	close cur_edtn_free
	DEALLOCATE cur_edtn_free
end
else
begin
	OPEN cur_edtn_free 
		fetch NEXT FROM cur_edtn_free INTO @rec_edtn_free_publ , @rec_edtn_free_edtn,@rec_edtn_free_edtn_seqno,@rec_edtn_free_edtn_name,@rec_edtn_free_sup_rate,@rec_edtn_free_main_edtn
			WHILE (@@FETCH_STATUS = 0) 
			BEGIN
				if (@vvar is null or @vvar = '') begin 
					set @vvar        ='sum(case edtn when '+''''+@rec_edtn_free_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_free_edtn_name+'"';
					set @vvar_sum    ='sum('+'"'+@rec_edtn_free_edtn_name+'") "'+@rec_edtn_free_edtn_name+'"';
					set @vvar_sum1   ='sum('+'"'+@rec_edtn_free_edtn_name+'"';
				end
				else
				begin
					set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_free_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_free_edtn_name+'"';
					set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_free_edtn_name+'") "'+@rec_edtn_free_edtn_name+'"';
					set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_free_edtn_name+'"';
				end
	                
	                
		fetch NEXT FROM cur_edtn_free INTO @rec_edtn_free_publ , @rec_edtn_free_edtn,@rec_edtn_free_edtn_seqno,@rec_edtn_free_edtn_name,@rec_edtn_free_sup_rate,@rec_edtn_free_main_edtn
	END     
	close cur_edtn_free
	DEALLOCATE cur_edtn_free

end

if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end


if @pextra2 = '2' begin  
        if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,d.unit as unit_code,m.sup_ty_code,
            substring(m.sup_ty_name,1,25) supply_name
            from cir_supply d,cir_supply_type_mast m
            where d.comp_code = m.comp_code 
            and d.supply_type_code=m.sup_ty_code
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ)             
            /* and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' */
            and m.bill_pay=''N'' 
            --and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
            group by d.comp_code,d.unit,m.sup_ty_code,m.sup_ty_name) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit as unit_code,m.sup_ty_code sup_ty_code,
            substring(m.sup_ty_name,1,25) supply_name
            ,'+@vvar+' from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code
             and d.supply_type_code=m.sup_ty_code 
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ)             
             --and d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
             and m.bill_pay=''N'' ---and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' = '''')
            group by d.comp_code,d.unit_,m.sup_ty_code,m.sup_ty_name) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
end
else
begin
	if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,d.unit_code,m.sup_ty_code,
            substring(m.sup_ty_name,1,25) supply_name
            from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code 
            and d.sup_type_code=m.sup_ty_code
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            and m.bill_pay=''N'' 
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
            group by d.comp_code,d.unit_code,m.sup_ty_code,m.sup_ty_name) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit_code,m.sup_ty_code sup_ty_code,
            substring(m.sup_ty_name,1,25) supply_name
            ,'+@vvar+' from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code
             and d.sup_type_code=m.sup_ty_code 
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
             d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
             and m.bill_pay=''N'' and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' = '''')
            group by d.comp_code,d.unit_code,m.sup_ty_code,m.sup_ty_name) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
end
print(@v_query1)
exec(@v_query1)




 set @vvar=null
    set @vvar_sum=null
    set @vvar_sum1=null


-------------------for edition total

if @pextra2 = '2' begin  
declare cur_edtn_total cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(p.edition_nick,1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,0 sup_rate,p.main_edtn main_edtn
    from cir_supply_type_mast m,cir_supply d ,cir_edtn_mast p 
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and 
      d.comp_code=m.comp_code  and d.supply_type_code=m.sup_ty_code and 
      d.unit=p.unit_code and d.unit = @punitcode and      
      d.publ=isnull(@ppublcode,d.publ) and
      d.publ=p.publ and d.edtn=p.edtn 
      order by publ,main_edtn,edtn_seqno,edtn,sup_rate
end
else
begin  
declare cur_edtn_total cursor for
    select distinct d.publ publ,d.edtn edtn,p.edtn_seq_no edtn_seqno,
    case @plangtype when '1' then substring(p.edition_nick,1,15)
    else substring(p.edtn_name_oth_lang,1,20) end edtn_name
    ,d.sup_rate sup_rate,p.main_edtn main_edtn
    from cir_supply_type_mast m,cir_dbksup d ,cir_edtn_mast p 
    where m.comp_code=@pcompcode and m.comp_code=d.comp_code and d.comp_code=p.comp_code and 
      d.comp_code=m.comp_code  and d.sup_type_code=m.sup_ty_code and 
      d.unit_code=p.unit_code and d.unit_code = @punitcode and
      d.supdate >= @vsupdate and d.supdate <=@vsupdate1 and
      d.publ=isnull(@ppublcode,d.publ) and
      d.publ=p.publ and d.edtn=p.edtn 
      order by publ,main_edtn,edtn_seqno,edtn,sup_rate
end 
-- cursor variable for cur_edtn_free
declare @rec_edtn_total_publ as varchar(200)
declare @rec_edtn_total_edtn as varchar(200)
declare @rec_edtn_total_edtn_seqno as numeric(5)
declare @rec_edtn_total_edtn_name as varchar(500)
declare @rec_edtn_total_sup_rate as numeric(14,2)
declare @rec_edtn_total_main_edtn as varchar(200)
-- end here --
if @pextra2 = '2' begin  
OPEN cur_edtn_total 
    fetch NEXT FROM cur_edtn_total INTO @rec_edtn_total_publ , @rec_edtn_total_edtn,@rec_edtn_total_edtn_seqno,@rec_edtn_total_edtn_name,@rec_edtn_total_sup_rate,@rec_edtn_total_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_total_edtn+''''+' then base_supply else 0 end) "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_total_edtn_name+'") "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_total_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_total_edtn+''''+' then base_supply else 0 end) "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_total_edtn_name+'") "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_total_edtn_name+'"';
            end
                
                
    fetch NEXT FROM cur_edtn_total INTO @rec_edtn_total_publ , @rec_edtn_total_edtn,@rec_edtn_total_edtn_seqno,@rec_edtn_total_edtn_name,@rec_edtn_total_sup_rate,@rec_edtn_total_main_edtn
END     
close cur_edtn_total
DEALLOCATE cur_edtn_total
end
else
begin
OPEN cur_edtn_total 
    fetch NEXT FROM cur_edtn_total INTO @rec_edtn_total_publ , @rec_edtn_total_edtn,@rec_edtn_total_edtn_seqno,@rec_edtn_total_edtn_name,@rec_edtn_total_sup_rate,@rec_edtn_total_main_edtn
        WHILE (@@FETCH_STATUS = 0) 
        BEGIN
            if (@vvar is null or @vvar = '') begin 
                set @vvar        ='sum(case edtn when '+''''+@rec_edtn_total_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum    ='sum('+'"'+@rec_edtn_total_edtn_name+'") "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum1   ='sum('+'"'+@rec_edtn_total_edtn_name+'"';
            end
            else
            begin
                set @vvar        =@vvar+','+'sum(case edtn when '+''''+@rec_edtn_total_edtn+''''+' then sup_copy else 0 end) "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum    =@vvar_sum+','+'sum('+'"'+@rec_edtn_total_edtn_name+'") "'+@rec_edtn_total_edtn_name+'"';
                set @vvar_sum1   =@vvar_sum1+'+"'+@rec_edtn_total_edtn_name+'"';
            end
                
                
    fetch NEXT FROM cur_edtn_total INTO @rec_edtn_total_publ , @rec_edtn_total_edtn,@rec_edtn_total_edtn_seqno,@rec_edtn_total_edtn_name,@rec_edtn_total_sup_rate,@rec_edtn_total_main_edtn
END     
close cur_edtn_total
DEALLOCATE cur_edtn_total
end
if @vvar_sum1 is not null or @vvar_sum1 !='' begin
    set @vvar_sum1=@vvar_sum1+') "Total"'
end

if @pextra2 = '2' begin  
        if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from
            (select d.comp_code,d.unit as unit_code,null as sup_ty_code, null as supply_name
            from cir_supply d
            where d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
            group by d.comp_code,d.unit) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit as unit_code   ,null as sup_ty_code, null as supply_name
            ,'+@vvar+' from cir_supply d,cir_supply_type_mast m
            where d.comp_code = m.comp_code
             and d.supply_type_code=m.sup_ty_code 
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ)  
            group by d.comp_code,d.unit) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
 end
else
begin
if @vvar is null or @vvar ='' begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name from(select d.comp_code,unit_code,null as sup_ty_code, null as supply_name
            from cir_dbksup d
            where d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
            d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <='+''''+cast(@vsupdate1 as varchar)+''''+' 
            
            and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' ='''')
            group by d.comp_code,d.unit_code) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
        else
        begin
            set @v_query1='select x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name,'+@vvar_sum+','+@vvar_sum1+' from
            (select d.comp_code,d.unit_code   ,null as sup_ty_code, null as supply_name
            ,'+@vvar+' from cir_dbksup d,cir_supply_type_mast m
            where d.comp_code = m.comp_code
             and d.sup_type_code=m.sup_ty_code 
            and d.comp_code = '+''''+@pcompcode+''''+' and
            d.unit_code = '+''''+@punitcode+''''+' and d.publ = isnull('+''''+@ppublcode+''''+',d.publ) and            
             d.supdate >= '+''''+cast(@vsupdate as varchar)+''''+' and d.supdate <= '+''''+cast(@vsupdate1 as varchar)+''''+' 
              and (d.final_supply_flag='+''''+@pextra3+''''+' or '+''''+@pextra3+''''+' = '''')
            group by d.comp_code,d.unit_code) x
            group by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name
            order by x.comp_code,x.unit_code,x.sup_ty_code,x.supply_name';
        end
end
print(@v_query1)
exec(@v_query1)



SET CONCAT_NULL_YIELDS_NULL On



/////////////////////////////////


ALTER PROCEDURE [dbo].[cir_rep_supply_cir_route_supply_variance_p]
	@pcomp_code                               VARCHAR(20) ,
	@punit_code                               VARCHAR(20) ,
	@ppublication                             VARCHAR(20) ,
	@pmainedtn                                VARCHAR(20) ,
	@pedtn                                    VARCHAR(20) ,
	@proute                                   VARCHAR(20) ,
	@pfirstdate                               VARCHAR(20) ,
	@pseconddate                              VARCHAR(20) ,
	@pdateformat                              VARCHAR(20) ,
	@pextra1                                  VARCHAR(200),--it is use for finalised or unfinalised
	@pextra2                                  VARCHAR(200),--it is used for supply type 
	@pextra3             as varchar(200),--agency type
	@pextra4             as varchar(200),-- agency class
	@pextra5             as varchar(200),--final.unfinal
	@pextra6             as varchar(200),
	@pextra7             as varchar(200),
	@pextra8             as varchar(200),
	@pextra9             as varchar(200),
	@pextra10            as varchar(200)
AS 

	DECLARE @vfirstdate                               DATETIME 
	DECLARE @vseconddate                              DATETIME 
Begin		
	SET @vfirstdate  =  dbo.convert_user_date('/',@pfirstdate,@pdateformat)
	SET @vseconddate  = dbo.convert_user_date('/',@pseconddate,@pdateformat)
	print(@vfirstdate)
	print(@vseconddate)

declare @vbase_supply as int
declare @vmon_supply as int
declare @vtue_supply as int
declare @vwed_supply as int
declare @vthu_supply as int
declare @vfri_supply as int
declare @vsat_supply as int
declare @vsun_supply as int
declare @day as varchar(3)
 set @day=upper(datename(dw,@vseconddate))
print(@day)

	If upper(@pextra1)='U' Begin
	

         select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
         dbo.cir_get_city(x.comp_code,x.city_code) "CITY NAME",
         x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",

		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",

		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                 (select isnull(sum(base_supply),0) 
                 from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           --(a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and                           
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                           order by comp_code,route_code,ag_name
		End
        else	Begin
				select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
				x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "INCREASE SUPPLY",

				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "DECREASE SUPPLY",

				CASE SUM(x.first_sup) WHEN 0 THEN 100 
				ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
				END "PERCENT_VARIANCE",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd      =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code=   b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn      =   a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and 
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup                            
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
								   and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
								   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
								   )x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,
									x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                                   order by comp_code,route_code,ag_name
        End
        
        If upper(@pextra1)='U' Begin
				---route wise total
        select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='' ) and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null  or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null  or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                            --(a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           (a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.route_code,x.route_name,x.route_name_oth_lang
                           order by comp_code,route_code
		End
        else	Begin
				----route wise total
                 select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "INCREASE SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "DECREASE SUPPLY",
				CASE SUM(x.first_sup) WHEN 0 THEN 100 
				ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
				END "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code=     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =      a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
										(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
									and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                   ) x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.route_code,x.route_name,x.route_name_oth_lang
                                   order by comp_code,route_code
        End
        
        If upper(@pextra1)='U' Begin
				----comp wise total
        select x.comp_code "COMP CODE",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE",
		(select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
        d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
        (m.dist_code = @proute or @proute is null or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
        where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
        (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
		(select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
          (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code		 = @pcomp_code and unit_code =    @punit_code and
                                 publ			 = @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           --(a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           (a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
							and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code
                           order by comp_code
			End
        else	Begin
        ----comp wise total
                     select x.comp_code "COMP CODE",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
					CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
					ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
					END "INCREASE SUPPLY",

					CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
					ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
					END "DECREASE SUPPLY",

					CASE SUM(x.first_sup) WHEN 0 THEN 100 
					ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
					END "PERCENT_VARIANCE",
                     (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
                            d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn='') and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                            (m.dist_code = @proute or @proute is null  or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                            (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                             publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                             supdate                  =   @vfirstdate and cir_dbksup.comp_code =    b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                             (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                                  (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                             publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                             supdate      = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                       and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
										and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                       and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                       )x
                                 where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code
        End
		 
End


/*	select @vbase_supply=isnull(sum(base_supply),0) from cir_supply,cir_dbksup a,cir_route_mast b
                           where cir_supply.comp_code     =   @pcomp_code and cir_supply.unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (cir_supply.edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')
	case @day
					when 'MON' then isnull(sum(distinct SUPPLY_MON),0) + @vbase_supply
					when 'TUE' then isnull(sum(distinct SUPPLY_TUE),0) + @vbase_supply
					when 'WED' then isnull(sum(distinct SUPPLY_WED),0) + @vbase_supply
					when 'THU' then isnull(sum(distinct SUPPLY_THU),0) + @vbase_supply
					when 'FRI' then isnull(sum(distinct SUPPLY_FRI),0) + @vbase_supply
					when 'SAT' then isnull(sum(distinct SUPPLY_SAT+ @vbase_supply),0) 
					when 'SUN' then isnull(sum(distinct SUPPLY_SUN),0) + @vbase_supply
					else isnull(sum(base_supply),0) end
	*/
////////////////////////////////////////////////////////////end///////////////////////////////////////////////////////

////////////////////////////add by Deepika 11/02/2012 for issue no. 7045///////////////////////////////////////////

                                                                                                                                                                                                                                                          
ALTER procedure [dbo].[cir_rep_abc_supply_summ](
	@pcompcode			as  varchar(50),
	@punitcode          as  varchar(50),
	@pbrancode          as  varchar(50),
	@ppublcode          as  varchar(50),
	@pmedtncode         as  varchar(50),
	@pedtncode          as  varchar(50),
	@pagtype            as  varchar(50),
	@pagclass           as  varchar(50),   
	@pfromdate          as  datetime,
	@ptilldate          as  datetime,
	@preptype           as  varchar(50),--1 for pcentre wise branch wise report 2 for State wise city wise
	@pdateformat        as  varchar(50),
	@puserid			as  varchar(50),   
	@pextra1            as  varchar(50),
	@pextra2            as  varchar(50),
	@pextra3            as  varchar(50),
	@pextra4            as  varchar(50),
	@pextra5            as  varchar(50))

as 

declare @v_frdt as    datetime
declare @v_todt  as   datetime;


declare @v_comp_code     varchar(50);
declare @v_unit_code     varchar(50);
declare @v_publ          varchar(50);
declare @v_medtn         varchar(50);
declare @v_edtn          varchar(50);
declare @v_edtn_name     varchar(50);
declare @v_state_code    varchar(50);
declare @v_dist_code     varchar(50);
declare @v_tehsil_taluka varchar(50);
declare @v_city_code     varchar(50);
declare @v_city_name     varchar(50);
declare @v_zone_code     varchar(50);
declare @v_region_code   varchar(50);
declare @v_branch_code   varchar(50);
declare @v_sup_copy      int;
declare @v_supdate       datetime;
declare @v_bill_pay      varchar(20);

if @punitcode='' Begin
	set @punitcode=null
end	
if	@pbrancode='' Begin
	set @pbrancode=null
End
if @ppublcode='' Begin
	set @ppublcode=null
end	
if	@pmedtncode='' Begin
	set @pmedtncode=null
End
if @pedtncode='' Begin
	set @pedtncode=null
end	
if	@pedtncode='' Begin
	set @pedtncode=null
End
if @pagtype='' Begin
	set @pagtype=null
end	
if	@pagclass='' Begin
	set @pagclass=null
End


CREATE TABLE #CIR_LEDGER_REPORT
( COMP_CODE      VARCHAR(10),
  UNIT_CODE      VARCHAR(10),
  BRANCH_CODE    VARCHAR(10),
  DOCTYPE        VARCHAR(10),
  AGCD           VARCHAR(50),
  DPCD           VARCHAR(50),
  RECPTNO        VARCHAR(50),
  RECPTDT        DATETIME,
  AMOUNT         numeric(14,2),
  CHQNO          VARCHAR(50),
  CHQDT          DATETIME,
  CHQ_BANK       VARCHAR(100),
  EXEC_CODE      VARCHAR(20),
  REMARKS        VARCHAR(500),
  REASON         VARCHAR(30),
  BILLNO         VARCHAR(50),
  BILLDT         DATETIME,
  BILLAMT        numeric(14,2),
  ADJAMT         numeric(14,2),
  LEFTAMT        numeric(14,2),
  DEBIT_HEAD     VARCHAR(200 ),
  CREDIT_HEAD    VARCHAR(200),
  REC_SEQNO      numeric(10),
  RECOVARY_DAYS  numeric(5),
  AGNAME         VARCHAR(500),
  OPBAL_SEC      numeric(14,2),
  SESS_ID        numeric(10) ,                    
  NARR_LINE      numeric(3),
  CITY_CODE      VARCHAR(10)
)


declare cur_data cursor for
 select x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.state_name, 
        x.dist_code,x.tehsil_taluka,x.city_code,x.city_name,x.zone_code,x.region_code,x.branch_code,
        x.bill_pay,x.supdate, sum(x.sup_copy) sup_copy
        from(
        select b.comp_code,b.unit_code,b.publ,e.main_edtn,b.edtn,e.edtn_name,dbo.cir_get_state(b.comp_code,m.country_code,m.state_code) state_name, 
        m.dist_code,m.tehsil_taluka,m.city_code,c.city_name,c.zone_code,c.region_code,m.branch_code,
        b.supdate ,case when isnull(s.bill_pay,'N')='Y' then 'BILLED' else 'UNBILLED' END bill_pay, 
        sum(b.sup_copy) sup_copy
        from cir_dbksup b,cir_agmast m,cir_edtn_mast e ,cir_city_mast c,cir_supply_type_mast s
        where b.comp_code=@pcompcode and b.comp_code=m.comp_code and b.comp_code=e.comp_code and b.comp_code=c.comp_code and b.comp_code=s.comp_code and
        b.unit_code=isnull(@punitcode,b.unit_code) and b.unit_code=m.unit 
        and b.agcd=m.agcd and b.dpcd=m.dpcd 
        and b.publ=e.publ and b.publ=isnull(@ppublcode,b.publ) 
        and b.edtn=e.edtn and b.edtn=isnull(@pedtncode,b.edtn) 
        and b.supdate between @pfromdate and @ptilldate
        and b.sup_type_code=s.sup_ty_code and  
        e.main_edtn=isnull(@pmedtncode,e.main_edtn) 
        and (m.ag_type=@pagtype or @pagtype is null) 
        and (m.ag_class=@pagclass or @pagclass is null) 
        and (m.branch_code=@pbrancode or @pbrancode is null) 
        and m.city_code=c.city_code
        group by b.comp_code,b.unit_code,b.publ,e.main_edtn,b.edtn,m.state_code,m.country_code,m.dist_code,m.tehsil_taluka,
        e.edtn_name,b.edtn,b.supdate ,isnull(s.bill_pay,'N'),
        m.city_code,c.city_name,c.zone_code,c.region_code,m.branch_code) x
        group by x.comp_code,x.unit_code,x.publ,x.main_edtn,x.edtn,x.edtn_name,x.state_name, 
        x.dist_code,x.tehsil_taluka,x.city_code,x.city_name,x.zone_code,x.region_code,x.branch_code,
        x.bill_pay,supdate;

begin

--set @v_frdt   =@pfromdate
--set @v_todt   =@ptilldate

open cur_data

fetch next from  cur_data INTO  @v_comp_code,@v_unit_code,@v_publ,@v_medtn,@v_edtn,@v_edtn_name,@v_state_code,@v_dist_code,@v_tehsil_taluka,@v_city_code,
            @v_city_name,@v_zone_code,@v_region_code,@v_branch_code, 
            @v_bill_pay,@v_supdate,@v_sup_copy


	WHILE (@@FETCH_STATUS = 0) BEGIN      
        
				insert into #cir_ledger_report
				(comp_code, unit_code, branch_code, doctype,agcd, dpcd,billno, recptno, debit_head,chqno,chq_bank, exec_code, remarks,  
				reason,rec_seqno,billdt)
				values(@v_comp_code,@v_unit_code,@v_branch_code,@v_publ,@v_medtn,@v_edtn,@v_edtn_name,@v_state_code,@v_dist_code,@v_tehsil_taluka,@v_zone_code,@v_region_code,@v_city_name,
				@v_bill_pay,@v_sup_copy, @v_supdate);



				fetch NEXT FROM cur_data INTO @v_comp_code,@v_unit_code,@v_publ,@v_medtn,@v_edtn,@v_edtn_name,@v_state_code,@v_dist_code,@v_tehsil_taluka,@v_city_code,
				@v_city_name,@v_zone_code,@v_region_code,@v_branch_code, 
				@v_bill_pay,@v_supdate,@v_sup_copy

	End
	close cur_data
	deallocate cur_data

	if (@preptype='1' ) begin--for Pcenter wise
            
            select a.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=a.comp_code) as "COMP_NAME",
            a.unit_code as "UNIT_CODE",(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=a.unit_code) as "UNIT_NAME", 
            a.branch_code as "BRANCH_CODE",(select "Branch_Name" from branch_mst where "Branch_Code"=a.branch_code) as "BRANCH_NAME", 
            sum(a.rec_seqno) as "SUP_COPY",a.reason as "BILL_PAY"
            from #cir_ledger_report a           
            group by a.comp_code ,a.unit_code, a.branch_code,a.reason
            order by comp_name,bill_pay,unit_name,branch_name;
            
            select a.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=a.comp_code) as "COMP_NAME",
            a.unit_code as "UNIT_CODE",(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=a.unit_code) as "UNIT_NAME", 
            sum(a.rec_seqno) as "SUP_COPY",a.reason as "BILL_PAY"
            from #cir_ledger_report a          
            group by a.comp_code ,a.unit_code, a.reason
            order by comp_name,bill_pay,unit_name;

            
            select a.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=a.comp_code) as "COMP_NAME",
            sum(a.rec_seqno) as "SUP_COPY",a.reason as "BILL_PAY"
            from #cir_ledger_report a          
            group by a.comp_code ,a.reason
            order by comp_name,bill_pay;
	end

	else begin

            select a.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=a.comp_code) as "COMP_NAME",
            a.recptno as "STATE_NAME", a.city_code as "CITY_CODE", a.remarks as "CITY_NAME",   
            sum(a.rec_seqno) as "SUP_COPY",a.reason as "BILL_PAY"
            from #cir_ledger_report a             
            group by a.comp_code ,a.recptno,a.city_code,a.remarks,a.reason
            order by comp_name,bill_pay,state_name,city_name         

            select a.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=a.comp_code) as "COMP_NAME",
            a.recptno as "STATE_NAME",sum(a.rec_seqno) as "SUP_COPY",a.reason as "BILL_PAY"
            from #cir_ledger_report a      
            group by a.comp_code ,a.recptno,a.reason
            order by comp_name,bill_pay,state_name


            select a.comp_code as "COMP_CODE",(select "Comp_Name" from comp_mst where "Comp_Code"=a.comp_code) as "COMP_NAME",
            sum(a.rec_seqno) as "SUP_COPY",a.reason as "BILL_PAY"
            from #cir_ledger_report a            
            group by a.comp_code , a.reason
            order by comp_name,bill_pay

	end
 
    delete from #cir_ledger_report

end

//////////////////////////////






ALTER procedure [dbo].[cir_citywise_supply](
@pcomp_code        as varchar(50),
@punit_code       as varchar(50),
@pbrancode         as varchar(50),
@ppublcode        as varchar(50),
@pagtype          as varchar(50),
@pstatecode        as varchar(50),
@pcitycode         as varchar(50),
@pfrom_supdate     as varchar(50),
@ptill_supdate     as varchar(50),
@pdateformat       as varchar(50),
@pextra1           as varchar(50),
@pextra2            as varchar(50)

)
as
SET CONCAT_NULL_YIELDS_NULL OFF
CREATE TABLE #CIR_TEMP_DT
(
  SQNO  NUMeric,
  DT    DATEtime
)

declare @vfrdt  as  datetime;
declare @vtodt  as datetime;
declare @v_dt   as  datetime;
declare @v_cnt   as numeric(5)
declare @vvar    as varchar(4000);
declare @vvar_sum   as  varchar(4000);
declare @vvar_sum1  as  varchar(4000);
declare @v_query  as  varchar(max);
declare @v_query1  as  varchar(max);

set @v_cnt=0;

set @vfrdt=dbo.GetLastDayOfMonth (@pfrom_supdate)  --@pfrom_supdate;
set @vtodt=dbo.GetFirstDayOfMonth (@ptill_supdate) --@ptill_supdate;


print('abcd')
print(@v_dt)


if @v_dt is null or @v_dt = '' 
begin
print('abc')
set @v_dt=@vfrdt
end
print('@vfrdt')print(@vfrdt)
WHILE (@v_dt < @vtodt)
BEGIN
	if @v_dt>=@vtodt begin
       break;
    end
	print('@v_dt') print(@v_dt)
	if @v_dt is null or @v_dt = '' begin
	--if @v_dt=@vfrdt begin
		set @v_dt=dbo.GetLastDayOfMonth (@vfrdt);
		print('@v_dt1') print(@v_dt)
	end
	else
	begin
	print('@v_dt2')
		set @v_dt=DATEADD(mm,1,@v_dt)
		print(@v_dt)
	end
	set @v_cnt=@v_cnt+1
	print(@v_cnt)
	insert into #cir_temp_dt(sqno,dt) values(@v_cnt,@v_dt);
END
print('x')

declare c1 cursor for
select sqno,dt from #cir_temp_dt order by sqno,dt;

declare @c1_sqno as numeric
declare @c1_dt as datetime



OPEN c1 
	fetch NEXT FROM c1 INTO @c1_sqno , @v_dt
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN
		print('1')
			set @v_cnt= @v_cnt+1 
			if (@vvar is null or @vvar = '') begin print('2')
				--set @vvar        ='sum(decode(last_day(b.billdt),'+''''+@v_dt+''''+',b.bill_copy,0))"'+to_char(v_dt,'Mon/YYYY')+'"';
				set @vvar        ='sum(case(dbo.GetLastDayOfMonth(b.billdt)) when '+''''+cast(@v_dt as varchar)+''''+' then b.bill_copy else 0 end) "'+SUBSTRING(CONVERT(VARCHAR(11), @v_dt, 113), 4, 8)+'"';
				print('3')--set @vvar_sum    ='sum('+'"'+to_char(v_dt,'Mon/YYYY')+'") "'+to_char(v_dt,'Mon/YYYY')+'"';
				set @vvar_sum    ='sum(d.'+'"'+SUBSTRING(CONVERT(VARCHAR(11), @v_dt, 113), 4, 8)+'") "'+SUBSTRING(CONVERT(VARCHAR(11), @v_dt, 113), 4, 8)+'"';
				set @vvar_sum1   ='sum(d.'+'"'+SUBSTRING(CONVERT(VARCHAR(11), @v_dt, 113), 4, 8)+'"';
			end
			else
			begin
				--set @vvar        =@vvar+','+'sum(decode(last_day(b.billdt),'+''''+v_dt+''''+',b.bill_copy,0))"'+SUBSTRING(CONVERT(VARCHAR(11), @v_dt, 113), 4, 8)+'"';
				set @vvar        =@vvar+','+'sum(case(dbo.GetLastDayOfMonth(b.billdt)) when '+''''+cast(@v_dt as varchar)+''''+' then b.bill_copy else 0 end) "'+SUBSTRING(CONVERT(VARCHAR(11), @v_dt, 113), 4, 8)+'"';
				set @vvar_sum    =@vvar_sum+','+'sum(d.'+'"'+SUBSTRING(CONVERT(VARCHAR(11), @v_dt, 113), 4, 8)+'") "'+SUBSTRING(CONVERT(VARCHAR(11), @v_dt, 113), 4, 8)+'"';
				set @vvar_sum1   =@vvar_sum1+'+d."'+SUBSTRING(CONVERT(VARCHAR(11), @v_dt, 113), 4, 8)+'"';
			end
				
				
	fetch NEXT FROM c1 INTO @c1_sqno , @v_dt
END 	
close c1
DEALLOCATE c1
if @vvar_sum1 is not null or @vvar_sum1 !='' begin
            set @vvar_sum1=@vvar_sum1+') "Total"'
end
print('a')


if @vvar is not null and @vvar !='' begin

set  @v_query='select d.comp_code comp_code,d.unit_code unit_code,s."State_Name" state_name,dbo.cir_get_city(d.comp_code,d.city_code) city_name,'+@vvar_sum+','+@vvar_sum1+' from (select b.comp_code comp_code,b.unit_code unit_code,a.state_code state_code,
        a.city_code city_code,'+@vvar+' from cir_agmast a, cir_bill_det b
        where a.comp_code=b.comp_code and b.comp_code='+''''+@pcomp_code+''''+' and a.unit=b.unit_code 
and 
(b.unit_code='''+@punit_code+''' or  '''+@punit_code+''' is null or '''+@punit_code+''' ='''' )
 and 
        a.agcd=b.agcd and a.dpcd=b.dpcd 
and (a.branch_code='''+@pbrancode+''' or '''+@pbrancode+'''='''' or  '''+@pbrancode+''' is null) 

and (a.ag_type='''+@pagtype+''' or '''+@pagtype+'''='''' or  '''+@pagtype+''' is null ) 
and (b.publ ='''+@ppublcode+'''  or '''+@ppublcode+'''='''' or  '''+@ppublcode+''' is null) 
and (a.state_code='''+@pstatecode+'''   or '''+@pstatecode+'''='''' or  '''+@pstatecode+''' is null) 
and (a.city_code='''+@pcitycode+'''  or '''+@pcitycode+'''='''' or  '''+@pcitycode+''' is null)

 and
        b.billdt between '+''''+cast(@vfrdt as varchar)+''''+' and '+''''+cast(@vtodt as varchar)+''''+' group by b.comp_code,b.unit_code,b.billdt,a.city_code,a.state_code) d,state_mst s
        where d.state_code=s."State_Code" 
        group by d.comp_code,d.unit_code,s."State_Name",d.city_code order by comp_code,unit_code,state_name,city_name';
        --insert into test1(vstring,vstring2) values('cir_citywise_supply ',v_query);commit;
      
print(@v_query)
exec(@v_query)
        
		set      @v_query1='select d.comp_code comp_code,d.unit_code unit_code,s."State_Name" state_name,'+@vvar_sum+','+@vvar_sum1+' from (select b.comp_code comp_code,b.unit_code unit_code,a.state_code state_code,
		a.city_code city_code,'+@vvar+' from cir_agmast a, cir_bill_det b
		where a.comp_code=b.comp_code and b.comp_code='+''''+@pcomp_code+''''+' 
		and a.unit=b.unit_code 

and 
(b.unit_code='''+@punit_code+''' or  '''+@punit_code+''' is null or '''+@punit_code+''' ='''' )
 and 
        a.agcd=b.agcd and a.dpcd=b.dpcd 
and (a.branch_code='''+@pbrancode+''' or '''+@pbrancode+'''='''' or  '''+@pbrancode+''' is null) 

and (a.ag_type='''+@pagtype+''' or '''+@pagtype+'''='''' or  '''+@pagtype+''' is null ) 
and (b.publ ='''+@ppublcode+'''  or '''+@ppublcode+'''='''' or  '''+@ppublcode+''' is null) 
and (a.state_code='''+@pstatecode+'''   or '''+@pstatecode+'''='''' or  '''+@pstatecode+''' is null) 
and (a.city_code='''+@pcitycode+'''  or '''+@pcitycode+'''='''' or  '''+@pcitycode+''' is null)

 and


		 b.billdt between '+''''+cast(@vfrdt as varchar)+''''+' 
		and '+''''+cast(@vtodt as varchar)+''''+' 
		group by b.comp_code,b.unit_code,b.billdt,a.city_code,a.state_code) d,state_mst s
		where d.state_code=s."State_Code"
		group by d.comp_code,d.unit_code,s."State_Name" order by comp_code,unit_code,state_name';
        --insert into test1(vstring,vstring2) values('cir_citywise_supply ',v_query);commit;
        --open p_accounts1 for v_query;
print(@v_query1)
exec(@v_query1) 
end
else
begin
set  @v_query='select d.comp_code comp_code,d.unit_code unit_code,s."State_Name" state_name,dbo.cir_get_city(d.comp_code,d.city_code) city_name from (select b.comp_code comp_code,b.unit_code unit_code,a.state_code state_code,
        a.city_code city_code from cir_agmast a, cir_bill_det b
        where a.comp_code=b.comp_code and b.comp_code='+''''+@pcomp_code+''''+' and a.unit=b.unit_code 
and 
(b.unit_code='''+@punit_code+''' or  '''+@punit_code+''' is null or '''+@punit_code+''' ='''' )
 and 
        a.agcd=b.agcd and a.dpcd=b.dpcd 
and (a.branch_code='''+@pbrancode+''' or '''+@pbrancode+'''='''' or  '''+@pbrancode+''' is null) 

and (a.ag_type='''+@pagtype+''' or '''+@pagtype+'''='''' or  '''+@pagtype+''' is null ) 
and (b.publ ='''+@ppublcode+'''  or '''+@ppublcode+'''='''' or  '''+@ppublcode+''' is null) 
and (a.state_code='''+@pstatecode+'''   or '''+@pstatecode+'''='''' or  '''+@pstatecode+''' is null) 
and (a.city_code='''+@pcitycode+'''  or '''+@pcitycode+'''='''' or  '''+@pcitycode+''' is null)

 and
        b.billdt between '+''''+cast(@vfrdt as varchar)+''''+' and '+''''+cast(@vtodt as varchar)+''''+' group by b.comp_code,b.unit_code,b.billdt,a.city_code,a.state_code) d,state_mst s
        where d.state_code=s."State_Code" 
        group by d.comp_code,d.unit_code,s."State_Name",d.city_code order by comp_code,unit_code,state_name,city_name';
        --insert into test1(vstring,vstring2) values('cir_citywise_supply ',v_query);commit;
      
print(@v_query)
exec(@v_query)
        
		set      @v_query1='select d.comp_code comp_code,d.unit_code unit_code,s."State_Name" state_name from (select b.comp_code comp_code,b.unit_code unit_code,a.state_code state_code,
		a.city_code city_code from cir_agmast a, cir_bill_det b
		where a.comp_code=b.comp_code and b.comp_code='+''''+@pcomp_code+''''+' 
		and a.unit=b.unit_code 

and 
(b.unit_code='''+@punit_code+''' or  '''+@punit_code+''' is null or '''+@punit_code+''' ='''' )
 and 
        a.agcd=b.agcd and a.dpcd=b.dpcd 
and (a.branch_code='''+@pbrancode+''' or '''+@pbrancode+'''='''' or  '''+@pbrancode+''' is null) 

and (a.ag_type='''+@pagtype+''' or '''+@pagtype+'''='''' or  '''+@pagtype+''' is null ) 
and (b.publ ='''+@ppublcode+'''  or '''+@ppublcode+'''='''' or  '''+@ppublcode+''' is null) 
and (a.state_code='''+@pstatecode+'''   or '''+@pstatecode+'''='''' or  '''+@pstatecode+''' is null) 
and (a.city_code='''+@pcitycode+'''  or '''+@pcitycode+'''='''' or  '''+@pcitycode+''' is null)

 and


		 b.billdt between '+''''+cast(@vfrdt as varchar)+''''+' 
		and '+''''+cast(@vtodt as varchar)+''''+' 
		group by b.comp_code,b.unit_code,b.billdt,a.city_code,a.state_code) d,state_mst s
		where d.state_code=s."State_Code"
		group by d.comp_code,d.unit_code,s."State_Name" order by comp_code,unit_code,state_name';
        --insert into test1(vstring,vstring2) values('cir_citywise_supply ',v_query);commit;
        --open p_accounts1 for v_query;
print(@v_query1)
exec(@v_query1) 
end

    


SET CONCAT_NULL_YIELDS_NULL On



///////////////////////////////////////end  issue no. 7045//////////////////////////////////////////////////////


/////////////////////////////////add by Deepika 11/05/2012 issue no. 6929/////////////////////////////////

                                                                
                                                                     
                                                                     
                                            
ALTER procedure [dbo].[cir_payreason_for_receipt]
    @pcompcode       as varchar(200),
    @punitcode       as varchar(200),
    @pdoctype        as varchar(200),
    @pagcd           as varchar(200),
    @pdpcd           as varchar(200),
    @pdateformat     as varchar(200),
    @pextra1         as varchar(200),
    @pextra2         as varchar(200),
    @pextra3         as varchar(200),
    @pextra4         as varchar(200),
    @pextra5         as varchar(200),
    @pextra6         as varchar(200),
    @pextra7         as varchar(200),
    @pextra8         as varchar(200),
    @pextra9         as varchar(200),
    @pextra10        as varchar(200)
as
begin

    if(@pdoctype !='RCR') Begin
        select distinct reason_code as "PAY_MODE_CODE",reason_name as "PAYMENT_MODE_NAME",'N' as "MODE_TYPE" ,chq_return_flag as "CHQ_RETURN_FLAG",
        no_of_times as "NO_OF_TIMES",valid_days as "VALID_DAYS"
        from cir_reason_mst where comp_code = @pcompcode and ((upper(reason_name) like upper(@pextra1)+'%') or (@pextra1 is null) or (@pextra1='')) and 
        ((doc_type=@pdoctype) or doc_type is null or doc_type='') and  ((CHQ_RETURN_FLAG= @pextra2) or CHQ_RETURN_FLAG is null or CHQ_RETURN_FLAG='') 
        order by payment_mode_name
    End
    
     if(@pdoctype ='RCR'  and  @pextra2='Y') Begin
        select distinct reason_code as "PAY_MODE_CODE",reason_name as "PAYMENT_MODE_NAME",'N' as "MODE_TYPE" ,chq_return_flag as "CHQ_RETURN_FLAG",
        no_of_times as "NO_OF_TIMES",valid_days as "VALID_DAYS"
        from cir_reason_mst where comp_code = @pcompcode and ((upper(reason_name) like upper(@pextra1)+'%') or (@pextra1 is null) or (@pextra1='')) and 
        ((doc_type=@pdoctype) or doc_type is null or doc_type='') and  ((CHQ_RETURN_FLAG= @pextra2) or CHQ_RETURN_FLAG is null or CHQ_RETURN_FLAG='') 
        order by payment_mode_name
    End
    
    if(@pdoctype ='RCR' and  @pextra2!='Y' ) Begin
        select distinct x.PAY_MODE_CODE as "PAY_MODE_CODE" ,x."PAYMENT_MODE_NAME" as "PAYMENT_MODE_NAME",x."MODE_TYPE" as "MODE_TYPE" ,x."CHQ_RETURN_FLAG" as "CHQ_RETURN_FLAG",
        x."NO_OF_TIMES" as "NO_OF_TIMES",x."VALID_DAYS" as "VALID_DAYS" from 
        (select distinct p."Pay_Mode_Code" as "PAY_MODE_CODE" ,p."Payment_Mode_Name" as "PAYMENT_MODE_NAME",p.payment_mode_type as "MODE_TYPE" ,'N' as "CHQ_RETURN_FLAG",
        0 as "NO_OF_TIMES",0 as "VALID_DAYS"
        from payment_mode_mast p,cir_agency_paymode a
        where a.comp_code=@pcompcode and a.unit_code=@punitcode and a.agcd=@pagcd and a.dpcd=@pdpcd and 
        a.paymode=p."Pay_Mode_Code" and ((upper(p."Payment_Mode_Name") like upper(@pextra1)+'%') or (@pextra1 is null) or (@pextra1='')) and
        isnull(a.paymode_active,'N')='Y'
        union
        select distinct p."Pay_Mode_Code" as "PAY_MODE_CODE" ,p."Payment_Mode_Name" as "PAYMENT_MODE_NAME",p.payment_mode_type as "MODE_TYPE" ,'N' as "CHQ_RETURN_FLAG",
        0 as "NO_OF_TIMES",0 as "VALID_DAYS"
        from payment_mode_mast p
        where ((upper(p."Payment_Mode_Name") like upper(@pextra1)+'%') or (@pextra1 is null) or (@pextra1='')) and p."Pay_Mode_Code"='CA0') x
        order by payment_mode_name
    End
    
    select getdate() as "CUR_DATE"
    
End

/////////////////////////////////////////////////end/////////////////////////////////////////////////////////////////




/////////////////////add by deepika 14/05/2012 for issue no. 5021


ALTER PROCEDURE [dbo].[cir_rep_supply_cir_taluka_supply_variance_p]
    @pcomp_code                               VARCHAR(20) ,
	@punit_code                               VARCHAR(20) ,
	@ppublication                             VARCHAR(20) ,
	@pmainedtn                                VARCHAR(20) ,
	@pedtn                                    VARCHAR(20) ,
	@ptaluka                                  VARCHAR(20) ,
	@pfirstdate                               VARCHAR(20) ,
	@pseconddate                              VARCHAR(20) ,
	@pdateformat                              VARCHAR(20) ,
	@pextra1                                  VARCHAR(4000) ,
	@pextra2                                  VARCHAR(4000) ,
    @pextra3             as varchar(200),--agency type
	@pextra4             as varchar(200),-- agency class
	@pextra5             as varchar(200),--final.unfinal
	@pextra6             as varchar(200),
	@pextra7             as varchar(200),
	@pextra8             as varchar(200),
	@pextra9             as varchar(200),
	@pextra10            as varchar(200)
AS

    DECLARE @vfirstdate                               DATETIME
    DECLARE @vseconddate                              DATETIME
    --    SELECT @vfirstdate  = @pfirstdate
    --    SELECT @vseconddate  =  @pseconddate
    SET @vfirstdate  =  dbo.convert_user_date('/',@pfirstdate,@pdateformat)
    SET @vseconddate  = dbo.convert_user_date('/',@pseconddate,@pdateformat)

print(@vfirstdate)
print(@vseconddate)

if upper(@pextra1)='U' begin       
	SELECT
	m.comp_code "COMP CODE",m.agcd "AGENCY CODE",m.dpcd "AGENCY SUB CODE",
	m.ag_name "AGENCY NAME",m.ag_name_oth_lang "AGENCY OTHER LANG",DBO.cir_get_city(m.comp_code, m.city_code) "CITY NAME",
	m.tehsil_taluka "TALUKA CODE",isnull(m.talu_name,'(blank)') "TALUKA NAME",m.talu_oname "TALUKA NAME OTHER LANG",
	SUM(m.first_sup) "FIRST SUPPLY",SUM(m.second_sup) "SECOND SUPPLY",

	CASE sign(ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) WHEN - 1 THEN 0
	ELSE (ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0))
	END "INCREASE SUPPLY",

	CASE sign(ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) WHEN 1 THEN 0
	ELSE (ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0))
	END "DECREASE SUPPLY",

	CASE ISNULL(SUM(m.first_sup), 0) WHEN 0 THEN 100
	ELSE ROUND(((ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) * 100) / CONVERT(FLOAT,
	CASE sign(SUM(m.second_sup) - SUM(m.first_sup)) WHEN - 1 THEN SUM(m.first_sup)
	ELSE SUM(m.second_sup) END), 2)
	END "PERCENT_VARIANCE",
	dbo.cir_get_drop_point_name(m.comp_code,unit_code,station_code,1) "DROP POINT NAME",
    dbo.cir_get_drop_point_name(m.comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME"
	FROM (    
	SELECT DISTINCT a.comp_code ,a.unit_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang
	,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
	 (    SELECT ISNULL(SUM(sup_copy), 0)
	from cir_supply
	WHERE comp_code  = @pcomp_code
	 AND (unit  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR    @pedtn  is null  OR    @pedtn = '')
	 and isnull(cir_supply.supply_flag,'N') =    'Y' 
	 AND cir_supply.agcd  = a.agcd
	 AND cir_supply.dpcd  = a.dpcd
	 AND cir_supply.edtn  in(
		 SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and (cir_supply.supply_type_code = @pextra2 or @pextra2 is null  or @pextra2='')
		 ))	 first_sup,
	 (SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup a
	WHERE comp_code  = @pcomp_code AND    (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR @pedtn  is null OR    @pedtn = '')
	 AND supdate  = @vseconddate
	 AND a.agcd  = a.agcd AND    a.dpcd  = a.dpcd
	 AND a.edtn  in
		(SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and  (a.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')
		 )) second_sup
	FROM  cir_dbksup a,cir_taluka_mast b,cir_agmast c
	WHERE a.comp_code  = @pcomp_code AND a.comp_code  = c.comp_code AND b.comp_code  = c.comp_code
	AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND a.unit_code  = c.unit
	AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
	AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
	AND (c.tehsil_taluka  = @ptaluka OR    @ptaluka  is null  OR    @ptaluka = '')
	AND c.tehsil_taluka=b.talu_code
	group by a.comp_code ,a.unit_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code ,c.branch_code 
	) m
	WHERE    ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
	GROUP BY m.comp_code,m.unit_code,m.agcd,m.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.tehsil_taluka,m.talu_name,m.talu_oname,m.station_code,m.branch_code
	ORDER BY m.comp_code,m.tehsil_taluka,m.ag_name
end
else
begin
SELECT
	m.comp_code "COMP CODE",m.agcd "AGENCY CODE",m.dpcd "AGENCY SUB CODE",
	m.ag_name "AGENCY NAME",m.ag_name_oth_lang "AGENCY OTHER LANG",DBO.cir_get_city(m.comp_code, m.city_code) "CITY NAME",
	m.tehsil_taluka "TALUKA CODE",isnull(m.talu_name,'(blank)') "TALUKA NAME",m.talu_oname "TALUKA NAME OTHER LANG",
	SUM(m.first_sup) "FIRST SUPPLY",SUM(m.second_sup) "SECOND SUPPLY",

	CASE sign(ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) WHEN - 1 THEN 0
	ELSE (ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0))
	END "INCREASE SUPPLY",

	CASE sign(ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) WHEN 1 THEN 0
	ELSE (ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0))
	END "DECREASE SUPPLY",

	CASE ISNULL(SUM(m.first_sup), 0) WHEN 0 THEN 100
	ELSE ROUND(((ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) * 100) / CONVERT(FLOAT,
	CASE sign(SUM(m.second_sup) - SUM(m.first_sup)) WHEN - 1 THEN SUM(m.first_sup)
	ELSE SUM(m.second_sup) END), 2)
	END "PERCENT_VARIANCE",
	dbo.cir_get_drop_point_name(m.comp_code,m.unit_code,m.station_code,1) "DROP POINT NAME",
    dbo.cir_get_drop_point_name(m.comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME"
	FROM (    SELECT DISTINCT
	 a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code station_code,c.branch_code branch_code,
	 (    SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup
	WHERE comp_code  = @pcomp_code
	 AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR    @pedtn  is null  OR    @pedtn = '')
	 AND supdate  = @vfirstdate
	 AND cir_dbksup.agcd  = a.agcd
	 AND cir_dbksup.dpcd  = a.dpcd
	 AND cir_dbksup.edtn  in(
		 SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) first_sup,
	 (SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup
	WHERE comp_code  = @pcomp_code AND    (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR @pedtn  is null OR    @pedtn = '')
	 AND supdate  = @vseconddate
	 AND cir_dbksup.agcd  = a.agcd AND    cir_dbksup.dpcd  = a.dpcd
	 AND cir_dbksup.edtn  in
		(SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) second_sup	
	FROM  cir_dbksup a,cir_taluka_mast b,cir_agmast c
	WHERE a.comp_code  = @pcomp_code AND a.comp_code  = c.comp_code AND b.comp_code  = c.comp_code
	AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND a.unit_code  = c.unit
	AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
	AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
	AND (c.tehsil_taluka  = @ptaluka OR    @ptaluka  is null  OR    @ptaluka = '')
	AND c.tehsil_taluka=b.talu_code
	group by a.comp_code ,a.unit_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,c.station_code ,c.branch_code ) m
	WHERE    ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
	GROUP BY m.comp_code,m.unit_code,m.agcd,m.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.tehsil_taluka,m.talu_name,m.talu_oname,m.station_code,m.branch_code
	ORDER BY m.comp_code,m.tehsil_taluka,m.ag_name

end


-- district wise
if upper(@pextra1)='U' begin 
	SELECT r.comp_code "COMP CODE", r.tehsil_taluka "TALUKA CODE",isnull(r.talu_name,'(blank)') "TALUKA NAME",r.talu_oname "TALUKA NAME OTHER LANG",
	SUM(r.first_sup) "FIRST SUPPLY",
	SUM(r.second_sup) "SECOND SUPPLY",
	CASE sign(ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) WHEN - 1 THEN 0
	ELSE (ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0))
	END "INCREASE SUPPLY",

	CASE sign(ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) WHEN 1 THEN 0
	ELSE (ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0))
	END "DECREASE SUPPLY",

	CASE ISNULL(SUM(r.first_sup), 0) WHEN 0 THEN 100
	ELSE ROUND(((ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) * 100) / CONVERT(FLOAT,
	CASE sign(SUM(r.second_sup) - SUM(r.first_sup)) WHEN - 1 THEN SUM(r.first_sup)
	ELSE SUM(r.second_sup)END), 2)
	END "PERCENT_VARIANCE"
	FROM (SELECT DISTINCT
	a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
	(    SELECT ISNULL(SUM(sup_copy), 0)
	from cir_supply
	WHERE comp_code  = @pcomp_code
	 AND (unit = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR    @pedtn  is null  OR    @pedtn = '')
	 and isnull(cir_supply.supply_flag,'N') =    'Y' 
	 AND cir_supply.agcd  = a.agcd
	 AND cir_supply.dpcd  = a.dpcd
	 AND cir_supply.edtn  in(
		 SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and (cir_supply.supply_type_code = @pextra2 or @pextra2 is null  or @pextra2='')
		 ))	 first_sup ,
	(SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup a
	WHERE comp_code  = @pcomp_code AND    (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	AND publ  = @ppublication
	AND (edtn  = @pedtn OR @pedtn  is null OR    @pedtn = '')
	AND supdate  = @vseconddate
	AND a.agcd  = a.agcd AND    a.dpcd  = a.dpcd
	AND a.edtn  in
	(SELECT DISTINCT edtn FROM  cir_edtn_mast
	WHERE comp_code  = @pcomp_code
	 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
	 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
	 and  (a.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')
	 )) second_sup 
	FROM  cir_dbksup a,cir_taluka_mast b,cir_agmast c
	WHERE a.comp_code  = @pcomp_code
	AND a.comp_code  = c.comp_code
	AND b.comp_code  = c.comp_code
	AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
	AND a.unit_code  = c.unit
	AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
	AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
	AND (c.tehsil_taluka  = @ptaluka OR    @ptaluka  is null  OR    @ptaluka = '')
	AND c.tehsil_taluka=b.talu_code
	group by a.comp_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname) r
	WHERE ISNULL(r.second_sup, 0) - ISNULL(r.first_sup, 0)  <> 0
	GROUP BY r.comp_code,r.tehsil_taluka,r.talu_name,r.talu_oname
	ORDER BY r.comp_code,r.tehsil_taluka
end
else
begin

       SELECT
                 r.comp_code "COMP CODE", r.tehsil_taluka "TALUKA CODE",isnull(r.talu_name,'(blank)') "TALUKA NAME",r.talu_oname "TALUKA NAME OTHER LANG",
                 SUM(r.first_sup) "FIRST SUPPLY",
                 SUM(r.second_sup) "SECOND SUPPLY",
                CASE sign(ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) WHEN - 1 THEN 0
                ELSE (ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0))
                END "INCREASE SUPPLY",
                 
                CASE sign(ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) WHEN 1 THEN 0
                ELSE (ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0))
                END "DECREASE SUPPLY",
                 
                CASE ISNULL(SUM(r.first_sup), 0) WHEN 0 THEN 100
                ELSE ROUND(((ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) * 100) / CONVERT(FLOAT,
                CASE sign(SUM(r.second_sup) - SUM(r.first_sup)) WHEN - 1 THEN SUM(r.first_sup)
                ELSE SUM(r.second_sup)END), 2)
                END "PERCENT_VARIANCE"
        FROM (    SELECT DISTINCT
                     a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                     (SELECT ISNULL(SUM(sup_copy), 0)
                    FROM  cir_dbksup
                    WHERE comp_code  = @pcomp_code
                     AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
                     AND publ  = @ppublication
                     AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                     AND supdate  = @vfirstdate
                     AND cir_dbksup.agcd  = a.agcd
                     AND cir_dbksup.dpcd  = a.dpcd
                     AND cir_dbksup.edtn  in
                        (SELECT DISTINCT edtn FROM  cir_edtn_mast
                        WHERE comp_code  = @pcomp_code
                         AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                         AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) first_sup,
                     (SELECT ISNULL(SUM(sup_copy), 0) FROM  cir_dbksup
                    WHERE comp_code  = @pcomp_code
                     AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
                     AND publ  = @ppublication
                     AND (edtn  = @pedtn OR    @pedtn  is null)
                     AND supdate  = @vseconddate
                     AND cir_dbksup.agcd  = a.agcd
                     AND cir_dbksup.dpcd  = a.dpcd
                     AND cir_dbksup.edtn  in (SELECT DISTINCT edtn FROM  cir_edtn_mast
                        WHERE comp_code  = @pcomp_code
                         AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                         AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) second_sup
            FROM  cir_dbksup a,cir_taluka_mast b,cir_agmast c
            WHERE a.comp_code  = @pcomp_code
             AND a.comp_code  = c.comp_code
             AND b.comp_code  = c.comp_code
             AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
             AND a.unit_code  = c.unit
             AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
             AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
             AND (c.tehsil_taluka  = @ptaluka OR    @ptaluka  is null  OR    @ptaluka = '')
			AND c.tehsil_taluka=b.talu_code) r
        WHERE ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
        GROUP BY r.comp_code,r.tehsil_taluka,r.talu_name,r.talu_oname
        ORDER BY r.comp_code,r.tehsil_taluka
end
if upper(@pextra1)='U' begin 
	SELECT
         q.comp_code "COMP CODE",
         SUM(q.first_sup) "FIRST SUPPLY",
         SUM(q.second_sup) "SECOND SUPPLY",
        CASE sign(ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) WHEN - 1 THEN 0
        ELSE (ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0))
        END "INCREASE SUPPLY",
         
        CASE sign(ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) WHEN 1 THEN 0
        ELSE (ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0))
        END "DECREASE SUPPLY",
         
        CASE ISNULL(SUM(q.first_sup), 0) WHEN 0 THEN 100
        ELSE ROUND(((ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) * 100) / CASE sign(SUM(q.second_sup) - SUM(q.first_sup)) WHEN - 1 THEN SUM(q.first_sup) ELSE SUM(q.second_sup) END, 2)
        END "PERCENT_VARIANCE",
        
        (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit 
        and (d.unit_code = @punit_code or @punit_code is null or @punit_code='') and
                    d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn ='') 
                    and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                    (m.tehsil_taluka = @ptaluka or @ptaluka is null or @ptaluka='') and d.edtn in
                    (select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn ='')) 
                    and (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')) first_total_supply        
			    FROM (SELECT DISTINCT a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
    (SELECT ISNULL(SUM(sup_copy), 0)
	from cir_supply
	WHERE comp_code  = @pcomp_code
	 AND (unit  = @punit_code or @punit_code is null or @punit_code ='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR    @pedtn  is null  OR    @pedtn = '')
	 and isnull(cir_supply.supply_flag,'N') =    'Y' 
	 AND cir_supply.agcd  = a.agcd
	 AND cir_supply.dpcd  = a.dpcd
	 AND cir_supply.edtn  in(
		 SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and (cir_supply.supply_type_code = @pextra2 or @pextra2 is null  or @pextra2='')
		 ))	 first_sup,
	 (SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup a
	WHERE comp_code  = @pcomp_code AND    (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR @pedtn  is null OR    @pedtn = '')
	 AND supdate  = @vseconddate
	 AND a.agcd  = a.agcd AND    a.dpcd  = a.dpcd
	 AND a.edtn  in
		(SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and  (a.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')
	 )) second_sup
        FROM  cir_dbksup a,cir_taluka_mast b,cir_agmast c
        WHERE a.comp_code  = @pcomp_code AND  a.comp_code  = c.comp_code AND b.comp_code  = c.comp_code
         AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='') AND    a.unit_code  = c.unit
         AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
         AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
         AND (c.tehsil_taluka=    @ptaluka OR    @ptaluka  is null OR    @ptaluka = '')
         AND c.tehsil_taluka=b.talu_code
         group by a.comp_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname
         ) q
        WHERE ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
        GROUP BY  q.comp_code  ORDER BY q.comp_code
end
else
begin       
       

        SELECT
                 q.comp_code "COMP CODE",
                 SUM(q.first_sup) "FIRST SUPPLY",
                 SUM(q.second_sup) "SECOND SUPPLY",
                CASE sign(ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) WHEN - 1 THEN 0
                ELSE (ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0))
                END "INCREASE SUPPLY",
                 
                CASE sign(ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) WHEN 1 THEN 0
                ELSE (ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0))
                END "DECREASE SUPPLY",
                 
                CASE ISNULL(SUM(q.first_sup), 0) WHEN 0 THEN 100
                ELSE ROUND(((ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) * 100) / CASE sign(SUM(q.second_sup) - SUM(q.first_sup)) WHEN - 1 THEN SUM(q.first_sup) ELSE SUM(q.second_sup) END, 2)
                END "PERCENT_VARIANCE",
                (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit 
        and (d.unit_code = @punit_code or @punit_code is null or @punit_code='') and
                    d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn ='') 
                    and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                    (m.tehsil_taluka = @ptaluka or @ptaluka is null or @ptaluka='') and d.edtn in
                    (select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn ='')) 
                    and (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')) first_total_supply   
                    
        FROM (    SELECT DISTINCT a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.tehsil_taluka,b.talu_name,b.talu_oname,
                     (SELECT ISNULL(SUM(sup_copy), 0)
                    FROM  cir_dbksup
                    WHERE comp_code  = @pcomp_code
                     AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
                     AND publ  = @ppublication
                     AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                     AND supdate  = @vfirstdate
                     AND cir_dbksup.agcd  = a.agcd AND    cir_dbksup.dpcd  = a.dpcd
                     AND cir_dbksup.edtn  in
                        (SELECT DISTINCT edtn
                        FROM  cir_edtn_mast
                        WHERE comp_code  = @pcomp_code
                         AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                         AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) first_sup,
                     (    SELECT ISNULL(SUM(sup_copy), 0)
                    FROM  cir_dbksup
                    WHERE comp_code  = @pcomp_code AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
                     AND publ  = @ppublication
                     AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                     AND supdate  = @vseconddate
                     AND cir_dbksup.agcd  = a.agcd AND cir_dbksup.dpcd  = a.dpcd
                     AND cir_dbksup.edtn  in
                        (SELECT DISTINCT edtn
                        FROM  cir_edtn_mast
                        WHERE comp_code  = @pcomp_code
                         AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                         AND    (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) second_sup
            FROM  cir_dbksup a,cir_taluka_mast b,cir_agmast c
            WHERE a.comp_code  = @pcomp_code AND    a.comp_code  = c.comp_code AND    b.comp_code  = c.comp_code
             AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
              AND    a.unit_code  = c.unit
             AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
             AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
             AND (c.tehsil_taluka=    @ptaluka OR    @ptaluka  is null OR    @ptaluka = '')
             AND c.tehsil_taluka=b.talu_code) q
        WHERE ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
        GROUP BY  q.comp_code         ORDER BY q.comp_code
end        

///////////////////////next



ALTER PROCEDURE [dbo].[cir_rep_supply_cir_dist_supply_variance_p]
    @pcomp_code                               VARCHAR(20) ,
    @punit_code                               VARCHAR(20) ,
    @ppublication                             VARCHAR(20) ,
    @pmainedtn                                VARCHAR(20) ,
    @pedtn                                    VARCHAR(20) ,
    @pdist                                    VARCHAR(20) ,
    @pfirstdate                                VARCHAR(20),
    @pseconddate                               VARCHAR(20),
    @pdateformat                              VARCHAR(20) ,
    @pextra1                                  VARCHAR(200) ,
    @pextra2                                  VARCHAR(200) ,
    @pextra3             as varchar(200),--agency type
    @pextra4             as varchar(200),-- agency class
    @pextra5             as varchar(200),--final.unfinal
    @pextra6             as varchar(200),
    @pextra7             as varchar(200),
    @pextra8             as varchar(200),
    @pextra9             as varchar(200),
    @pextra10            as varchar(200)
AS

    DECLARE @vfirstdate                               DATETIME
    DECLARE @vseconddate                              DATETIME
    --    SELECT @vfirstdate  = @pfirstdate
    --    SELECT @vseconddate  =  @pseconddate
    SET @vfirstdate  =  dbo.convert_user_date('/',@pfirstdate,@pdateformat)
    SET @vseconddate  = dbo.convert_user_date('/',@pseconddate,@pdateformat)

print(@vfirstdate)
print(@vseconddate)

if upper(@pextra1)='U' begin       
	SELECT
	m.comp_code "COMP CODE",m.agcd "AGENCY CODE",m.dpcd "AGENCY SUB CODE",
	m.ag_name "AGENCY NAME",m.ag_name_oth_lang "AGENCY OTHER LANG",DBO.cir_get_city(m.comp_code, m.city_code) "CITY NAME",
	m.dist_code "DISTRICT CODE",m.dist_name "DISTRICT NAME",m.dist_oname "DISTRICT NAME OTHER LANG",
	SUM(m.first_sup) "FIRST SUPPLY",SUM(m.second_sup) "SECOND SUPPLY",

	CASE sign(ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) WHEN - 1 THEN 0
	ELSE (ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0))
	END "INCREASE SUPPLY",

	CASE sign(ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) WHEN 1 THEN 0
	ELSE (ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0))
	END "DECREASE SUPPLY",

	CASE ISNULL(SUM(m.first_sup), 0) WHEN 0 THEN 100
	ELSE ROUND(((ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) * 100) / CONVERT(FLOAT,
	CASE sign(SUM(m.second_sup) - SUM(m.first_sup)) WHEN - 1 THEN SUM(m.first_sup)
	ELSE SUM(m.second_sup) END), 2)
	END "PERCENT_VARIANCE",
	dbo.cir_get_drop_point_name(m.comp_code,unit_code,station_code,1) "DROP POINT NAME",
    dbo.cir_get_drop_point_name(m.comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME"
	FROM (    
	SELECT DISTINCT a.comp_code ,a.unit_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang
	,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
	 (    SELECT ISNULL(SUM(sup_copy), 0)
	from cir_supply
	WHERE comp_code  = @pcomp_code
	 AND (unit  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR    @pedtn  is null  OR    @pedtn = '')
	 and isnull(cir_supply.supply_flag,'N') =    'Y' 
	 AND cir_supply.agcd  = a.agcd
	 AND cir_supply.dpcd  = a.dpcd
	 AND cir_supply.edtn  in(
		 SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and (cir_supply.supply_type_code = @pextra2 or @pextra2 is null  or @pextra2='')
		 ))	 first_sup,
	 (SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup a
	WHERE comp_code  = @pcomp_code AND    (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR @pedtn  is null OR    @pedtn = '')
	 AND supdate  = @vseconddate
	 AND a.agcd  = a.agcd AND    a.dpcd  = a.dpcd
	 AND a.edtn  in
		(SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and  (a.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')
		 )) second_sup
	FROM  cir_dbksup a,cir_dist_mast b,cir_agmast c
	WHERE a.comp_code  = @pcomp_code AND a.comp_code  = c.comp_code AND b.comp_code  = c.comp_code
	AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND a.unit_code  = c.unit
	AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
	AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
	AND (c.dist_code  = @pdist OR    @pdist  is null  OR    @pdist = '')
	AND c.dist_code  = b.dist_code
	group by a.comp_code ,a.unit_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code ,c.branch_code 
	) m
	WHERE    ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
	GROUP BY m.comp_code,m.unit_code,m.agcd,m.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.dist_code,m.dist_name,m.dist_oname,m.station_code,m.branch_code
	ORDER BY m.comp_code,m.dist_code,m.ag_name
end
else
begin
SELECT
	m.comp_code "COMP CODE",m.agcd "AGENCY CODE",m.dpcd "AGENCY SUB CODE",
	m.ag_name "AGENCY NAME",m.ag_name_oth_lang "AGENCY OTHER LANG",DBO.cir_get_city(m.comp_code, m.city_code) "CITY NAME",
	m.dist_code "DISTRICT CODE",m.dist_name "DISTRICT NAME",m.dist_oname "DISTRICT NAME OTHER LANG",
	SUM(m.first_sup) "FIRST SUPPLY",SUM(m.second_sup) "SECOND SUPPLY",

	CASE sign(ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) WHEN - 1 THEN 0
	ELSE (ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0))
	END "INCREASE SUPPLY",

	CASE sign(ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) WHEN 1 THEN 0
	ELSE (ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0))
	END "DECREASE SUPPLY",

	CASE ISNULL(SUM(m.first_sup), 0) WHEN 0 THEN 100
	ELSE ROUND(((ISNULL(SUM(m.second_sup), 0) - ISNULL(SUM(m.first_sup), 0)) * 100) / CONVERT(FLOAT,
	CASE sign(SUM(m.second_sup) - SUM(m.first_sup)) WHEN - 1 THEN SUM(m.first_sup)
	ELSE SUM(m.second_sup) END), 2)
	END "PERCENT_VARIANCE",
	dbo.cir_get_drop_point_name(m.comp_code,m.unit_code,m.station_code,1) "DROP POINT NAME",
    dbo.cir_get_drop_point_name(m.comp_code,unit_code,station_code,2) "DROP POINT NAME OTHER LANG",branch_code "BRANCH NAME"
	FROM (    SELECT DISTINCT
	 a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code station_code,c.branch_code branch_code,
	 (    SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup
	WHERE comp_code  = @pcomp_code
	 AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR    @pedtn  is null  OR    @pedtn = '')
	 AND supdate  = @vfirstdate
	 AND cir_dbksup.agcd  = a.agcd
	 AND cir_dbksup.dpcd  = a.dpcd
	 AND cir_dbksup.edtn  in(
		 SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) first_sup,
	 (SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup
	WHERE comp_code  = @pcomp_code AND    (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR @pedtn  is null OR    @pedtn = '')
	 AND supdate  = @vseconddate
	 AND cir_dbksup.agcd  = a.agcd AND    cir_dbksup.dpcd  = a.dpcd
	 AND cir_dbksup.edtn  in
		(SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) second_sup	
	FROM  cir_dbksup a,cir_dist_mast b,cir_agmast c
	WHERE a.comp_code  = @pcomp_code AND a.comp_code  = c.comp_code AND b.comp_code  = c.comp_code
	AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND a.unit_code  = c.unit
	AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
	AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
	AND (c.dist_code  = @pdist OR    @pdist  is null  OR    @pdist = '')
	AND c.dist_code  = b.dist_code
	group by a.comp_code ,a.unit_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,c.station_code ,c.branch_code ) m
	WHERE    ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
	GROUP BY m.comp_code,m.unit_code,m.agcd,m.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.dist_code,m.dist_name,m.dist_oname,m.station_code,m.branch_code
	ORDER BY m.comp_code,m.dist_code,m.ag_name

end


-- district wise
if upper(@pextra1)='U' begin 
	SELECT r.comp_code "COMP CODE", r.dist_code "DISTRICT CODE", r.dist_name "DISTRICT NAME",
	r.dist_oname "DISTRICT NAME OTHER LANG",
	SUM(r.first_sup) "FIRST SUPPLY",
	SUM(r.second_sup) "SECOND SUPPLY",
	CASE sign(ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) WHEN - 1 THEN 0
	ELSE (ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0))
	END "INCREASE SUPPLY",

	CASE sign(ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) WHEN 1 THEN 0
	ELSE (ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0))
	END "DECREASE SUPPLY",

	CASE ISNULL(SUM(r.first_sup), 0) WHEN 0 THEN 100
	ELSE ROUND(((ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) * 100) / CONVERT(FLOAT,
	CASE sign(SUM(r.second_sup) - SUM(r.first_sup)) WHEN - 1 THEN SUM(r.first_sup)
	ELSE SUM(r.second_sup)END), 2)
	END "PERCENT_VARIANCE"
	FROM (SELECT DISTINCT
	a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
	(    SELECT ISNULL(SUM(sup_copy), 0)
	from cir_supply
	WHERE comp_code  = @pcomp_code
	 AND (unit = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR    @pedtn  is null  OR    @pedtn = '')
	 and isnull(cir_supply.supply_flag,'N') =    'Y' 
	 AND cir_supply.agcd  = a.agcd
	 AND cir_supply.dpcd  = a.dpcd
	 AND cir_supply.edtn  in(
		 SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and (cir_supply.supply_type_code = @pextra2 or @pextra2 is null  or @pextra2='')
		 ))	 first_sup ,
	(SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup a
	WHERE comp_code  = @pcomp_code AND    (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	AND publ  = @ppublication
	AND (edtn  = @pedtn OR @pedtn  is null OR    @pedtn = '')
	AND supdate  = @vseconddate
	AND a.agcd  = a.agcd AND    a.dpcd  = a.dpcd
	AND a.edtn  in
	(SELECT DISTINCT edtn FROM  cir_edtn_mast
	WHERE comp_code  = @pcomp_code
	 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
	 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
	 and  (a.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')
	 )) second_sup 
	FROM  cir_dbksup a,cir_dist_mast b,cir_agmast c
	WHERE a.comp_code  = @pcomp_code
	AND a.comp_code  = c.comp_code
	AND b.comp_code  = c.comp_code
	AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
	AND a.unit_code  = c.unit
	AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
	AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
	AND (c.dist_code  = @pdist OR    @pdist  is null OR    @pdist = '')
	AND c.dist_code  = b.dist_code 
	group by a.comp_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname) r
	WHERE ISNULL(r.second_sup, 0) - ISNULL(r.first_sup, 0)  <> 0
	GROUP BY r.comp_code,r.dist_code,r.dist_name,r.dist_oname
	ORDER BY r.comp_code,r.dist_code
end
else
begin

       SELECT
                 r.comp_code "COMP CODE", r.dist_code "DISTRICT CODE", r.dist_name "DISTRICT NAME",
                 r.dist_oname "DISTRICT NAME OTHER LANG",
                 SUM(r.first_sup) "FIRST SUPPLY",
                 SUM(r.second_sup) "SECOND SUPPLY",
                CASE sign(ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) WHEN - 1 THEN 0
                ELSE (ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0))
                END "INCREASE SUPPLY",
                 
                CASE sign(ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) WHEN 1 THEN 0
                ELSE (ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0))
                END "DECREASE SUPPLY",
                 
                CASE ISNULL(SUM(r.first_sup), 0) WHEN 0 THEN 100
                ELSE ROUND(((ISNULL(SUM(r.second_sup), 0) - ISNULL(SUM(r.first_sup), 0)) * 100) / CONVERT(FLOAT,
                CASE sign(SUM(r.second_sup) - SUM(r.first_sup)) WHEN - 1 THEN SUM(r.first_sup)
                ELSE SUM(r.second_sup)END), 2)
                END "PERCENT_VARIANCE"
        FROM (    SELECT DISTINCT
                     a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                     (SELECT ISNULL(SUM(sup_copy), 0)
                    FROM  cir_dbksup
                    WHERE comp_code  = @pcomp_code
                     AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
                     AND publ  = @ppublication
                     AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                     AND supdate  = @vfirstdate
                     AND cir_dbksup.agcd  = a.agcd
                     AND cir_dbksup.dpcd  = a.dpcd
                     AND cir_dbksup.edtn  in
                        (SELECT DISTINCT edtn FROM  cir_edtn_mast
                        WHERE comp_code  = @pcomp_code
                         AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                         AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) first_sup,
                     (SELECT ISNULL(SUM(sup_copy), 0) FROM  cir_dbksup
                    WHERE comp_code  = @pcomp_code
                     AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
                     AND publ  = @ppublication
                     AND (edtn  = @pedtn OR    @pedtn  is null)
                     AND supdate  = @vseconddate
                     AND cir_dbksup.agcd  = a.agcd
                     AND cir_dbksup.dpcd  = a.dpcd
                     AND cir_dbksup.edtn  in (SELECT DISTINCT edtn FROM  cir_edtn_mast
                        WHERE comp_code  = @pcomp_code
                         AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                         AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) second_sup
            FROM  cir_dbksup a,cir_dist_mast b,cir_agmast c
            WHERE a.comp_code  = @pcomp_code
             AND a.comp_code  = c.comp_code
             AND b.comp_code  = c.comp_code
             AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
             AND a.unit_code  = c.unit
             AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
             AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
             AND (c.dist_code  = @pdist OR    @pdist  is null OR    @pdist = '')
             AND c.dist_code  = b.dist_code) r
        WHERE ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
        GROUP BY r.comp_code,r.dist_code,r.dist_name,r.dist_oname
        ORDER BY r.comp_code,r.dist_code
end
if upper(@pextra1)='U' begin 
	SELECT
         q.comp_code "COMP CODE",
         SUM(q.first_sup) "FIRST SUPPLY",
         SUM(q.second_sup) "SECOND SUPPLY",
        CASE sign(ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) WHEN - 1 THEN 0
        ELSE (ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0))
        END "INCREASE SUPPLY",
         
        CASE sign(ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) WHEN 1 THEN 0
        ELSE (ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0))
        END "DECREASE SUPPLY",
         
        CASE ISNULL(SUM(q.first_sup), 0) WHEN 0 THEN 100
        ELSE ROUND(((ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) * 100) / CASE sign(SUM(q.second_sup) - SUM(q.first_sup)) WHEN - 1 THEN SUM(q.first_sup) ELSE SUM(q.second_sup) END, 2)
        END "PERCENT_VARIANCE",
        
        (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit 
        and (d.unit_code = @punit_code or @punit_code is null or @punit_code='') and
                    d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn ='') 
                    and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                    (m.dist_code = @pdist or @pdist is null or @pdist='') and d.edtn in
                    (select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn ='')) 
                    and (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')) first_total_supply        
			    FROM (SELECT DISTINCT a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
    (SELECT ISNULL(SUM(sup_copy), 0)
	from cir_supply
	WHERE comp_code  = @pcomp_code
	 AND (unit  = @punit_code or @punit_code is null or @punit_code ='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR    @pedtn  is null  OR    @pedtn = '')
	 and isnull(cir_supply.supply_flag,'N') =    'Y' 
	 AND cir_supply.agcd  = a.agcd
	 AND cir_supply.dpcd  = a.dpcd
	 AND cir_supply.edtn  in(
		 SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and (cir_supply.supply_type_code = @pextra2 or @pextra2 is null  or @pextra2='')
		 ))	 first_sup,
	 (SELECT ISNULL(SUM(sup_copy), 0)
	FROM  cir_dbksup a
	WHERE comp_code  = @pcomp_code AND    (unit_code  = @punit_code or @punit_code is null or @punit_code='')
	 AND publ  = @ppublication
	 AND (edtn  = @pedtn OR @pedtn  is null OR    @pedtn = '')
	 AND supdate  = @vseconddate
	 AND a.agcd  = a.agcd AND    a.dpcd  = a.dpcd
	 AND a.edtn  in
		(SELECT DISTINCT edtn FROM  cir_edtn_mast
		WHERE comp_code  = @pcomp_code
		 AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
		 AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = '')
		 and  (a.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')
	 )) second_sup
        FROM  cir_dbksup a,cir_dist_mast b,cir_agmast c
        WHERE a.comp_code  = @pcomp_code AND  a.comp_code  = c.comp_code AND b.comp_code  = c.comp_code
         AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='') AND    a.unit_code  = c.unit
         AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
         AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
         AND (c.dist_code  = @pdist OR    @pdist  is null OR    @pdist = '')
         AND c.dist_code  = b.dist_code
         group by a.comp_code ,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname
         ) q
        WHERE ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
        GROUP BY  q.comp_code  ORDER BY q.comp_code
end
else
begin       
       

        SELECT
                 q.comp_code "COMP CODE",
                 SUM(q.first_sup) "FIRST SUPPLY",
                 SUM(q.second_sup) "SECOND SUPPLY",
                CASE sign(ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) WHEN - 1 THEN 0
                ELSE (ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0))
                END "INCREASE SUPPLY",
                 
                CASE sign(ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) WHEN 1 THEN 0
                ELSE (ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0))
                END "DECREASE SUPPLY",
                 
                CASE ISNULL(SUM(q.first_sup), 0) WHEN 0 THEN 100
                ELSE ROUND(((ISNULL(SUM(q.second_sup), 0) - ISNULL(SUM(q.first_sup), 0)) * 100) / CASE sign(SUM(q.second_sup) - SUM(q.first_sup)) WHEN - 1 THEN SUM(q.first_sup) ELSE SUM(q.second_sup) END, 2)
                END "PERCENT_VARIANCE",
                (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit 
        and (d.unit_code = @punit_code or @punit_code is null or @punit_code='') and
                    d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn ='') 
                    and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                    (m.dist_code = @pdist or @pdist is null or @pdist='') and d.edtn in
                    (select distinct edtn from cir_edtn_mast
                    where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn ='')) 
                    and (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2 ='')) first_total_supply   
                    
        FROM (    SELECT DISTINCT a.comp_code comp_code,a.agcd,a.dpcd,c.ag_name,c.ag_name_oth_lang,c.city_code,c.dist_code,b.dist_name,b.dist_oname,
                     (SELECT ISNULL(SUM(sup_copy), 0)
                    FROM  cir_dbksup
                    WHERE comp_code  = @pcomp_code
                     AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
                     AND publ  = @ppublication
                     AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                     AND supdate  = @vfirstdate
                     AND cir_dbksup.agcd  = a.agcd AND    cir_dbksup.dpcd  = a.dpcd
                     AND cir_dbksup.edtn  in
                        (SELECT DISTINCT edtn
                        FROM  cir_edtn_mast
                        WHERE comp_code  = @pcomp_code
                         AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                         AND (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) first_sup,
                     (    SELECT ISNULL(SUM(sup_copy), 0)
                    FROM  cir_dbksup
                    WHERE comp_code  = @pcomp_code AND (unit_code  = @punit_code or @punit_code is null or @punit_code='')
                     AND publ  = @ppublication
                     AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                     AND supdate  = @vseconddate
                     AND cir_dbksup.agcd  = a.agcd AND cir_dbksup.dpcd  = a.dpcd
                     AND cir_dbksup.edtn  in
                        (SELECT DISTINCT edtn
                        FROM  cir_edtn_mast
                        WHERE comp_code  = @pcomp_code
                         AND (edtn  = @pedtn OR    @pedtn  is null OR    @pedtn = '')
                         AND    (main_edtn  = @pmainedtn OR    @pmainedtn  is null OR    @pmainedtn = ''))) second_sup
            FROM  cir_dbksup a,cir_dist_mast b,cir_agmast c
            WHERE a.comp_code  = @pcomp_code AND    a.comp_code  = c.comp_code AND    b.comp_code  = c.comp_code
             AND (a.unit_code  = @punit_code or @punit_code is null or @punit_code='')
              AND    a.unit_code  = c.unit
             AND (a.supdate  = @vfirstdate OR    a.supdate  = @vseconddate)
             AND a.agcd  = c.agcd AND a.dpcd  = c.dpcd
             AND (c.dist_code  = @pdist OR    @pdist  is null OR    @pdist = '')
             AND c.dist_code  = b.dist_code) q
        WHERE ISNULL(second_sup, 0) - ISNULL(first_sup, 0)  <> 0
        GROUP BY  q.comp_code         ORDER BY q.comp_code
end        


///////////////////////next


ALTER PROCEDURE [dbo].[cir_rep_supply_cir_route_supply_variance_p]
	@pcomp_code                               VARCHAR(20) ,
	@punit_code                               VARCHAR(20) ,
	@ppublication                             VARCHAR(20) ,
	@pmainedtn                                VARCHAR(20) ,
	@pedtn                                    VARCHAR(20) ,
	@proute                                   VARCHAR(20) ,
	@pfirstdate                               VARCHAR(20) ,
	@pseconddate                              VARCHAR(20) ,
	@pdateformat                              VARCHAR(20) ,
	@pextra1                                  VARCHAR(200),--it is use for finalised or unfinalised
	@pextra2                                  VARCHAR(200),--it is used for supply type 
	@pextra3             as varchar(200),--agency type
	@pextra4             as varchar(200),-- agency class
	@pextra5             as varchar(200),--final.unfinal
	@pextra6             as varchar(200),
	@pextra7             as varchar(200),
	@pextra8             as varchar(200),
	@pextra9             as varchar(200),
	@pextra10            as varchar(200)
AS 

	DECLARE @vfirstdate                               DATETIME 
	DECLARE @vseconddate                              DATETIME 
Begin		
	SET @vfirstdate  =  dbo.convert_user_date('/',@pfirstdate,@pdateformat)
	SET @vseconddate  = dbo.convert_user_date('/',@pseconddate,@pdateformat)
	print(@vfirstdate)
	print(@vseconddate)

declare @vbase_supply as int
declare @vmon_supply as int
declare @vtue_supply as int
declare @vwed_supply as int
declare @vthu_supply as int
declare @vfri_supply as int
declare @vsat_supply as int
declare @vsun_supply as int
declare @day as varchar(3)
 set @day=upper(datename(dw,@vseconddate))
print(@day)

	If upper(@pextra1)='U' Begin
	

         select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
         dbo.cir_get_city(x.comp_code,x.city_code) "CITY NAME",
         x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",

		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",

		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                 (select isnull(sum(base_supply),0) 
                 from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           --(a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and                           
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                           order by comp_code,route_code,ag_name
		End
        else	Begin
				select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
				x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "INCREASE SUPPLY",

				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "DECREASE SUPPLY",

				CASE SUM(x.first_sup) WHEN 0 THEN 100 
				ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
				END "PERCENT_VARIANCE",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd      =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code=   b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn      =   a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and 
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup                            
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
								   and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
								   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
								   )x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,
									x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                                   order by comp_code,route_code,ag_name
        End
        
        If upper(@pextra1)='U' Begin
				---route wise total
        select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='' ) and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null  or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null  or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                            --(a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           (a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.route_code,x.route_name,x.route_name_oth_lang
                           order by comp_code,route_code
		End
        else	Begin
				----route wise total
                 select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "INCREASE SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "DECREASE SUPPLY",
				CASE SUM(x.first_sup) WHEN 0 THEN 100 
				ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
				END "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code=     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =      a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
										(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
									and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                   ) x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.route_code,x.route_name,x.route_name_oth_lang
                                   order by comp_code,route_code
        End
        
        If upper(@pextra1)='U' Begin
				----comp wise total
        select x.comp_code "COMP CODE",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE",
		(select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
        d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
        (m.dist_code = @proute or @proute is null or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
        where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
        (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
		(select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
          (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code		 = @pcomp_code and unit_code =    @punit_code and
                                 publ			 = @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           --(a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           (a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
							and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code
                           order by comp_code
			End
        else	Begin
        ----comp wise total
                     select x.comp_code "COMP CODE",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
					CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
					ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
					END "INCREASE SUPPLY",

					CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
					ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
					END "DECREASE SUPPLY",

					CASE SUM(x.first_sup) WHEN 0 THEN 100 
					ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
					END "PERCENT_VARIANCE",
                     (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
                            d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn='') and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                            (m.dist_code = @proute or @proute is null  or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                            (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                             publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                             supdate                  =   @vfirstdate and cir_dbksup.comp_code =    b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                             (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                                  (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                             publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                             supdate      = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                       and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
										and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                       and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                       )x
                                 where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code
        End
		 
End


/*	select @vbase_supply=isnull(sum(base_supply),0) from cir_supply,cir_dbksup a,cir_route_mast b
                           where cir_supply.comp_code     =   @pcomp_code and cir_supply.unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (cir_supply.edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')
	case @day
					when 'MON' then isnull(sum(distinct SUPPLY_MON),0) + @vbase_supply
					when 'TUE' then isnull(sum(distinct SUPPLY_TUE),0) + @vbase_supply
					when 'WED' then isnull(sum(distinct SUPPLY_WED),0) + @vbase_supply
					when 'THU' then isnull(sum(distinct SUPPLY_THU),0) + @vbase_supply
					when 'FRI' then isnull(sum(distinct SUPPLY_FRI),0) + @vbase_supply
					when 'SAT' then isnull(sum(distinct SUPPLY_SAT+ @vbase_supply),0) 
					when 'SUN' then isnull(sum(distinct SUPPLY_SUN),0) + @vbase_supply
					else isnull(sum(base_supply),0) end
	*/

///////////////////////////////////////////////////end////////////////////////////////////////////////////////////////




/******************************prachi 14-may 6589*********************/

ALTER procedure [dbo].[cir_fetch_for_unsold_transfer]
    @pcomp_code      as varchar(20),
    @punit_code      as varchar(20),
    @pbran_code      as varchar(20),
    @pprocess_idno   as numeric(20),
    @ppacket_szie    as int,
    @puserid         as varchar(20), 
    @pdateformat     as varchar(20),
    @pextra1         as varchar(20),
    @pextra2         as varchar(20),
    @pextra3         as varchar(20),
    @pextra4         as varchar(20),
    @pextra5         as varchar(20),
    @pextra6         as varchar(20),
    @pextra7         as varchar(20),
    @pextra8         as varchar(20),
    @pextra9         as varchar(20),
    @pextra10        as varchar(20)
as
begin

    select distinct x.comp_code as "COMP_CODE",x.unit_code as "UNIT_CODE",x.branch_code as "BRANCH_CODE",x.doctype as "DOCTYPE",
    x.publ as "PUBL",x.publ_name as"PUBL_NAME", x.main_edtn as "MAIN_EDTN",x.main_edtn_name as "MAIN_EDTN_NAME",
    x.edtn as "EDTN",x.edtn_name as "EDTN_NAME",x.copy_rate as "COPY_RATE",x.total_unsold as "TOTAL_UNSOLD",
    ceiling(cast(x.total_unsold as numeric)/@ppacket_szie) AS "PKT"
    from(
    select distinct d.comp_code,d.unit_code,d.branch_code,d.doctype,
    d.publ,p.publ_name, e.main_edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) main_edtn_name,
    d.edtn,e.edtn_name,d.copy_rate,sum(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0)+isnull(apr_damage,0)) as TOTAL_UNSOLD
    from cir_unsold_hdr h,cir_unsold_dtl d,cir_agmast m,cir_publ_mast p,cir_edtn_mast e,cir_bill_return_print b
    where h.comp_code=d.comp_code and h.comp_code=m.comp_code
     and h.comp_code=p.comp_code and h.comp_code=e.comp_code and h.comp_code=b.comp_code
      and h.comp_code=@pcomp_code 
    and 
    h.unit_code=d.unit_code and h.unit_code=m.unit
     and h.unit_code=b.unit_code 
    and h.unit_code=@punit_code and 
    h.doctype=d.doctype and h.doctype='UCN'
     and h.recptno=d.recptno and h.recptno=b.billno
     and h.recptdt=d.recptdt and h.recptdt=b.billdt
     and
    h.agcd=isnull(d.sup_agcd,d.agcd) and h.agcd=m.agcd 
    and h.dpcd=isnull(d.sup_dpcd,d.dpcd) and h.dpcd=m.dpcd and d.publ=p.publ and d.publ=e.publ and d.edtn=e.edtn
     and  
    d.branch_code=@pbran_code 
    and (isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0)+isnull(apr_damage,0))>0 and b.return_copy=@pprocess_idno
    group by d.comp_code,d.unit_code,d.branch_code,d.doctype,d.publ,p.publ_name,e.main_edtn,d.edtn,e.edtn_name,d.copy_rate) x
    order by comp_code,unit_code,publ_name,main_edtn_name,edtn_name,copy_rate;
    
    select getdate() as "CUR_DATE"
    
    delete from cir_bill_return_print where return_copy=@pprocess_idno
    
End

                                  
ALTER function [dbo].[cir_get_unsold_stock](
      @pcompcode         as varchar(20),
      @punitcode         as varchar(20),
      @pbrancode         as varchar(20),
      @ppublcode         as varchar(20),
      @pedtncode         as varchar(20),
      @pedtnrate         as float,
      @pason_date        as varchar(20),
	  @pprevcopy		 as int,
      @pdateformat       as varchar(20),
      @puserid           as varchar(20),
      @pextra1           as varchar(20),
      @pextra2           as varchar(20)) returns int 
    As
	
	Begin
      declare @v_opbal_unsold		as int
      declare @v_op_branch_rec		as int
      declare @v_op_branch_trf		as int
      declare @v_op_sale		as int
      declare @v_op_resale		as int
      declare @v_op_comp_ret		as int
      declare @v_op_short_excess	as int
      declare @v_opbal			as int
       
		DECLARE @v_dt  DATETIME	
		SET @v_dt  =  DBO.convert_user_date('/', @pason_date,@pdateformat)     
        /*---------unsold balance-------------*/
        select @v_opbal_unsold=isnull(sum(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0)),0)  
        from cir_unsold_dtl 
        where comp_code=@pcompcode and unit_code=@punitcode and doctype='UCN' and recptdt<=@v_dt and publ=@ppublcode and edtn=@pedtncode and
        copy_rate=@pedtnrate and (branch_code=@pbrancode or @pbrancode is null);

        /*---------Branch Received-------------*/
        select @v_op_branch_rec=isnull(sum(edtn_copy),0) from cir_branch_return_det 
            where comp_code=@pcompcode and unit_code=@punitcode and doctype='TI' and recptdt<=@v_dt and
            publ_code=@ppublcode and edtn_code=@pedtncode and edtn_rate=@pedtnrate and (branch_code=@pbrancode or @pbrancode is null)
        
        /*---------Branch Transfered------------*/
        select @v_op_branch_trf=isnull(sum(edtn_copy),0) from cir_branch_return_det 
            where comp_code=@pcompcode and unit_code=@punitcode and doctype='TRF' and recptdt<=@v_dt and
            publ_code=@ppublcode and edtn_code=@pedtncode and edtn_rate=@pedtnrate and (branch_code=@pbrancode or @pbrancode is null)

        /*---------Raddi sale-------------*/            
        select @v_op_sale=isnull(sum(no_of_copy),0) from cir_return_sale_det
            where comp_code=@pcompcode and unit_code=@punitcode and doctype='RET' and recptdt<=@v_dt and
            publ_code=@ppublcode and edtn_code=@pedtncode and edtn_rate=@pedtnrate and (branch_code=@pbrancode or @pbrancode is null)

        /*---------Distribution Return-------------*/
        select @v_op_comp_ret=isnull(sum(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0)),0)  
        from cir_unsold_dtl_dis 
            where comp_code=@pcompcode and unit_code=@punitcode and doctype='UCN' and recptdt<=@v_dt and publ=@ppublcode and edtn=@pedtncode and
            copy_rate=@pedtnrate and (branch_code=@pbrancode or @pbrancode is null);

        /*---------Resale copy-------------*/    
        select @v_op_resale=isnull(sum(sup_copy),0) from cir_dbksup_resale 
            where comp_code=@pcompcode and unit_code=@punitcode and publ=@ppublcode and edtn=@pedtncode and
                  supdate<=@v_dt and sup_rate=@pedtnrate and isnull(return_copy_sale,'N')='Y' 
                  and (resale_branch=@pbrancode or @pbrancode is null)
            
        /*---------Short Excepss Copy-------------*/
        select @v_op_short_excess=isnull(sum(isnull(short_excess,1)*no_of_copy),0)  from cir_physical_ver_det
            where comp_code=@pcompcode and unit_code=@punitcode and doctype='VR' and recptdt<=@v_dt and
            publ_code=@ppublcode and edtn_code=@pedtncode and edtn_rate=@pedtnrate and (branch_code=@pbrancode or @pbrancode is null);

        set @v_opbal=isnull(@v_opbal_unsold,0)+isnull(@v_op_branch_rec,0)-isnull(@v_op_branch_trf,0)-isnull(@v_op_sale,0)-isnull(@v_op_comp_ret,0)-isnull(@v_op_resale,0)+isnull(@v_op_short_excess,0)-isnull(@pprevcopy,0)
            
        return isnull(@v_opbal,0)
        
End 





/******************************prachi 14-may 6589*********************/


//////////////////////////////add by Deepika 14/05/2012 sent by Amit tomer sir/////////////////////////////////

ALTER PROCEDURE [dbo].[cir_rep_supply_cir_rep_supply1]
	@pcomp_code			VARCHAR(40) ,
	@punit_code         VARCHAR(40) ,
	@ppubl              VARCHAR(40) ,
	@pmainedtn          VARCHAR(40) ,
	@pedtn              VARCHAR(40) ,
	@proute             VARCHAR(40) ,
	@pfrom_supdate      DATETIME ,
	@ptill_supdate      DATETIME ,
	@pdateformat        VARCHAR(40) ,
    @pextra1            VARCHAR(40) ,--for branch
    @pextra2            VARCHAR(40) ,--for state,
	@pextra3			VARCHAR(40) ,--this is use to final and unfinal po Y for Final And N for unfinal
	@pextra4            VARCHAR(40) ,--for zone,
	@pextra5            VARCHAR(40) ,--for region
	@pextra6            VARCHAR(40) ,--for district
	@pextra7            VARCHAR(40) ,--for taluka
	@pextra8            VARCHAR(40) ,--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,other than statewise
	@pextra9            VARCHAR(40) , -- it is using for standing order / posting
	@pextra10           VARCHAR(40)
AS 
BEGIN
	DECLARE @vfrom_supdate	varchar(20);
	DECLARE @vtill_supdate  varchar(20);
	declare @vsup_seq_no	int
	
	
	DECLARE @supply_type_name	VARCHAR(4000)
	DECLARE @supply_sum			VARCHAR(4000) 
	DECLARE @vvar               VARCHAR(4000) 
	DECLARE @vvar_sum           VARCHAR(4000) 
	DECLARE @vquery             VARCHAR(8000) 
	DECLARE @vquery1            VARCHAR(8000) 
	DECLARE @vquery2            VARCHAR(8000) 
	DECLARE @vquery3            VARCHAR(8000) 
	DECLARE @vquery4            VARCHAR(8000) 
	
	SET @vfrom_supdate  =@pfrom_supdate
	SET @vtill_supdate  = @ptill_supdate
	
	if @pextra9 = '2' begin
	DECLARE cur_sup_type cursor LOCAL FOR 
		select distinct ' sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) "'+sup_ty_name+'",' vty,
		'sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) +' vty_sum,sup_seq_no
		from cir_supply_type_mast s, cir_supply d,cir_edtn_mast e
		where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code 
		and s.sup_ty_code =d.supply_type_code and
		(d.unit=isnull(@punit_code,d.unit) or @punit_code='') and d.publ=e.publ and 
		(d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
		d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
		(e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
		order by sup_seq_no;
		
		OPEN cur_sup_type 
		fetch NEXT FROM cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
			while(@@FETCH_STATUS = 0) BEGIN
				set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@supply_type_name + '', SPACE(0))
				set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@supply_sum + '', SPACE(0))

		fetch NEXT from cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
		end
		close cur_sup_type
		
		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)
	end
	else
	begin
		DECLARE cur_sup_type cursor LOCAL FOR 
		select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
		'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
		from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
		where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code 
		and s.sup_ty_code =d.sup_type_code and
		(d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ 
		and (d.publ=isnull(@ppubl,d.publ) or @ppubl='') 
		and d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
		d.supdate between @pfrom_supdate and @ptill_supdate and
		(e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
		order by sup_seq_no;
		
		OPEN cur_sup_type 
		fetch NEXT FROM cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
			while(@@FETCH_STATUS = 0) BEGIN
				set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@supply_type_name + '', SPACE(0))
				set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@supply_sum + '', SPACE(0))

		fetch NEXT from cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
		end
		close cur_sup_type
		
		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)
	end	
		
	
	
	print('here')
	print(@vvar)
	print(@vvar_sum)	
	print('close')
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9 = '1' 
begin

		if @pextra8='1' Begin--for route
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) ROUTE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		if @pextra8='2' Begin----for  branch
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,dbo.cir_get_branch(d.comp_code,m.branch_code) BRANCH_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit_code,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end

		if @pextra8='3' Begin----for  zone
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,
			dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,
			d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,
			c.zone_code ZONE_CODE,
			dbo.cir_get_zone_name(d.comp_code,c.zone_code) ZONE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit_code,d.publ,d.edtn,zone_code,d.agcd,d.dpcd'                
				print @vquery 
				EXEC (@vquery)
		end
		print('ch2')
		if @pextra8='4' Begin----for  region
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,
			dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,
			dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,
			c.region_code REGION_CODE,dbo.cir_get_region_name(d.comp_code,c.region_code) REGION_NAME,
			d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		print('ch3')
		if @pextra8='5' Begin----for  district
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''1'',null,null,null) DIST_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+'''
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,dist_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end

		if @pextra8='6' Begin----for Taluka
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) TALUKA_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,taluka_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		if @pextra8='7' Begin----for State
			set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE
			--,dbo.cir_get_state1(d.comp_code,m.state_code) STATE_NAME
			,dbo.cir_get_state(d.comp_code,m.COUNTRY_CODE,m.state_code) STATE_NAME
			,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
				c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname ,m.COUNTRY_CODE
				order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
				SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code order by d.comp_code,d.unit_code'
				print @vquery1
				EXEC (@vquery1)
				
		if @pextra8='1' Begin--for route
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
					from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
					where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='2' Begin--for branch
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+'''
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='3' Begin--for Zone
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='4' Begin--for region
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+'''
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code'
			print('r1')
			print @vquery2
			EXEC (@vquery2)
		end

		if @pextra8='5' Begin--for District
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='6' Begin--for Taluka
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka order by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka'
			print @vquery2
			EXEC (@vquery2)
		end

		if @pextra8='7' Begin--for state
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code'
			print @vquery2
			EXEC (@vquery2)
		end

		SET @vquery3  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit_code,d.publ,d.edtn order by d.comp_code,d.unit_code,d.publ,d.edtn'
		print @vquery3
		EXEC (@vquery3)

		SET @vquery4  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
					and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ'
		print @vquery4
		EXEC (@vquery4)
end
else
begin
print('new') print(@vvar)
		if @pextra8='1' Begin--for route
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) ROUTE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT"
				, '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		if @pextra8='2' Begin----for  branch
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,dbo.cir_get_branch(d.comp_code,m.branch_code) BRANCH_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end

		if @pextra8='3' Begin----for  zone
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,
			dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,
			d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,
			c.zone_code ZONE_CODE,
			dbo.cir_get_zone_name(d.comp_code,c.zone_code) ZONE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
					order by d.comp_code,d.unit,d.publ,d.edtn,zone_code,d.agcd,d.dpcd'                
				print @vquery 
				EXEC (@vquery)
		end
		print('ch2')
		if @pextra8='4' Begin----for  region
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,
			dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,
			dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,
			c.region_code REGION_CODE,dbo.cir_get_region_name(d.comp_code,c.region_code) REGION_NAME,
			d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		print('ch3')
		if @pextra8='5' Begin----for  district
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''1'',null,null,null) DIST_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+'''
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,dist_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end

		if @pextra8='6' Begin----for Taluka
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) TALUKA_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
				isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,taluka_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
		if @pextra8='7' Begin----for State
			set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE
			--,dbo.cir_get_state1(d.comp_code,m.state_code) STATE_NAME
			,dbo.cir_get_state(d.comp_code,m.COUNTRY_CODE,m.state_code) STATE_NAME
			,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
				substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
				c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname ,m.COUNTRY_CODE
				order by d.comp_code,d.unit,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd'
		                
				print @vquery 
				EXEC (@vquery)
		end
				SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit order by d.comp_code,d.unit'
				print @vquery1
				EXEC (@vquery1)
				
		if @pextra8='1' Begin--for route
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
					from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
					where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,d.route_code order by d.comp_code,d.unit,d.publ,d.edtn,d.route_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='2' Begin--for branch
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+'''
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code order by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='3' Begin--for Zone
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code order by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='4' Begin--for region
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+'''
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')   
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,d.publ,d.edtn,c.region_code order by d.comp_code,d.unit,d.publ,d.edtn,c.region_code'
			print('r1')
			print @vquery2
			EXEC (@vquery2)
		end

		if @pextra8='5' Begin--for District
				SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code order by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code'
				print @vquery2
				EXEC (@vquery2)
		end

		if @pextra8='6' Begin--for Taluka
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka order by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka'
			print @vquery2
			EXEC (@vquery2)
		end

		if @pextra8='7' Begin--for state
			SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,d.publ,d.edtn,m.state_code order by d.comp_code,d.unit,d.publ,d.edtn,m.state_code'
			print @vquery2
			EXEC (@vquery2)
		end

		SET @vquery3  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,'+@vvar+','+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
					group by d.comp_code,d.unit,d.publ,d.edtn order by d.comp_code,d.unit,d.publ,d.edtn'
		print @vquery3
		EXEC (@vquery3)

		SET @vquery4  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,'+@vvar+','+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
				where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
					m.unit=d.unit and d.unit='''+@punit_code+''' 
					--and (isnull(final_supply_flag,''N'') = '''+@pextra3+'''  or '''+@pextra3+''' is null or '''+@pextra3+'''='''')  
					and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
					and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
					and m.agcd=d.agcd and m.dpcd=d.dpcd 
					--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
					
					and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
					and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
					and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
					and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
					and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
					and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
					and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
					and m.city_code=c.city_code 
					and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
				group by d.comp_code,d.unit,d.publ order by d.comp_code,d.unit,d.publ'
		print @vquery4
		EXEC (@vquery4)
end


DEALLOCATE cur_sup_type

END


////////////////////////////
ALTER PROCEDURE [dbo].[cir_rep_supply_cir_route_supply_variance_multiple_p]
	@pcomp_code                               VARCHAR(20) ,
	@punit_code                               VARCHAR(20) ,
	@ppublication                             VARCHAR(20) ,
	@pmainedtn                                VARCHAR(20) ,
	@pedtn                                    VARCHAR(20) ,
	@proute                                   VARCHAR(20) ,
	@pfirstdate                               VARCHAR(20) ,
	@pseconddate                              VARCHAR(20) ,
	@pthirddate                               VARCHAR(20) ,
	@pdateformat                              VARCHAR(20) ,
	@pextra1                                  VARCHAR(200),--it is use for finalised or unfinalised
	@pextra2                                  VARCHAR(200),--it is used for supply type 
	@pextra3             as varchar(200),--agency type
	@pextra4             as varchar(200),-- agency class
	@pextra5             as varchar(200),--final.unfinal
	@pextra6             as varchar(200),
	@pextra7             as varchar(200),
	@pextra8             as varchar(200),
	@pextra9             as varchar(200),
	@pextra10            as varchar(200)
AS 

	DECLARE @vfirstdate                               DATETIME 
	DECLARE @vseconddate                              DATETIME 
	DECLARE @vthirddate                               DATETIME 
Begin		
	SET @vfirstdate  =  dbo.convert_user_date('/',@pfirstdate,@pdateformat)
	SET @vseconddate  = dbo.convert_user_date('/',@pseconddate,@pdateformat)
	SET @vthirddate  = dbo.convert_user_date('/',@pthirddate,@pdateformat)
	print(@vfirstdate)
	print(@vseconddate)
	print(@vthirddate)

	If upper(@pextra1)='U' Begin
         select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
         dbo.cir_get_city(x.comp_code,x.city_code) "CITY NAME",
         x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG"
         ,sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",sum(x.third_sup) "THIRD SUPPLY",
         -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C",
		
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and                           
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                           order by comp_code,route_code,ag_name
		End
        else	Begin
				select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
				x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				sum(x.third_sup) "THIRD SUPPLY",
           -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd      =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code=   b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn      =   a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and 
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                             (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
								   and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
								   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
								   )x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,
									x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                                   order by comp_code,route_code,ag_name
        End
        
        If upper(@pextra1)='U' Begin
				---route wise total
        select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY"
		,sum(x.third_sup) "THIRD SUPPLY",
          -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='' ) and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null  or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null  or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                     (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null  or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null  or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.route_code,x.route_name,x.route_name_oth_lang
                           order by comp_code,route_code
		End
        else	Begin
				----route wise total
                 select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
                 sum(x.third_sup) "THIRD SUPPLY",
           -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C"
		 from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code=     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =      a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
										(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
										(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
									and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                   ) x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.route_code,x.route_name,x.route_name_oth_lang
                                   order by comp_code,route_code
        End
        
        If upper(@pextra1)='U' Begin
				----comp wise total
        select x.comp_code "COMP CODE",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		sum(x.third_sup) "THIRD SUPPLY",
          -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C"		,
		(select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
        d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
        (m.dist_code = @proute or @proute is null or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
        where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
        (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
		(select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
          (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code		 = @pcomp_code and unit_code =    @punit_code and
                                 publ			 = @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                     (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code		 = @pcomp_code and unit_code =    @punit_code and
                                 publ			 = @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup            
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
							and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code
                           order by comp_code
			End
        else	Begin
        ----comp wise total
                     select x.comp_code "COMP CODE",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
					sum(x.third_sup) "THIRD SUPPLY",
           -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C"	,
                     (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
                            d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn='') and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                            (m.dist_code = @proute or @proute is null  or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                            (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                             publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                             supdate                  =   @vfirstdate and cir_dbksup.comp_code =    b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                             (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                                  (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                             publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                             supdate      = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                                (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                             publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                             supdate      = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                       and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
										and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                       and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                       )x
                                 where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code
        End
		 
End


/////////////////////////////////////////////////////

ALTER PROCEDURE [dbo].[cir_rep_supply_cir_route_supply_variance_p]
	@pcomp_code                               VARCHAR(20) ,
	@punit_code                               VARCHAR(20) ,
	@ppublication                             VARCHAR(20) ,
	@pmainedtn                                VARCHAR(20) ,
	@pedtn                                    VARCHAR(20) ,
	@proute                                   VARCHAR(20) ,
	@pfirstdate                               VARCHAR(20) ,
	@pseconddate                              VARCHAR(20) ,
	@pdateformat                              VARCHAR(20) ,
	@pextra1                                  VARCHAR(200),--it is use for finalised or unfinalised
	@pextra2                                  VARCHAR(200),--it is used for supply type 
	@pextra3             as varchar(200),--agency type
	@pextra4             as varchar(200),-- agency class
	@pextra5             as varchar(200),--final.unfinal
	@pextra6             as varchar(200),
	@pextra7             as varchar(200),
	@pextra8             as varchar(200),
	@pextra9             as varchar(200),
	@pextra10            as varchar(200)
AS 

	DECLARE @vfirstdate                               DATETIME 
	DECLARE @vseconddate                              DATETIME 
Begin		
	SET @vfirstdate  =  dbo.convert_user_date('/',@pfirstdate,@pdateformat)
	SET @vseconddate  = dbo.convert_user_date('/',@pseconddate,@pdateformat)
	print(@vfirstdate)
	print(@vseconddate)

declare @vbase_supply as int
declare @vmon_supply as int
declare @vtue_supply as int
declare @vwed_supply as int
declare @vthu_supply as int
declare @vfri_supply as int
declare @vsat_supply as int
declare @vsun_supply as int
declare @day as varchar(3)
 set @day=upper(datename(dw,@vseconddate))
print(@day)

	If upper(@pextra1)='U' Begin
	

         select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
         dbo.cir_get_city(x.comp_code,x.city_code) "CITY NAME",
         x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",

		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",

		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                 (select isnull(sum(base_supply),0) 
                 from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           --(a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and                           
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                           order by comp_code,route_code,ag_name
		End
        else	Begin
				select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
				x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "INCREASE SUPPLY",

				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "DECREASE SUPPLY",

				CASE SUM(x.first_sup) WHEN 0 THEN 100 
				ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
				END "PERCENT_VARIANCE",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd      =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code=   b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn      =   a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and 
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup                            
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
								   and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
								   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
								   )x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,
									x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                                   order by comp_code,route_code,ag_name
        End
        
        If upper(@pextra1)='U' Begin
				---route wise total
        select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='' ) and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null  or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null  or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                            --(a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           (a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.route_code,x.route_name,x.route_name_oth_lang
                           order by comp_code,route_code
		End
        else	Begin
				----route wise total
                 select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "INCREASE SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "DECREASE SUPPLY",
				CASE SUM(x.first_sup) WHEN 0 THEN 100 
				ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
				END "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code=     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =      a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
										(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
									and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                   ) x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.route_code,x.route_name,x.route_name_oth_lang
                                   order by comp_code,route_code
        End
        
        If upper(@pextra1)='U' Begin
				----comp wise total
        select x.comp_code "COMP CODE",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE",
		(select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
        d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
        (m.dist_code = @proute or @proute is null or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
        where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
        (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
		(select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
          (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code		 = @pcomp_code and unit_code =    @punit_code and
                                 publ			 = @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           --(a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           (a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
							and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code
                           order by comp_code
			End
        else	Begin
        ----comp wise total
                     select x.comp_code "COMP CODE",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
					CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
					ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
					END "INCREASE SUPPLY",

					CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
					ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
					END "DECREASE SUPPLY",

					CASE SUM(x.first_sup) WHEN 0 THEN 100 
					ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
					END "PERCENT_VARIANCE",
                     (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
                            d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn='') and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                            (m.dist_code = @proute or @proute is null  or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                            (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                             publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                             supdate                  =   @vfirstdate and cir_dbksup.comp_code =    b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                             (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                                  (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                             publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                             supdate      = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                       and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
										and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                       and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                       )x
                                 where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code
        End
		 
End


/*	select @vbase_supply=isnull(sum(base_supply),0) from cir_supply,cir_dbksup a,cir_route_mast b
                           where cir_supply.comp_code     =   @pcomp_code and cir_supply.unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (cir_supply.edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')
	case @day
					when 'MON' then isnull(sum(distinct SUPPLY_MON),0) + @vbase_supply
					when 'TUE' then isnull(sum(distinct SUPPLY_TUE),0) + @vbase_supply
					when 'WED' then isnull(sum(distinct SUPPLY_WED),0) + @vbase_supply
					when 'THU' then isnull(sum(distinct SUPPLY_THU),0) + @vbase_supply
					when 'FRI' then isnull(sum(distinct SUPPLY_FRI),0) + @vbase_supply
					when 'SAT' then isnull(sum(distinct SUPPLY_SAT+ @vbase_supply),0) 
					when 'SUN' then isnull(sum(distinct SUPPLY_SUN),0) + @vbase_supply
					else isnull(sum(base_supply),0) end
	*/

//////////////////////////////////////////

ALTER PROCEDURE [dbo].[cir_rep_supply_temp]
@pcomp_code         as varchar(200),
@punit_code         as varchar(200),
@ppubl              as varchar(200),
@pmainedtn          as varchar(200),
@pedtn              as varchar(200),
@proute             as varchar(200),
@pfrom_supdate      as datetime,
@ptill_supdate      as datetime,
@pdateformat        as varchar(200),
@pextra1            as varchar(200),--for branch
@pextra2            as varchar(200),--for State
@pextra3            as varchar(200),--this is use to final and unfinal po
@pextra4            as varchar(200),--for zone,
@pextra5            as varchar(200),--for region
@pextra6            as varchar(200),--for district
@pextra7            as varchar(200),--for taluka
@pextra8            as varchar(200),--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,other than statewise
@pextra9            as varchar(200),
@pextra10           as varchar(200)

AS

declare @vfrom_supdate    varchar(20);
declare @vtill_supdate    varchar(20);
declare @rec_sup_type		as varchar(200) 
declare @rec_sup_type_sum	as varchar(200) 
declare @rec_sup_seq_no		as int

if @pextra9 ='2' begin
	DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_supply d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.supply_type_code and
    (d.unit=isnull(@punit_code,d.unit) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    --d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;
end
else
begin
	DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.sup_type_code and
    (d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;
end
	declare @vvar		varchar(4000)
	declare @vvar_sum	varchar(4000)
	declare @vquery		varchar(8000)

	set @vvar=''
	set @vvar_sum=''
 
	set @vfrom_supdate=convert(varchar(20),@pfrom_supdate,101)
	set @vtill_supdate=convert(varchar(20),@ptill_supdate,101)

	print('@vfrom_supdate')print(@vfrom_supdate);
	print('@vtill_supdate')print(@vtill_supdate);

if @pextra9 ='2' begin
	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type
end
else
begin
	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type
end
	print('@vvar')print(@vvar)
	print('@vvar_sum')print(@vvar_sum)

	set @vvar    =substring(@vvar,1,len(@vvar)-1)
	set @vvar_sum=substring(@vvar_sum,1,len(@vvar_sum)-1)
	print('@vvar2')print(@vvar)
	print('@vvar_sum2')print(@vvar_sum)
   
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9 ='2' begin
	if @pextra8='1' begin----for route 
		set @vquery='select d.comp_code comp_code,d.unit unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
			d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) route_name,
			dbo.cir_get_name_cir_route(d.comp_code,d.unit,d.route_code,''2'',null,null,null) route_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 								
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,d.publ,d.route_code
			order by d.comp_code,d.unit,d.publ,route_name';

	end ------ route	
	else if @pextra8='2' begin----for  branch
		set @vquery='select d.comp_code comp_code,d.unit unit_code,m.branch_code branch_code,
	dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
	 '+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 								
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	 group by d.comp_code,d.unit,m.branch_code
	order by d.comp_code,d.unit,branch_name'

	end ---- branch		
	else if @pextra8='3' begin----for  zone  
	 
	set @vquery=' select d.comp_code comp_code,d.unit unit_code,c.zone_code,
		dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 				
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit,c.zone_code
		order by d.comp_code,d.unit,zone_name';

	end  ---- zone
	else if @pextra8='4' begin----for  region   
		set @vquery='  select d.comp_code comp_code,d.unit unit_code,c.region_code,
		dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 				
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit,c.region_code
		order by d.comp_code,d.unit,region_name';

	end ---- end  region
	else if @pextra8='5' begin----for  district

		set @vquery='select d.comp_code comp_code,d.unit unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
		dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
					from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 				
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit,m.state_code,m.dist_code
			order by d.comp_code,d.unit,m.state_code,district_name	'

	end  ---- district
	else if @pextra8='6' begin----for  tehsil_taluka

		set @vquery='  select d.comp_code comp_code,d.unit unit_code,m.tehsil_taluka tehsil_taluka,
		dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
		dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit,m.tehsil_taluka
		order by d.comp_code,d.unit,taluka_name';
	end  ----for  tehsil_taluka

	else begin
		set @vquery='select d.comp_code comp_code,d.unit unit_code,m.country_code country_code,
		m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
		 ,'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit and d.unit='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 				
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit,m.country_code,m.state_code
		order by d.comp_code,d.unit,m.country_code,state_name';
	end
end
else
begin
		if @pextra8='1' begin----for route 
		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
			d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
			dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.route_code
			order by d.comp_code,d.unit_code,d.publ,route_name';

	end ------ route	
	else if @pextra8='2' begin----for  branch
		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.branch_code branch_code,
	dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
	 '+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	 group by d.comp_code,d.unit_code,m.branch_code
	order by d.comp_code,d.unit_code,branch_name'

	end ---- branch		
	else if @pextra8='3' begin----for  zone  
	 
	set @vquery=' select d.comp_code comp_code,d.unit_code unit_code,c.zone_code,
		dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,c.zone_code
		order by d.comp_code,d.unit_code,zone_name';

	end  ---- zone
	else if @pextra8='4' begin----for  region   
		set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,c.region_code,
		dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,c.region_code
		order by d.comp_code,d.unit_code,region_name';

	end ---- end  region
	else if @pextra8='5' begin----for  district

		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
		dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
					from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			group by d.comp_code,d.unit_code,m.state_code,m.dist_code
			order by d.comp_code,d.unit_code,m.state_code,district_name	'

	end  ---- district
	else if @pextra8='6' begin----for  tehsil_taluka

		set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,m.tehsil_taluka tehsil_taluka,
		dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
		dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
		'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,m.tehsil_taluka
		order by d.comp_code,d.unit_code,taluka_name';
	end  ----for  tehsil_taluka

	else begin
		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.country_code country_code,
		m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
		 ,'+@vvar+' ,'+@vvar_sum+' TOTAL 
				from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
				m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
				and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
				and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
				and m.agcd=d.agcd and m.dpcd=d.dpcd 
				and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
				and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
				and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
				and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
				and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
				and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
				and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
				and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
				and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
				and m.city_code=c.city_code 
				and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		group by d.comp_code,d.unit_code,m.country_code,m.state_code
		order by d.comp_code,d.unit_code,m.country_code,state_name';
	end
end
print(@vquery)
exec(@vquery)


////////////////////////////////////////////////////////////////////end///////////////////////////////////////////////


///////////////////////////ADD BY deepika for issue no. 4543 14/05/2012////////////////////////////////////////////




ALTER procedure [dbo].[cir_area_break_down]

(
     @pcomp_code         as varchar(100),
    @punit_code         as varchar(100),
    @pbrancode          as varchar(100),
    @ppublcode          as varchar(100),
    @pmedtncode         as varchar(100),
    @pedtncode          as varchar(100),
    @pagtype            as varchar(100),

    @pzonecode          as varchar(100),
    @pregioncode        as varchar(100),
    @pstatecode         as varchar(100),
    @pdistcode          as varchar(100),

    @pfromdate          as varchar(100),
    @ptilldate          as varchar(100),
    @psup_copy          as NUMERIC,
    @psup_baseon        as varchar(100),--it is used for Gross(G)/Average(A)
    @pdateformat        as varchar(100),
    @puserid            as varchar(100),
    @pbreakon           as NUMERIC,--it is used for Grouping on Zone(1)/Region(2)/State(3)/Branch(4)/District(5)/Taluka(6)
    @pdatashow          as NUMERIC,--it is used for data show Agency(1)/City(2)
    @pextra1            as varchar(100),
    @pextra2            as varchar(100),
    @pextra3            as varchar(100),
    @pextra4            as varchar(100),
    @pextra5            as varchar(100)

)


  As


declare @v_zero as    varchar(800);
declare @v_comp_code  as     varchar(800);
declare @v_unit  as     varchar(800);
declare @v_agcd as     varchar(800);
declare @v_dpcd as     varchar(800);
declare @v_agency_name as    varchar(800);
declare @v_zone_name as     varchar(800);
declare @v_region_name as     varchar(800);
declare @v_state_name as     varchar(800);
declare @v_branch_name as     varchar(800);
declare @v_dist_name as    varchar(800);
declare @v_taluka_name as     varchar(800);
declare @v_city_name as     varchar(800);
declare @v_sup_copy as     varchar(800);
declare @v_null as      varchar(800);


CREATE TABLE #CIR_TEMP_BILL_COLLECTION
(
  COMP_CODE        VARCHAR(100),
  UNIT_CODE        VARCHAR(100),
  BILLNO           VARCHAR(200),
  BILLDT           DATETIME,
  PUBL_CODE        VARCHAR(100),
  AGCD             VARCHAR(100 ),
  DPCD             VARCHAR(100 ),
  SUPPLY_COPY      NUMERIC(10)                   DEFAULT 0,
  GROSS_AMT        NUMERIC(15,2)                 DEFAULT 0,
  COMM_AMT         NUMERIC(15,2)                 DEFAULT 0,
  SUR_AMT          NUMERIC(15,2)                 DEFAULT 0,
  RETURN_COPY      NUMERIC(10)                   DEFAULT 0,
  RETURN_AMT       NUMERIC(15,2)                 DEFAULT 0,
  DN_AMT           NUMERIC(15,2)                 DEFAULT 0,
  CN_AMT           NUMERIC(15,2)                 DEFAULT 0,
  REC_AMT          NUMERIC(15,2)                 DEFAULT 0,
  PREV_BAL         NUMERIC(15,2)                 DEFAULT 0,
  CUR_SESSIONID    NUMERIC,
  AGNAME           VARCHAR(200 ),
  AGNAME_OTH_LANG  VARCHAR(250 ),
  CITY_CODE        VARCHAR(200 ),
  TALUKA_CODE      VARCHAR(200 ),
  DIST_CODE        VARCHAR(200 ),
  STATE_CODE       VARCHAR(200 ),
  REMARKS          VARCHAR(500 ),
  RET_COMM_AMT     NUMERIC(15,2),
  BILL_SEC_AMT     NUMERIC(15,2),
  SEC_OPBAL        NUMERIC(15,2)

)


declare @v_frdt    as  datetime;
declare @v_todt    as  datetime;

set @v_frdt   =@pfromdate
set @v_todt   =@ptilldate

declare cur_supply cursor for


--SELECT DISTINCT X.sup_copy FROM(
    select a.comp_code comp_code,a.unit unit,a.agcd agcd,a.dpcd dpcd,a.ag_name agency_name,
 --d.zone_code zone_code,
dbo.cir_get_zone_name(a.comp_code,d.zone_code) zone_name,
    --d.region_code region,
dbo.cir_get_region_name(a.comp_code,d.region_code) region_name,
    --a.state_code state_code,
dbo.cir_get_state(a.comp_code,a.country_code,a.state_code) state_name,
    --a.dist_code dist_code,
       a.branch_code branch_code,
  
dbo.cir_get_dist(a.comp_code,a.state_code,a.dist_code) dist_name,
   -- isnull(a.abc_citycode,a.city_code) city_code,
   dbo.cir_get_taluka(a.comp_code,a.tehsil_taluka) taluka_name,
d.city_name city_name,
  null branch_name,
 sum(b.sup_copy) sup_copy,
    a.tehsil_taluka taluka_code

    from cir_agmast a,cir_dbksup b,cir_edtn_mast c,cir_city_mast d
    where a.comp_code=b.comp_code and a.comp_code=c.comp_code and a.comp_code=d.comp_code and a.comp_code=@pcomp_code 
and        a.unit=@punit_code and a.unit=b.unit_code 
and a.unit=c.unit_code and a.agcd=b.agcd and a.dpcd=b.dpcd 
and        b.supdate>=@v_frdt and b.supdate<=@v_todt 
and b.publ=c.publ 
--and b.publ=isnull(@ppublcode,b.publ) 
and b.edtn=c.edtn and  b.edtn=isnull(@pedtncode, b.edtn) 
and c.main_edtn=isnull(@pmedtncode, c.main_edtn) 
--and        isnull(a.abc_citycode,a.city_code)=d.city_code 
and (d.zone_code=@pzonecode or @pzonecode is null OR  @pzonecode='') 
and (d.region_code=@pregioncode  or @pregioncode is null OR  @pregioncode='')
  /*******************new added*************/
        and (d.dist_code=@pdistcode  or @pdistcode is null or @pdistcode='')
        and (d.state_code=@pstatecode  or @pstatecode is null or @pstatecode='')
        and (a.branch_code=@pbrancode  or @pbrancode is null or @pbrancode='')
         and (a.ag_type=@pagtype  or @pagtype is null or @pagtype='')
          and (b.sup_copy=@psup_copy  or @psup_copy is null )
           /*******************new added*************/
        group by a.comp_code,a.unit,a.agcd,a.dpcd,a.ag_name,a.country_code,a.state_code,a.dist_code,isnull(a.abc_citycode,a.city_code),d.city_name,d.zone_code,d.region_code,a.tehsil_taluka,a.branch_code

begin
set @v_null= null
open cur_supply
fetch next from  cur_supply INTO 

@v_comp_code,@v_unit,@v_agcd,@v_dpcd,@v_agency_name,@v_zone_name,@v_region_name,@v_state_name,
            @v_branch_name,@v_dist_name,@v_taluka_name,@v_city_name,@v_null,@v_sup_copy,@v_zero


WHILE (@@FETCH_STATUS = 0) 
	BEGIN  
PRINT('2')
        insert into #cir_temp_bill_collection(comp_code,unit_code,agcd,dpcd,agname, agname_oth_lang ,remarks ,state_code,
            billno,dist_code,taluka_code,city_code,publ_code,supply_copy,return_copy)
        values(@v_comp_code,@v_unit,@v_agcd,@v_dpcd,@v_agency_name,@v_zone_name,@v_region_name,@v_state_name,
            @v_branch_name,@v_dist_name,@v_taluka_name,@v_city_name,null,@v_sup_copy,0);






fetch next from  cur_supply INTO 

@v_comp_code,@v_unit,@v_agcd,@v_dpcd,@v_agency_name,@v_zone_name,@v_region_name,@v_state_name,
            @v_branch_name,@v_dist_name,@v_taluka_name,@v_city_name,@v_null,@v_sup_copy,@v_zero




END


	close cur_supply
	deallocate cur_supply



if (@pbreakon='1') begin --zone wise
       print('3') 
        select a.comp_code comp_code,a.unit_code unit_code,
        a.agname_oth_lang zone_code,a.city_code city_name,
        sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 

        group by a.comp_code,a.unit_code,a.agname_oth_lang,a.city_code
        order by comp_code,unit_code,zone_code,city_name;

       
        select a.comp_code comp_code,a.unit_code unit_code,
        a.agname_oth_lang zone_code,sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 
        group by a.comp_code,a.unit_code,a.agname_oth_lang
        order by comp_code,unit_code,agname_oth_lang;

end

   if (@pbreakon='2')
 begin --region wise
        print('4')
        select a.comp_code comp_code,a.unit_code unit_code,
        a.remarks region_name,
        a.city_code city_name,
        sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 

        group by a.comp_code,a.unit_code,a.remarks,a.city_code
        order by comp_code,unit_code,region_name,city_name;

        
        select a.comp_code comp_code,a.unit_code unit_code,
        a.remarks region_name,sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 

        group by a.comp_code,a.unit_code,a.remarks
        order by comp_code,unit_code,region_name;

end
   
IF (@PBREAKON='3')
 BEGIN --STATE WISE
       print('5')
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        A.STATE_CODE STATE_NAME,
        A.DIST_CODE DIST_NAME,
        A.CITY_CODE CITY_NAME,
        A.TALUKA_CODE TALUKA_NAME,SUM(A.SUPPLY_COPY) GROSS_COPY,
        0 LESS_COPY,0 ABOVE_COPY
        FROM #CIR_TEMP_BILL_COLLECTION A 

        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.STATE_CODE,A.CITY_CODE,A.DIST_CODE,
        A.TALUKA_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_NAME,CITY_NAME;

       
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
        A.STATE_CODE STATE_NAME,SUM(A.SUPPLY_COPY) GROSS_COPY,
        0 LESS_COPY,0 ABOVE_COPY
        FROM #CIR_TEMP_BILL_COLLECTION A 

        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.STATE_CODE
        ORDER BY COMP_CODE,UNIT_CODE,STATE_NAME;
END
    if (@pbreakon='4')
    begin --Branch wise

        select a.comp_code comp_code,a.unit_code unit_code,
        a.billno branch_name,
        a.city_code city_name,
        sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 
        group by a.comp_code,a.unit_code,a.billno,a.city_code
        order by comp_code,unit_code,branch_name,city_name;

       
        select a.comp_code comp_code,a.unit_code unit_code,
        a.billno branch_name,sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 

        group by a.comp_code,a.unit_code,a.billno
        order by comp_code,unit_code,branch_name;
end
    if (@pbreakon='5') begin --District wise

        select a.comp_code comp_code,a.unit_code unit_code, a.dist_code dist_name,
        a.city_code city_name,  sum(a.supply_copy) gross_copy,  0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 

        group by a.comp_code,a.unit_code,a.dist_code,a.city_code
        order by comp_code,unit_code,dist_name,city_name;

       
        select a.comp_code comp_code,a.unit_code unit_code,
        a.dist_code dist_name, sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 

        group by a.comp_code,a.unit_code,a.dist_code
        order by comp_code,unit_code,dist_name;

end
    if(@pbreakon='6')
 begin --Taluka wise
       
        select a.comp_code comp_code,a.unit_code unit_code, a.taluka_code taluka_name,
        a.city_code city_name, sum(a.supply_copy) gross_copy,        0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 
        group by a.comp_code,a.unit_code,a.taluka_code,a.city_code
        order by comp_code,unit_code,taluka_name,city_name;


        select a.comp_code comp_code,a.unit_code unit_code, a.taluka_code taluka_name, sum(a.supply_copy) gross_copy,
        0 less_copy,0 Above_copy
        from #cir_temp_bill_collection a 

        group by a.comp_code,a.unit_code,a.taluka_code
        order by comp_code,unit_code,taluka_name;
     end ;


delete from #cir_temp_bill_collection


end



//////////////////////////////////////////////end//////////////////////////////////////////////////////////////////


/////////////////////add by deepika 15/05/2012 for issue no 6747////////////////////////////////////////////
                                                                                                                                                                                                                                                        
ALTER PROCEDURE [dbo].[cir_rep_collection_cir_rep_datewise_monthwise_p]
	@pcompcode			VARCHAR(40) ,
	@punitcode          VARCHAR(40) ,
	@pdoctype           VARCHAR(400) ,
	@ppaymode_reason    VARCHAR(40) ,
	@pactype            VARCHAR(40) ,
	@pagency_type       VARCHAR(40) ,
	@pfromdate          VARCHAR(40) ,
	@ptodate            VARCHAR(40) ,
	@pdateformat        VARCHAR(40) ,
	@prep               VARCHAR(40) ,--this is used for datewise(D) or monthwise(M)
	@pextra1            VARCHAR(40) ,--FOR BRANCH
	@pextra2            VARCHAR(40) --FOR DISTRICT
AS 
	DECLARE @v_frdt		DATETIME 
	DECLARE @v_todt		DATETIME 
	declare @vreason	varchar(1000)
	declare @reason		varchar(400)

	DECLARE @v_frdt11  varchar(40) 
	DECLARE @v_todt11  varchar(40) 

	SET @v_frdt  = dbo.convert_user_date('/', @pfromdate,@pdateformat)
	SET @v_todt  = dbo.convert_user_date('/', @ptodate,@pdateformat)

	set @v_frdt11 = cast (@v_frdt as varchar)
	set @v_todt11 = cast (@v_todt as varchar)

	PRINT(@v_frdt)
	PRINT(@v_todt)
	
	DECLARE cur_reason cursor LOCAL FOR 
		SELECT DISTINCT 
			--'sum( case a.reason when ' + '''' + CAST(a.reason AS VARCHAR) + '''' + ' then a.amount else 0 end ) "'+  CAST(reason AS VARCHAR) + '"' ,
			'CASE WHEN A.DOCTYPE+''#''+A.REASON='+''''+A.DOCTYPE+'#'+A.REASON+''''+' THEN ABS(SUM(A.AMOUNT)) ELSE 0 END "'+a.doctype+'#'+reason+'"' vreason,
				 a.doctype+'#'+a.reason REASON
		FROM  cir_rcphdr a,	 cir_agmast b 
		WHERE a.comp_code  = @pcompcode AND a.comp_code  = b.comp_code
		 AND a.unit_code  = b.unit AND (a.unit_code  = @punitcode OR	@punitcode  is null OR	@punitcode = '')
		 AND a.agcd  = b.agcd AND a.dpcd  = b.dpcd
		 AND (b.ag_type  = @pagency_type OR	@pagency_type  is null OR	@pagency_type = '')
		 AND (a.doctype  = @pdoctype OR	@pdoctype  is null OR	@pdoctype = '')
		 AND a.recptdt  between @v_frdt  and  @v_todt
		 AND (a.reason  = @ppaymode_reason OR @ppaymode_reason  is null OR	@ppaymode_reason = '')
		 AND (a.achd  = @pactype OR	@pactype is null OR @pactype = '')
         AND (a.branch_code=@pextra1 or @pextra1 is null or @pextra1='') and (b.dist_code=@pextra2 or @pextra2 is null or @pextra2='')
		ORDER BY reason 
		
		DECLARE @rec_reason		VARCHAR(400) 
        DECLARE @vrec_reason    VARCHAR(400)  

		DECLARE @vvar			VARCHAR(4000) 
		DECLARE @vvar_sum       VARCHAR(4000) 
		DECLARE @vquery         VARCHAR(4000) 

		OPEN cur_reason 
			fetch NEXT FROM cur_reason INTO  @vreason,@reason
			WHILE (@@FETCH_STATUS = 0) 
			BEGIN 
				IF @vvar is null BEGIN 
						SET @vvar  =@vreason
						SET @vvar_sum  = 'sum("'+@reason+'") "'+@reason+'"';
				END
				ELSE BEGIN 
					SET @vvar  = @vvar + ',' + @vreason
					SET @vvar_sum  = @vvar_sum + ',sum("'+@reason+'") "'+@reason+'"';
				END
   			fetch NEXT FROM cur_reason INTO  @vreason,@reason
			END 
		close cur_reason

		IF @vvar is not null and @prep in ( 'D' , 'M' ) BEGIN 
			IF @prep = 'D' BEGIN 
			PRINT('11')
				SET @vquery  = 'select comp_code as "COMP_CODE",unit_code AS "UNIT_CODE",recptdt AS "RECPTDT",' + @vvar_sum + ' from (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,' + @vvar + ' from cir_rcphdr a,cir_agmast b where a.comp_code=b.comp_code and a.comp_code=' + '''' + @pcompcode + '''' + ' and a.unit_code=b.unit and (a.unit_code=' + '''' + @punitcode + '''' + ' or' + '''' + @punitcode + '''' + ' is null ' + ' or  ' + '''' + @punitcode + '''' + ' = '''') and a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type=' + '''' + @pagency_type + '''' + ' or' + '''' + @pagency_type + '''' + ' is null ' + ' or  ' + '''' + @pagency_type + '''' + ' = '''') and (a.doctype=' + '''' + @pdoctype + '''' + ' or' + '''' + @pdoctype + '''' + ' is null ' + ' or  ' + '''' + @pdoctype + '''' + ' = '''') and a.recptdt between' + '''' + @v_frdt11 + '''' + ' and' + '''' + @v_todt11 + '''' + ' and 
				(a.reason=' + '''' + @ppaymode_reason + '''' + ' or' + '''' + @ppaymode_reason + '''' + ' is null ' + ' or  ' + '''' + @ppaymode_reason + '''' + ' = '''') and (a.achd=' + '''' + @pactype + '''' + ' or' + '''' + @pactype + '''' + ' is null ' + ' or  ' + '''' + @pactype + '''' + ' = '''') and (a.branch_code=' + '''' + @pextra1 + '''' + ' or' + '''' + @pextra1 + '''' + ' is null ' + ' or  ' + '''' + @pextra1 + '''' + ' = '''')  and (b.dist_code=' + '''' + @pextra2 + '''' + ' or' + '''' + @pextra2 + '''' + ' is null ' + ' or  ' + '''' + @pextra2 + '''' + ' = '''') group by a.comp_code,a.unit_code,a.recptdt,a.reason,a.doctype) m group by m.comp_code,m.unit_code,m.recptdt  order by comp_code,unit_code,recptdt' 
                print(@vquery)
				
				EXEC (@vquery) 
				SET @vquery  = 'select comp_code as "COMP_CODE",unit_code AS "UNIT_CODE",' + @vvar_sum + ' from  (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,' + @vvar + ' from cir_rcphdr a,cir_agmast b  where a.comp_code=b.comp_code and a.comp_code=' + '''' + @pcompcode + '''' + ' and a.unit_code=b.unit and (a.unit_code=' + '''' + @punitcode + '''' + ' or' + '''' + @punitcode + '''' + ' is null ' + ' or  ' + '''' + @punitcode + '''' + ' = '''') and  a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type=' + '''' + @pagency_type + '''' + ' or' + '''' + @pagency_type + '''' + ' is null ' + ' or  ' + '''' + @pagency_type + '''' + ' = '''') and  (a.doctype=' + '''' + @pdoctype + '''' + ' or' + '''' + @pdoctype + '''' + ' is null ' + ' or  ' + '''' + @pdoctype + '''' + ' = '''') and a.recptdt between' + '''' + @v_frdt11 + '''' + ' and' + '''' + @v_todt11 + '''' + ' and 
				(a.reason=' + '''' + @ppaymode_reason + '''' + ' or' + '''' + @ppaymode_reason + '''' + ' is null ' + ' or  ' + '''' + @ppaymode_reason + '''' + ' = '''') and (a.achd=' + '''' + @pactype + '''' + ' or' + '''' + @pactype + '''' + ' is null' + ' or  ' + '''' + @pactype + '''' + ' = '''') and (a.branch_code=' + '''' + @pextra1 + '''' + ' or' + '''' + @pextra1 + '''' + ' is null ' + ' or  ' + '''' + @pextra1 + '''' + ' = '''')  and (b.dist_code=' + '''' + @pextra2 + '''' + ' or' + '''' + @pextra2 + '''' + ' is null ' + ' or  ' + '''' + @pextra2 + '''' + ' = '''')  group by a.comp_code,a.unit_code,a.recptdt,a.reason,a.doctype)n  group by n.comp_code,n.unit_code order by comp_code,unit_code' 
				EXEC (@vquery) 
			END
			ELSE BEGIN 
			PRINT('21')
				SET @vquery  = 'select comp_code as "COMP_CODE",unit_code AS "UNIT_CODE", CONVERT(VARCHAR(25),DATEADD(dd,-(DAY(recptdt)-1),recptdt),101) as "DT", (DATENAME(MM, recptdt) '+ ' + '+ '''' +'-' +''''+ ' + ' + 'CAST(YEAR(recptdt) AS VARCHAR(4))) AS "RECPTDT" ,' + @vvar_sum + ' from  (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,' + @vvar + ' from cir_rcphdr a,cir_agmast b  where a.comp_code=b.comp_code and a.comp_code=' + '''' + @pcompcode + '''' + ' and a.unit_code=b.unit and (a.unit_code=' + '''' + @punitcode + '''' + ' or' + '''' + @punitcode + '''' + ' is null' + ' or  ' + '''' + @punitcode + '''' + ' = '''') and  a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type=' + '''' + @pagency_type + '''' + ' or' + '''' + @pagency_type + '''' + ' is null ' + ' or  ' + '''' + @pagency_type + '''' + ' = '''') and  (a.doctype=' + '''' + @pdoctype + '''' + ' or' + '''' + @pdoctype + '''' + ' is null ' + ' or  ' + '''' + @pdoctype + '''' + ' = '''') and a.recptdt between' + '''' + @v_frdt11 + '''' + ' and' + '''' + @v_todt11 + '''' + ' and  
				(a.reason=' + '''' + @ppaymode_reason + '''' + ' or' + '''' + @ppaymode_reason + '''' + ' is null ' + ' or  ' + '''' + @ppaymode_reason + '''' + ' = '''') and (a.achd=' + '''' + @pactype + '''' + ' or' + '''' + @pactype + '''' + ' is null' + ' or  ' + '''' + @pactype + '''' + ' = '''') and (a.branch_code=' + '''' + @pextra1 + '''' + ' or' + '''' + @pextra1 + '''' + ' is null ' + ' or  ' + '''' + @pextra1 + '''' + ' = '''')  and (b.dist_code=' + '''' + @pextra2 + '''' + ' or' + '''' + @pextra2 + '''' + ' is null ' + ' or  ' + '''' + @pextra2 + '''' + ' = '''') group by a.comp_code,a.unit_code,a.recptdt,a.reason,a.doctype) v  group by v.comp_code,v.unit_code,CONVERT(VARCHAR(25),DATEADD(dd,-(DAY(v.recptdt)-1),v.recptdt),101) , (DATENAME(MM, v.recptdt)' + '+ ' +'''' +'-' +''''+ '+' + 'CAST(YEAR(v.recptdt) AS VARCHAR(4)))   order by comp_code,unit_code' 
				
		    	EXEC (@vquery) 
		    	print(@vquery)
				PRINT('44')
				SET @vquery  = 'select comp_code as "COMP_CODE",unit_code AS "UNIT_CODE",' + @vvar_sum + ' from  (select a.comp_code comp_code,a.unit_code unit_code,a.recptdt recptdt,' + @vvar + ' from cir_rcphdr a,cir_agmast b  where a.comp_code=b.comp_code and a.comp_code=' + '''' + @pcompcode + '''' + ' and a.unit_code=b.unit and (a.unit_code=' + '''' + @punitcode + '''' + ' or' + '''' + @punitcode + '''' + ' is null' + ' or  ' + '''' + @punitcode + '''' + ' = '''') and   a.agcd=b.agcd and a.dpcd=b.dpcd and (b.ag_type=' + '''' + @pagency_type + '''' + ' or' + '''' + @pagency_type + '''' + ' is null ' + ' or  ' + '''' + @pagency_type + '''' + ' = '''') and  (a.doctype=' + '''' + @pdoctype + '''' + ' or' + '''' + @pdoctype + '''' + ' is null ' + ' or  ' + '''' + @pdoctype + '''' + ' = '''') and a.recptdt between' + '''' + @v_frdt11 + '''' + ' and' + '''' + @v_todt11 + '''' + ' and 
				(a.reason=' + '''' + @ppaymode_reason + '''' + ' or' + '''' + @ppaymode_reason + '''' + ' is null ' + ' or  ' + '''' + @ppaymode_reason + '''' + ' = '''') and (a.achd=' + '''' + @pactype + '''' + ' or' + '''' + @pactype + '''' + ' is null ' + ' or  ' + '''' + @pactype + '''' + ' = '''') and (a.branch_code=' + '''' + @pextra1 + '''' + ' or' + '''' + @pextra1 + '''' + ' is null ' + ' or  ' + '''' + @pextra1 + '''' + ' = '''')  and (b.dist_code=' + '''' + @pextra2 + '''' + ' or' + '''' + @pextra2 + '''' + ' is null ' + ' or  ' + '''' + @pextra2 + '''' + ' = '''') group by a.comp_code,a.unit_code,a.recptdt,a.reason,a.doctype) w  group by w.comp_code,w.unit_code  order by comp_code,unit_code' 
				EXEC (@vquery) 
				print(@vquery)
				PRINT('33')
			END
		END
		ELSE BEGIN 
			SET @vquery  = 'select' + '''' + @pcompcode + '''' + ' "COMP_CODE",' + '''' + @punitcode + '''' + ' "unit_code",' + '''' + convert(varchar(10),getdate(),101)+ '''' + ' "recptdt"  where 1=2' 
print(@vquery)
			EXEC (@vquery) 
			SET @vquery  = 'select' + '''' + @pcompcode + '''' + ' "COMP_CODE",' + '''' + @punitcode + '''' + ' "unit_code"  where 1=2' 
print(@vquery)
			EXEC (@vquery)
		END

print(@vquery)
		DEALLOCATE cur_reason




                                                                     
                                                                     
                                                                     
                                             


///////////////////////////////////////////////////////end///////////////////////////////////////////////////////

/////////////////////add by deepika 15/05/2012 for issue no 7449////////////////////////////////////////////


ALTER PROCEDURE [dbo].[cir_rep_ageing]
@pcomp_code varchar(20),
@punit_code varchar(20),
@pbran_code varchar(20),
@pzone_code varchar(30),
@pregion_code varchar(30),
@pdist_code varchar(20),
@ptaluka_code varchar(20),
@pagtype      varchar(50),
@pagclass      varchar(50),
@pag_main_code varchar(50),
@pag_sub_code varchar(50),
@paging_by varchar(50),
@pasondt datetime,
@pdebitupto_date datetime,
@pcreditupto_date datetime,
@ptill_days1 varchar(20),
@ptill_days2 varchar(20),
@ptill_days3 varchar(30),
@ptill_days4 varchar(30),
@ptill_days5 varchar(50),
@ptill_days6 varchar(50),
@pdateformat varchar(20),
@puserid varchar(20),
@pextra1 varchar(20),
@pextra2 varchar(20),
@pextra3 varchar(30),
@pextra4 varchar(30),
@pextra5 varchar(50)

AS

declare  @vtodt   as datetime
declare  @vasondt  as datetime     
declare  @v_dt    as datetime
declare  @v_ondt  as datetime
declare  @v_days numeric(10);

declare  @v_pending_rcpt_amt as numeric(14,2) 

declare  @v_amt     as    numeric(14,2);
declare  @v_amt030  as   numeric(14,2);
declare  @v_amt3160 as   numeric(14,2);
declare  @v_amt6190 as   numeric(14,2);
declare  @v_amt91120 as numeric(14,2);
declare  @v_amt121180   as numeric(14,2);
declare  @v_amt181   as numeric(14,2);

declare  @debit_amt_030  as  numeric(14,2)  --debit amt  for slab  1 days
declare  @debit_amt_3160 as  numeric(14,2)  --debit amt  for slab  2 days
declare  @debit_amt_6190 as  numeric(14,2)  --debit amt  for slab  3 days
declare  @debit_amt_91120 as numeric(14,2)  --debit amt  for slab  4 days
declare  @debit_amt_121180  as  numeric(14,2)  --debit amt  for >slab 5 days
declare  @debit_amt_181  as  numeric(14,2)  --debit amt  for >slab 6 days
declare  @bill_pending_amt as numeric(14,2)
declare  @rcpt_pending_amt  as numeric(14,2) --pending receipt amount

CREATE TABLE #cir_temp_ageing
(
  COMP_CODE     VARCHAR(8),
  UNIT_CODE     VARCHAR(8),
  BRAN_CODE     VARCHAR(8),
  AGCD          VARCHAR(8),
  DPCD          VARCHAR(8),
  AG_NAME       VARCHAR(100),
  CITY_NAME     VARCHAR(100),
  PENDING_AMT   NUMERIC(14,2),
  SLAB_1        NUMERIC(14,2),
  SLAB_2        NUMERIC(14,2),
  SLAB_3        NUMERIC(14,2),
  SLAB_4        NUMERIC(14,2),
  SLAB_5        NUMERIC(14,2),
  SLAB_6        NUMERIC(14,2),
  ON_ACAMT      NUMERIC(14,2),
  RECT_PENDING  NUMERIC(14,2),
  SESSIONID     NUMERIC(14)
)

set @vtodt=@pdebitupto_date
set @vasondt=@pcreditupto_date

set @debit_amt_030  =0  --debit amt  for slab  1 days
set @debit_amt_3160  =0  --debit amt  for slab  2 days
set  @debit_amt_6190  =0  --debit amt  for slab  3 days
set   @debit_amt_91120  =0 --debit amt  for slab  4 days
set   @debit_amt_121180   =0  --debit amt  for >slab 4 days
set   @debit_amt_181   =0  --debit amt  for >slab 4 days
set   @bill_pending_amt  =0
set   @rcpt_pending_amt  =0  --pending receipt amount


	declare cur_agency cursor for
			select m.Comp_Code comp_code,m.agcd agcd,m.dpcd dpcd,m.ag_name agency_name,
			m.City_Code city_code,c.city_name city_name,m.credit_days credit_days,m.branch_code branch_name
			from cir_agmast m,cir_city_mast c
			where m.comp_code=c.comp_code and m.comp_code=@pcomp_code 
			and m.unit=@punit_code and m.city_code=c.city_code 
			and (c.zone_code=@pzone_code or @pzone_code is null or @pzone_code ='') 
			and (m.Dist_Code=@pdist_code or @pdist_code is null or @pdist_code ='') 
			and (m.tehsil_taluka=@ptaluka_code or @ptaluka_code is null or @ptaluka_code ='') 
			and (m.agcd=@pag_main_code or @pag_main_code is null or @pag_main_code ='') 
			and (m.dpcd=@pag_sub_code or @pag_sub_code is null or @pag_sub_code ='')
			order by branch_name,agency_name; 
		

-- cursor cur_agency variables
declare @rec_agency_comp_code as varchar(30)
declare @rec_agency_agcd as varchar(20)
declare @rec_agency_dpcd as varchar(30)
declare @rec_agency_agency_name as varchar(300)
declare @rec_agency_city_code as varchar(200)
declare @rec_agency_city_name as varchar(200)
declare @rec_agency_credit_days as int
declare @rec_agency_branch_name as varchar(50)

-- cursor v_bill variables
declare @v_bill_billno as varchar(50)
declare @v_bill_billdt as varchar(30)
declare @v_bill_bill_amt as numeric(15,2)

-- cursor v_pending_rcpt variables  
declare @v_pending_rcpt_ag_main_code as varchar(30)
declare @v_pending_rcpt_ag_sub_code as varchar(50)
declare @v_pending_rcpt_amount as numeric(15,2)



--SELECT 'cursor has ' + CAST(@@CURSOR_ROWS AS VARCHAR) + ' rows'
open cur_agency
		fetch NEXT FROM cur_agency INTO @rec_agency_comp_code,@rec_agency_agcd,@rec_agency_dpcd,@rec_agency_agency_name ,@rec_agency_city_code ,@rec_agency_city_name ,@rec_agency_credit_days ,@rec_agency_branch_name
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN
			--SELECT 'cursor has ' + CAST(@@CURSOR_ROWS AS VARCHAR) + ' rows'
			print @rec_agency_dpcd
			set @debit_amt_030 = 0;
			set @debit_amt_3160 = 0;
			set @debit_amt_6190 = 0;
			set @debit_amt_91120 = 0;
			set @debit_amt_121180 = 0;
			set @debit_amt_181 = 0;
			set @rcpt_pending_amt = 0;
			set @bill_pending_amt = 0;
			print('enter first')
			declare c_bill cursor for
					select distinct billno,billdt,sum(amount) bill_amt from cir_outmast
					where comp_code=@pcomp_code and unit_code=@punit_code and
					agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
					billdt<=@vtodt and isnull(amount,0)>0
					group by comp_code,billno,billdt
					union
					select distinct recptno billno,recptdt billdt,sum(amount) bill_amt from cir_outmast
					where comp_code=@pcomp_code and unit_code=@punit_code and
					agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
					recptdt<=@vtodt and isnull(amount,0)>0 and billno is null
					group by comp_code,recptno,recptdt order by 2,1
                          
				     --having  sum(amount)<0
					open c_bill
							fetch NEXT FROM c_bill INTO @v_bill_billno,@v_bill_billdt,@v_bill_bill_amt
							WHILE (@@FETCH_STATUS = 0) 
							begin
								print('enter second')
								set @v_dt    = @v_bill_billdt
								set @v_ondt  = @vtodt
								print(@v_dt)
								print(@v_ondt)
								if @paging_by='D' begin
									set @v_days=DATEDIFF(dd, @v_dt,@v_ondt )---isnull(pcrdtday,0)+1;
								end
								else
								begin    
									set @v_days=DATEDIFF(dd, @v_dt,@v_ondt )+1;
								end
								if @v_days<0 begin
									set @v_days=0;
								end
								print('x')
								print(@v_days)
								set @v_amt               =0;
								set @v_amt030            =0;
								set @v_amt3160           =0;
								set @v_amt6190           =0;
								set @v_amt91120          =0;
								set @v_amt121180         =0;
								set @v_amt181            =0;	

								if @v_days between 0 and @ptill_days1 begin
									select @v_amt030=sum(amount) from cir_outmast 
									where comp_code=@pcomp_code and unit_code=@punit_code and
										  agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
										  billno=@v_bill_billno and billdt=@v_bill_billdt and 
										  recptdt<=@vasondt and amount<0

									set @v_amt030 =isnull(@v_bill_bill_amt,0)+isnull(@v_amt030,0);
									set @debit_amt_030 =isnull(@debit_amt_030,0)+isnull(@v_amt030,0)
								end
								else if @v_days between isnull(@ptill_days1,0)+1 and @ptill_days2 begin
									select @v_amt3160=sum(amount) from cir_outmast 
									where comp_code=@pcomp_code and unit_code=@punit_code and
										  agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
										  billno=@v_bill_billno and billdt=@v_bill_billdt and 
										  recptdt<=@vasondt and amount<0
									--insert into debug_ageing (BILLNO, BILLDATE, DAYS,AMOUNT2) values( v_bill.billno,v_bill.billdt,v_days, isnull(v_bill.bill_amt,0));
									set @v_amt3160 =isnull(@v_bill_bill_amt,0)+isnull(@v_amt3160,0);
									set @debit_amt_3160 =isnull(@debit_amt_3160,0)+isnull(@v_amt3160,0)
								end
								else if @v_days between isnull(@ptill_days2,0)+1 and @ptill_days3 begin
									select @v_amt6190=sum(amount) from cir_outmast 
									where comp_code=@pcomp_code and unit_code=@punit_code and
										  agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
										  billno=@v_bill_billno and billdt=@v_bill_billdt and 
										  recptdt<=@vasondt and amount<0
									--insert into debug_ageing (BILLNO, BILLDATE, DAYS,AMOUNT2) values( v_bill.billno,v_bill.billdt,v_days, isnull(v_bill.bill_amt,0));
									set @v_amt6190 =isnull(@v_bill_bill_amt,0)+isnull(@v_amt6190,0);
									set @debit_amt_6190 =isnull(@debit_amt_6190,0)+isnull(@v_amt6190,0)
								end
								else if @v_days between isnull(@ptill_days3,0)+1 and @ptill_days4 begin
									select @v_amt91120=sum(amount) from cir_outmast 
									where comp_code=@pcomp_code and unit_code=@punit_code and
										  agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
										  billno=@v_bill_billno and billdt=@v_bill_billdt and 
										  recptdt<=@vasondt and amount<0
									--insert into debug_ageing (BILLNO, BILLDATE, DAYS,AMOUNT2) values( v_bill.billno,v_bill.billdt,v_days, isnull(v_bill.bill_amt,0));
									set @v_amt91120 =isnull(@v_bill_bill_amt,0)+isnull(@v_amt91120,0);
									set @debit_amt_91120 =isnull(@debit_amt_91120,0)+isnull(@v_amt91120,0)
								end  
								else if @v_days between isnull(@ptill_days4,0)+1 and @ptill_days5 begin
									select @v_amt121180=sum(amount) from cir_outmast 
									where comp_code=@pcomp_code and unit_code=@punit_code and
										  agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
										  billno=@v_bill_billno and billdt=@v_bill_billdt and 
										  recptdt<=@vasondt and amount<0
									--insert into debug_ageing (BILLNO, BILLDATE, DAYS,AMOUNT2) values( v_bill.billno,v_bill.billdt,v_days, isnull(v_bill.bill_amt,0));
									set @v_amt121180 =isnull(@v_bill_bill_amt,0)+isnull(@v_amt121180,0);
									set @debit_amt_121180 =isnull(@debit_amt_121180,0)+isnull(@v_amt121180,0)
								end        
								else
								begin
									select @v_amt181=sum(amount) from cir_outmast 
									where comp_code=@pcomp_code and unit_code=@punit_code and
										  agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
										  billno=@v_bill_billno and billdt=@v_bill_billdt and 
										  recptdt<=@vasondt and amount<0
									--insert into debug_ageing (BILLNO, BILLDATE, DAYS,AMOUNT2) values( v_bill.billno,v_bill.billdt,v_days, isnull(v_bill.bill_amt,0));
									set @v_amt181 =isnull(@v_bill_bill_amt,0)+isnull(@v_amt181,0);
									set @debit_amt_181 =isnull(@debit_amt_181,0)+isnull(@v_amt181,0)
								end
								

							fetch NEXT FROM c_bill INTO @v_bill_billno,@v_bill_billdt,@v_bill_bill_amt
							end
					close c_bill		
				deallocate c_bill
		
		select @v_pending_rcpt_amt=sum(amount) from cir_outmast 
        where comp_code=@pcomp_code and unit_code=@punit_code and
          agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
          (billno is null or billdt>@vasondt) and 
          recptdt<=@vasondt and 
          doctyp+recptno+cast(recptdt as varchar) not in 
          (select distinct doctyp+recptno+cast(recptdt as varchar) from ad_outstand
           where comp_code=@pcomp_code and unit_code=@punit_code and
                 agcd=@rec_agency_agcd and dpcd=@rec_agency_dpcd and
                 recptdt<=@vtodt and isnull(amount,0)<0 and billno IS NULL)
	
		set @v_amt=isnull(@debit_amt_030,0)+isnull(@debit_amt_3160,0)+isnull(@debit_amt_6190,0)+isnull(@debit_amt_91120,0)+isnull(@debit_amt_121180,0)+isnull(@debit_amt_181,0)

		if @v_amt=0 begin
			set @debit_amt_030    = 0
			set @debit_amt_3160   = 0
			set @debit_amt_6190   = 0
			set @debit_amt_91120  = 0
			set @debit_amt_121180 = 0
			set @debit_amt_181    = 0
			set @rcpt_pending_amt = 0
		end
		else
		begin
			set @rcpt_pending_amt=isnull(@v_pending_rcpt_amount,0)
			set @bill_pending_amt=isnull(@v_amt,0)
		end
		print('zzz')
		insert into #cir_temp_ageing (comp_code,unit_code,agcd,dpcd,ag_name,
                city_name,pending_amt,slab_1,slab_2,slab_3,slab_4,slab_5,
                slab_6,rect_pending,on_acamt,sessionid)
        values (@rec_agency_comp_code,@punit_code,@rec_agency_agcd, @rec_agency_dpcd, @rec_agency_agency_name,
               @rec_agency_city_name,isnull(@bill_pending_amt,0),isnull(@debit_amt_030,0),isnull(@debit_amt_3160,0), isnull(@debit_amt_6190,0), isnull(@debit_amt_121180,0), isnull(@debit_amt_181,0),
               0,isnull(@rcpt_pending_amt,0),0,@@spid);
		print('xxx')
		fetch NEXT FROM cur_agency INTO @rec_agency_comp_code,@rec_agency_agcd,@rec_agency_dpcd,@rec_agency_agency_name ,@rec_agency_city_code ,@rec_agency_city_name ,@rec_agency_credit_days ,@rec_agency_branch_name
		    set @debit_amt_030    = 0
			set @debit_amt_3160   = 0
			set @debit_amt_6190   = 0
			set @debit_amt_91120  = 0
			set @debit_amt_121180 = 0
			set @debit_amt_181    = 0
			set @rcpt_pending_amt = 0
			set @bill_pending_amt = 0
		end
		
close cur_agency;
--SELECT 'cursor has ' + CAST(@@CURSOR_ROWS AS VARCHAR) + ' rows'
deallocate cur_agency

select comp_code,unit_code,agcd,dpcd,ag_name,city_name,pending_amt,slab_1,slab_2,slab_3,slab_4,slab_5,
slab_6,rect_pending from #cir_temp_ageing 
/*where (PENDING_AMT>0 or SLAB_1>0 or SLAB_2>0 or SLAB_3>0 or SLAB_4>0 or SLAB_5>0 or ABS(RECT_PENDING)>0  )  
 and sessionid=@@SPID  */
 order by ag_name;
drop table #cir_temp_ageing



	


////////////////////////////////////////////end///////////////////////////////////////////////////////////////////////

      /**************************prachi 15-may 5034*****************************************************/
ALTER PROCEDURE [dbo].[payfill]
@compcode as varchar(8),
@userid as varchar(8)
 AS

select Payment_Mode_Name,Pay_Mode_Code,payment_mode_type from payment_mode_mast where comp_code=@compcode
order by Pay_Mode_Code
/**************************prachi 15-may 5034*****************************************************/

/**************************prachi 15-may 7402*****************************************************/
ALTER procedure [dbo].[cir_comm_category]
(
@comp_code as varchar(50)
)

as
select CATG_CODE as COMM_CATG_CODE, CATEG_DESC as COMM_CATG_DESC from CIR_WASTE_CATG_MAST  where STATUS ='N'
--select * from CIR_WASTE_CATG_MAST
/**************************prachi 15-may 7402*****************************************************/    


/////////////////////deepika  16/05/2012 sent by amit Tomer sir/////////////////////////////


ALTER PROCEDURE cir_rep_supply_cir_rep_supply1
	@pcomp_code			VARCHAR(40) ,
	@punit_code         VARCHAR(40) ,
	@ppubl              VARCHAR(40) ,
	@pmainedtn          VARCHAR(40) ,
	@pedtn              VARCHAR(40) ,
	@proute             VARCHAR(40) ,
	@pfrom_supdate      DATETIME ,
	@ptill_supdate      DATETIME ,
	@pdateformat        VARCHAR(40) ,
    @pextra1            VARCHAR(40) ,--for branch
    @pextra2            VARCHAR(40) ,--for state,
	@pextra3			VARCHAR(40) ,--this is use to final and unfinal po
	@pextra4            VARCHAR(40) ,--for zone,
	@pextra5            VARCHAR(40) ,--for region
	@pextra6            VARCHAR(40) ,--for district
	@pextra7            VARCHAR(40) ,--for taluka
	@pextra8            VARCHAR(40) ,--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,other than statewise
	@pextra9            VARCHAR(40) ,--for publication type
	@pextra10           VARCHAR(40),--for executive
	@pextra11           VARCHAR(40),-- it is using for standing order / posting
	@pextra12           VARCHAR(40),
	@pextra13           VARCHAR(40),
	@pextra14           VARCHAR(40),
	@pextra15           VARCHAR(40)
AS 
BEGIN
	DECLARE @vfrom_supdate	varchar(20);
	DECLARE @vtill_supdate  varchar(20);
	declare @vsup_seq_no	int
	
	DECLARE @supply_type_name	VARCHAR(4000)
	DECLARE @supply_sum			VARCHAR(4000) 
	DECLARE @vvar               VARCHAR(4000) 
	DECLARE @vvar_sum           VARCHAR(4000) 
	DECLARE @vquery             VARCHAR(8000) 
	DECLARE @vquery1            VARCHAR(8000) 
	DECLARE @vquery2            VARCHAR(8000) 
	DECLARE @vquery3            VARCHAR(8000) 
	DECLARE @vquery4            VARCHAR(8000) 

	SET @vfrom_supdate  = convert(varchar(20),@pfrom_supdate,101)
	SET @vtill_supdate  = convert(varchar(20),@ptill_supdate,101)
	
	if @pextra11 = '2' begin
	DECLARE cur_sup_type cursor LOCAL FOR 
		select distinct ' sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) "'+sup_ty_name+'",' vty,
		'sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) +' vty_sum,sup_seq_no
		from cir_supply_type_mast s, cir_supply d,cir_edtn_mast e
		where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code 
		and s.sup_ty_code =d.supply_type_code and
		(d.unit=isnull(@punit_code,d.unit) or @punit_code='') and d.publ=e.publ and 
		(d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
		d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
		(e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
		order by sup_seq_no;
		
		OPEN cur_sup_type 
		fetch NEXT FROM cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
			while(@@FETCH_STATUS = 0) BEGIN
				set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@supply_type_name + '', SPACE(0))
				set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@supply_sum + '', SPACE(0))

		fetch NEXT from cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
		end
		close cur_sup_type
		
		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)
	end
	else
	begin
		DECLARE cur_sup_type cursor LOCAL FOR 
		select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
		'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
		from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
		where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code 
		and s.sup_ty_code =d.sup_type_code and
		(d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ 
		and (d.publ=isnull(@ppubl,d.publ) or @ppubl='') 
		and d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
		d.supdate between @pfrom_supdate and @ptill_supdate and
		(e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
		order by sup_seq_no;
		
		OPEN cur_sup_type 
		fetch NEXT FROM cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
			while(@@FETCH_STATUS = 0) BEGIN
				set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@supply_type_name + '', SPACE(0))
				set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@supply_sum + '', SPACE(0))

		fetch NEXT from cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
		end
		close cur_sup_type
		
		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)
	end	
		
		
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9=null begin
	set @pextra9=''
end
if @pextra10=null begin
	set @pextra10=''
end
if @pextra11=null begin
	set @pextra11=''
end
if @pextra12=null begin
	set @pextra12=''
end
if @pextra13=null begin
	set @pextra13=''
end

if @pextra14=null begin
	set @pextra14=''
end
if @pextra15=null begin
	set @pextra15=''
end

if @pextra11 = '1' 
begin
	if @pextra8='1' 
	Begin--for route
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) ROUTE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		,dbo.cir_get_mode_name(d.comp_code,d.unit_code+d.route_code) as "MODE_NAME"
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code 
		and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
		order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end
	if @pextra8='2' 
	Begin----for  branch
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,dbo.cir_get_branch(d.comp_code,m.branch_code) BRANCH_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
		order by d.comp_code,d.unit_code,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'

		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='3' 
	Begin----for  zone
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,
		dbo.cir_get_zone_name(d.comp_code,c.zone_code) ZONE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
		order by d.comp_code,d.unit_code,d.publ,d.edtn,zone_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='4' 
	Begin----for  region
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,dbo.cir_get_region_name(d.comp_code,c.region_code) REGION_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
		order by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='5' 
	Begin----for  district
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''1'',null,null,null) DIST_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,dist_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='6' 
	Begin----for Taluka
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) TALUKA_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,taluka_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end
	if @pextra8='7' 
	Begin----for State
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,dbo.cir_get_state1(d.comp_code,m.state_code) STATE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
		c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='8' 
	Begin----for Executive
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,dbo.cir_get_executive(d.comp_code,m.executive_code) EXECUTIVE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
		c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname order by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end
		SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code order by d.comp_code,d.unit_code'
		print @vquery1
		EXEC (@vquery1)
			
	if @pextra8='1' 
	Begin--for route
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='2' 
	Begin--for branch
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='3' 
	Begin--for Zone
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='4' 
	Begin--for region
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='5' 
	Begin--for District
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='6' 
	Begin--for Taluka
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka order by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='7' 
	Begin--for state
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='8' 
	Begin--for executive
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code'
		print @vquery2
		EXEC (@vquery2)
	end

		SET @vquery3  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn order by d.comp_code,d.unit_code,d.publ,d.edtn'
		print @vquery3
		EXEC (@vquery3)

		SET @vquery4  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ'
		print @vquery4
		EXEC (@vquery4)
end
else
begin
	if @pextra8='1' 
	Begin--for route
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) ROUTE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT"
	, '+@vvar+','+@vvar_sum+' TOTAL 
	,dbo.cir_get_mode_name(d.comp_code,d.unit+d.route_code) as "MODE_NAME"
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code 
	and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
	order by d.comp_code,d.unit,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end
if @pextra8='2' 
Begin----for  branch
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,dbo.cir_get_branch(d.comp_code,m.branch_code) BRANCH_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
	order by d.comp_code,d.unit,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'

	print @vquery 
	EXEC (@vquery)
end

if @pextra8='3' 
Begin----for  zone
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME
	,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,
	dbo.cir_get_zone_name(d.comp_code,c.zone_code) ZONE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
	order by d.comp_code,d.unit,d.publ,d.edtn,zone_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end

if @pextra8='4' 
Begin----for  region
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn
	,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,dbo.cir_get_region_name(d.comp_code,c.region_code) REGION_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
	order by d.comp_code,d.unit,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end

if @pextra8='5' 
Begin----for  district
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''1'',null,null,null) DIST_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,dist_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end

if @pextra8='6' 
Begin----for Taluka
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) TALUKA_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME",
	 dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,taluka_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end
if @pextra8='7' 
Begin----for State
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,dbo.cir_get_state1(d.comp_code,m.state_code) STATE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
	c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT",
	 dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname 
	order by d.comp_code,d.unit,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end

if @pextra8='8' 
Begin----for Executive
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,dbo.cir_get_executive(d.comp_code,m.executive_code) EXECUTIVE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
	c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname
	order by d.comp_code,d.unit,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end
	SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit order by d.comp_code,d.unit_code'
	print @vquery1
	EXEC (@vquery1)
		
if @pextra8='1' 
Begin--for route
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,d.route_code order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='2' 
Begin--for branch
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME
	,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code order by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='3' 
Begin--for Zone
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code order by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='4' 
Begin--for region
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,c.region_code order by d.comp_code,d.unit,d.publ,d.edtn,c.region_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='5' 
Begin--for District
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code order by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='6' 
Begin--for Taluka
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka order by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='7' 
Begin--for state
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.state_code order by d.comp_code,d.unit,d.publ,d.edtn,m.state_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='8' 
Begin--for executive
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.executive_code order by d.comp_code,d.unit,d.publ,d.edtn,m.executive_code'
	print @vquery2
	EXEC (@vquery2)
end

	SET @vquery3  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn order by d.comp_code,d.unit,d.publ,d.edtn'
	print @vquery3
	EXEC (@vquery3)

	SET @vquery4  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ order by d.comp_code,d.unit,d.publ'
	print @vquery4
	EXEC (@vquery4)
end

DEALLOCATE cur_sup_type

END

///////////////////////////////////////////////////

ALTER PROCEDURE [dbo].[cir_rep_supply_temp]
@pcomp_code         as varchar(200),
@punit_code         as varchar(200),
@ppubl              as varchar(200),
@pmainedtn          as varchar(200),
@pedtn              as varchar(200),
@proute             as varchar(200),
@pfrom_supdate      as datetime,
@ptill_supdate      as datetime,
@pdateformat        as varchar(200),
@pextra1            as varchar(200),--for branch
@pextra2            as varchar(200),--for State
@pextra3            as varchar(200),--this is use to final and unfinal po
@pextra4            as varchar(200),--for zone,
@pextra5            as varchar(200),--for region
@pextra6            as varchar(200),--for district
@pextra7            as varchar(200),--for taluka
@pextra8            as varchar(200),--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,7 for statewise,8 for executive
@pextra9            as varchar(200),--for publication type
@pextra10           as varchar(200),--for executive
@pextra11           as varchar(200),--for based on 1 for supply post and 2 for standing order
@pextra12           as varchar(200),
@pextra13           as varchar(200),
@pextra14           as varchar(200),
@pextra15           as varchar(200)

AS

declare @vfrom_supdate    varchar(20);
declare @vtill_supdate    varchar(20);
declare @rec_sup_type		as varchar(200) 
declare @rec_sup_type_sum	as varchar(200) 
declare @rec_sup_seq_no		as int

if @pextra11 ='2' begin
DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_supply d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.supply_type_code and
    (d.unit=isnull(@punit_code,d.unit) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    --d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;
end
else
begin
DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.sup_type_code and
    (d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;
end
	declare @vvar		varchar(4000)
	declare @vvar_sum	varchar(4000)
	declare @vquery		varchar(8000)

	set @vvar=''
	set @vvar_sum=''
 
	set @vfrom_supdate=convert(varchar(20),@pfrom_supdate,101)
	set @vtill_supdate=convert(varchar(20),@ptill_supdate,101)

	print('@vfrom_supdate')print(@vfrom_supdate);
	print('@vtill_supdate')print(@vtill_supdate);

if @pextra11 ='2' begin
	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type
end
else
begin
	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type
end

	print('@vvar')print(@vvar)
	print('@vvar_sum')print(@vvar_sum)

if @vvar='' or @vvar is null begin
	set @vvar=null
end
else begin
	set @vvar    =substring(@vvar,1,len(@vvar)-1)
	set @vvar_sum=substring(@vvar_sum,1,len(@vvar_sum)-1)
end	
	print('@vvar2')print(@vvar)
	print('@vvar_sum2')print(@vvar_sum)
   
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9=null begin
	set @pextra9=''
end
if @pextra10=null begin
	set @pextra10=''
end

if @pextra11=null begin
	set @pextra11=''
end
if @pextra12=null begin
	set @pextra12=''
end
if @pextra13=null begin
	set @pextra13=''
end

if @pextra14=null begin
	set @pextra14=''
end
if @pextra15=null begin
	set @pextra15=''
end
if @pextra11 ='2' begin
	if @vvar='' or @vvar is null 
	begin
		set @vquery='select d.comp_code comp_code,d.unit unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
		d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) route_name,
		dbo.cir_get_name_cir_route(d.comp_code,d.unit,d.route_code,''2'',null,null,null) route_oname
		from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit and d.unit='''+@punit_code+''' 
		and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit,d.publ,d.route_code
		order by d.comp_code,d.unit,d.publ,route_name';
	end
	else 
	begin
		if @pextra8='1' 
		begin----for route 
			set @vquery='select d.comp_code comp_code,d.unit unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
			d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) route_name,
			dbo.cir_get_name_cir_route(d.comp_code,d.unit,d.route_code,''2'',null,null,null) route_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,d.publ,d.route_code
			order by d.comp_code,d.unit,d.publ,route_name';
		end ------ route	
		else if @pextra8='2' 
		begin----for  branch
			set @vquery='select d.comp_code comp_code,d.unit unit_code,m.branch_code branch_code,
			dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.branch_code
			order by d.comp_code,d.unit,branch_name'
		end ---- branch		
		else if @pextra8='3' 
		begin----for  zone
			set @vquery=' select d.comp_code comp_code,d.unit unit_code,c.zone_code,
			dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,c.zone_code
			order by d.comp_code,d.unit,zone_name';
		end  ---- zone
		else if @pextra8='4' 
		begin----for  region   
			set @vquery='  select d.comp_code comp_code,d.unit unit_code,c.region_code,
			dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,c.region_code
			order by d.comp_code,d.unit,region_name';
		end ---- end  region
		else if @pextra8='5' 
		begin----for  district
			set @vquery='select d.comp_code comp_code,d.unit unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
			dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.state_code,m.dist_code
			order by d.comp_code,d.unit,m.state_code,district_name	'
		end  ---- district
		else if @pextra8='6' 
		begin----for  tehsil_taluka
			set @vquery='  select d.comp_code comp_code,d.unit unit_code,m.tehsil_taluka tehsil_taluka,
			dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
			dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.tehsil_taluka
			order by d.comp_code,d.unit,taluka_name';
		end  ----for  tehsil_taluka
		else if @pextra8='7' 
		begin----for  State
			set @vquery='select d.comp_code comp_code,d.unit unit_code,m.country_code country_code,
			m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
			,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.country_code,m.state_code
			order by d.comp_code,d.unit,m.country_code,state_name';
		end  ----for  state
		else 
		begin--for executive
			set @vquery='select d.comp_code comp_code,d.unit unit_code,m.country_code country_code,
			m.executive_code executive_code,dbo.cir_get_executive(d.comp_code,m.executive_code) executive_name
			,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.country_code,m.executive_code
			order by d.comp_code,d.unit,m.country_code,executive_name';
		end
	end
end
else
begin
	if @vvar='' or @vvar is null 
	begin
		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
		d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
		dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.route_code
		order by d.comp_code,d.unit_code,d.publ,route_name';
	end
	else 
	begin
		if @pextra8='1' 
		begin----for route 
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
			d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
			dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.route_code
			order by d.comp_code,d.unit_code,d.publ,route_name';
		end ------ route	
		else if @pextra8='2' 
		begin----for  branch
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.branch_code branch_code,
			dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.branch_code
			order by d.comp_code,d.unit_code,branch_name'
		end ---- branch		
		else if @pextra8='3' 
		begin----for  zone
			set @vquery=' select d.comp_code comp_code,d.unit_code unit_code,c.zone_code,
			dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,c.zone_code
			order by d.comp_code,d.unit_code,zone_name';
		end  ---- zone
		else if @pextra8='4' 
		begin----for  region   
			set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,c.region_code,
			dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,c.region_code
			order by d.comp_code,d.unit_code,region_name';
		end ---- end  region
		else if @pextra8='5' 
		begin----for  district
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
			dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.state_code,m.dist_code
			order by d.comp_code,d.unit_code,m.state_code,district_name	'
		end  ---- district
		else if @pextra8='6' 
		begin----for  tehsil_taluka
			set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,m.tehsil_taluka tehsil_taluka,
			dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
			dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.tehsil_taluka
			order by d.comp_code,d.unit_code,taluka_name';
		end  ----for  tehsil_taluka
		else if @pextra8='7' 
		begin----for  State
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.country_code country_code,
			m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
			,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.country_code,m.state_code
			order by d.comp_code,d.unit_code,m.country_code,state_name';
		end  ----for  state
		else 
		begin--for executive
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.country_code country_code,
			m.executive_code executive_code,dbo.cir_get_executive(d.comp_code,m.executive_code) executive_name
			,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.country_code,m.executive_code
			order by d.comp_code,d.unit_code,m.country_code,executive_name';
		end
	end
end
print(@vquery)
exec(@vquery)

/////////////////////////////////////////////////////////end///////////////////////////////////////////////  



/////////////////////////////////Add by Deepika 18/05/2012 issue no. 6747////////////////////////////


ALTER PROCEDURE  [dbo].[cir_agency_type_bind]

 @pcomp_code as varchar(200),
 @pdateformat as varchar(200),
 @pextra1 as varchar(200),
 @pextra2 as varchar(200)

 AS
  select * from cir_agency_typ_mast 
                             where comp_code=@pcomp_code
                              and((UPPER(agency_type_desc)  like UPPER(@pextra1) + '%')
		                   OR	(@pextra1  is null))  and
                             
                                    	ISNULL(freeze_flag,'N')='N'
                             order by agency_type_code


//////////////////////////////////////////end ////////////////////////////////////////////



/////////////////ADD FOR ISSUE NO. 7464 19/05/2012/////////////////////////////////////////



ALTER procedure [dbo].[cir_rep_supply_cir_branch_wise_supply]
(
@pcomp_code     as varchar(50),
@punit_code     as varchar(50),
@ppubl          as varchar(50),
@pmainedtn      as varchar(50),
@pedtn          as varchar(50),
@proute         as varchar(50),
@pfrom_supdate  as varchar(50),
@ptill_supdate  as varchar(50),
@pdateformat    as varchar(50),
@pextra1        as varchar(50),--for login user id
@pextra2        as varchar(50),----supply type
@pextra3        as varchar(50),------ for ,ag_class
@pextra4        as varchar(50)


)
as


declare @vfrom_supdate   as  datetime
declare @vtill_supdate   as  datetime


 set @vfrom_supdate=@pfrom_supdate
 set @vtill_supdate=@ptill_supdate

if(@pextra1 = '') begin
  set @pextra1 = null
end
if(@pextra2 = '') begin
  set @pextra2 = null
end
if(@pextra3 = '') begin
  set @pextra4 = null
end
if(@pextra4 = '') begin
  set @pextra4 = null
end

select d.comp_code as "COMP_CODE",d.unit_code AS "UNIT_CODE",m.branch_code, dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name ,
               d.agcd AS "AGCD",d.dpcd AS "DPCD",m.ag_name AS "AG_NAME",m.ag_name_oth_lang AS "AG_NAME_OTH_LANG",sum(d.sup_copy) AS "SUP_COPY",
               dbo.cir_get_city(d.comp_code,m.city_code) as "CITY_NAME",
               dbo.cir_get_name_cir_city(d.comp_code,m.city_code,2,null,null,null) as "CITY_ONAME",
               dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) as "DROP_POINT_NAME",
               dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) as "DROP_POINT_ONAME"
               from cir_dbksup d,cir_agmast m,cir_edtn_mast e
               where d.comp_code    = m.comp_code and d.comp_code    = e.comp_code and
                     d.unit_code    = m.unit and
                     d.agcd         = m.agcd and
                     d.dpcd         = m.dpcd and
                     d.comp_code    = @pcomp_code and
                     d.unit_code    = @punit_code and
                     d.publ         = e.publ 
                     
                     and d.publ         = @ppubl 
                    
                     and
                     
                     d.edtn=e.edtn and (d.edtn       = @pedtn or @pedtn is null or @pedtn ='')
                  
                     and
                   (d.route_code = @proute or @proute is null or @proute ='' )
                    
                    and
                     d.supdate between @vfrom_supdate and @vtill_supdate
                    and
                    (e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn ='') 
                  and (d.sup_type_code=@pextra2 or @pextra2 is null) and

					 (m.ag_type=@pextra3 or @pextra3 is null) 
					  and
					 (m.ag_class=@pextra4 or @pextra4 is null)
					
                  group by d.comp_code,d.unit_code,m.branch_code,
                           d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code
                  order by d.comp_code,d.unit_code,d.agcd,d.dpcd;
      
        select d.comp_code as "COMP_CODE",d.unit_code AS "UNIT_CODE",m.branch_code, dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name ,
               sum(d.sup_copy) AS "SUP_COPY"
               from cir_dbksup d,cir_agmast m,cir_edtn_mast e
               where d.comp_code    = m.comp_code and d.comp_code    = e.comp_code and
                     d.unit_code    = m.unit and
                     d.agcd         = m.agcd and
                     d.dpcd         = m.dpcd and
                     d.comp_code    = @pcomp_code and
                     d.unit_code    = @punit_code and
                     d.publ         = e.publ and 
                     d.publ         = @ppubl and
                     d.edtn=e.edtn and (d.edtn       = @pedtn or @pedtn is null) 
                   and
                   (d.route_code = @proute or @proute is null  or @proute ='') and
                     d.supdate between @vfrom_supdate and @vtill_supdate
                     and
                     (e.main_edtn=@pmainedtn or @pmainedtn is null or  @pmainedtn='')
                      and 
					 (m.ag_type=@pextra3 or @pextra3 is null) and 
					 (m.ag_class=@pextra4 or @pextra4 is null)
                  group by d.comp_code,d.unit_code,m.branch_code
                  order by d.comp_code,d.unit_code,m.branch_code;
     
        select d.comp_code as "COMP_CODE",d.unit_code AS "UNIT_CODE",m.branch_code, dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name ,
               sum(d.sup_copy) AS "SUP_COPY"
               from cir_dbksup d,cir_agmast m,cir_edtn_mast e
               where d.comp_code    = m.comp_code and d.comp_code    = e.comp_code and
                     d.unit_code    = m.unit and
                     d.agcd         = m.agcd and
                     d.dpcd         = m.dpcd and
                     d.comp_code    = @pcomp_code and
                     d.unit_code    = @punit_code and
                     d.publ         = e.publ and d.publ         = @ppubl 
                   and
                     d.edtn=e.edtn and (d.edtn       = @pedtn or @pedtn is null)
                      and
                     (d.route_code = @proute or @proute is null or @proute='') and
                     d.supdate between @vfrom_supdate and @vtill_supdate 
                   and
                     (e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='') 
                   and 
					 (m.ag_type=@pextra3 or @pextra3 is null) and 
					 (m.ag_class=@pextra4 or @pextra4 is null)
                  group by d.comp_code,d.unit_code,m.branch_code
                  order by d.comp_code,d.unit_code,m.branch_code;
     
       select d.comp_code as "COMP_CODE",m.branch_code,dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name ,
	   sum(d.sup_copy) AS "SUP_COPY",max(sup_rate) as "COPY_RATE"
               from cir_dbksup d,cir_agmast m,cir_edtn_mast e
               where d.comp_code    = m.comp_code and d.comp_code    = e.comp_code and
                     d.unit_code    = m.unit and
                     d.agcd         = m.agcd and
                     d.dpcd         = m.dpcd and
                     d.comp_code    = @pcomp_code and
                     d.unit_code    = @punit_code and
                     d.publ         = e.publ and d.publ         = @ppubl 
                    and
                 d.edtn=e.edtn and (d.edtn       = @pedtn or @pedtn is null) 
                   and
                     (d.route_code = @proute or @proute is null or @proute='') and
                     d.supdate between @vfrom_supdate and @vtill_supdate 
                     and
                     (e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
                     and 
					 (m.ag_type=@pextra3 or @pextra3 is null) and 
					 (m.ag_class=@pextra4 or @pextra4 is null)
                  group by d.comp_code,m.branch_code
                  order by d.comp_code,m.branch_code;
   

///////////////////////////////////////////////////END///////////////////////////////////////////////

////////////////////////////////////ISSUE NO:6657(19/05/2012)/////////////////////////////////

USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[cir_rep_inst_agency_wise]    Script Date: 05/19/2012 14:03:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



ALTER procedure [dbo].[cir_rep_inst_agency_wise](
      @pcompcode         as varchar(50),
      @punitcode         as varchar(50),
      @pbrancode         as varchar(50),
      @pagcd             as varchar(50),
      @pdpcd             as varchar(50),
      @pac_type          as varchar(50),
      @pfrom_dt          as datetime,
      @ptill_dt          as datetime,
      @ppaymode          as varchar(50),
      @preptype          as varchar(50),--D for Detail ,S for Summary
      @pdateformat       as varchar(50),
      @puserid           as varchar(50),
      @pextra1           as varchar(50),
      @pextra2           as varchar(50),
      @pextra3           as varchar(50),
      @pextra4           as varchar(50),
      @pextra5           as varchar,
      @pextra6           as varchar(50),
      @pextra7           as varchar(50),
      @pextra8           as varchar(50),
      @pextra9           as varchar(50),
      @pextra10          as varchar(50)     
     
      )
As

declare @v_frdt  as       datetime;
declare  @v_todt  as       datetime;


set @v_frdt=@pfrom_dt;
set @v_todt=@ptill_dt;

if (@preptype='1') 
begin--details                   
      
				select x.comp_code as "COMP_CODE", x.unit_code as "UNIT_CODE", x.inst_date as "INST_DATE", x.inst_code as "INST_CODE",
				x.agcd as "AGCD", x.dpcd as "DPCD",x.ag_name as "AG_NAME",x.branch_code as "BRANCH_CODE",(select "Branch_Name" from branch_mst where "Branch_Code"=x.branch_code) as "BRANCH_NAME",
				x.drop_point_name as "DROP_POINT_NAME", x.city_name as "CITY_NAME",x.state_name as "STATE_NAME",
				x.dist_name as "DIST_NAME",x.ag_type as "AG_TYPE",x.agency_type_name as "AGENCY_TYPE_NAME",
				x.inst_no as "INST_NO",x.inst_duedt as "INST_DUEDT" ,x.inst_enddt as "INST_ENDDT",
				x.inst_chqno as "INST_CHQNO",x.inst_chqdt as "INST_CHQDT",x.inst_chqamt as "INST_CHQAMT",x.inst_status as "INST_STATUS",
				x.inst_stdt as "INST_STDT", x.no_of_inst as "NO_OF_INST", x.tot_instamt as "TOT_INSTAMT", x.inst_freq as "INST_FREQ",
				x.inst_amt as "INST_AMT",x.paid_amt as "PAID_AMT",(isnull(x.inst_amt,0)-abs(isnull(x.paid_amt,0))) as "INST_BAL"
				FROM(select d.comp_code, d.unit_code, m.inst_date, d.inst_code,
				d.agcd, d.dpcd ,a.ag_name ,a.branch_code ,(select "Branch_Name" from branch_mst where "Branch_Code"=a.branch_code) as "BRANCH_NAME",
				dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,a.station_code,1) as "DROP_POINT_NAME", 
				dbo.cir_get_city(d.comp_code,a.city_code) as "CITY_NAME",dbo.cir_get_state(d.comp_code,a.country_code, a.state_code) as "STATE_NAME",
				dbo. cir_get_dist(d.comp_code,a.state_code,a.dist_code) as "DIST_NAME",
				a.ag_type ,(select agency_type_desc from cir_agency_typ_mast where comp_code=d.comp_code and agency_type_code=a.ag_type) as "AGENCY_TYPE_NAME",
				d.inst_no,d.inst_duedt ,d.inst_enddt,
				d.inst_chqno ,d.inst_chqdt,d.inst_chqamt ,d.inst_status ,m.inst_stdt , m.no_of_inst , m.tot_instamt , m.inst_freq ,
				d.inst_amt,(select abs(sum(inst_due_amt)) from cir_inst_bill_det where comp_code=m.comp_code and inst_code=m.inst_code and agcd=m.agcd and dpcd=m.dpcd and
				recptno is not null and recptdt<=@v_todt) as "PAID_AMT"
				from cir_installment_mast m,cir_installment_det d,cir_agmast a
				where d.comp_code=m.comp_code and d.comp_code=a.comp_code 
				and d.comp_code=@pcompcode 
				and d.unit_code=m.unit_code 
				and d.unit_code=a.unit and 
				d.unit_code=isnull(@punitcode,d.unit_code) 
				and 
				d.agcd=m.agcd and d.agcd=a.agcd 
				and d.agcd=isnull(@pagcd,d.agcd) 
				and d.dpcd=m.dpcd and d.dpcd=a.dpcd 
				and d.dpcd=isnull(@pdpcd,d.dpcd) 
				and m.achd=isnull(@pac_type,m.achd) 
				--and         m.inst_date between @v_frdt and @v_todt
				and (m.paymode=@ppaymode or @ppaymode is null)) x
				order by comp_code,unit_code,branch_name,ag_name,inst_date,inst_no;

end 
    


if(@preptype='2')
 begin
--for summrey

				select x.comp_code as "COMP_CODE", x.unit_code as "UNIT_CODE", x.agcd as "AGCD", x.dpcd as "DPCD",
				x.ag_name as "AG_NAME",x.branch_code as "BRANCH_CODE",x.branch_code as "BRANCH_NAME",
				x.drop_point_name as "DROP_POINT_NAME", x.city_name as "CITY_NAME",x.state_name as "STATE_NAME",x.dist_name as "DIST_NAME",
				x.ag_type as "AG_TYPE",x.agency_type_name as "AGENCY_TYPE_NAME",
				x.inst_freq as "INST_FREQ",x.inst_stdt as "INST_STDT",x.inst_enddt as "INST_ENDDT",
				x.inst_amt as "INST_AMT",x.paid_amt as "PAID_AMT",isnull(x.inst_amt,0)-isnull(x.paid_amt,0) as "BAL_AMT" from
				(select d.comp_code as "COMP_CODE", d.unit_code as "UNIT_CODE", d.agcd as "AGCD", d.dpcd as "DPCD",
				a.ag_name as "AG_NAME",a.branch_code as "BRANCH_CODE",(select "Branch_Name" from branch_mst where "Branch_Code"=a.branch_code) as "BRANCH_NAME",
				dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,a.station_code,1) as "DROP_POINT_NAME", 
				dbo.cir_get_city(d.comp_code,a.city_code) as "CITY_NAME",dbo.cir_get_state(d.comp_code,a.country_code, a.state_code) as "STATE_NAME",
				dbo.cir_get_dist(d.comp_code,a.state_code,a.dist_code) as "DIST_NAME",
				a.ag_type as "AG_TYPE",(select agency_type_desc from cir_agency_typ_mast where comp_code=d.comp_code and agency_type_code=a.ag_type) as "AGENCY_TYPE_NAME",
				m.inst_freq as "INST_FREQ",min(m.inst_stdt) as "INST_STDT",max(d.inst_enddt) as "INST_ENDDT",
				sum(d.inst_amt) as "INST_AMT",(select abs(sum(inst_due_amt)) from cir_inst_bill_det where comp_code=m.comp_code and inst_code=m.inst_code and agcd=m.agcd and dpcd=m.dpcd and
				recptno is not null and recptdt<=@v_todt) as "PAID_AMT"
				from cir_installment_mast m,cir_installment_det d,cir_agmast a
				where d.comp_code=m.comp_code 
				and d.comp_code=a.comp_code 
				and d.comp_code=@pcompcode 
				and d.unit_code=m.unit_code 
				and d.unit_code=a.unit 
				and d.unit_code=isnull(@punitcode,d.unit_code) 
				and d.agcd=m.agcd 
				and d.agcd=a.agcd 
				and d.agcd=isnull(@pagcd,d.agcd)
				and   d.dpcd=m.dpcd 
				and d.dpcd=a.dpcd and d.dpcd=isnull(@pdpcd,d.dpcd) 
				--and m.achd=isnull(@pac_type,m.achd) 
				-- and m.inst_date<=@v_todt 
				and (m.paymode=@ppaymode or @ppaymode is null)  
				group by 
				m.comp_code,
				m.INST_CODE,
				m.AGCD,
				m.DPCD,
				d.comp_code, d.unit_code, d.agcd, d.dpcd,a.ag_name,a.branch_code,a.station_code,
				a.city_code,a.country_code, a.state_code,a.dist_code,a.ag_type,m.inst_freq) x
				where isnull(x.inst_amt,0)-isnull(x.paid_amt,0)>0
				order by comp_code,unit_code,branch_name,ag_name;
     end 




if (@preptype='3') begin--for overall
		 
				select x.comp_code as "COMP_CODE", x.unit_code as "UNIT_CODE",x.branch_code as "BRANCH_CODE",
				(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=x.unit_code) as "PUB_CENT_NAME",
				(select "Branch_Name" from branch_mst where "Branch_Code"=x.branch_code) as "BRANCH_NAME",
				sum(x.tot_instamt) as "TOT_INSTAMT",
				sum(x.inst_amt) as "INST_AMT",sum(x.paid_amt) as "PAID_AMT",(sum(isnull(x.inst_amt,0))-sum(abs(isnull(x.paid_amt,0)))) as "INST_BAL"
				FROM(select d.comp_code, d.unit_code, m.inst_date, d.inst_code,
				a.branch_code ,(select "Branch_Name" from branch_mst where "Branch_Code"=a.branch_code) as "BRANCH_NAME",
				m.tot_instamt ,d.inst_amt,(select abs(sum(inst_due_amt)) from cir_inst_bill_det
				where comp_code=m.comp_code and inst_code=m.inst_code and agcd=m.agcd and dpcd=m.dpcd and
				recptno is not null ) as "PAID_AMT"
				from cir_installment_mast m,cir_installment_det d,cir_agmast a
				where d.comp_code=m.comp_code and d.comp_code=a.comp_code
				and d.comp_code=@pcompcode
				and d.unit_code=m.unit_code and d.unit_code=a.unit
				and  d.unit_code=isnull(@punitcode,d.unit_code)
				and m.inst_date between @v_frdt and @v_todt
				) x group by  x.comp_code, x.unit_code,x.branch_code ;


end



else
begin
				select x.comp_code as "COMP_CODE", x.unit_code as "UNIT_CODE",x.branch_code as "BRANCH_CODE",X.INST_CODE,
				dbo. cir_get_agency(comp_code,unit_code,(select MAX(AGCD) from cir_installment_det
				WHERE comp_code=X.COMP_CODE AND UNIT_CODE=X.UNIT_CODE AND INST_CODE=X.INST_CODE  ) ,
				(select MAX(dpcd) from cir_installment_det
				WHERE comp_code=X.COMP_CODE AND UNIT_CODE=X.UNIT_CODE AND INST_CODE=X.INST_CODE  )) "AGENCY",
				(select "Pub_Cent_name" from pub_cent_mast where "Pub_cent_Code"=x.unit_code) as "PUB_CENT_NAME",
				(select "Branch_Name" from branch_mst where "Branch_Code"=x.branch_code) as "BRANCH_NAME",
				sum(x.tot_instamt) as "TOT_INSTAMT",
				sum(x.inst_amt) as "INST_AMT",sum(x.paid_amt) as "PAID_AMT",(sum(isnull(x.inst_amt,0))-sum(abs(isnull(x.paid_amt,0)))) as "INST_BAL",
				(select MIN(INST_DUEDT) from cir_installment_det
				WHERE comp_code=X.COMP_CODE AND UNIT_CODE=X.UNIT_CODE AND INST_CODE=X.INST_CODE  ) as "START_DT",
				(select MAX(INST_DUEDT) from cir_installment_det
				WHERE comp_code=X.COMP_CODE AND UNIT_CODE=X.UNIT_CODE AND INST_CODE=X.INST_CODE  ) as "FINSHED_DT",
				(select MAX(AGCD) from cir_installment_det
				WHERE comp_code=X.COMP_CODE AND UNIT_CODE=X.UNIT_CODE AND INST_CODE=X.INST_CODE  ) as "AGCD",
				(select MAX(dpcd) from cir_installment_det
				WHERE comp_code=X.COMP_CODE AND UNIT_CODE=X.UNIT_CODE AND INST_CODE=X.INST_CODE  ) as "DPCD",

				
(
select
case inst_freq
when 'M' then 'MONTHLY'
when 'W' then 'WEEKLY'
when 'D' then 'DAILY'
when 'Y' then 'YEARLY' end

FROM cir_installment_MAST  WHERE comp_code=X.COMP_CODE AND UNIT_CODE=X.UNIT_CODE AND INST_CODE=X.INST_CODE)
"INST_FREQ"
				
			/*	(SELECT decode(inst_freq,'M','MONTHLY','W','WEEKLY','D','DAILY','YEARLY') FROM cir_installment_MAST
				WHERE comp_code=X.COMP_CODE AND UNIT_CODE=X.UNIT_CODE AND INST_CODE=X.INST_CODE  )  "INST_FREQ"*/


				FROM(select d.comp_code, d.unit_code, m.inst_date, d.inst_code,
				a.branch_code ,(select "Branch_Name" from branch_mst where "Branch_Code"=a.branch_code) as "BRANCH_NAME",
				m.tot_instamt ,d.inst_amt,(select abs(sum(inst_due_amt)) from cir_inst_bill_det 
				where comp_code=m.comp_code and inst_code=m.inst_code and agcd=m.agcd and dpcd=m.dpcd and
				recptno is not null ) as "PAID_AMT"
				from cir_installment_mast m,cir_installment_det d,cir_agmast a
				where d.comp_code=m.comp_code and d.comp_code=a.comp_code 
				and d.comp_code=@pcompcode
				and d.unit_code=m.unit_code and d.unit_code=a.unit 
				and d.agcd=m.agcd and d.dpcd=m.dpcd and d.agcd=a.agcd and d.dpcd=a.dpcd
				and d.agcd=isnull(@pagcd,d.agcd) and d.dpcd=isnull(@pdpcd,d.dpcd)
				and  d.unit_code=isnull(@punitcode,d.unit_code)
				and m.inst_date between @v_frdt and @v_todt 
				) x group by  x.comp_code, x.unit_code,x.branch_code,X.INST_CODE ;  				
					


end





//////////////////////END/////////////////////////S


///////////////////////////////add by deepika for issue no  7525 19/05/2012//////////////////



ALTER  procedure [dbo].[chkprefren]
@Pcompcode as varchar(10)

as 

select * from PREFERRENCES where "comp_code"=@Pcompcode;


/////////////////////////////


ALTER procedure [dbo].[fa_account_mast_typewise] 
      @pcompcode     as    varchar(20),
      @paccty        as    varchar(20),
      @paccname      as    varchar(200),
      @puserid       as    varchar(20),
      @pextra1       as    varchar(200),
      @pextra2       as    varchar(200)
   as
begin

if @paccty='' Begin
    set @paccty=null
end

if @paccname='' Begin
    set @paccname=null
end
if @puserid='' Begin
    set @puserid=null
end
if @pextra1='' Begin
    set @pextra1=null
end
if @pextra2='' Begin
    set @pextra2=null
end
         select m.comp_code as "COMP_CODE", m.cdp as "CDP", m.acc_name as "ACC_NAME", m.acc_alias as "ACC_ALIAS",
         m.acc_nature as "ACC_NATURE", m.ACC_TY as "ACC_TY",t.ac_type_desc as "AC_TYPE_DESC",t.ac_cash_bank as "AC_CASH_BANK"
           from fa_acc_mast m,fa_account_type_mast t
            where m.comp_code = @pcompcode and m.comp_code = t.comp_code
                and m.acc_ty =t.ac_type_code and t.ac_cash_bank=isnull(@paccty,t.ac_cash_bank)
                and (upper (m.acc_name) like upper ('%' +@paccname + '%') or @paccname is null)
                order by acc_name
             
            
END

///////////////////////////////




ALTER PROCEDURE [dbo].[bindagencynameonkey]
@compcode as varchar(8),
@userid as varchar(8),
@agency varchar(1000)
 AS

--select  distinct  Agency_Code,agency_name from Agency_mast where comp_code=@compcode and userid=@userid and type='P'

select  distinct  SUB_Agency_Code,Agency_Name,code_subcode from Agency_mast where comp_code=@compcode  and agency_name like '%'+@agency+'%'



///////////////////////////////for save/////////









ALTER PROCEDURE [dbo].[loginInsert]
@username as varchar(50),
@password as varchar(20),
@userid as varchar(10),
@date_format as varchar(50),
@comp_name as varchar(50),
@com_code as varchar(10),
@curr_code as varchar(8),
@retainer_code as varchar(8),
@agencycode as varchar(50),
@user as  varchar(50),
@admin as varchar(50),
@comp_user as varchar(20),
@compnamelist as varchar(25),
@emailid  as varchar(50),
@discount as varchar(20),
@filter as varchar(50),
@rolename as varchar(20),
@editlines as varchar(50),
@firstname  as VARCHAR(20),
@lastname   as VARCHAR(20),
@pstatus    AS VARCHAR(20),
@p_empcode as varchar(50),
@p_acccode as varchar(50)
AS

insert into login(username,   password,   userid,   date_format,    comp_name,com_code, curr_code, retainer_code, Agency_code,user_status,Admin,Company_user,USER_COMPANY,EMAIL ,DISCOUNT,FILTER,ROLEID,BOOKING_EDITLINES,FIRSTNAME,LASTNAME,STATUS,HR_CODE,ACC_CODE)
values(@username,@password,@userid,@date_format,@comp_name,@com_code,@curr_code,@retainer_code,@agencycode,@user,@admin,@comp_user ,@compnamelist,@emailid,@discount,@filter,@rolename,@editlines,@firstname,@lastname,@pstatus,@p_empcode,@p_acccode)


 DELETE FROM MODULE_DETAIBUTTONL WHERE MODULE_DETAIBUTTONL.userid=@userid

 INSERT INTO MODULE_DETAIBUTTONL SELECT BUTTONID, FORM_NAME,COMPCODE,@userid,'',FORM_ID,'','','','','0',''  FROM ROLE_PERMISSION WHERE ROLEID=@rolename



/////////////////////////////////////for execute


ALTER PROCEDURE [dbo].[loginexecute]

@username as varchar(50),
@userid as varchar(10),
@com_code as varchar(10),
@admin as varchar(8)

AS

declare @query  as   varchar(1000)



	if(@admin='')
		set @query='select [username]
      ,[password]
      ,[userid]
      ,[date_format]
      ,[COM_CODE]
      ,[comp_name]
      ,[Autogenerate]
      ,[curr_code]
      ,[retainer_code]
      ,[Agency_code]
      ,[User_status]
      ,[Admin]
      ,[Company_user]
      ,[USER_COMPANY]
      ,[EMAIL]
      ,[CREATION_DATETIME]
      ,[DISCOUNT]
      ,[FILTER]
      ,[ROLEID]
      ,[BOOKING_EDITLINES]
      ,[FIRSTNAME]
      ,[LASTNAME]
      ,[ROLE]
      ,[STATUS]
      ,[DOMAIN_USER]
      ,(select NAME+''(''+EMP_CODE+'')'' from HR_EMP_MST where COMP_CD='''+@com_code+''' AND EMP_CODE=login.HR_CODE)AS HR_CODE,(select Agency_Name from agency_mast where  agency_mast.code_subcode=LOGIN.Agency_code)as AGENCY_NAME,(select ACC_NAME from fa_acc_mast where CDP=LOGIN.ACC_CODE) as ACC_NAME,ACC_CODE from login where   admin!=''yes'''  --username='''+@username+''''
	else
		set @query='select [username]
      ,[password]
      ,[userid]
      ,[date_format]
      ,[COM_CODE]
      ,[comp_name]
      ,[Autogenerate]
      ,[curr_code]
      ,[retainer_code]
      ,[Agency_code]
      ,[User_status]
      ,[Admin]
      ,[Company_user]
      ,[USER_COMPANY]
      ,[EMAIL]
      ,[CREATION_DATETIME]
      ,[DISCOUNT]
      ,[FILTER]
      ,[ROLEID]
      ,[BOOKING_EDITLINES]
      ,[FIRSTNAME]
      ,[LASTNAME]
      ,[ROLE]
      ,[STATUS]
      ,[DOMAIN_USER]
      ,(select NAME+''(''+EMP_CODE+'')'' from HR_EMP_MST where COMP_CD='''+@com_code+''' AND EMP_CODE=login.HR_CODE)AS HR_CODE,(select Agency_Name from agency_mast where  agency_mast.code_subcode=LOGIN.Agency_code)as AGENCY_NAME,(select ACC_NAME from fa_acc_mast where CDP=LOGIN.ACC_CODE) as ACC_NAME,ACC_CODE from login where admin=''yes'''

if(@com_code<>''  and @com_code <>'0')
begin
	set @query= @query + ' and com_code= '''+@com_code+''''
end

if(@username<>'')
begin
	set @query= @query + ' and username like ''%'+@username+'%'''
end

if(@userid<>'')
begin
	set @query= @query + ' and userid = '''+@userid+''''
end



print(@query)
exec(@query)


///////////////////////////////////// for modify



ALTER PROCEDURE  [dbo].[loginModify]

@username as varchar(50),
@password as varchar(20),
@userid as varchar(10),
@date_format as varchar(50),
@comp_name as varchar(50),
@com_code as varchar(10),
@curr_code as varchar(8),
@retainer_code as varchar(8),
@agencycode as varchar(50),
@user as varchar(50),
@admin as varchar(50),
@comp_user as varchar(20),
@companylist as varchar(25),
@emailid as varchar(50),
@disc as varchar(20),
@fil as varchar(8),
@role as varchar(8),
@editlines as varchar(1),
@firstname  as VARCHAR(20),
@lastname   as VARCHAR(20),
@pstatus    AS VARCHAR(20),
@p_empcode as varchar(50),
@p_acccode as varchar(50)


AS

update login set FIRSTNAME=@firstname,LASTNAME =@lastname,username=@username, password=@password, date_format=@date_format, comp_name=@comp_name, com_code=@com_code, curr_code=@curr_code, 
retainer_code=@retainer_code,Agency_code=@agencycode,user_status=@user,Admin=@admin,Company_user=@comp_user ,
 BOOKING_EDITLINES=@editlines, ROLEID=@role,FILTER=@fil, DISCOUNT=@disc, USER_COMPANY=@companylist,EMAIL=@emailid,STATUS=@pstatus,HR_CODE=@p_empcode,ACC_CODE=@p_acccode where userid=@userid

DELETE FROM MODULE_DETAIBUTTONL WHERE MODULE_DETAIBUTTONL.userid=@userid

INSERT INTO MODULE_DETAIBUTTONL
           ([Button_id]
           ,[Form_Name]
           ,[comp_code]
           ,[userid]
           ,[Module_No]
           ,[Form_id]
           ,[Paid_permission]
           ,[Backdate_booking]
           ,[Ro_date_perm]
           ,[Confirm_qbc])
            SELECT BUTTONID, FORM_NAME,COMPCODE,@userid,'',FORM_ID,'','','',''  FROM ROLE_PERMISSION WHERE ROLEID=@role;





/////////////////////////////// for delete



ALTER PROCEDURE [dbo].[loginDelete] 

@userid as varchar(8),
@compcode as varchar(8)
AS

delete login where userid=@userid
delete login_branch_mast where user_code=@userid
delete from module_detaibuttonl where userid= @userid and comp_code=@compcode





/////////////////////////////////////////////////end////////////////////////////////////////////////////////////////////////



////////////////////////////////////add by Deepika for issue no 7433 19/05/2012//////////////////////////////


 ALTER Procedure [dbo].[cir_pcenter_detail_p]
     @pcompcode           VARCHAR(20),
     @ppcenter           VARCHAR(20),
     @plangtype           VARCHAR(20),  ---1 for enlish and 2 for other language
     @pdateformat         VARCHAR(20),
     @pextra1             VARCHAR(200),
     @pextra2            VARCHAR(200)


  As
  
       
	select TOP 1 *,(select pan_no from comp_mst x where x.comp_code= pub_cent_mast.comp_code and comp_code=@pcompcode) as "pan_no"
	from pub_cent_mast where /*"Comp_Code"=pcompcode  and*/
	(Pub_cent_Code=@ppcenter or @ppcenter is null or @ppcenter = '') 
	order by "Comp_Code";
        


 

///////////////////////////////////////end//////////////////////////////////////////////////




\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\add by Vivek for issue no 4649 21/05/2012////////////////////////////////////


USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[tv_duplicacy]    Script Date: 05/21/2012 10:49:15 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[tv_duplicacy]
	@ptbl_name                                VARCHAR(4000) ,
	@pcol1                                    VARCHAR(4000) ,
	@pcol1_val                                VARCHAR(4000) ,
	@pcol2                                    VARCHAR(4000) ,
	@pcol2_val                                VARCHAR(4000) ,
	@pcol3                                    VARCHAR(4000) ,
	@pcol3_val                                VARCHAR(4000) ,
	@pcol4                                    VARCHAR(4000) ,
	@pcol4_val                                VARCHAR(4000) ,
	@pcol5                                    VARCHAR(4000) ,
	@pcol5_val                                VARCHAR(4000) ,
	@pcol6                                    VARCHAR(4000) ,
	@pcol6_val                                VARCHAR(4000) ,
	@pcol7                                    VARCHAR(4000) ,
	@pcol7_val                                VARCHAR(4000) ,
	@pcol8                                    VARCHAR(4000) ,
	@pcol8_val                                VARCHAR(4000) ,
	@pcol9                                    VARCHAR(4000) ,
	@pcol9_val                                VARCHAR(4000) ,
	@pcol10                                   VARCHAR(4000) ,
	@pcol10_val                               VARCHAR(4000) ,
	@pdateformat                              VARCHAR(4000) ,
	@pextra1                                  VARCHAR(4000) ,
	@pextra2                                  VARCHAR(4000) 
AS 
	BEGIN
		SET NOCOUNT ON
		
		DECLARE @v_query                                  VARCHAR(4000) 
		DECLARE @num                                      FLOAT 
		SELECT @v_query  = 'SELECT COUNT(*) as "REC_COUNT" FROM ' + @ptbl_name  +' WHERE 1 = 1' 
		IF @pcol1 IS NOT NULL and @pcol1<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol1 + '=''' + @pcol1_val + '''' 
		END
   
		IF @pcol2 IS NOT NULL and @pcol2<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol2 + '=''' + @pcol2_val + '''' 
		END
   
		IF @pcol3 IS NOT NULL and @pcol3<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol3 + '=''' + @pcol3_val + '''' 
		END
   
		IF @pcol4 IS NOT NULL and @pcol4<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol4 + '=''' + @pcol4_val + '''' 
		END
   
		IF @pcol5 IS NOT NULL and @pcol5<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol5 + '=''' + @pcol5_val + '''' 
		END
   
		IF @pcol6 IS NOT NULL and @pcol6<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol6 + '=''' + @pcol6_val + '''' 
		END
   
		IF @pcol7 IS NOT NULL and @pcol7<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol7 + '=''' + @pcol7_val + '''' 
		END
   
		IF @pcol8 IS NOT NULL and @pcol8<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol8 + '=''' + @pcol8_val + '''' 
		END
   
		IF @pcol9 IS NOT NULL and @pcol9<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol9 + '=''' + @pcol9_val + '''' 
		END
   
		IF @pcol10 IS NOT NULL and @pcol10<>''
		BEGIN 
			SELECT @v_query  = @v_query + ' AND ' + @pcol10 + '=''' + @pcol10_val + '''' 
		END
   
		DECLARE @PrintVariable VARCHAR (4000)

		SELECT @PrintVariable =  ISNULL(CAST(@v_query AS VARCHAR(8000)), '' ) 

		PRINT (@PrintVariable)
		EXEC (@v_query)

END





////////////////////////////////////////end by Vivek///////////////////////////////////////////////////////////////////////

//////////////////////////////////Add by Vivek for issue no 6836 21/05/2012////////////////////////////////////////////


USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[cir_aglisting_commcat]    Script Date: 05/21/2012 14:28:00 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[cir_aglisting_commcat]
@pcomp_code       as varchar(200),
@punit            as varchar(200),
@pbranch_code     as varchar(200),
@pagcd            as varchar(200),
@pdpcd            as varchar(200),
@pag_type         as varchar(200),
@pag_class        as varchar(200),
@pcomm_code       as varchar(200),
@pextra1          as varchar(200),
@pextra2          as varchar(200)

AS 
	
select x.comm_catg_desc,max(x.comm_catg_desc),sum(x.upline)main ,sum(x.sub) sub,sum(isnull(x.upline,0))+sum(isnull(x.sub,0)) total from(
select  c.comm_catg_desc,count(*) "UPLINE",null "SUB"  from cir_supply a,cir_agmast b,cir_comm_catg_mast c
  where a.comp_code=@pcomp_code
  and a.comp_code=b.comp_code
  and a.comp_code=c.comp_code
  and (a.unit=@punit or @punit is null or @punit ='')
  and a.unit=b.unit
  and (b.branch_code=@pbranch_code or @pbranch_code is null  or @pbranch_code ='')
  and a.agcd=b.agcd and a.dpcd=b.dpcd and a.dpcd='0001'
  and (a.agcd=@pagcd or @pagcd is null or @pagcd ='')
  and (a.dpcd=@pdpcd or @pdpcd is null or @pdpcd='')
  and (b.ag_type=@pag_type or @pag_type is null or @pag_type ='')
  and (b.ag_class=@pag_class or @pag_class is null or @pag_class ='')
  and (a.comm_code=@pcomm_code or @pcomm_code is null or @pcomm_code ='')
  and a.comm_code=c.comm_catg_code
  group by c.comm_catg_desc
union all
select c.comm_catg_desc,null "UPLINE",count(*) "SUB"   from cir_supply a,cir_agmast b,cir_comm_catg_mast c
  where a.comp_code=@pcomp_code
  and a.comp_code=b.comp_code
  and a.comp_code=c.comp_code
  and (a.unit=@punit or @punit is null or @punit ='')
  and a.unit=b.unit
  and (b.branch_code=@pbranch_code or @pbranch_code is null or @pbranch_code ='')
  and a.agcd=b.agcd and a.dpcd=b.dpcd and a.dpcd!='0001'
  and (a.agcd=@pagcd or @pagcd is null or @pagcd ='')
  and (a.dpcd=@pdpcd or @pdpcd is null or @pdpcd ='')
  and (b.ag_type=@pag_type or @pag_type is null or @pag_type ='')
  and (b.ag_class=@pag_class or @pag_class is null or @pag_class ='')
  and (a.comm_code=@pcomm_code or @pcomm_code is null or @pcomm_code ='')
  and a.comm_code=c.comm_catg_code
  group by c.comm_catg_desc) x
  group by x.comm_catg_desc order by X.comm_catg_desc;





////////////////////////////////////End by Vivek/////////////////////////////////////////////////////////////////////////

********************* end of route supply(Daily variance report - add city name*********************Rikkee Garg-21/5/12



USE [thevoice]
GO
/****** Object:  StoredProcedure [dbo].[cir_rep_supply_cir_route_supply_variance_p]    Script Date: 05/21/2012 11:57:48 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[cir_rep_supply_cir_route_supply_variance_p]
	@pcomp_code                               VARCHAR(20) ,
	@punit_code                               VARCHAR(20) ,
	@ppublication                             VARCHAR(20) ,
	@pmainedtn                                VARCHAR(20) ,
	@pedtn                                    VARCHAR(20) ,
	@proute                                   VARCHAR(20) ,
	@pfirstdate                               VARCHAR(20) ,
	@pseconddate                              VARCHAR(20) ,
	@pdateformat                              VARCHAR(20) ,
	@pextra1                                  VARCHAR(200),--it is use for finalised or unfinalised
	@pextra2                                  VARCHAR(200),--it is used for supply type 

	@pextra3             as varchar(200),--agency type
	@pextra4             as varchar(200),-- agency class
	@pextra5             as varchar(200),--final.unfinal
	@pextra6             as varchar(200),
	@pextra7             as varchar(200),
	@pextra8             as varchar(200),
	@pextra9             as varchar(200),
	@pextra10            as varchar(200)
AS 

	DECLARE @vfirstdate                               DATETIME 
	DECLARE @vseconddate                              DATETIME 
Begin		
	SET @vfirstdate  =  dbo.convert_user_date('/',@pfirstdate,@pdateformat)
	SET @vseconddate  = dbo.convert_user_date('/',@pseconddate,@pdateformat)
	print(@vfirstdate)
	print(@vseconddate)

	If upper(@pextra1)='U' Begin
         select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
         dbo.cir_get_city(x.comp_code,x.city_code) "CITY NAME",
         x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",

		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",

		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                           order by comp_code,route_code,ag_name
		End
        else	Begin
				select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
				dbo.cir_get_city(x.comp_code,x.city_code) "CITY NAME",
				x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "INCREASE SUPPLY",

				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "DECREASE SUPPLY",

				CASE SUM(x.first_sup) WHEN 0 THEN 100 
				ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
				END "PERCENT_VARIANCE",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd      =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code=   b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn      =   a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and 
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code )x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,
									x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                                   order by comp_code,route_code,ag_name
        End
        
        If upper(@pextra1)='U' Begin
				---route wise total
        select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='' ) and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null  or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null  or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.route_code,x.route_name,x.route_name_oth_lang
                           order by comp_code,route_code
		End
        else	Begin
				----route wise total
                 select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "INCREASE SUPPLY",
				CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
				ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
				END "DECREASE SUPPLY",
				CASE SUM(x.first_sup) WHEN 0 THEN 100 
				ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
				END "PERCENT_VARIANCE" from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code=     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =      a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
										(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code ) x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.route_code,x.route_name,x.route_name_oth_lang
                                   order by comp_code,route_code
        End
        
        If upper(@pextra1)='U' Begin
				----comp wise total
        select x.comp_code "COMP CODE",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "INCREASE SUPPLY",
		CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
		ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
		END "DECREASE SUPPLY",
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE",
		(select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
        d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
        (m.dist_code = @proute or @proute is null or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
        where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
        (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
		(select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
          (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code		 = @pcomp_code and unit_code =    @punit_code and
                                 publ			 = @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code
                           order by comp_code
			End
        else	Begin
        ----comp wise total
                     select x.comp_code "COMP CODE",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
					CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN - 1 THEN 0 
					ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
					END "INCREASE SUPPLY",

					CASE sign(ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) WHEN 1 THEN 0 
					ELSE (ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) 
					END "DECREASE SUPPLY",

					CASE SUM(x.first_sup) WHEN 0 THEN 100 
					ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
					END "PERCENT_VARIANCE",
                     (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
                            d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn='') and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                            (m.dist_code = @proute or @proute is null  or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                            (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                             publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                             supdate                  =   @vfirstdate and cir_dbksup.comp_code =    b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                             (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                                  (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                             publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                             supdate      = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = @vfirstdate or a.supdate = @vseconddate) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code )x
                                 where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code
        End
		 
End

*********************************** end of route supply(Daily variance report - add city name)***********************

///////////////////////////////// Add by Vivek issue no 6836 21/05/2012/////////////////////////////////////////////


USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[cir_branchlisting_commcat]    Script Date: 05/21/2012 14:37:58 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[cir_branchlisting_commcat]
@pcomp_code       as varchar(200),
@punit            as varchar(200),
@pbranch_code     as varchar(200),
@pagcd            as varchar(200),
@pdpcd            as varchar(200),
@pag_type         as varchar(200),
@pag_class        as varchar(200),
@pcomm_code       as varchar(200),
@pextra1          as varchar(200),
@pextra2          as varchar(200)

AS 
	
select x.branch_code,x.branch_name,x.comm_catg_desc
,
max(x.comm_catg_desc),
sum(x.upline)main ,
sum (isnull(x.sub,0)) sub,
sum(isnull(x.upline,0))+sum(isnull(x.sub,0))
 total from(
 select  b.branch_code, 
dbo.cir_get_branch(a.comp_code,b.branch_code) branch_name ,
c.comm_catg_desc,count(*) "UPLINE",null "SUB"  
from cir_supply a,cir_agmast b,cir_comm_catg_mast c
		where a.comp_code=@pcomp_code 
		and a.comp_code=b.comp_code 
		and a.comp_code=c.comp_code 
		and (a.unit=@punit or @punit is null or @punit ='') 
		and a.unit=b.unit 
		and (b.branch_code=@pbranch_code or @pbranch_code is null or @pbranch_code ='') 
		and a.agcd=b.agcd and a.dpcd=b.dpcd and a.dpcd='0001'
		and (a.agcd=@pagcd or @pagcd is null or @pagcd ='') 
		and (a.dpcd=@pdpcd or @pdpcd is null or @pdpcd ='') 
		and (b.ag_type=@pag_type or @pag_type is null or @pag_type ='')
		and (b.ag_class=@pag_class or @pag_class is null or @pag_class ='') 
		and (a.comm_code=@pcomm_code or @pcomm_code is null or @pcomm_code ='') 
		and a.comm_code=c.comm_catg_code
		group by a.comp_code,b.branch_code,c.comm_catg_desc
union
select  b.branch_code, dbo.cir_get_branch(a.comp_code,b.branch_code) branch_name ,c.comm_catg_desc,count(*) "UPLINE",null "SUB"  from cir_supply a,cir_agmast b,cir_comm_catg_mast c
		where a.comp_code=@pcomp_code 
		and a.comp_code=b.comp_code 
		and a.comp_code=c.comp_code 
		and (a.unit=@punit or @punit is null or @punit ='') 
		and a.unit=b.unit 
		and (b.branch_code=@pbranch_code or @pbranch_code is null or @pbranch_code ='') 
		and a.agcd=b.agcd and a.dpcd=b.dpcd and a.dpcd!='0001'
		and (a.agcd=@pagcd or @pagcd is null or @pagcd ='') 
		and (a.dpcd=@pdpcd or @pdpcd is null or @pdpcd ='') 
		and (b.ag_type=@pag_type or @pag_type is null or @pag_type ='')
		and (b.ag_class=@pag_class or @pag_class is null or @pag_class ='') 
		and (a.comm_code=@pcomm_code or @pcomm_code is null or @pcomm_code ='') 
		and a.comm_code=c.comm_catg_code
		group by a.comp_code,b.branch_code,c.comm_catg_desc) x 
		group by x.branch_code,x.branch_name,x.comm_catg_desc 
		order by x.branch_code,x.branch_name,x.comm_catg_desc






/////////////////////////////End by Vivek///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

************************* billing*************rikkee garg 21/05/12*************

USE [thevoice]
GO
/****** Object:  StoredProcedure [dbo].[cir_billing_p]    Script Date: 05/21/2012 15:32:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[cir_billing_p]
	@pcomp_code			VARCHAR(20) ,
	@punit_code         VARCHAR(20) ,
	@pbill_freq         VARCHAR(20) ,
	@ppubl_freq         VARCHAR(20) ,--for publication type
	@ppubl              VARCHAR(20) ,--for publication 
	@pfrdt              DATETIME ,
	@ptodt              DATETIME ,
	@pbilldt            DATETIME ,
	@pdateformat        VARCHAR(20) ,
	@puserid            VARCHAR(20) ,
	@pextra1            VARCHAR(400) ,
	@pextra2            VARCHAR(400) 
AS 
	DECLARE @vbill_publwise			varchar(1)
	set @vbill_publwise='N'
    DECLARE @vrec_publ				varchar(20);
    DECLARE @v_bill_publwise		varchar(20);
	DECLARE @ln_count               NUMERIC(10)
	DECLARE @vsrch_amt              FLOAT 
	DECLARE @daily_gross_amount     NUMERIC(12,2)
	DECLARE @daily_net_amount       NUMERIC(12,2) 
	DECLARE @tot_surcharge_amt      NUMERIC(12,2) 
	DECLARE @vcomm_per              FLOAT 
	DECLARE @vcomm_amt              NUMERIC(12,2) 
	DECLARE @curr_bilagcd           VARCHAR(30)                     
	SET @curr_bilagcd = 'DUMMY_CURR' 
	DECLARE @prev_bilagcd           VARCHAR(30)                     
	SET @prev_bilagcd = 'DUMMY_PREV' 
	DECLARE @curr_record            VARCHAR(100)                    
	SET @curr_record = 'DUMMY_CURR' 
	--new add

	DECLARE @prev_record            VARCHAR(100)                    
	SET @prev_record = 'DUMMY_PREV' 
	--new add
	
	DECLARE @SUP_DAY				varchar(25)

	DECLARE @tot_copy               NUMERIC(12)                     
	SET @tot_copy = 0 
	DECLARE @vbill_no               VARCHAR(20) 
	DECLARE @vid                    NUMERIC(10)
	DECLARE @v_frdt                 DATETIME 
	DECLARE @v_todt                 DATETIME 
	DECLARE @v_billdt               DATETIME 
	DECLARE @v_agcd_sec_per         FLOAT                           
	SET @v_agcd_sec_per = 0 
	DECLARE @v_agcd_sec_amt_limt    FLOAT                           
	SET @v_agcd_sec_amt_limt = 0 
	DECLARE @v_sec_limit            NUMERIC(10,2) 
	DECLARE @v_bill_dbn_amt         NUMERIC(10,2) 
	DECLARE @v_bill_sec_amt         NUMERIC(10,2) 
	DECLARE @v_remark               VARCHAR(200) 
	DECLARE @v_reptno               VARCHAR(25) 
	DECLARE @v_rec_no               NUMERIC(10) 
	DECLARE @v_daily_comm_amt       NUMERIC(10,2) 
	DECLARE @v_daily_sur_amt        NUMERIC(10,2) 
	DECLARE @v_daily_gross_amt      NUMERIC(10,2) 
	DECLARE @v_daily_bill_amt       NUMERIC(10,2) 

	DECLARE @vcomp_code1			varchar(20)
	DECLARE @vunit1					varchar(20)
	DECLARE @vbill_agcd1			varchar(20)
	DECLARE @vbill_dpcd1			varchar(20)
	DECLARE @vbranch_code1			varchar(20)
	DECLARE @vcity_name1			varchar(400)
	DECLARE @vag_name1				varchar(400)
	DECLARE @vprint_seqno1			float
	DECLARE @vagbill_publ1			varchar(20)
	
	DECLARE @vcomp_code11			varchar(20)
	DECLARE @vunit_code11			varchar(20)
	DECLARE @vpubl11				varchar(20)
	DECLARE @vedtn11				varchar(20)
	DECLARE @vcomm_fix_auto_spl11	varchar(20)
	DECLARE @vcomm_code11			varchar(400)
	DECLARE @vsup_rate11			float
	DECLARE @vsupdate11				datetime
	DECLARE @vsurch_cd11			varchar(400)
	DECLARE @sup_copy11				float
	DECLARE @avg_sup                FLOAT 
	DECLARE @vcomm_catg_type2       varchar(10)
	DECLARE @vsun_comm_rate2        float
	DECLARE @vsun_comm_rate1        float
	DECLARE @vmon_comm_rate1        float
	DECLARE @vtue_comm_rate1        float
	DECLARE @vwed_comm_rate1        float
	DECLARE @vthu_comm_rate1        float
	DECLARE @vfri_comm_rate1        float
	DECLARE @vsat_comm_rate1        float
	DECLARE @vcomm_catg_type1       varchar(10)
	DECLARE @vsun_rate1				float
	DECLARE @vmon_rate1				float
	DECLARE @vtue_rate1				float
	DECLARE @vwed_rate1				float
	DECLARE @vthu_rate1				float
	DECLARE @vfri_rate1				float
	DECLARE @vsat_rate1				float
	
	declare @v_bill_exist			numeric(10)

	SET @v_frdt		=	@pfrdt
	SET @v_todt		=	@ptodt
	SET @v_billdt	=	@v_todt
	
	create table #temp_dual
	(temp_publ	varchar(20))
	
	insert into #temp_dual(temp_publ) values(null)
	
	CREATE TABLE #CIR_BILL_DET_TEMP
	(COMP_CODE    VARCHAR(8),
	UNIT_CODE     VARCHAR(8),
	BILLNO        VARCHAR(20),
	BILLDT        DATETIME,
	AGCD          VARCHAR(8),
	DPCD          VARCHAR(8),
	PUBL          VARCHAR(3),
	EDTN          VARCHAR(3),
	BILL_COPY     NUMERIC(7),
	COPY_RATE     NUMERIC(10,4),
	COMM_FLAG     VARCHAR(1),
	COMM_RATE     NUMERIC(10,4),
	COMM_AMT      NUMERIC(10,4),
	SUR_RATE      NUMERIC(10,4),
	SUR_AMT       NUMERIC(10,4),
	GROSS_AMOUNT  NUMERIC(14,2),
	BILL_AMOUNT   NUMERIC(14,2),
	FROMDT        DATETIME,
	TODT          DATETIME,
	COAG          VARCHAR(8),
	CODP          VARCHAR(8),
	SESSIONID     NUMERIC(15),
	COMM_TYPE     VARCHAR(1))
    
    select @vbill_publwise=cir_bill_publwise from preferrences where "comp_code"=@pcomp_code

    select @v_bill_exist=count(*) from cir_bill_det d,cir_publ_mast p
        where d.comp_code = p.comp_code and d.comp_code=@pcomp_code and d.unit_code=@punit_code and
        d.billdt between @v_frdt and @v_todt and d.publ=p.publ and (p.pro_type = @ppubl_freq or @ppubl_freq is null);
	PRINT('@v_bill_exist')PRINT(@v_bill_exist)PRINT('@vbill_publwise')PRINT(@vbill_publwise)
    declare cur_publ cursor for
        select x.publ publ from 
        (select distinct publ from cir_publ_mast 
        where comp_code=@pcomp_code and publ = isnull(@ppubl,publ) and (pro_type=@ppubl_freq or @ppubl_freq is null) and 
        @vbill_publwise='Y' 
        union
        select null publ from #temp_dual where isnull(@vbill_publwise,'N')='N')x 
        order by publ
		PRINT('OPEN cur_publ')
		OPEN cur_publ 
		fetch NEXT FROM cur_publ INTO @vrec_publ
		WHILE (@@FETCH_STATUS = 0) BEGIN                
			
			PRINT('@vrec_publ')PRINT(@vrec_publ)
			
			DECLARE agency_cur cursor LOCAL FOR 
			select a.comp_code comp_code,a.unit unit,a.bill_agcd bill_agcd,a.bill_dpcd bill_dpcd,
			m.branch_code branch_code,dbo.cir_get_city(a.comp_code,m.city_code) city_name,
			m.ag_name ag_name,m.print_seq print_seqno,@vrec_publ agbill_publ from
			(select distinct a.comp_code,a.unit,a.bill_agcd,a.bill_dpcd
			from cir_agmast a,cir_supply s
			where  a.comp_code = @pcomp_code and a.comp_code = s.comp_code and a.unit  = s.unit and a.unit  = @punit_code and
			a.agcd=s.agcd and a.dpcd=s.dpcd and a.agcd+a.dpcd in (select distinct CAST(x.agcddpcd AS VARCHAR) from
			(select distinct CAST(d.agcd AS VARCHAR) + CAST(d.dpcd AS VARCHAR)as agcddpcd from cir_dbksup d,cir_publ_mast p
			where d.comp_code = @pcomp_code and d.comp_code = p.comp_code and d.unit_code = @punit_code and
			d.publ = isnull(@vrec_publ,d.publ) and d.publ = p.publ and
			d.supdate between @v_frdt  and  @v_todt and isnull(d.sup_copy,0)>0 
			union
			select distinct CAST(d.agcd AS VARCHAR) + CAST(d.dpcd AS VARCHAR) as agcddpcd from cir_dbksup_resale d,cir_publ_mast p
			where d.comp_code = @pcomp_code and d.comp_code = p.comp_code and d.unit_code = @punit_code and
			d.publ = isnull(@vrec_publ,d.publ) and d.publ = p.publ and
			d.supdate between @v_frdt  and  @v_todt and isnull(d.sup_copy,0)>0 ) x) and
			a.bill_agcd is not null and a.bill_agcd<>'' and a.bill_dpcd is not null and a.bill_dpcd<>'' and 
			--bill_agcd = 'A0002' and bill_dpcd = '0001' and
			isnull(a.to_bill,'N')='Y' and
			--isnull(a.unsold_valid_flag,'M')=@pbill_freq
			isnull(s.billing_cycle,'M')=@pbill_freq
			) a,cir_agmast m
			where a.comp_code=m.comp_code and a.unit=m.unit and a.bill_agcd=m.agcd and a.bill_dpcd=m.dpcd and
			@v_bill_exist=0
			order by comp_code,unit,branch_code,print_seqno,city_name,ag_name
           
		/*SELECT a.comp_code comp_code, a.unit unit, a.bill_agcd bill_agcd, a.bill_dpcd bill_dpcd, m.branch_code branch_code,
		dbo.cir_get_name_cir_city(a.comp_code, m.city_code, '1', '', '', '') city_name,m.ag_name ag_name, m.print_seq print_seqno
		FROM (	SELECT DISTINCT a.comp_code, a.unit, a.bill_agcd, a.bill_dpcd FROM  cir_agmast a WHERE	 a.comp_code  = @pcomp_code
		AND	a.unit  = @punit_code AND	a.agcd + a.dpcd  in(SELECT DISTINCT CAST(agcd AS VARCHAR) + CAST(dpcd AS VARCHAR)
		FROM  cir_dbksup WHERE	 comp_code  = @pcomp_code AND	unit_code  = @punit_code AND (publ  = @ppubl OR @ppubl  is null OR @ppubl='')
        AND	supdate  between @v_frdt  and  @v_todt AND	isnull(sup_copy, 0)  > 0) AND	a.bill_agcd  is not null AND	a.bill_dpcd  is not null
		AND	isnull(a.to_bill, 'N')  = 'Y' and isnull(a.unsold_valid_flag,'M')=@pbill_freq) a, cir_agmast m 
		WHERE	 a.comp_code  = m.comp_code AND	a.unit  = m.unit AND	a.bill_agcd  = m.agcd AND	a.bill_dpcd  = m.dpcd
		ORDER BY comp_code, unit, branch_code, print_seqno, city_name, ag_name */

		OPEN agency_cur 
		fetch NEXT FROM agency_cur INTO @vcomp_code1 , @vunit1 ,@vbill_agcd1, @vbill_dpcd1 , @vbranch_code1, @vcity_name1, @vag_name1,@vprint_seqno1,@vagbill_publ1
		WHILE (@@FETCH_STATUS = 0) BEGIN
			print('cursor_Agency_open')
			SET @curr_bilagcd  =  @vbill_agcd1 +  @vbill_dpcd1 
			SET @curr_record  =  @vbill_agcd1 +  @vbill_dpcd1 
			---------------------------------------------- add new code ------------------------------------------------------
					
			IF @curr_record <> @prev_record BEGIN 
				SET @daily_gross_amount  = 0 
				SET @tot_copy  = 0 
				SET @tot_surcharge_amt  = 0 
				SET @vsrch_amt  = 0 
				SET @vcomm_amt  = 0 
			END
			print('BILLING1')
            print(@vcomp_code1)
            print(@vunit1)
            print(@vbill_agcd1)
            print(@vbill_dpcd1)
            print(@vrec_publ)
            print(@v_frdt)
            print(@v_todt)
			
			        
			DECLARE cur_supply cursor LOCAL FOR
			select u.comp_code comp_code,u.unit_code unit_code,u.publ publ,u.edtn edtn,u.comm_fix_auto_spl comm_fix_auto_spl,
			u.comm_code comm_code,u.sup_rate sup_rate,u.supdate supdate,u.surch_cd surch_cd,sum(u.sup_copy) sup_copy from
			(select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,d.edtn edtn,d.comm_fix_auto_spl comm_fix_auto_spl,
			d.comm_code comm_code,d.sup_rate sup_rate,d.supdate supdate,d.surch_cd surch_cd,d.agcd agcd,d.dpcd dpcd,d.sup_copy sup_copy
			from cir_dbksup d,cir_supply_type_mast s,cir_publ_mast p
			where d.comp_code = @vcomp_code1 and d.comp_code = s.comp_code and d.comp_code = p.comp_code and
			d.unit_code = @vunit1 and d.sup_type_code=s.sup_ty_code and isnull(s.bill_pay,'N') = 'Y' and
			d.publ = isnull(@vrec_publ,d.publ) and d.publ =p.publ and
			d.supdate between @v_frdt and @v_todt and isnull(d.sup_copy,0)>0
			union all
			select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,d.edtn edtn,d.comm_fix_auto_spl comm_fix_auto_spl,
			d.comm_code comm_code,d.sup_rate sup_rate,d.supdate supdate,d.surch_cd surch_cd,d.agcd agcd,d.dpcd dpcd,d.sup_copy sup_copy
			from cir_dbksup_resale d,cir_supply_type_mast s,cir_publ_mast p
			where d.comp_code = @vcomp_code1 and d.comp_code = s.comp_code and d.comp_code = p.comp_code and
			d.unit_code = @vunit1 and d.sup_type_code=s.sup_ty_code and isnull(s.bill_pay,'N') = 'Y' and
			d.publ = isnull(@vrec_publ,d.publ) and d.publ =p.publ and 
			d.supdate between @pfrdt and @ptodt and isnull(d.sup_copy,0)>0) u
			where u.agcd+u.dpcd in (select CAST(agcd AS VARCHAR) + CAST(dpcd AS VARCHAR) from cir_agmast
			where comp_code = @vcomp_code1 and unit = @vunit1 and bill_agcd = @vbill_agcd1 and bill_dpcd = @vbill_dpcd1)
			group by u.comp_code,u.unit_code,u.publ,u.edtn,u.comm_fix_auto_spl,u.comm_code,u.sup_rate,u.supdate,u.surch_cd;
       
			/*SELECT comp_code, unit_code, publ, edtn, comm_fix_auto_spl, comm_code, sup_rate, supdate, surch_cd, SUM(CONVERT(FLOAT, sup_copy)) sup_copy
			FROM  cir_dbksup WHERE comp_code  = @pcomp_code AND	unit_code  = @punit_code AND	sup_type_code  in(
			SELECT sup_ty_code FROM cir_supply_type_mast 	WHERE	 comp_code  = @pcomp_code AND	isnull(bill_pay, 'N')  = 'Y') AND	publ  in
			(SELECT publ	FROM  cir_publ_mast WHERE	 comp_code  = @pcomp_code )AND	agcd + dpcd  in(SELECT CAST(agcd AS VARCHAR) + CAST(dpcd AS VARCHAR)
			FROM  cir_agmast WHERE comp_code  = @vcomp_code1 AND	unit  = @vunit1 AND	bill_agcd  = @vbill_agcd1 AND	bill_dpcd  = @vbill_dpcd1)
			AND	supdate  between @v_frdt and @v_todt AND	isnull(sup_copy, 0)  > 0 GROUP BY comp_code, unit_code, publ, edtn, comm_fix_auto_spl, comm_code,sup_rate, supdate,  surch_cd */

			OPEN cur_supply 
			fetch NEXT FROM cur_supply INTO @vcomp_code11 , @vunit_code11,@vpubl11 , @vedtn11,@vcomm_fix_auto_spl11 , @vcomm_code11 ,@vsup_rate11 ,@vsupdate11 , @vsurch_cd11,@sup_copy11
			WHILE (@@FETCH_STATUS = 0) begin
				print 'cursor_supply_open'
				SET @tot_copy			= isnull(@tot_copy, 0)+ isnull(@sup_copy11, 0)
				SET @daily_gross_amount = isnull(@daily_gross_amount, 0)+ isnull(@sup_copy11, 0)* isnull( @vsup_rate11, 0)
				SET @v_daily_gross_amt  = isnull(@sup_copy11, 0)* isnull( @vsup_rate11, 0)
				SET	@SUP_DAY = CONVERT(VARCHAR(20) , DATENAME(WEEKDAY, @vsupdate11),20)
				
				IF  @vcomm_fix_auto_spl11 != 'A'  BEGIN 
					DECLARE comm_fix_spl cursor LOCAL FOR 
					select sun_comm_rate,mon_comm_rate,tue_comm_rate,wed_comm_rate,thu_comm_rate,fri_comm_rate,sat_comm_rate,comm_catg_type
					from cir_comm_mast  where comp_code = @pcomp_code and  unit_code = @punit_code and  publ = @vpubl11 and
					edtn = @vedtn11 and comm_type = @vcomm_fix_auto_spl11 and  comm_catg_code = @vcomm_code11 and  
					valid_from = (select max(valid_from) from cir_comm_mast where comp_code = @pcomp_code and unit_code = @punit_code and
					publ = @vpubl11 and  edtn = @vedtn11 and comm_type = @vcomm_fix_auto_spl11 and comm_catg_code = @vcomm_code11 and 
					valid_from <= @vsupdate11)	 
											
						OPEN comm_fix_spl
						fetch NEXT FROM comm_fix_spl INTO @vsun_comm_rate1,@vmon_comm_rate1 ,@vtue_comm_rate1,@vwed_comm_rate1,@vthu_comm_rate1,@vfri_comm_rate1 ,@vsat_comm_rate1 ,@vcomm_catg_type1

						IF (@SUP_DAY = 'Sunday' )BEGIN 
							SET @vcomm_per  =  @vsun_comm_rate1 
						END
						ELSE IF (@SUP_DAY = 'Monday') BEGIN 
							SET @vcomm_per  =   @vmon_comm_rate1
						END
						ELSE IF (@SUP_DAY = 'Tuesday')BEGIN 
							SET @vcomm_per  =   @vtue_comm_rate1
						END
						ELSE IF (@SUP_DAY = 'Wednesday') BEGIN 
							SET @vcomm_per  =   @vwed_comm_rate1 
						END
						ELSE IF (@SUP_DAY = 'Thursday') BEGIN 
							SET @vcomm_per  =   @vthu_comm_rate1 
						END
						ELSE IF (@SUP_DAY = 'Friday' )BEGIN 
							SET @vcomm_per  =   @vfri_comm_rate1
						END
						ELSE IF (@SUP_DAY = 'Saturday') BEGIN 
							SET @vcomm_per  =   @vsat_comm_rate1
						END
						ELSE BEGIN 
							SET @vcomm_per  = 0 
						END

						IF isnull( @vcomm_catg_type1, 'N')= 'P' BEGIN 
							SET @vcomm_amt			= isnull(@vcomm_amt, 0)+ ( isnull( @sup_copy11, 0)* isnull( @vsup_rate11, 0)) * isnull(@vcomm_per, 0)/ 100 
							SET @v_daily_comm_amt	= ( isnull(@sup_copy11, 0)* isnull(@vsup_rate11, 0)) * isnull(@vcomm_per, 0)/ 100 
						END
						ELSE IF isnull(@vcomm_catg_type1, 'N')= 'C' BEGIN 
							SET @vcomm_amt			= isnull(@vcomm_amt, 0)+ isnull(@sup_copy11, 0)* isnull(@vcomm_per, 0)
							SET @v_daily_comm_amt	= isnull(@sup_copy11, 0)* isnull(@vcomm_per, 0)
						END
						ELSE BEGIN 
							SET @vcomm_amt  = 0 
							SET @v_daily_comm_amt	= 0 
						END

						close comm_fix_spl
						DEALLOCATE comm_fix_spl
					END

					DECLARE cur_surcharge cursor LOCAL FOR 
					SELECT sun_rate,mon_rate,tue_rate,wed_rate,thu_rate,fri_rate,sat_rate FROM  cir_surcharge_mast WHERE	 comp_code  = @pcomp_code AND	unit  = @punit_code AND	publ  = @vpubl11
					AND	edtn  = @vedtn11 AND	surch_cd  = @vsurch_cd11 AND	valid_from  =(SELECT MAX(valid_from)FROM  cir_surcharge_mast 
					WHERE comp_code  = @pcomp_code AND	unit  = @punit_code AND	publ  = @vpubl11 AND	edtn  = @vedtn11
					AND	surch_cd = @vsurch_cd11 AND	valid_from <= @vsupdate11)
		
					OPEN cur_surcharge 
					fetch NEXT FROM cur_surcharge INTO @vsun_rate1 ,@vmon_rate1,@vtue_rate1 ,@vwed_rate1,@vthu_rate1,@vfri_rate1,@vsat_rate1
					print('cursor_surcharge')
					
					IF (@SUP_DAY = 'Sunday' ) BEGIN 
						SET @vsrch_amt  =    @vsun_rate1
					END
					ELSE IF (@SUP_DAY = 'Monday') BEGIN 
						SET @vsrch_amt  =    @vmon_rate1
					END
					ELSE IF (@SUP_DAY = 'Tuesday') BEGIN 
						SET @vsrch_amt  =   @vtue_rate1
					END
					ELSE IF (@SUP_DAY = 'Wednesday')BEGIN 
						SET @vsrch_amt  =    @vwed_rate1
					END
					ELSE IF (@SUP_DAY = 'Thursday') BEGIN 
						SET @vsrch_amt  =   @vthu_rate1
					END
					ELSE IF (@SUP_DAY = 'Friday' )BEGIN 
						SET @vsrch_amt  =   @vfri_rate1
					END
					ELSE IF (@SUP_DAY = 'Saturday') BEGIN 
						SET @vsrch_amt  =    @vsat_rate1
					END
					ELSE BEGIN 
						SET @vsrch_amt  = 0 
					END
					
					close cur_surcharge
							
					DEALLOCATE cur_surcharge

					SET @tot_surcharge_amt  = isnull(@tot_surcharge_amt, 0)+ isnull( @sup_copy11, 0)* isnull(@vsrch_amt, 0)
					SET @v_daily_sur_amt	= isnull( @sup_copy11, 0)* isnull(@vsrch_amt, 0)
					SET @v_daily_bill_amt	= isnull(@v_daily_gross_amt, 0)+ isnull(@v_daily_sur_amt, 0)- isnull(@v_daily_comm_amt, 0)
										 

					INSERT INTO  #cir_bill_det_temp ( comp_code , unit_code , billdt , agcd , dpcd , publ , edtn , bill_copy , copy_rate , 
										comm_flag , comm_rate , comm_amt , sur_rate , sur_amt , gross_amount , bill_amount , fromdt , todt , coag , codp ,comm_type )  
										VALUES ( @vcomp_code11 ,@vunit_code11 , @v_billdt , @vbill_agcd1,@vbill_dpcd1 ,@vpubl11 , @vedtn11,@sup_copy11, 
										@vsup_rate11, @vcomm_fix_auto_spl11 , isnull(@vcomm_per, 0) , isnull(@v_daily_comm_amt, 0) , isnull(@vsrch_amt, 0) , isnull(@v_daily_sur_amt, 0) , 
										isnull(@v_daily_gross_amt, 0) , isnull(@v_daily_bill_amt, 0) , @vsupdate11 , @vsupdate11 , @vbill_agcd1 , @vbill_dpcd1 ,@vcomm_catg_type1)							
					fetch NEXT FROM cur_supply INTO @vcomp_code11 , @vunit_code11,@vpubl11 , @vedtn11,@vcomm_fix_auto_spl11 , @vcomm_code11 ,@vsup_rate11 ,@vsupdate11 , @vsurch_cd11,@sup_copy11
				END 
						
				SET @avg_sup  = isnull(@tot_copy, 0)
						
				IF   @vcomm_fix_auto_spl11 = 'A' BEGIN 
					IF @tot_copy > 0 BEGIN 

               			DECLARE comm_auto cursor LOCAL FOR 
						select sun_comm_rate,comm_catg_type from cir_comm_mast where comp_code = @pcomp_code and unit_code = @punit_code and publ = @vpubl11 and
						edtn = @vedtn11 and comm_type = @vcomm_fix_auto_spl11 and comm_catg_code = @vcomm_code11 and  valid_from = (select max(valid_from) from cir_comm_mast
						where comp_code = @pcomp_code and unit_code = @punit_code and  publ = @vpubl11 and  edtn = @vedtn11 and comm_type = @vcomm_fix_auto_spl11 and
						comm_catg_code = @vcomm_code11 and   valid_from <= @v_billdt and @avg_sup between isnull(sup_copy_from,0) and isnull(sup_copy_to,0)) and
						@avg_sup between isnull(sup_copy_from,0) and isnull(sup_copy_to,0);

						OPEN comm_auto 
						fetch NEXT FROM comm_auto INTO  @vsun_comm_rate2  ,@vcomm_catg_type2 

						SET @vcomm_per  =  @vsun_comm_rate2 
															
						IF isnull( @vcomm_catg_type2, 'N')= 'P' BEGIN 
							SET @vcomm_amt  = isnull(@daily_gross_amount, 0)* isnull(@vcomm_per, 0)/ 100 
						END
						ELSE IF isnull( @vcomm_catg_type2, 'N')= 'C' BEGIN 
							SET @vcomm_amt  = isnull(@tot_copy, 0)* isnull(@vcomm_per, 0)
						END
						ELSE BEGIN 
							SET @vcomm_amt  = 0 
						END
		
						close comm_auto
					    DEALLOCATE comm_auto
					END
				END
   
				close cur_supply
                DEALLOCATE  cur_supply 

				SET @daily_net_amount  = isnull(@daily_gross_amount, 0)+ isnull(@tot_surcharge_amt, 0)- isnull(@vcomm_amt, 0)

				SET @vbill_no  = DBO.cir_generate_billno( @vcomp_code1, @vunit1, @v_billdt, @pdateformat, '', '')

                IF isnull(@tot_copy, 0)> 0 Begin	
					SELECT @v_sec_limit  =  ABS(SUM(CONVERT(FLOAT, amount))) FROM  cir_rcphdr WHERE	 comp_code  =@vcomp_code1
					AND	unit_code  = @vunit1 AND	agcd  = @vbill_agcd1 AND	dpcd  = @vbill_dpcd1 AND	achd  = 'SC'
											
					SET @v_sec_limit  = 0 
									
					DECLARE @v_bran_code VARCHAR(8)

					SELECT DISTINCT @v_agcd_sec_per  =  security_per, @v_agcd_sec_amt_limt  =  sec_amt_limt, @v_bran_code  =  branch_code
					FROM  cir_agmast WHERE comp_code  = @pcomp_code AND	unit  = @punit_code AND	agcd  = @vbill_agcd1 AND dpcd  = @vbill_dpcd1
							
					PRINT(@v_agcd_sec_per)
                    PRINT(@v_agcd_sec_amt_limt)
							
					IF isnull(@v_agcd_sec_amt_limt, 0)> isnull(@v_sec_limit, 0)and isnull(@v_agcd_sec_per, 0)> 0 BEGIN 
						SET @v_bill_dbn_amt  = isnull(@v_agcd_sec_per, 0)* isnull(@daily_net_amount, 0)/ 100 
					END
			   
					IF isnull(@v_agcd_sec_amt_limt, 0)- isnull(@v_sec_limit, 0)< isnull(@v_bill_dbn_amt, 0)BEGIN 
						SET @v_bill_sec_amt  = isnull(@v_agcd_sec_amt_limt, 0)- isnull(@v_sec_limit, 0)
					END
					ELSE BEGIN 
						SET @v_bill_sec_amt  = isnull(@v_bill_dbn_amt, 0)
					END

					INSERT INTO  cir_bill   ( comp_code , unit_code ,billno , 	billdt , agcd , dpcd , publ , bill_copy , gross_amount , 
					sur_amount , comm_amount , bill_amount , bill_frdt ,bill_todt , bill_flag , bill_remark , userid , creation_date , bill_sec_amt , branch_code,sec_per_rate )  
					VALUES ( @vcomp_code1 , @vunit1 , @vbill_no , @v_billdt , @vbill_agcd1 , @vbill_dpcd1 ,@vpubl11 , isnull(@tot_copy, 0) , 
					isnull(@daily_gross_amount, 0) , isnull(@tot_surcharge_amt, 0) , isnull(@vcomm_amt, 0) , @daily_net_amount , 
					@v_frdt , @v_todt , @pbill_freq , CAST(CONVERT(VARCHAR(23), @v_billdt) AS VARCHAR) + ' Billing' , @puserid , 
					GETDATE() , isnull(@v_bill_sec_amt, 0) , @v_bran_code,@v_agcd_sec_per ) 

					INSERT INTO  cir_outmast   ( comp_code , unit_code , agcd , dpcd , doctyp , billno , billdt , publ , amount , 
					remark , voucherno , usrid , creation_date , bill_sec_amt , branch_code )  
					VALUES ( @vcomp_code1 , @vunit1, @vbill_agcd1 , @vbill_dpcd1 , 'BIL' , @vbill_no , @v_billdt , @vpubl11 , 
					@daily_net_amount , CAST(CONVERT(VARCHAR(23), @v_billdt) AS VARCHAR) + ' Billing' , @vbill_no , @puserid , 
					GETDATE() , isnull(@v_bill_sec_amt, 0) , @v_bran_code )  
					
					INSERT INTO  cir_bill_det   ( comp_code , unit_code , billno , billdt ,agcd , dpcd ,coag , 	codp , publ , edtn , 
					copy_rate , comm_flag , comm_rate , sur_rate , fromdt , todt , bill_copy , gross_amount , comm_amt , sur_amt , 
					bill_amount , bill_flag , branch_code,comm_type )  
					SELECT comp_code, unit_code, @vbill_no billno, billdt, agcd, dpcd, agcd, dpcd, publ, edtn, copy_rate, comm_flag,
					comm_rate, sur_rate, MIN(fromdt) fromdt, MAX(todt) todt, SUM(bill_copy) bill_copy,
					SUM(CONVERT(FLOAT, gross_amount)) gross_amount,SUM(CONVERT(FLOAT, comm_amt)) comm_amt,SUM(CONVERT(FLOAT, sur_amt)) sur_amt,
					SUM(CONVERT(FLOAT, bill_amount)) bill_amount, @pbill_freq, @v_bran_code,comm_type
					FROM  #cir_bill_det_temp 
					GROUP BY comp_code, unit_code, billdt, agcd, dpcd, publ, edtn, copy_rate, comm_flag, comm_rate,  sur_rate ,comm_type

					delete from #cir_bill_det_temp
					
					IF isnull(@v_bill_sec_amt, 0)> 0 BEGIN 
                                 
						SET @v_remark  = 'Being amount auto debited against security deposit against bill number' + @vbill_no + ' dated' + CONVERT(VARCHAR(23), @v_billdt)
									
						SELECT @v_rec_no  =  max(convert(int,SUBSTRING(RECPTNO,(len(RECPTNO) -7),len(RECPTNO)))) + 1 FROM cir_rcphdr 
							WHERE comp_code = @vcomp_code1 AND	doctype  = 'DN'
					
						IF @v_rec_no is null or @v_rec_no = '0' BEGIN 
							SET @v_reptno  =   @v_bran_code + '-' + REPLACE(CONVERT(VARCHAR(5), GETDATE(), 2), '.', '')+ '0001'   --'DN' + '0001' 
						END
						ELSE BEGIN 
							SET @v_reptno  =   @v_bran_code + '-' + dbo.fnPadLeft('0',8,@v_rec_no)   -- 'DN ' + CASE WHEN LEN(@v_rec_no) >= 4 THEN SUBSTRING(CONVERT(VARCHAR(4000), @v_rec_no),1,4) ELSE SUBSTRING(REPLICATE('0',4),1,4-LEN(@v_rec_no)) + CONVERT(VARCHAR(4000),@v_rec_no) END  
						END

                        insert into cir_rcphdr(comp_code,unit_code,agcd,dpcd,doctype,
                         recptno,recptdt,amount,reason,remark,
                         achd,voucherno,voucherdt,userid,creation_date,branch_code)
                         values( @vcomp_code1 , @vunit1  , @vbill_agcd1 , @vbill_dpcd1 , 'DN' , @v_reptno , @v_billdt , 
							isnull(@v_bill_sec_amt, 0) , 'SEC DEBIT',@v_remark,
                         'NM',@v_reptno,@v_billdt,@puserid,GETDATE(),@v_bran_code);
							
							
						insert into cir_rcpdet(comp_code,unit_code,agcd,dpcd,doctyp,
							recptno,recptdt,payfor,achd,amount,
							reason,remark,voucherno,voucherdt,usrid,
							creation_date,branch_code)
						values(@vcomp_code1, @vunit1,@vbill_agcd1 , @vbill_dpcd1 ,'DN',
							@v_reptno,@v_billdt,@vunit1,'NM',isnull(@v_bill_sec_amt, 0),
							'SEC DEBIT',@v_remark,@v_reptno,@v_billdt,@puserid,
							GETDATE(),@v_bran_code);    
							
							PRINT('25')

							INSERT INTO  cir_outmast ( comp_code , unit_code , agcd , dpcd , doctyp , recptno , recptdt , achd , amount , 
							reason , remark , voucherno , voucherdt , usrid , creation_date , branch_code )  
							VALUES ( @vcomp_code1 ,  @vunit1 , @vbill_agcd1, @vbill_dpcd1 , 'DN' , @v_reptno , @v_billdt , 'NM' , 
							isnull(@v_bill_sec_amt, 0) , 'SEC DEBIT' , @v_remark , @v_reptno , @v_billdt , @puserid , GETDATE() , @v_bran_code )  
								
							SET @v_remark  = 'Being amount auto credited against security deposit against bill number' + @vbill_no + ' dated' + CONVERT(VARCHAR(23), @v_billdt)+ ' and debit note number' + @v_reptno 
								
							SELECT @v_rec_no  =  max(convert(int,SUBSTRING(RECPTNO,(len(RECPTNO) -7),len(RECPTNO)))) + 1  FROM  cir_rcphdr 	WHERE	 comp_code  = @vcomp_code1 AND	doctype  = 'CN'
						
							IF @v_rec_no is null or @v_rec_no = '0' BEGIN 
								SET @v_reptno  =   @v_bran_code + '-' + REPLACE(CONVERT(VARCHAR(5), GETDATE(), 2), '.', '')+ '0001'   --'DN' + '0001' 
							END
							ELSE BEGIN 
								SET @v_reptno  =   @v_bran_code + '-' + dbo.fnPadLeft('0',8,@v_rec_no)   -- 'DN ' + CASE WHEN LEN(@v_rec_no) >= 4 THEN SUBSTRING(CONVERT(VARCHAR(4000), @v_rec_no),1,4) ELSE SUBSTRING(REPLICATE('0',4),1,4-LEN(@v_rec_no)) + CONVERT(VARCHAR(4000),@v_rec_no) END  
							END

							INSERT INTO  cir_rcphdr ( comp_code , unit_code , agcd , dpcd , doctype , recptno , recptdt , amount , reason , remark , 
							achd , voucherno , voucherdt , userid , creation_date , branch_code )  
							 VALUES ( @vcomp_code1 , @vunit1 , @vbill_agcd1, @vbill_dpcd1, 'CN' , @v_reptno , @v_billdt , 
							- 1 * isnull(@v_bill_sec_amt, 0) , 'SEC DEBIT' , @v_remark , 'SC' , @v_reptno , @v_billdt , @puserid , GETDATE() , @v_bran_code )  
								
							INSERT INTO  cir_rcpdet( comp_code , unit_code , agcd , dpcd , doctyp , recptno , recptdt , payfor , achd , amount , reason , 
							remark , voucherno , voucherdt , usrid , creation_date , branch_code )  
							VALUES 	( @vcomp_code1 , @vunit1 , @vbill_agcd1 , @vbill_dpcd1 , 'CN' , @v_reptno , @v_billdt , 
							@vunit1 , 'SC' , - 1 * isnull(@v_bill_sec_amt, 0) , 'SEC DEBIT' , @v_remark , @v_reptno , @v_billdt , @puserid , GETDATE() , @v_bran_code )  

							INSERT INTO  cir_outmast   ( comp_code , unit_code , agcd , dpcd , doctyp , recptno , recptdt , achd , amount , 
							reason , remark , voucherno , voucherdt , usrid , creation_date , branch_code )  
							VALUES 	( @vcomp_code1 , @vunit1 , @vbill_agcd1 , @vbill_dpcd1 , 'CN' , @v_reptno , @v_billdt , 'SC' , - 1 * isnull(@v_bill_sec_amt, 0) , 
							'SEC DEBIT' , @v_remark , @v_reptno , @v_billdt , @puserid , GETDATE() , @v_bran_code )  
			
				        END
   
						SET @v_sec_limit  = 0 
						SET @v_bill_dbn_amt  = 0 
						SET @v_bill_sec_amt  = 0 
						SET @v_remark  = '' 
						SET @v_reptno  = '' 
						SET @v_rec_no  = 0 
						SET @v_daily_comm_amt  = 0 
						SET @v_daily_sur_amt  = 0 
						SET @v_daily_gross_amt  = 0 
						SET @v_daily_bill_amt  = 0 
			    END
   
			fetch NEXT FROM agency_cur INTO @vcomp_code1 , @vunit1 ,@vbill_agcd1, @vbill_dpcd1 , @vbranch_code1, @vcity_name1, @vag_name1,@vprint_seqno1,@vagbill_publ1	
		
END
close agency_cur
DEALLOCATE agency_cur
	set @vrec_publ=null
	fetch NEXT FROM cur_publ into @vrec_publ
	END
close cur_publ


DEALLOCATE cur_publ
DROP TABLE #cir_bill_det_temp;
DROP TABLE #te
************************************ end of billing rikkee 21/5/2012*************************

/////////////////////////////////////Add by vivek issue no 4821 21/05/2012///////////////////////////////////////


USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[cir_rep_collection_cir_rep_unitwise_monthwise_p]    Script Date: 05/21/2012 15:38:48 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[cir_rep_collection_cir_rep_unitwise_monthwise_p] 
	@pcompcode                                VARCHAR(4000) ,
	@punitcode                                VARCHAR(4000) ,
	@pdoctype                                 VARCHAR(4000) ,
	@ppaymode_reason                          VARCHAR(4000) ,
	@pactype                                  VARCHAR(4000) ,
	@pfromdate                                datetime ,
	@ptodate                                  datetime ,
	@pdateformat                              VARCHAR(4000) ,
	@pextra1                                  VARCHAR(4000) ,
	@pextra2                                  VARCHAR(4000) 
AS 
	
SET CONCAT_NULL_YIELDS_NULL OFF
	DECLARE @v_frdt                                   DATETIME 
	DECLARE @v_todt                                   DATETIME 

	DECLARE @v_frdt11                                 VARCHAR(40) 
	DECLARE @v_todt11                                 VARCHAR(40) 
	DECLARE @v_months                                 FLOAT                           
	SET @v_months = 0 
	DECLARE @v_cnt                                    FLOAT                           
	SET @v_cnt = 0 
	DECLARE @v_dt                                     DATETIME 
	DECLARE @v_dt11                                   VARCHAR(40) 
	DECLARE @vvar                                     VARCHAR(4000) 
	DECLARE @vvar_sum                                 VARCHAR(4000) 
	DECLARE @vquery                                   VARCHAR(4000) 
	DECLARE @vquery1                                   VARCHAR(4000) 


	SET @v_frdt  = @pfromdate--dbo.convert_user_date('/',@pdateformat, @pfromdate)
	SET @v_todt  = @ptodate--dbo.convert_user_date('/',@pdateformat, @ptodate)
     
    

	set @v_frdt11 =  cast (@v_frdt as datetime)
	set @v_todt11 =  cast (@v_todt as datetime)

    SET @v_frdt11  = CONVERT(VARCHAR(25),@v_frdt,101)
    SET @v_todt11  = CONVERT(VARCHAR(25),@v_todt,101)

	PRINT('1')

		SELECT @v_months  =  ( convert(FLOAT ,month(@v_todt)) - convert(FLOAT ,month(@v_frdt)) ),@v_dt  =   (CONVERT(VARCHAR(25),DATEADD(dd,-(DAY(@v_frdt)-1),@v_frdt),101))
		
		PRINT(@v_months)

		PRINT(@v_dt)
PRINT('11')
		set @v_dt11 =  cast (@v_dt as varchar)

		IF @v_months = 0 BEGIN 
			SET @v_months  = 0 
		END
	
		WHILE (0 = 0) BEGIN 
			IF @v_cnt > @v_months BEGIN 
				BREAK
			END
			IF @vvar is null BEGIN 
				SET @vvar  = 'sum(case(CONVERT(VARCHAR(25),DATEADD(dd,-(DAY(a.recptdt)-1),a.recptdt),101)) when ' + '''' + @v_dt11 + '''' + 'then a.amount else 0 end ) "' + @v_dt11 + '"' 
				SET @vvar_sum  = 'sum("' + @v_dt11 + '") "' + @v_dt11 + '"' 
			END
			ELSE BEGIN 
				SET @vvar  = @vvar + ',sum(case(CONVERT(VARCHAR(25),DATEADD(dd,-(DAY(a.recptdt)-1),a.recptdt),101)) when ' + '''' + @v_dt11 + '''' + 'then a.amount else 0 end ) "' + @v_dt11 + '"' 
				SET @vvar_sum  = @vvar_sum + ',sum("' + @v_dt11 + '") "' + @v_dt11 + '"' 
			END
   
			SET @v_dt  = DATEADD(M, 1, @v_dt)
			SET @v_cnt  = @v_cnt + 1 
		    set @v_dt11 =  cast (@v_dt as varchar)
		END 
		

		print(@vvar)
		print(@vvar_sum)
		--insert into test1(vstring,vstring2) values('unit monthwise vvar ',v_months,vvar)
		
		IF @vvar is not null BEGIN 
			SET @vquery  = 'select comp_code,unit_code,unit_code unit_name,' + @vvar_sum + ' from  
			(select a.comp_code comp_code,a.unit_code unit_code,CONVERT(VARCHAR(25),DATEADD(dd,-(DAY(recptdt)-1),recptdt),101) as  recptdt
			,' + @vvar + ' from cir_rcphdr a  where a.comp_code=' + '''' + @pcompcode + '''' + ' 
			and (a.unit_code=' + '''' + @punitcode + '''' + ' or' + '''' + @punitcode + '''' + ' is null' + ' or  ' + '''' + @punitcode + '''' + ' = '''') 
			and (a.doctype=' + '''' + @pdoctype + '''' + ' or' + '''' + @pdoctype + '''' + ' is null' + ' or  ' + '''' + @pdoctype + '''' + ' = '''') 
			and a.recptdt between' + '''' + @v_frdt11 + '''' + ' and' + '''' + @v_todt11 + '''' + ' 
			and (a.reason=' + '''' + @ppaymode_reason + '''' + ' or' + '''' + @ppaymode_reason + '''' + ' is null' + ' or  ' + '''' + @ppaymode_reason + '''' + ' = '''') 
			and (a.achd=' + '''' + @pactype + '''' + ' or' + '''' + @pactype + '''' + ' is null' + ' or  ' + '''' + @pactype + '''' + ' = '''')   
			group by a.comp_code,a.unit_code,CONVERT(VARCHAR(25),DATEADD(dd,-(DAY(recptdt)-1),recptdt),101) )l 
			group by l.comp_code,l.unit_code,CONVERT(VARCHAR(25),DATEADD(dd,-(DAY(l.recptdt)-1),l.recptdt),101) 
			,(DATENAME(MM, l.recptdt) '+ ' + '+ '''' +'-' +''''+ ' + ' + 'CAST(YEAR(l.recptdt) AS VARCHAR(4)))   
			order by l.comp_code,l.unit_code' 
			EXEC (@vquery) 
			SET @vquery1  = 'select comp_code,' + @vvar_sum + ' from  (select a.comp_code comp_code,a.unit_code unit_code
			,a.recptdt recptdt,' + @vvar + ' from cir_rcphdr a  where a.comp_code=' + '''' + @pcompcode + '''' + ' 
			and (a.unit_code=' + '''' + @punitcode + '''' + ' or' + '''' + @punitcode + '''' + ' is null' + ' or  ' + '''' + @punitcode + '''' + ' = '''') 
			and (a.doctype=' + '''' + @pdoctype + '''' + ' or' + '''' + @pdoctype + '''' + ' is null' + ' or  ' + '''' + @pdoctype + '''' + ' = '''')
			and a.recptdt between' + '''' + @v_frdt11 + '''' + ' and' + '''' + @v_todt11 + '''' + ' 
			and (a.reason=' + '''' + @ppaymode_reason + '''' + ' or' + '''' + @ppaymode_reason + '''' + ' is null' + ' or  ' + '''' + @ppaymode_reason + '''' + ' = '''') 
			and (a.achd=' + '''' + @pactype + '''' + ' or' + '''' + @pactype + '''' + ' is null' + ' or  ' + '''' + @pactype + '''' + ' = '''')   
			group by a.comp_code,a.unit_code,a.recptdt,a.reason) 
			m group by m.comp_code  order by m.comp_code' 
			EXEC (@vquery1) 
		END
		ELSE 
        BEGIN 
			SET @vquery  = 'select' + '''' + @pcompcode + '''' + ' "comp_code",' + '''' + @punitcode + '''' + ' "unit_code"  where 1=2' 
			EXEC (@vquery) 
			SET @vquery1  = 'select' + '''' + @pcompcode + '''' + ' "comp_code"  where 1=2' 
			EXEC (@vquery1) 
		END
		
print(@vquery)
print(@vquery1)
///////////////////////////////////////End by Vivek 21/05/2012////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////Add by vivek issue no 6836   22/05/2012////////////////////////////////////////////////////////////////

USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[cir_comm_catg_bind_p]    Script Date: 05/22/2012 10:50:46 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[cir_comm_catg_bind_p]
	@pcomp_code                               VARCHAR(20) ,
	@pdateformate                             VARCHAR(20) ,
	@pextra1                                  VARCHAR(4000) ,
	@pextra2                                  VARCHAR(4000) 
AS 

		SELECT *
		FROM  cir_comm_catg_mast 
		WHERE	 comp_code  = @pcomp_code   
		AND	((UPPER(COMM_CATG_DESC)  like UPPER(@pextra1) + '%')
		 OR	(@pextra1  is null))

/////////////////////////////////////////////////////////End by Vivek///////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////Add by Vivek issue no 5360 23/05/2012///////////////////////////////////////////////
USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[cir_suspend_user_name]    Script Date: 05/23/2012 16:06:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER  PROCEDURE [dbo].[cir_suspend_user_name]
(
   @P_USERID as VARCHAR(50),
   @P_UNIT as VARCHAR(50),
   @P_COMPCODE as VARCHAR(50),
   @P_SUSP_TYPE as VARCHAR(50)
   
)
AS

      
select distinct  dbo.get_USER_NAME(USERID) as "USER_NAME",USERID from  CIR_SUSPEND_TRAN WHERE  SUSP=@P_SUSP_TYPE AND COMP_CODE=@P_COMPCODE;

////////////////////////////////////End by Vivek////////////////////////////////////////////////////////////////////////////////////////////////////


///////////////////////////////////////////////issue 6734 start ///////////////////////////////////////////////////////////////////////



ALTER FUNCTION [dbo].[cir_get_mode_name_agn](
@pcomp_code	as varchar(200), 
@punit		as varchar(200), 
@pagcd		as varchar(200), 
@pdpcd		as varchar(200), 
@ppubl		as varchar(200),
@pedtn		as varchar(200)) RETURNS varchar(200) AS


BEGIN
declare @vmode_desc		varchar(200)
declare @vroute_code	varchar(200)
      select   distinct  @vroute_code=route_code  from cir_supply 
          where comp_code=@pcomp_code and 
                unit=@punit and 
                agcd=@pagcd and 
                dpcd=@pdpcd and 
                publ=@ppubl and
                edtn=@pedtn and
                supply_flag='Y';

      select  @vmode_desc=mode_desc from cir_route_mode_mast 
         where  comp_code=@pcomp_code and 
                mode_code =( select route_mode from cir_route_mast 
                                  where comp_code=@pcomp_code  and unit=@punit   and 
                                        route_code=@vroute_code)



  return isnull(@vmode_desc,'')
END


/////////////////////////////////////////////////issue 6734 end//////////////////////////////////////////////////////////////////



/////////////////////////////////add by Deepika 24/05/2012 for issue no. 7605////////


ALTER PROCEDURE [dbo].[cir_rep_supply_cir_rep_supply1]
	@pcomp_code			VARCHAR(40) ,
	@punit_code         VARCHAR(40) ,
	@ppubl              VARCHAR(40) ,
	@pmainedtn          VARCHAR(40) ,
	@pedtn              VARCHAR(40) ,
	@proute             VARCHAR(40) ,
	@pfrom_supdate      DATETIME ,
	@ptill_supdate      DATETIME ,
	@pdateformat        VARCHAR(40) ,
    @pextra1            VARCHAR(40) ,--for branch
    @pextra2            VARCHAR(40) ,--for state,
	@pextra3			VARCHAR(40) ,--this is use to final and unfinal po
	@pextra4            VARCHAR(40) ,--for zone,
	@pextra5            VARCHAR(40) ,--for region
	@pextra6            VARCHAR(40) ,--for district
	@pextra7            VARCHAR(40) ,--for taluka
	@pextra8            VARCHAR(40) ,--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,other than statewise
	@pextra9            VARCHAR(40) ,--for publication type
	@pextra10           VARCHAR(40),--for executive
	@pextra11           VARCHAR(40),-- it is using for standing order / posting
	@pextra12           VARCHAR(40),
	@pextra13           VARCHAR(40),
	@pextra14           VARCHAR(40),
	@pextra15           VARCHAR(40)
AS 
BEGIN
	DECLARE @vfrom_supdate	varchar(20);
	DECLARE @vtill_supdate  varchar(20);
	declare @vsup_seq_no	int
	
	DECLARE @supply_type_name	VARCHAR(4000)
	DECLARE @supply_sum			VARCHAR(4000) 
	DECLARE @vvar               VARCHAR(4000) 
	DECLARE @vvar_sum           VARCHAR(4000) 
	DECLARE @vquery             VARCHAR(8000) 
	DECLARE @vquery1            VARCHAR(8000) 
	DECLARE @vquery2            VARCHAR(8000) 
	DECLARE @vquery3            VARCHAR(8000) 
	DECLARE @vquery4            VARCHAR(8000) 

	SET @vfrom_supdate  = convert(varchar(20),@pfrom_supdate,101)
	SET @vtill_supdate  = convert(varchar(20),@ptill_supdate,101)
	
	if @pextra11 = '2' begin
	DECLARE cur_sup_type cursor LOCAL FOR 
		select distinct ' sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) "'+sup_ty_name+'",' vty,
		'sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) +' vty_sum,sup_seq_no
		from cir_supply_type_mast s, cir_supply d,cir_edtn_mast e
		where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code 
		and s.sup_ty_code =d.supply_type_code and
		(d.unit=isnull(@punit_code,d.unit) or @punit_code='') and d.publ=e.publ and 
		(d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
		d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
		(e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
		order by sup_seq_no;
		
		OPEN cur_sup_type 
		fetch NEXT FROM cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
			while(@@FETCH_STATUS = 0) BEGIN
				set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@supply_type_name + '', SPACE(0))
				set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@supply_sum + '', SPACE(0))

		fetch NEXT from cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
		end
		close cur_sup_type
		
		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)
	end
	else
	begin
		DECLARE cur_sup_type cursor LOCAL FOR 
		select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
		'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
		from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
		where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code 
		and s.sup_ty_code =d.sup_type_code and
		(d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ 
		and (d.publ=isnull(@ppubl,d.publ) or @ppubl='') 
		and d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
		d.supdate between @pfrom_supdate and @ptill_supdate and
		(e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
		order by sup_seq_no;
		
		OPEN cur_sup_type 
		fetch NEXT FROM cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
			while(@@FETCH_STATUS = 0) BEGIN
				set @vvar =COALESCE(@vvar+'', SPACE(0)) + '' + COALESCE(@supply_type_name + '', SPACE(0))
				set @vvar_sum=COALESCE(@vvar_sum+'', SPACE(0)) + '' + COALESCE(@supply_sum + '', SPACE(0))

		fetch NEXT from cur_sup_type INTO  @supply_type_name,@supply_sum,@vsup_seq_no
		end
		close cur_sup_type
		
		SET @vvar  = SUBSTRING(@vvar, 1, LEN(@vvar) - 1)
		SET @vvar_sum  = SUBSTRING(@vvar_sum, 1, LEN(@vvar_sum) - 1)
	end	
		
		
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9=null begin
	set @pextra9=''
end
if @pextra10=null begin
	set @pextra10=''
end
if @pextra11=null begin
	set @pextra11=''
end
if @pextra12=null begin
	set @pextra12=''
end
if @pextra13=null begin
	set @pextra13=''
end

if @pextra14=null begin
	set @pextra14=''
end
if @pextra15=null begin
	set @pextra15=''
end

if @pextra11 = '1' 
begin
	if @pextra8='1' 
	Begin--for route
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) ROUTE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		,dbo.cir_get_mode_name(d.comp_code,d.unit_code+d.route_code) as "MODE_NAME"
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code 
		and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
		order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end
	if @pextra8='2' 
	Begin----for  branch
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,dbo.cir_get_branch(d.comp_code,m.branch_code) BRANCH_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
		order by d.comp_code,d.unit_code,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'

		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='3' 
	Begin----for  zone
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,
		dbo.cir_get_zone_name(d.comp_code,c.zone_code) ZONE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
		order by d.comp_code,d.unit_code,d.publ,d.edtn,zone_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='4' 
	Begin----for  region
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,dbo.cir_get_region_name(d.comp_code,c.region_code) REGION_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
		order by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='5' 
	Begin----for  district
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''1'',null,null,null) DIST_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,dist_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='6' 
	Begin----for Taluka
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) TALUKA_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
		isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit_code,d.publ,d.edtn,taluka_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end
	if @pextra8='7' 
	Begin----for State
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,dbo.cir_get_state1(d.comp_code,m.state_code) STATE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
		c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end

	if @pextra8='8' 
	Begin----for Executive
		set @vquery='select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,dbo.cir_get_executive(d.comp_code,m.executive_code) EXECUTIVE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
		substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
		c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname order by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd'
		    
		print @vquery 
		EXEC (@vquery)
	end
		SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code order by d.comp_code,d.unit_code'
		print @vquery1
		EXEC (@vquery1)
			
	if @pextra8='1' 
	Begin--for route
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='2' 
	Begin--for branch
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.branch_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='3' 
	Begin--for Zone
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.zone_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='4' 
	Begin--for region
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code order by d.comp_code,d.unit_code,d.publ,d.edtn,c.region_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='5' 
	Begin--for District
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.dist_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='6' 
	Begin--for Taluka
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka order by d.comp_code,d.unit_code,d.publ,d.edtn,m.tehsil_taluka'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='7' 
	Begin--for state
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.state_code'
		print @vquery2
		EXEC (@vquery2)
	end

	if @pextra8='8' 
	Begin--for executive
		SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code order by d.comp_code,d.unit_code,d.publ,d.edtn,m.executive_code'
		print @vquery2
		EXEC (@vquery2)
	end

		SET @vquery3  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.edtn order by d.comp_code,d.unit_code,d.publ,d.edtn'
		print @vquery3
		EXEC (@vquery3)

		SET @vquery4  = ' select d.comp_code COMP_CODE,d.unit_code UNIT_CODE,d.publ PUBL,'+@vvar+','+@vvar_sum+' TOTAL 
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ order by d.comp_code,d.unit_code,d.publ'
		print @vquery4
		EXEC (@vquery4)
end
else
begin
	if @pextra8='1' 
	Begin--for route
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) ROUTE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT"
	, '+@vvar+','+@vvar_sum+' TOTAL 
	,dbo.cir_get_mode_name(d.comp_code,d.unit+d.route_code) as "MODE_NAME"
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code 
	and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
	order by d.comp_code,d.unit,d.publ,d.edtn,d.route_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end
if @pextra8='2' 
Begin----for  branch
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,dbo.cir_get_branch(d.comp_code,m.branch_code) BRANCH_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
	order by d.comp_code,d.unit,d.publ,d.edtn,branch_name,d.agcd,d.dpcd'

	print @vquery 
	EXEC (@vquery)
end

if @pextra8='3' 
Begin----for  zone
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME
	,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,
	dbo.cir_get_zone_name(d.comp_code,c.zone_code) ZONE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
	order by d.comp_code,d.unit,d.publ,d.edtn,zone_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end

if @pextra8='4' 
Begin----for  region
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn
	,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,dbo.cir_get_region_name(d.comp_code,c.region_code) REGION_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code 
	order by d.comp_code,d.unit,d.publ,d.edtn,c.region_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end

if @pextra8='5' 
Begin----for  district
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''1'',null,null,null) DIST_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME"
	, dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,dist_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end

if @pextra8='6' 
Begin----for Taluka
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) TALUKA_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",dbo.cir_get_city(d.comp_code,m.city_code) "CITY NAME",
	isnull(dbo.CIR_GET_NAME_CIR_CITY(d.comp_code,m.city_code,2,null,null,null),''NA'') "CITY ONAME",
	 dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code order by d.comp_code,d.unit,d.publ,d.edtn,taluka_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end
if @pextra8='7' 
Begin----for State
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,dbo.cir_get_state1(d.comp_code,m.state_code) STATE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
	c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT",
	 dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname 
	order by d.comp_code,d.unit,d.publ,d.edtn,m.state_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end

if @pextra8='8' 
Begin----for Executive
	set @vquery='select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,dbo.cir_get_executive(d.comp_code,m.executive_code) EXECUTIVE_NAME,d.agcd "AGENCY CODE",d.dpcd "AGENCY SUBCODE",
	substring(m.ag_name,1,50) "AGENCY NAME",substring(m.ag_name_oth_lang,1,50) "AGENCY ONAME",c.city_name "CITY NAME",
	c.city_oname "CITY ONAME", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,1) "DROP_POINT", dbo.cir_get_drop_point_name(d.comp_code,d.unit,m.station_code,2) "ODROP_POINT", '+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd,m.ag_name,m.ag_name_oth_lang,m.city_code,m.station_code,c.city_name,c.city_Oname
	order by d.comp_code,d.unit,d.publ,d.edtn,m.executive_code,d.agcd,d.dpcd'
	    
	print @vquery 
	EXEC (@vquery)
end
	SET @vquery1  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit order by d.comp_code,d.unit_code'
	print @vquery1
	EXEC (@vquery1)
		
if @pextra8='1' 
Begin--for route
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,d.route_code ROUTE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,d.route_code order by d.comp_code,d.unit_code,d.publ,d.edtn,d.route_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='2' 
Begin--for branch
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME
	,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.branch_code BRANCH_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code order by d.comp_code,d.unit,d.publ,d.edtn,m.branch_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='3' 
Begin--for Zone
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.zone_code ZONE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code order by d.comp_code,d.unit,d.publ,d.edtn,c.zone_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='4' 
Begin--for region
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,c.region_code REGION_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,c.region_code order by d.comp_code,d.unit,d.publ,d.edtn,c.region_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='5' 
Begin--for District
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.dist_code DIST_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code order by d.comp_code,d.unit,d.publ,d.edtn,m.dist_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='6' 
Begin--for Taluka
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.tehsil_taluka TALUKA_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka order by d.comp_code,d.unit,d.publ,d.edtn,m.tehsil_taluka'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='7' 
Begin--for state
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.state_code STATE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.state_code order by d.comp_code,d.unit,d.publ,d.edtn,m.state_code'
	print @vquery2
	EXEC (@vquery2)
end

if @pextra8='8' 
Begin--for executive
	SET @vquery2  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,dbo.cir_get_edtn_name(d.comp_code,d.edtn) EDTN_NAME,m.executive_code EXECUTIVE_CODE,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn,m.executive_code order by d.comp_code,d.unit,d.publ,d.edtn,m.executive_code'
	print @vquery2
	EXEC (@vquery2)
end

	SET @vquery3  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,dbo.cir_get_publ_name(d.comp_code,d.publ) PUBL_NAME,d.edtn,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ,d.edtn order by d.comp_code,d.unit,d.publ,d.edtn'
	print @vquery3
	EXEC (@vquery3)

	SET @vquery4  = ' select d.comp_code COMP_CODE,d.unit UNIT_CODE,d.publ PUBL,'+@vvar+','+@vvar_sum+' TOTAL 
	from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c,cir_publ_mast p
	where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and m.comp_code=p.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
	m.unit=d.unit and d.unit='''+@punit_code+''' 
	and d.publ=e.publ and d.publ=p.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
	and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
	and m.agcd=d.agcd and m.dpcd=d.dpcd 
	--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
	--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
	and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
	and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
	and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
	and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
	and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
	and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
	and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
	and m.city_code=c.city_code 
	and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
	and (p.pro_type='''+@pextra9+''' or '''+@pextra9+'''='''')
	and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
	group by d.comp_code,d.unit,d.publ order by d.comp_code,d.unit,d.publ'
	print @vquery4
	EXEC (@vquery4)
end

DEALLOCATE cur_sup_type

END

///////////////////////////////next


ALTER PROCEDURE [dbo].[cir_rep_supply_temp]
@pcomp_code         as varchar(200),
@punit_code         as varchar(200),
@ppubl              as varchar(200),
@pmainedtn          as varchar(200),
@pedtn              as varchar(200),
@proute             as varchar(200),
@pfrom_supdate      as datetime,
@ptill_supdate      as datetime,
@pdateformat        as varchar(200),
@pextra1            as varchar(200),--for branch
@pextra2            as varchar(200),--for State
@pextra3            as varchar(200),--this is use to final and unfinal po
@pextra4            as varchar(200),--for zone,
@pextra5            as varchar(200),--for region
@pextra6            as varchar(200),--for district
@pextra7            as varchar(200),--for taluka
@pextra8            as varchar(200),--report type filter 1 for routewise,2 for branchwise,3 for zonewise,4 for regionwise,5 for district,6 for talukaiwse,7 for statewise,8 for executive
@pextra9            as varchar(200),--for publication type
@pextra10           as varchar(200),--for executive
@pextra11           as varchar(200),--for based on 1 for supply post and 2 for standing order
@pextra12           as varchar(200),
@pextra13           as varchar(200),
@pextra14           as varchar(200),
@pextra15           as varchar(200)

AS

declare @vfrom_supdate    varchar(20);
declare @vtill_supdate    varchar(20);
declare @rec_sup_type		as varchar(200) 
declare @rec_sup_type_sum	as varchar(200) 
declare @rec_sup_seq_no		as int

if @pextra11 ='2' begin
DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case supply_type_code when '+''''+sup_ty_code+''''+' then base_supply else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_supply d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.supply_type_code and
    (d.unit=isnull(@punit_code,d.unit) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    --d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;
end
else
begin
DECLARE cur_sup_type CURSOR READ_ONLY FOR
	select distinct ' sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) "'+sup_ty_name+'",' vty,
	'sum(case sup_type_code when '+''''+sup_ty_code+''''+' then sup_copy else 0 end ) +' vty_sum,sup_seq_no
	from cir_supply_type_mast s, cir_dbksup d,cir_edtn_mast e
    where s.comp_code=@pcomp_code and s.comp_code=d.comp_code and s.comp_code=e.comp_code and s.sup_ty_code =d.sup_type_code and
    (d.unit_code=isnull(@punit_code,d.unit_code) or @punit_code='') and d.publ=e.publ and 
    (d.publ=isnull(@ppubl,d.publ) or @ppubl='') and 
    d.edtn=e.edtn and (d.edtn=isnull(@pedtn,d.edtn) or @pedtn='') and 
    d.supdate between @pfrom_supdate and @ptill_supdate and
    (e.main_edtn=isnull(@pmainedtn,e.main_edtn) or @pmainedtn='')
    order by sup_seq_no;
end
	declare @vvar		varchar(4000)
	declare @vvar_sum	varchar(4000)
	declare @vquery		varchar(8000)

	set @vvar=''
	set @vvar_sum=''
 
	set @vfrom_supdate=convert(varchar(20),@pfrom_supdate,101)
	set @vtill_supdate=convert(varchar(20),@ptill_supdate,101)

	print('@vfrom_supdate')print(@vfrom_supdate);
	print('@vtill_supdate')print(@vtill_supdate);

if @pextra11 ='2' begin
	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type
end
else
begin
	open cur_sup_type  
		fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		WHILE @@FETCH_STATUS = 0 Begin 	
      		set @vvar		=@vvar+@rec_sup_type          		
      		set  @vvar_sum	=@vvar_sum+@rec_sup_type_sum
      		print('1')
      	fetch next from cur_sup_type into @rec_sup_type ,@rec_sup_type_sum,@rec_sup_seq_no
		end
    close cur_sup_type
	DEALLOCATE cur_sup_type
end

	print('@vvar')print(@vvar)
	print('@vvar_sum')print(@vvar_sum)

if @vvar='' or @vvar is null begin
	set @vvar=null
end
else begin
	set @vvar    =substring(@vvar,1,len(@vvar)-1)
	set @vvar_sum=substring(@vvar_sum,1,len(@vvar_sum)-1)
end	
	print('@vvar2')print(@vvar)
	print('@vvar_sum2')print(@vvar_sum)
   
if @punit_code=null begin
	set @punit_code=''
end
if @ppubl=null begin
	set @ppubl=''
end
if @pmainedtn=null begin
	set @pmainedtn=''
end
if @pedtn=null begin
	set @pedtn=''
end
if @proute=null begin
	set @proute=''
end
if @pextra1=null begin
	set @pextra1=''
end
if @pextra2=null begin
	set @pextra2=''
end
if @pextra3=null begin
	set @pextra3=''
end
if @pextra4=null begin
	set @pextra4=''
end
if @pextra5=null begin
	set @pextra5=''
end
if @pextra6=null begin
	set @pextra6=''
end
if @pextra7=null begin
	set @pextra7=''
end

if @pextra9=null begin
	set @pextra9=''
end
if @pextra10=null begin
	set @pextra10=''
end

if @pextra11=null begin
	set @pextra11=''
end
if @pextra12=null begin
	set @pextra12=''
end
if @pextra13=null begin
	set @pextra13=''
end

if @pextra14=null begin
	set @pextra14=''
end
if @pextra15=null begin
	set @pextra15=''
end
if @pextra11 ='2' begin
	if @vvar='' or @vvar is null 
	begin
		set @vquery='select d.comp_code comp_code,d.unit unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
		d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) route_name,
		dbo.cir_get_name_cir_route(d.comp_code,d.unit,d.route_code,''2'',null,null,null) route_oname
		from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit and d.unit='''+@punit_code+''' 
		and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit,d.publ,d.route_code
		order by d.comp_code,d.unit,d.publ,route_name';
	end
	else 
	begin
		if @pextra8='1' 
		begin----for route 
			set @vquery='select d.comp_code comp_code,d.unit unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
			d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit,d.route_code) route_name,
			dbo.cir_get_name_cir_route(d.comp_code,d.unit,d.route_code,''2'',null,null,null) route_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,d.publ,d.route_code
			order by d.comp_code,d.unit,d.publ,route_name';
		end ------ route	
		else if @pextra8='2' 
		begin----for  branch
			set @vquery='select d.comp_code comp_code,d.unit unit_code,m.branch_code branch_code,
			dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.branch_code
			order by d.comp_code,d.unit,branch_name'
		end ---- branch		
		else if @pextra8='3' 
		begin----for  zone
			set @vquery=' select d.comp_code comp_code,d.unit unit_code,c.zone_code,
			dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,c.zone_code
			order by d.comp_code,d.unit,zone_name';
		end  ---- zone
		else if @pextra8='4' 
		begin----for  region   
			set @vquery='  select d.comp_code comp_code,d.unit unit_code,c.region_code,
			dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,c.region_code
			order by d.comp_code,d.unit,region_name';
		end ---- end  region
		else if @pextra8='5' 
		begin----for  district
			set @vquery='select d.comp_code comp_code,d.unit unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
			dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.state_code,m.dist_code
			order by d.comp_code,d.unit,m.state_code,district_name	'
		end  ---- district
		else if @pextra8='6' 
		begin----for  tehsil_taluka
			set @vquery='  select d.comp_code comp_code,d.unit unit_code,m.tehsil_taluka tehsil_taluka,
			dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
			dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.tehsil_taluka
			order by d.comp_code,d.unit,taluka_name';
		end  ----for  tehsil_taluka
		else if @pextra8='7' 
		begin----for  State
			set @vquery='select d.comp_code comp_code,d.unit unit_code,m.country_code country_code,
			m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
			,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.country_code,m.state_code
			order by d.comp_code,d.unit,m.country_code,state_name';
		end  ----for  state
		else 
		begin--for executive
			set @vquery='select d.comp_code comp_code,d.unit unit_code,m.country_code country_code,
			m.executive_code executive_code,dbo.cir_get_executive(d.comp_code,m.executive_code) executive_name
			,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_supply d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit and d.unit='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			--and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			--and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit,m.country_code,m.executive_code
			order by d.comp_code,d.unit,m.country_code,executive_name';
		end
	end
end
else
begin
	if @vvar='' or @vvar is null 
	begin
		set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
		d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
		dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname
		from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
		where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
		m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
		and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
		and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
		and m.agcd=d.agcd and m.dpcd=d.dpcd 
		and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
		and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
		and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
		and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
		and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
		and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
		and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
		and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
		and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
		and m.city_code=c.city_code 
		and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
		and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
		and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
		group by d.comp_code,d.unit_code,d.publ,d.route_code
		order by d.comp_code,d.unit_code,d.publ,route_name';
	end
	else 
	begin
		if @pextra8='1' 
		begin----for route 
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,dbo.cir_get_publ_name(d.comp_code,d.publ) publ_name,
			d.route_code route_code,dbo.cir_get_route_name(d.comp_code,d.unit_code,d.route_code) route_name,
			dbo.cir_get_name_cir_route(d.comp_code,d.unit_code,d.route_code,''2'',null,null,null) route_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,d.publ,d.route_code
			order by d.comp_code,d.unit_code,d.publ,route_name';
		end ------ route	
		else if @pextra8='2' 
		begin----for  branch
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.branch_code branch_code,
			dbo.cir_get_branch(d.comp_code,m.branch_code) branch_name, 
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.branch_code
			order by d.comp_code,d.unit_code,branch_name'
		end ---- branch		
		else if @pextra8='3' 
		begin----for  zone
			set @vquery=' select d.comp_code comp_code,d.unit_code unit_code,c.zone_code,
			dbo.cir_get_zone_name(d.comp_code,c.zone_code) zone_name, 
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,c.zone_code
			order by d.comp_code,d.unit_code,zone_name';
		end  ---- zone
		else if @pextra8='4' 
		begin----for  region   
			set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,c.region_code,
			dbo.cir_get_region_name(d.comp_code,c.region_code) region_name,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,c.region_code
			order by d.comp_code,d.unit_code,region_name';
		end ---- end  region
		else if @pextra8='5' 
		begin----for  district
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.dist_code dist_code,dbo.cir_get_dist(d.comp_code,m.state_code,m.dist_code) district_name,
			dbo.cir_get_name_cir_district(d.comp_code,m.dist_code,''2'',null,null,null) district_oname, '+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.state_code,m.dist_code
			order by d.comp_code,d.unit_code,m.state_code,district_name	'
		end  ---- district
		else if @pextra8='6' 
		begin----for  tehsil_taluka
			set @vquery='  select d.comp_code comp_code,d.unit_code unit_code,m.tehsil_taluka tehsil_taluka,
			dbo.cir_get_taluka(d.comp_code,m.tehsil_taluka) taluka_name,
			dbo.cir_get_name_cir_taluka(d.comp_code,m.tehsil_taluka,''2'',null,null,null) taluka_oname,
			'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.tehsil_taluka
			order by d.comp_code,d.unit_code,taluka_name';
		end  ----for  tehsil_taluka
		else if @pextra8='7' 
		begin----for  State
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.country_code country_code,
			m.state_code state_code,dbo.cir_get_state(d.comp_code,m.country_code,m.state_code) state_name
			,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.country_code,m.state_code
			order by d.comp_code,d.unit_code,m.country_code,state_name';
		end  ----for  state
		else 
		begin--for executive
			set @vquery='select d.comp_code comp_code,d.unit_code unit_code,m.country_code country_code,
			m.executive_code executive_code,dbo.cir_get_executive(d.comp_code,m.executive_code) executive_name
			,'+@vvar+' ,'+@vvar_sum+' TOTAL 
			from cir_dbksup d,cir_agmast m,cir_edtn_mast e, cir_city_mast c
			where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=c.comp_code and d.comp_code='+''''+@pcomp_code+''''+' and 
			m.unit=d.unit_code and d.unit_code='''+@punit_code+''' 
			and d.publ=e.publ and (d.publ='''+@ppubl+''' or '''+@ppubl+'''='''')
			and d.edtn=e.edtn and (d.edtn='''+@pedtn+''' or '''+@pedtn+'''='''') 
			and m.agcd=d.agcd and m.dpcd=d.dpcd 
			and d.supdate between '+''''+@vfrom_supdate+''''+' and '+''''+ @vtill_supdate+''''+'
			and (d.final_supply_flag='''+@pextra3+''' or '''+@pextra3+'''='''')
			and (d.route_code='''+@proute+''' or '''+@proute+'''='''') 
			and (m.branch_code='''+@pextra1+''' or '''+@pextra1+'''='''')
			and (m.state_code='''+@pextra2+''' or '''+@pextra2+'''='''')
			and (c.zone_code='''+@pextra4+''' or '''+@pextra4+'''='''')
			and (c.region_code='''+@pextra5+''' or '''+@pextra5+'''='''')
			and (m.dist_code='''+@pextra6+''' or '''+@pextra6+'''='''')
			and (m.tehsil_taluka='''+@pextra7+''' or '''+@pextra7+'''='''')
			and m.city_code=c.city_code 
			and (e.main_edtn='''+@pmainedtn+''' or '''+@pmainedtn+'''='''')
			and exists (select ''x'' from cir_publ_mast where comp_code=d.comp_code and publ=d.publ and (pro_type='''+@pextra9+''' or '''+@pextra9+'''=''''))
			and (m.executive_code='''+@pextra10+''' or '''+@pextra10+'''='''')
			group by d.comp_code,d.unit_code,m.country_code,m.executive_code
			order by d.comp_code,d.unit_code,m.country_code,executive_name';
		end
	end
end
print(@vquery)
exec(@vquery)

///////////////////////next


ALTER FUNCTION [dbo].[cir_get_executive](
	@pcomp_code	as varchar(20),
	@pexec_code as varchar(20)) RETURNS varchar(200) AS

Begin
declare	@v_name  varchar(200)

      select @v_name=executive_desc from cir_executive_mast
             where comp_code=@pcomp_code and executive_code=@pexec_code
    
    return isnull(@v_name,'')

End

//////////////////////////next


create FUNCTION  [dbo].[cir_get_state1](
@pcomp_code		as varchar(100),
@pstate_code as varchar(100))  
returns varchar(200) 
AS  
BEGIN 

DECLARE @vstate_name VARCHAR(4000)

select @vstate_name=State_Name FROM state_mst where Comp_Code=@pcomp_code 
	and State_Code=@pstate_code
	   
RETURN isnull(@vstate_name,'NA')
END


///////////////////////////////////////////////////////end/////////////////////////////////////////////


////////////////////add by Deepika 24/05/2012  Issue No. 6929//////////////////////////////////


                                                          
                                                                     
                                             
ALTER PROCEDURE [dbo].[cir_rep_collection_cir_rep_collection_det_p]
	@pcompcode                                VARCHAR(20) ,
	@punitcode                                VARCHAR(20) ,
	@pbrachcode                               VARCHAR(20) ,
	@pdoctype                                 VARCHAR(20) ,
	@ppaymode                                 VARCHAR(20) ,
	@pactype                                  VARCHAR(20) ,
	@pfromdate                                datetime ,
	@ptodate                                  datetime ,
	@pdateformat                              VARCHAR(20) ,
	@pextra1                                  VARCHAR(200) ,
	@pextra2                                  VARCHAR(200) 
AS 
		DECLARE @v_frdt		DATETIME 
		DECLARE @v_todt     DATETIME 
		DECLARE	@A			INT
		DECLARE	@v_a		as varchar(1000)
	Begin
		SET @v_frdt  = @pfromdate--DBO.CONVERT_USER_DATE('/', @pfromdate,@pdateformat)
		--SET @v_frdt  = DBO.CONVERT_USER_DATE('/', @pfromdate,@pdateformat)
		SET @v_todt  =@ptodate--- DBO.CONVERT_USER_DATE('/', @ptodate,@pdateformat)
		/*if @pdoctype is not null Begin
            SET @a=dbo.FN_SPLITFIELD(@pdoctype ,',')
        end*/
		create  table #Results(SegmentNum INT, EditionName  VARCHAR(255))
		Begin
			if (@pdoctype is not null) begin
			insert into #Results select * from dbo.Fn_Splitfield(@pdoctype,',')
			End
		End
print 'amit'
        select A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.RECPTDT RECPTDT,A.RECPTNO RECPTNO,A.DOCTYPE DOCTYP,A.AGCD AGCD,
        A.DPCD DPCD,B.AG_NAME AS AGENCY_NAME,B.AG_NAME_OTH_LANG AGNAME_OTH_LANG,B.CITY_CODE,dbo.CIR_GET_CITY(B.COMP_CODE,B.CITY_CODE) CITY_NAME,
        B.TEHSIL_TALUKA TALUKA_CODE,dbo.CIR_GET_TALUKA(B.COMP_CODE,B.TEHSIL_TALUKA) TALUKA_NAME,A.VOUCHERNO VOUCHERNO,A.CHNO CHNO,A.CHDT CHDT,
       SUBSTRING(ISNULL((SELECT BANKNAME AS "bankname" FROM CIR_BANK_MAST WHERE COMP_CODE=A.COMP_CODE AND BANKCODE=A.CHBANK),A.CHBANK),1,15) AS BANK,ABS(A.AMOUNT) AMOUNT,
         dbo.INITCAP(A.REMARK) REMARK,A.ACHD ACHD,
       CASE WHEN A.DOCTYPE='RCR' THEN 
        (SELECT "Payment_Mode_Name" FROM PAYMENT_MODE_MAST WHERE "Pay_Mode_Code"=A.REASON)
        ELSE 
        (SELECT REASON_NAME FROM CIR_REASON_MST WHERE COMP_CODE=A.COMP_CODE AND REASON_CODE=A.REASON) END AS REASON,
        A.BRANCH_CODE BRANCH_CODE,(SELECT DISTINCT "Branch_Name" FROM BRANCH_MST WHERE "Branch_Code"=A.BRANCH_CODE) BRANCH_NAME,
        SUBSTRING(dbo.FA_GET_ACCOUNT_NAME(A.COMP_CODE,A.RCDP),1,15) DEBIT_HEAD,(SELECT DISTINCT CASE WHEN DSIGN=-1 THEN 'C' ELSE 'D' END DSIGN FROM CIR_DOCMST WHERE DOC_TYPE=A.DOCTYPE) DSIGN,
        A.USERID,(SELECT isnull(FIRSTNAME,"username")+' '+LASTNAME FROM LOGIN WHERE "userid"=A.USERID) CREATED_BY, A.CREATION_DATE CREATION_DATE, A.PROV_REC_NO PROV_REC_NO, A.PROV_REC_DT PROV_REC_DATE,
        A.REMARK_OTH REMARK_OTH
        from cir_rcphdr a,cir_agmast b
        where a.comp_code=b.comp_code and a.comp_code=@pcompcode  and a.unit_code=b.unit and a.unit_code =@punitcode and
              a.agcd=b.agcd and a.dpcd=b.dpcd and (a.agcd=@pextra1 or @pextra1 is null or @pextra1='') and (a.dpcd=@pextra2 or @pextra2 is null or @pextra2='') and
              a.recptdt between @v_frdt and @v_todt and --(a.doctype  = @pdoctype or @pdoctype is null or @pdoctype='' )
			 -- (a.doctype=@pdoctype or @pdoctype is null OR @pdoctype='') 
			  (a.doctype in (SELECT EditionName FROM #Results) or @pdoctype is null OR @pdoctype='')
			   and
              (a.reason =@ppaymode or @ppaymode is null OR	@ppaymode = '') and (ISNULL(a.achd, 'NM')  = @pactype OR	@pactype  is null OR	@pactype = '') and
              (a.branch_code  = @pbrachcode OR	@pbrachcode  is null  OR	@pbrachcode = '')
        order by comp_code,recptdt,doctype,recptno;

		/*SELECT a.comp_code comp_code, a.unit_code unit_code, a.recptdt recptdt, a.recptno recptno, a.doctype doctyp, a.agcd agcd,
		a.dpcd dpcd, b.ag_name  AGENCY_NAME, b.ag_name_oth_lang agname_oth_lang, b.city_code, DBO.cir_get_city(b.comp_code, b.city_code) city_name,
		b.tehsil_taluka taluka_code, DBO.cir_get_taluka(b.comp_code, b.tehsil_taluka) taluka_name, a.voucherno voucherno,
		a.chno chno, a.chdt chdt,
		SUBSTRING(ISNULL((SELECT bankname bankname  FROM  cir_bank_mast 	WHERE	 comp_code  = @pcompcode AND	bankcode  = a.chbank), a.chbank), 1, 15)  BANK,
		ABS(a.amount) amount, dbo.InitCap(a.remark) remark, a.achd achd,a.reason reason, a.branch_code branch_code,
		(SELECT DISTINCT Branch_Name FROM  branch_mst 	WHERE  Branch_Code  = a.branch_code) branch_name,
		SUBSTRING(DBO.fa_get_account_name(a.comp_code, a.rcdp), 1, 15) debit_head,
       (select distinct case when dsign=-1 then 'C' else 'D' end dsign 
		from cir_docmst where doc_type=a.doctype) dsign	,
		a.userid userid,(select ISNULL(FIRSTNAME,"username")+' '+LASTNAME from login where "userid"=a.userid) created_by, 
		a.creation_date creation_date, a.prov_rec_no prov_rec_no, a.prov_rec_dt prov_rec_date
        FROM  cir_rcphdr a, cir_agmast b 
		WHERE	 a.comp_code  = b.comp_code AND	a.comp_code  = @pcompcode
			AND	a.unit_code  = b.unit AND	a.unit_code  = @punitcode
			AND	a.agcd  = b.agcd
			AND (a.agcd=@pextra1 or @pextra1 is null or @pextra1='')
			AND	a.dpcd  = b.dpcd
			AND (a.dpcd=@pextra2 or @pextra2 is null or @pextra2='') 
			AND	a.recptdt  between @v_frdt  and  @v_todt
			AND	(a.doctype  = @pdoctype or @pdoctype is null or @pdoctype='' )
			--AND (a.doctype  in (SELECT EditionName FROM #Results) or @pdoctype is null OR @pdoctype='')
			AND	(a.reason  = @ppaymode OR	@ppaymode  is null OR	@ppaymode = '')
			AND	(ISNULL(a.achd, 'NM')  = @pactype OR	@pactype  is null OR	@pactype = '')
			AND	(a.branch_code  = @pbrachcode OR	@pbrachcode  is null  OR	@pbrachcode = '')
		 ORDER BY a.comp_code, a.recptdt,a.doctype, a.recptno */
		
	print 'amit1'	
		SELECT e.comp_code, e.doctype, e.reason, SUM(CONVERT(FLOAT, e.db_amount)) db_amount, 
        SUM(CONVERT(FLOAT, e.cr_amount)) cr_amount  FROM 
               (SELECT d.comp_code, d.doctype, d.reason,
		        CASE d.debit WHEN 'D' THEN SUM(CONVERT(FLOAT, d.amount)) END db_amount,				 
		        CASE d.credit WHEN 'C' THEN SUM(CONVERT(FLOAT, d.amount)) END cr_amount
		        FROM (SELECT a.comp_code comp_code,
		        (SELECT DOC_NAME  FROM dbo.CIR_DOCMST WHERE COMP_CODE=a.comp_code  AND DOC_TYPE=a.doctype)
		          doctype, --a.reason reason,
		        CASE WHEN A.DOCTYPE='RCR' THEN (SELECT "Payment_Mode_Name" FROM PAYMENT_MODE_MAST WHERE "Pay_Mode_Code"=A.REASON)
        ELSE (SELECT REASON_NAME FROM CIR_REASON_MST WHERE COMP_CODE=A.COMP_CODE AND REASON_CODE=A.REASON) END AS REASON,
             CASE sign(a.amount) WHEN 1 THEN 'D' END as debit,
             CASE sign(a.amount) WHEN - 1 THEN 'C' END as credit,
             ABS(a.amount)  amount
             FROM  cir_rcphdr a, cir_agmast b 
			WHERE	 a.comp_code  = b.comp_code
				AND	a.comp_code  = @pcompcode
				AND	a.unit_code  = b.unit
				AND	a.unit_code  = @punitcode
				AND	a.agcd  = b.agcd
				AND (a.agcd=@pextra1 or @pextra1 is null or @pextra1='')		
				AND	a.dpcd  = b.dpcd
				AND (a.dpcd=@pextra2 or @pextra2 is null or @pextra2='') 
				AND	a.recptdt  between @v_frdt  and  @v_todt
				--AND	 (a.doctype=@pdoctype or @pdoctype is null OR @pdoctype='')
				AND (a.doctype  in (SELECT EditionName FROM #Results) or @pdoctype is null OR @pdoctype='')
				AND	(a.reason  = @ppaymode OR	@ppaymode  is null  OR	@ppaymode  = '')
				AND	(ISNULL(a.achd, 'NM')  = @pactype  OR	@pactype  is null OR	@pactype  = '')
				AND	(a.branch_code  = @pbrachcode OR	@pbrachcode  is null OR	 @pbrachcode  = '')) d
                 GROUP BY d.comp_code, d.doctype, d.reason, d.debit, d.credit ) e
		GROUP BY e.comp_code, e.doctype,  e.reason 
		ORDER BY e.comp_code, e.doctype, e.reason 
		
		drop table #Results

End

///////////////////////////////////////end//////////////////////////////////////////////////////


/////////////////////add by Deepika 30/05/2012 sent by amit sir ////////////////////////////////////////////


CREATE procedure [dbo].[cir_publication_agency_wise]
	@pcomp_code			as varchar(40),
	@punit_code			as varchar(40),
	@ag_code			as varchar(40),
	@pextra1            as varchar(20),
	@pextra2            as varchar(20)
as
Begin
		select PUBL,PUBL_NAME from CIR_PUBL_MAST where 
		publ in(select PUBL from CIR_SUPPLY where
		COMP_CODE=@pcomp_code and 
		UNIT=@punit_code and 
		AGCD=@ag_code)
end

/////////////////////////////////////////////end///////////////////////


//////////////////////////////ADD BY DEEPIKA 30/05/2102///////////



CREATE PROCEDURE [dbo].[cir_agency_bind_cir_agency_bind_receipt_p]
	@pcompcode			VARCHAR(20) ,
	@punit              VARCHAR(20) ,
	@pdateformat        VARCHAR(20) ,
    @pdistcode          VARCHAR(20)=null,  
	@pextra1            VARCHAR(4000) ,
	@pextra2            VARCHAR(4000) 
AS 
BEGIN
	If UPPER(@pextra2)='D' Begin
			
		SELECT cir_agmast_dis.*,dbo.cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME",
		dbo.cir_get_agency(cir_agmast_dis.comp_code,cir_agmast_dis.unit,cir_agmast_dis.agcd,cir_agmast_dis.dpcd) "BILL_AGENCY",
		dbo.cir_get_agency_city(cir_agmast_dis.comp_code,cir_agmast_dis.unit,cir_agmast_dis.agcd,cir_agmast_dis.dpcd) "BILL_AGENCY_CITY",
		dbo.cir_get_drop_point_name(cir_agmast_dis.comp_code,cir_agmast_dis.unit,cir_agmast_dis.station_code,1) as "DROP_POINT_NAME"
		FROM  cir_agmast_dis 
		WHERE comp_code  = @pcompcode AND unit  = @punit and(dist_code =@pdistcode or @pdistcode is null)
		 AND ((UPPER(ag_name)  like UPPER(CAST(@pextra1 AS VARCHAR) + '%')) OR	(@pextra1  is null) OR	(@pextra1  = ''))
		 and cir_agmast_dis.DPCD='0001'
		  and isnull(TO_BILL,'N')='Y'
		 /*AND ISNULL(freeze_flag, 'N')  = 'N'*/
		union
		SELECT cir_agmast_dis.*,dbo.cir_get_city(cir_agmast_dis.comp_code,cir_agmast_dis.city_code) "CITY_NAME",
		dbo.cir_get_agency(cir_agmast_dis.comp_code,cir_agmast_dis.unit,cir_agmast_dis.agcd,cir_agmast_dis.dpcd) "BILL_AGENCY",
		dbo.cir_get_agency_city(cir_agmast_dis.comp_code,cir_agmast_dis.unit,cir_agmast_dis.agcd,cir_agmast_dis.dpcd) "BILL_AGENCY_CITY",
		dbo.cir_get_drop_point_name(cir_agmast_dis.comp_code,cir_agmast_dis.unit,cir_agmast_dis.station_code,1) as "DROP_POINT_NAME"
		FROM  cir_agmast_dis 
		WHERE comp_code  = @pcompcode AND unit  = @punit and(dist_code =@pdistcode or @pdistcode is null)
		 AND ((UPPER(agcd)  like UPPER(CAST(@pextra1 AS VARCHAR) + '%')) OR	(@pextra1  is null) OR	(@pextra1  = ''))
		 		 and cir_agmast_dis.DPCD='0001'
		 		 and isnull(TO_BILL,'N')='Y'
		 /*AND ISNULL(freeze_flag, 'N')  = 'N'*/
		ORDER BY 5
	End
	Else Begin
		SELECT cir_agmast.*,dbo.cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME",
		dbo.cir_get_agency(cir_agmast.comp_code,cir_agmast.unit,cir_agmast.agcd,cir_agmast.dpcd) "BILL_AGENCY",
		dbo.cir_get_agency_city(cir_agmast.comp_code,cir_agmast.unit,cir_agmast.agcd,cir_agmast.dpcd) "BILL_AGENCY_CITY",
		dbo.cir_get_drop_point_name(cir_agmast.comp_code,cir_agmast.unit,cir_agmast.station_code,1) as "DROP_POINT_NAME"
			FROM  cir_agmast 
			WHERE comp_code  = @pcompcode AND unit  = @punit and(dist_code =@pdistcode or @pdistcode is null)
			 AND ((UPPER(ag_name)  like UPPER(CAST(@pextra1 AS VARCHAR) + '%')) OR	(@pextra1  is null) OR	(@pextra1  = ''))
			 		 and cir_agmast.DPCD='0001'
			 		  and isnull(TO_BILL,'N')='Y'
			 /*AND ISNULL(freeze_flag, 'N')  = 'N'*/
		union
		SELECT cir_agmast.*,dbo.cir_get_city(cir_agmast.comp_code,cir_agmast.city_code) "CITY_NAME",
		dbo.cir_get_agency(cir_agmast.comp_code,cir_agmast.unit,cir_agmast.agcd,cir_agmast.dpcd) "BILL_AGENCY",
		dbo.cir_get_agency_city(cir_agmast.comp_code,cir_agmast.unit,cir_agmast.agcd,cir_agmast.dpcd) "BILL_AGENCY_CITY",
		dbo.cir_get_drop_point_name(cir_agmast.comp_code,cir_agmast.unit,cir_agmast.station_code,1) as "DROP_POINT_NAME"
			FROM  cir_agmast 
			WHERE comp_code  = @pcompcode AND unit  = @punit and(dist_code =@pdistcode or @pdistcode is null)
			 AND ((UPPER(agcd)  like UPPER(CAST(@pextra1 AS VARCHAR) + '%')) OR	(@pextra1  is null) OR	(@pextra1  = ''))
			 		 and cir_agmast.DPCD='0001'
			 		  and isnull(TO_BILL,'N')='Y'
			 /*AND ISNULL(freeze_flag, 'N')  = 'N'*/			 
			ORDER BY 5
	End
END



///////////////////////////////////////////////////END///////////////////////


//////////////////////////////add by Deepika 31/05/2012 sent by Amit Singh sir//////////////////////////////////////

                                                                     
                                                                     
                                                                     
                                             
ALTER PROCEDURE [dbo].[cir_unsold_credit_note_cir_unsold_supply_p]
	@pcomp_code			as varchar(40),
	@punit_code			as varchar(40),
	@ppubl_code			as varchar(40),
	@pedtn_code			as varchar(40),
	@psup_fromdate		as datetime,
	@psup_todate        as datetime,
	@pagcd_code			as varchar(20),
	@pdpcd_code			as varchar(20),
	@pdateformat        as varchar(20),
	@preceiptdt         as datetime,
	@pextra1            as varchar(20),--it is use for datewise or ratewise
	@pextra2            as varchar(20)
As
Begin
	if upper(@pextra2)='D' Begin
	PRINT 'A'
 
		select z.comp_code AS "COMP_CODE",z.unit_code AS "UNIT_CODE",z.publ AS "PUBL",z.publ_name AS "PUBL_NAME",z.edtn AS "EDTN" , z.edtn_name AS "EDTN_NAME",
		z.supply_date AS "SUPPLY_DATE", z.supply_date AS "SUPPLY_DATEMON",z.copy_rate AS "COPY_RATE",z.comm_fix_auto_spl AS "COMM_FIX_AUTO_SPL" ,z.comm_code AS "COMM_CODE",z.waste_rate AS "WASTE_RATE",
        substring(z.comm_rate,1,1) AS "COMM_CATEG_TYPE",substring(z.comm_rate,2,len(z.comm_rate)-1) AS "COMM_RATE",z.supply_copy AS "SUPPLY_COPY",z.rate_supply AS "RATE_SUPPLY", 
        z.RETURNABLE as "RETURNABLE",z.per_copy_weight per_copy_weight 
        ,z.RETURNABLEper
            as "RETURNABLEper" from--P30,C0.5
        (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,p.publ_name publ_name,
        d.edtn edtn,edition_nick edtn_name,d.supdate supply_date,
        d.sup_rate copy_rate,d.comm_fix_auto_spl comm_fix_auto_spl,d.comm_code comm_code,
		dbo.cir_get_waste_rate_catg(d.comp_code,d.unit_code,d.edtn,supdate,''''+@pdateformat+'''',d.waste_catg_code,null,null) waste_rate,
        dbo.cir_get_commission(d.comp_code,d.unit_code,d.publ,d.edtn,d.comm_fix_auto_spl ,d.comm_code,d.supdate,''''+@pdateformat+'''',sum(d.sup_copy),'','') comm_rate,
		'P' comm_catg_type, sum(d.sup_copy) supply_copy,sum(d.sup_copy) rate_supply,
		d.per_copy_weight per_copy_weight,d.waste_catg_code waste_catg_code
		,dbo.cir_get_unsold_returnable(d.comp_code,d.publ,sum(d.sup_copy),'A01',@pagcd_code,@pdpcd_code,'Q','','')  as "RETURNABLE" 
		,dbo.cir_get_unsold_returnable(d.comp_code,d.publ,sum(d.sup_copy),'A01',@pagcd_code,@pdpcd_code,'P','','')   as "RETURNABLEper"
        from cir_dbksup_dis d,cir_publ_mast p,cir_edtn_mast e
        where d.comp_code=@pcomp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and
              d.unit_code=@punit_code and d.publ=p.publ and d.publ=e.publ and
              (d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='') and
              d.edtn=e.edtn and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') and
            d.supdate between @psup_fromdate and @psup_todate and
            d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code and upper(isnull(@pextra1,'D'))='D'
            group by d.comp_code,d.unit_code,d.publ,p.publ_name,e.edition_nick,d.edtn,d.supdate,d.sup_rate,d.comm_fix_auto_spl,d.comm_code,d.per_copy_weight,d.waste_catg_code)z
     union
        select distinct z.comp_code AS "COMP_CODE",z.unit_code AS "UNIT_CODE",z.publ AS "PUBL",z.publ_name AS "PUBL_NAME",z.edtn AS "EDTN",z.edtn_name AS "EDTN_NAME",
		MAX(z.supply_date) AS "SUPPLY_DATE",dbo.GetLastDayOfMonth(z.supply_date) AS "SUPPLY_DATEMON",
        z.copy_rate AS "COPY_RATE",z.comm_fix_auto_spl AS "COMM_FIX_AUTO_SPL",z.comm_code AS "COMM_CODE",z.waste_rate AS "WASTE_RATE",
        z.comm_catg_type AS "COMM_CATEG_TYPE",z.comm_rate AS "COMM_RATE",sum(z.supply_copy) AS "SUPPLY_COPY",sum(z.supply_copy) rate_supply,
        dbo.cir_get_unsold_returnable(z.comp_code,z.publ,sum(z.supply_copy),'A01',@pagcd_code,@pdpcd_code,'Q','','')  RETURNABLE,
        max(z.per_copy_weight) per_copy_weight 
        ,dbo.cir_get_unsold_returnable(z.comp_code,z.publ,sum(z.supply_copy),'A01',@pagcd_code,@pdpcd_code,'P','','') as "RETURNABLEper"  
        from (select distinct y.comp_code,y.unit_code,y.publ,y.publ_name,y.edtn,y.edtn_name,y.supply_date,y.copy_rate,y.comm_fix_auto_spl,y.comm_code,y.waste_rate,
        substring(y.comm_rate,1,1) comm_catg_type,substring(y.comm_rate,2,len(y.comm_rate)-1) comm_rate,y.supply_copy,y.rate_supply ,
        y.per_copy_weight per_copy_weight from--P30,C0.5
        (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,p.publ_name publ_name,
        d.edtn edtn,edition_nick edtn_name,d.supdate supply_date,
        d.sup_rate copy_rate,d.comm_fix_auto_spl comm_fix_auto_spl,d.comm_code comm_code,
		dbo.cir_get_waste_rate_catg(d.comp_code,d.unit_code,d.edtn,d.supdate,''''+@pdateformat+'''',d.waste_catg_code,null,null) waste_rate,
        dbo.cir_get_commission(d.comp_code,d.unit_code,d.publ,d.edtn,d.comm_fix_auto_spl ,d.comm_code,d.supdate,''''+@pdateformat+'''',sum(d.sup_copy),'','') comm_rate,'P' comm_catg_type, 
		sum(d.sup_copy) supply_copy,
        (select sum(u.sup_copy) from cir_dbksup_dis u where u.comp_code=d.comp_code and u.unit_code=d.unit_code and 
        (u.publ=d.publ) and u.edtn=d.edtn and u.supdate between @psup_fromdate and @psup_todate and 
        u.billagcd=@pagcd_code and u.billdpcd=@pdpcd_code and u.sup_rate=d.sup_rate) rate_supply,
        d.per_copy_weight per_copy_weight,d.waste_catg_code waste_catg_code
        from cir_dbksup_dis d,cir_publ_mast p,cir_edtn_mast e
        where d.comp_code=@pcomp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and
              d.unit_code=@punit_code and d.publ=p.publ and d.publ=e.publ and
              (d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='') and
              d.edtn=e.edtn and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') and
            d.supdate between @psup_fromdate and @psup_todate and
            d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code and upper(isnull(@pextra1,'D'))='R'
            group by d.comp_code,d.unit_code,d.publ,p.publ_name,e.edition_nick,d.edtn,d.supdate,d.sup_rate,d.comm_fix_auto_spl,d.comm_code,d.per_copy_weight,d.waste_catg_code)y) z
            group by z.comp_code,z.unit_code,z.publ,z.publ_name,z.edtn,z.edtn_name,dbo.GetLastDayOfMonth(z.supply_date),
                z.copy_rate,z.comm_fix_auto_spl,z.comm_code,z.waste_rate,z.comm_catg_type,z.comm_rate
			order by publ_name,edtn,supply_date
	End
	Else Begin
	PRINT 'B'
            select z.comp_code AS "COMP_CODE",z.unit_code AS "UNIT_CODE",z.publ AS "PUBL",z.publ_name AS "PUBL_NAME",z.edtn AS "EDTN",z.edtn_name AS "EDTN_NAME",
			z.supply_date AS "SUPPLY_DATE",z.supply_date AS "SUPPLY_DATEMON",
            z.copy_rate AS "COPY_RATE",z.comm_fix_auto_spl AS "COMM_FIX_AUTO_SPL",z.comm_code AS "COMM_CODE",z.waste_rate AS "WASTE_RATE",
            substring(z.comm_rate,1,1) AS "COMM_CATEG_TYPE",substring(z.comm_rate,2,len(z.comm_rate)-1) AS "COMM_RATE",z.supply_copy AS "SUPPLY_COPY",z.rate_supply AS "RATE_SUPPLY",
           z.RETURNABLE
            as "RETURNABLE" ,z.per_copy_weight per_copy_weight 
            ,z.RETURNABLEper
            as "RETURNABLEper"  from--P30,C0.5
            (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,p.publ_name publ_name,
            d.edtn edtn,edition_nick edtn_name,d.supdate supply_date,
            d.sup_rate copy_rate,d.comm_fix_auto_spl comm_fix_auto_spl,d.comm_code comm_code,
			dbo.cir_get_waste_rate_catg(d.comp_code,d.unit_code,d.edtn,supdate,''''+@pdateformat+'''',d.waste_catg_code,null,null) waste_rate,
            dbo.cir_get_commission(d.comp_code,d.unit_code,d.publ,d.edtn,d.comm_fix_auto_spl ,d.comm_code,d.supdate,''''+@pdateformat+'''',sum(d.sup_copy),'','') comm_rate,
			'P' comm_catg_type, sum(d.sup_copy) supply_copy,sum(d.sup_copy) rate_supply,
			d.per_copy_weight per_copy_weight,d.waste_catg_code waste_catg_code,
			dbo.cir_get_unsold_returnable(d.comp_code,d.publ,sum(d.sup_copy),'A01',@pagcd_code,@pdpcd_code,'Q','','')  
            as "RETURNABLE"
            ,dbo.cir_get_unsold_returnable(d.comp_code,d.publ,sum(d.sup_copy),'A01',@pagcd_code,@pdpcd_code,'P','','')   as "RETURNABLEper"
            from cir_dbksup d,cir_publ_mast p,cir_edtn_mast e
            where d.comp_code=@pcomp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and
                d.unit_code=@punit_code and d.publ=p.publ and d.publ=e.publ and
                  (d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='') and
                  d.edtn=e.edtn and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') and
                d.supdate between @psup_fromdate and @psup_todate and
                d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code and upper(isnull(@pextra1,'D'))='D'
                group by d.comp_code,d.unit_code,d.publ,p.publ_name,e.edition_nick,d.edtn,d.supdate,d.sup_rate,d.comm_fix_auto_spl,d.comm_code,d.per_copy_weight,d.waste_catg_code) z
            union
            select distinct z.comp_code AS "COMP_CODE",z.unit_code AS "UNIT_CODE",z.publ AS "PUBL",z.publ_name AS "PUBL_NAME",z.edtn AS "EDTN",z.edtn_name AS "EDTN_NAME",
			MAX(z.supply_date) AS "SUPPLY_DATE",dbo.GetLastDayOfMonth(z.supply_date) AS "SUPPLY_DATEMON",
            z.copy_rate AS "COPY_RATE",z.comm_fix_auto_spl AS "COMM_FIX_AUTO_SPL",z.comm_code AS "COMM_CODE",z.waste_rate AS "WASTE_RATE",
            z.comm_catg_type AS "COMM_CATEG_TYPE",z.comm_rate AS "COMM_RATE",sum(z.supply_copy) AS "SUPPLY_COPY",sum(z.supply_copy) AS "RATE_SUPPLY" ,
            dbo.cir_get_unsold_returnable(z.comp_code,z.publ,sum(z.supply_copy),'A01',@pagcd_code,@pdpcd_code,'Q','','') 
            as "RETURNABLE",max(z.per_copy_weight) per_copy_weight 
            ,dbo.cir_get_unsold_returnable(z.comp_code,z.publ,sum(z.supply_copy),'A01',@pagcd_code,@pdpcd_code,'P','','') as "RETURNABLEper" from
            (select distinct y.comp_code,y.unit_code,y.publ,y.publ_name,y.edtn,y.edtn_name,y.supply_date,y.copy_rate,y.comm_fix_auto_spl,y.comm_code,y.waste_rate,
            substring(y.comm_rate,1,1) comm_catg_type,substring(y.comm_rate,2,len(y.comm_rate)-1) comm_rate,y.supply_copy,y.rate_supply,
            y.per_copy_weight per_copy_weight from--P30,C0.5
            (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,p.publ_name publ_name,d.edtn edtn,edition_nick edtn_name,d.supdate supply_date,
            d.sup_rate copy_rate,d.comm_fix_auto_spl comm_fix_auto_spl,d.comm_code comm_code,
			dbo.cir_get_waste_rate_catg(d.comp_code,d.unit_code,d.edtn,d.supdate,''''+@pdateformat+'''',d.waste_catg_code,null,null) waste_rate,
            dbo.cir_get_commission(d.comp_code,d.unit_code,d.publ,d.edtn,d.comm_fix_auto_spl ,d.comm_code,d.supdate,''''+@pdateformat+'''',sum(d.sup_copy),'','') comm_rate,
			'P' comm_catg_type, sum(d.sup_copy) supply_copy,
            (select sum(u.sup_copy) from cir_dbksup u where u.comp_code=d.comp_code and u.unit_code=d.unit_code and 
            (u.publ=d.publ) and u.edtn=d.edtn and u.supdate between @psup_fromdate and @psup_todate and 
            u.billagcd=@pagcd_code and u.billdpcd=@pdpcd_code and u.sup_rate=d.sup_rate) rate_supply,
            d.per_copy_weight per_copy_weight,d.waste_catg_code waste_catg_code
            from cir_dbksup d,cir_publ_mast p,cir_edtn_mast e
            where d.comp_code=@pcomp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and
                  d.unit_code=@punit_code and d.publ=p.publ and d.publ=e.publ and
                  (d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='') and
                  d.edtn=e.edtn and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') and
                d.supdate between @psup_fromdate and @psup_todate and
                d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code and upper(isnull(@pextra1,'D'))='R'
                group by d.comp_code,d.unit_code,d.publ,p.publ_name,e.edition_nick,d.edtn,d.supdate,d.sup_rate,d.comm_fix_auto_spl,d.comm_code,d.per_copy_weight,d.waste_catg_code) y) z
                group by z.comp_code,z.unit_code,z.publ,z.publ_name,z.edtn,z.edtn_name,dbo.GetLastDayOfMonth(z.supply_date),
                    z.copy_rate,z.comm_fix_auto_spl,z.comm_code,z.waste_rate,z.comm_catg_type,z.comm_rate
                order by publ_name,edtn,supply_date
	End
	
	--  this table for permissable days---------
	
	select top 1 ISNULL(z.output,'OK') as OUTPUT from(	
	select distinct dbo.cir_get_unsold_permissable_days
	(@pcomp_code,isnull(@ppubl_code,d.PUBL),'A01',@pagcd_code,@pdpcd_code,'D',@preceiptdt,@psup_fromdate,'','') as output
	,publ from cir_dbksup d 
	where d.comp_code=@pcomp_code and
	d.unit_code=@punit_code and
	(d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='')  
	and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') 
	and d.supdate between @psup_fromdate and @psup_todate and
	d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code
	group by d.PUBL) z where z.output not like 'OK%'
	
End


/////////////////////////////////

ALTER
function [dbo].[cir_get_unsold_returnable]

(

@pcompcode
as varchar(20),

@ppublcode
as varchar(20),

@psupcopy
as int,

@puserid
as varchar(20),

@pagcd
as varchar(20),

@pdpcd
as varchar(20),

@pflag
as varchar(1),

@pextra1
as varchar(20),

@pextra2
as varchar(20)

) returns numeric

As

Begin

-------

declare @v_bill_freq as varchar(1)

declare @v_unit as varchar(20)

declare @v_branch as varchar(20)

declare @v_region as varchar(20)

declare @v_zone as varchar(20)

declare @v_agtype as varchar(20)

declare @v_agclass as varchar(20)

declare @v_citycode as varchar(20)

declare @v_cnt as int

declare @v_output as numeric(14,2)

declare @v_value as numeric(14,2)

select distinct @v_bill_freq=billing_cycle from CIR_SUPPLY where comp_code= @pcompcode

and agcd=@pagcd and dpcd=@pdpcd and publ=@ppublcode

and (EDTN=@pextra1 or @pextra1 is null or @pextra1 ='')

select @v_unit=unit,@v_branch=branch_code,@v_citycode=city_code,@v_agtype=ag_type,@v_agclass=ag_class from cir_agmast

where comp_code=@pcompcode and agcd=@pagcd and dpcd=@pdpcd

select distinct @v_zone=zone_code,@v_region=region_code from cir_city_mast c where c.city_code=@v_citycode

if @v_unit = '' begin

set @v_unit=null

end

if @v_branch ='' begin

set @v_branch=null

end

if @v_region ='' begin

set @v_region=null

end

if @v_zone='' begin

set @v_zone=null

end

if @v_agtype='' begin

set @v_agtype=null

end

if @v_agclass ='' begin

set @v_agclass=null

end

select @v_cnt= count(*) from CIR_UNSOLD_RETURN_CONTROL where comp_code=@pcompcode

and publ_code=@ppublcode and bill_freq=@v_bill_freq

and (unit_code=@v_unit or @v_unit is null)

and (branch_code=@v_branch or @v_branch is null)

and (reg_code=@v_region or @v_region is null)

and (zone_code=@v_zone or @v_zone is null)

and (ag_type=@v_agtype or @v_agtype is null)

and (ag_class=@v_agclass or @v_agclass is null)

and (EDTN_CODE=@pextra1 or @pextra1 is null or @pextra1 ='')

select @v_output= isnull(perm_per,0) from CIR_UNSOLD_RETURN_CONTROL p--,cir_dbksup x

where comp_code=@pcompcode

--and x.comp_code=p.comp_code and x.publ=p.publ and x.edtn=p.edtn

and publ_code=@ppublcode and bill_freq=@v_bill_freq

and (unit_code=@v_unit or @v_unit is null)

and (branch_code=@v_branch or @v_branch is null)

and (reg_code=@v_region or @v_region is null)

and (zone_code=@v_zone or @v_zone is null)

and (ag_type=@v_agtype or @v_agtype is null)

and (ag_class=@v_agclass or @v_agclass is null)

and (EDTN_CODE=@pextra1 or @pextra1 is null or @pextra1 ='')

if @v_cnt =0 begin

set @v_output= 0

end

if @pflag = 'P'

begin

set @v_value=@v_output

end

else

begin

set @v_value=round(((@psupcopy*@v_output)/100),0)

end

/* ------- */

return isnull(@v_value,0)

End

///////////////////////////////////////

create
function [dbo].[cir_get_unsold_permissable_days]

(

@pcompcode
as varchar(20),

@ppublcode
as varchar(20),

@puserid
as varchar(20),

@pagcd
as varchar(20),

@pdpcd
as varchar(20),

@pflag
as varchar(1),

@pchkdate
as datetime,

@preceivedt
as datetime,

@pextra1
as varchar(20),

@pextra2
as varchar(20)

) returns varchar(500)

As

Begin

-------

declare @v_bill_freq as varchar(1)

declare @v_unit as varchar(20)

declare @v_branch as varchar(20)

declare @v_region as varchar(20)

declare @v_zone as varchar(20)

declare @v_agtype as varchar(20)

declare @v_agclass as varchar(20)

declare @v_citycode as varchar(20)

declare @v_cnt as int

declare @v_output as int

declare @v_value as varchar(500)

select distinct @v_bill_freq=billing_cycle from CIR_SUPPLY where comp_code= @pcompcode

and agcd=@pagcd and dpcd=@pdpcd and publ=@ppublcode

and (EDTN=@pextra1 or @pextra1 is null or @pextra1 ='')

select @v_unit=unit,@v_branch=branch_code,@v_citycode=city_code,@v_agtype=ag_type,@v_agclass=ag_class from cir_agmast

where comp_code=@pcompcode and agcd=@pagcd and dpcd=@pdpcd

select distinct @v_zone=zone_code,@v_region=region_code from cir_city_mast c where c.city_code=@v_citycode

if @v_unit = '' begin

set @v_unit=null

end

if @v_branch ='' begin

set @v_branch=null

end

if @v_region ='' begin

set @v_region=null

end

if @v_zone='' begin

set @v_zone=null

end

if @v_agtype='' begin

set @v_agtype=null

end

if @v_agclass ='' begin

set @v_agclass=null

end

select @v_cnt= count(*) from CIR_UNSOLD_RETURN_CONTROL where comp_code=@pcompcode

and publ_code=@ppublcode and bill_freq=@v_bill_freq

and (unit_code=@v_unit or @v_unit is null)

and (branch_code=@v_branch or @v_branch is null)

and (reg_code=@v_region or @v_region is null)

and (zone_code=@v_zone or @v_zone is null)

and (ag_type=@v_agtype or @v_agtype is null)

and (ag_class=@v_agclass or @v_agclass is null)

and (EDTN_CODE=@pextra1 or @pextra1 is null or @pextra1 ='')

select @v_output= isnull(no_of_days,0) from CIR_UNSOLD_RETURN_CONTROL p

where comp_code=@pcompcode

and publ_code=@ppublcode and bill_freq=@v_bill_freq

and (unit_code=@v_unit or @v_unit is null)

and (branch_code=@v_branch or @v_branch is null)

and (reg_code=@v_region or @v_region is null)

and (zone_code=@v_zone or @v_zone is null)

and (ag_type=@v_agtype or @v_agtype is null)

and (ag_class=@v_agclass or @v_agclass is null)

and (EDTN_CODE=@pextra1 or @pextra1 is null or @pextra1 ='')

declare @diff_days as int

set @diff_days=datediff(dd,@preceivedt,@pchkdate)

if @v_cnt =0 begin

set @v_output= 0

end

if @pflag = 'D'

begin

--@v_output -- contains permissable days allowed

if @diff_days > @v_output

begin

set @v_value='You are not authorized to receive unsold more than '+ cast (@v_output as varchar) + ' days.'

end

end

else

begin

set @v_value='OK'

end

-------

return isnull(@v_value,0)

End

//////////////////////////////////////////////////end////////////////////////////////////////////////////

///////////////////////////Add by vivek issue no 6808 31/05/2012//////////////////////////////////////////////////

USE [abhi26aug]
GO
/****** Object:  StoredProcedure [dbo].[Cir_Gen_Code_cir_unsold_scnction_p]    Script Date: 05/31/2012 10:56:19 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [dbo].[Cir_Gen_Code_cir_unsold_scnction_p]
	@pcompcode			VARCHAR(20),
	@punitcode			VARCHAR(20),
	@pdoctype           VARCHAR(20),
	@pdateformat        VARCHAR(20),
	@pextra1            VARCHAR(400),--for unsold receipt date
	@pextra2            VARCHAR(400) --for agency or distribution
AS 

	DECLARE @vtype_code		VARCHAR(15) 
    DECLARE @v_prefix		varchar(20)
    DECLARE @v_no			varchar(20)
    DECLARE @v_dt			datetime
    DECLARE @v_chkdt		datetime	

	set @v_dt =dbo.convert_user_date('/', @pextra1, @pdateformat)

    set @v_prefix='SN'+replace(substring(convert(varchar(20), @v_dt, 2),1,5), '.', '')

	set @v_chkdt =dbo.GetFirstDayOfMonth( @v_dt)

    select @v_no=curr_no from cir_series
		where comp_code=@pcompcode and unit_code=@punitcode
		and ty=ISNULL(@pdoctype,'SCN') and dbo.GetFirstDayOfMonth( year_monid)=@v_chkdt 
		and prefix=@v_prefix

    If @v_no is null or @v_no='0' or @v_no='' Begin
        set @vtype_code=@v_prefix+'00001'
        insert into cir_series(comp_code,unit_code,branch_code,ty,year_monid,prefix, curr_no)
		values(@pcompcode,@punitcode,null,ISNULL(@pdoctype,'SCN'),@v_chkdt,@v_prefix,1)
	End		
    Else 
	Begin
        set @v_no =convert(int,@v_no)+1

        set @vtype_code  =@v_prefix+cast(dbo.fnPadLeft('0',5,@v_no) as varchar(50))
        
        update cir_series set curr_no=isnull(curr_no,0)+1
        where comp_code=@pcompcode and unit_code=@punitcode 
		and ty=ISNULL(@pdoctype,'SCN') and dbo.GetFirstDayOfMonth(year_monid)=@v_chkdt 
		and prefix=@v_prefix
    End

    select @vtype_code as "VAR_CODE"
/////////////////////////////////////////////////End//////////////////////////////////////////////////////







++++++++++++++++++++++++++++++++++++send  sumit dhama  issue num:-4111 ++++++++++++++++++++

CREATE  procedure cir_fetch_data_for_rr
    @pcompcode      as varchar(30),
    @punitcode       as varchar(30),
    @pagtype        as varchar(30),
    @pagclass      as varchar(30),
    @ppublcode     as varchar(30),
    @pmedtncode     as varchar(30),
    @pedtncode       as varchar(30),
    @pagcd          as varchar(30),
    @pdpcd           as varchar(30),
    @proutecode      as varchar(30),
    @psubrtcode      as varchar(30),
    @psubsubrtcode  as varchar(30),
    @proutemode     as varchar(30),
    @psupdate       as datetime,
    @puserid        as varchar(30),
    @pdateformat    as varchar(30),
    @prr_flag        as varchar(30),--null for Both,1 for enter rr no.,2 for not enter rr no. 
    @pextra1        as varchar(30),
    @pextra2        as varchar(30),
    @pextra3         as varchar(30),
    @pextra4        as varchar(30),
    @pextra5         as varchar(30)
   
  As
begin
   if @prr_flag=1 begin
        select x.comp_code as "COMP_CODE" ,x.unit_code as "UNIT_CODE",x.agcd as "AGCD",x.dpcd as "DPCD",x.ag_name as "AGENCY_NAME",
        x.city_code as "CITY_CODE",x.city_name as "CITY_NAME",
        x.station_code as "DROP_POINT",x.drop_point_name as "DROP_POINT_NAME",
        x.publ as "PUBL",x.main_edtn as "MAIN_EDTN",x.main_edtn_name as "MAIN_EDTN_NAME", 
        x.edtn as "EDTN" ,x.edtn_name as "EDTN_NAME",x.billagcd as "BILLAGCD",x.billdpcd as "BILLDPCD",
        x.route_code as "ROUTE_CODE",x.route_name as "ROUTE_NAME",
        x.subroute_code as "SUBROUTE_CODE",x.subrt_name as "SUBRT_NAME", 
        x.subsubroute_code as "SUBSUBROUTE_CODE",x.subsubrt_name as "SUBSUBRT_NAME", 
        x.sup_copy as "SUP_COPY",x.rr_no as "RR_NO",
        case @pdateformat 
        WHEN 'mm/dd/yyyy' THEN CONVERT(varchar(10),x.rr_date,101)
		WHEN 'dd/mm/yyyy' THEN CONVERT(varchar(10),x.rr_date,103)
		WHEN 'yyyy/mm/dd' THEN CONVERT(varchar(10),x.rr_date,111)  END as "RR_DATE",
		x.rr_amt as "RR_AMT" from
        (select d.comp_code ,d.unit_code ,m.agcd ,m.dpcd,m.ag_name,
        m.city_code,dbo.cir_get_city(d.comp_code,m.city_code) as CITY_NAME,
        m.station_code ,dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,'1') as "DROP_POINT_NAME",
        d.publ,e.main_edtn,dbo.cir_get_edtn_name(d.comp_code,e.main_edtn) MAIN_EDTN_NAME, 
        d.edtn ,e.edtn_name,d.billagcd,d.billdpcd,d.route_code,r.route_name,
        d.subroute_code,(select subrt_name from cir_sub_route_mast where comp_code=d.comp_code and unit=d.unit_code and
        route_code=d.route_code and subrt_code=d.subroute_code) as SUBRT_NAME, 
        d.subsubroute_code,(select sub_subrt_name from cir_sub_subroute_mast where comp_code=d.comp_code and unit=d.unit_code and
        route_code=d.route_code and sub_subrt_code=d.subroute_code and sub_subrt_code=d.subsubroute_code) as SUBSUBRT_NAME, 
        sum(d.sup_copy) as SUP_COPY,null as "RR_NO",null as "RR_DATE",null as "RR_AMT"
        from cir_agmast m,cir_dbksup d,cir_edtn_mast e,cir_route_mode_mast rm,cir_route_mast r
        where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=r.comp_code and m.comp_code=rm.comp_code and m.comp_code=@pcompcode and 
        m.unit=d.unit_code and m.unit=r.unit and m.agcd=d.agcd and m.agcd=isnull(@pagcd,m.agcd) and m.dpcd=d.dpcd and m.dpcd=isnull(@pdpcd,m.dpcd) and
        d.publ=e.publ and d.publ=isnull(@ppublcode,d.publ) and 
        d.edtn=e.edtn and d.edtn=isnull(@pedtncode,d.edtn) and e.main_edtn=isnull(@pmedtncode,e.main_edtn) and
        d.supdate = @psupdate and d.route_code=r.route_code and r.route_mode=rm.mode_code and (r.route_mode=@proutemode or @proutemode is null) and
        (m.ag_type=@pagtype or @pagtype is null) and (m.ag_class=@pagclass or @pagclass is null) and
        not exists (select 'x' from cir_rr_detail where comp_code=d.comp_code and unit_code=d.unit_code and edtn_code=d.edtn and 
        agcd=d.agcd and dpcd=d.dpcd and supdate=d.supdate)
        group by d.comp_code,d.unit_code,m.agcd,m.dpcd,m.ag_name,m.station_code,m.city_code,
        d.publ,d.edtn,d.billagcd,d.billdpcd,e.main_edtn,e.edtn_name,d.route_code,r.route_name,d.subroute_code,d.subsubroute_code
        union
        select d.comp_code ,d.unit_code ,m.agcd ,m.dpcd,m.ag_name,
        m.city_code,dbo.cir_get_city(d.comp_code,m.city_code) as CITY_NAME,
        m.station_code ,dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,'1') as "DROP_POINT_NAME",
        d.publ,e.main_edtn,dbo.cir_get_edtn_name(d.comp_code,e.main_edtn) MAIN_EDTN_NAME, 
        d.edtn ,e.edtn_name,d.billagcd,d.billdpcd,d.route_code,r.route_name,
        d.subroute_code,(select subrt_name from cir_sub_route_mast where comp_code=d.comp_code and unit=d.unit_code and
        route_code=d.route_code and subrt_code=d.subroute_code) as SUBRT_NAME, 
        d.subsubroute_code,(select sub_subrt_name from cir_sub_subroute_mast where comp_code=d.comp_code and unit=d.unit_code and
        route_code=d.route_code and sub_subrt_code=d.subroute_code and sub_subrt_code=d.subsubroute_code) as SUBSUBRT_NAME, 
        sum(d.sup_copy) as SUP_COPY,rr.rr_no as RR_NO,rr.rr_date ,rr.rr_amt
        from cir_agmast m,cir_dbksup d,cir_edtn_mast e,cir_route_mode_mast rm,cir_route_mast r,cir_rr_detail rr
        where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=r.comp_code and m.comp_code=rm.comp_code and 
        m.comp_code=rr.comp_code and m.comp_code=@pcompcode and 
        m.unit=d.unit_code and m.unit=r.unit and m.unit=rr.unit_code and m.agcd=d.agcd and m.agcd=rr.agcd and m.agcd=isnull(@pagcd,m.agcd) and 
        m.dpcd=d.dpcd and m.dpcd=rr.dpcd and m.dpcd=isnull(@pdpcd,m.dpcd) and
        d.publ=e.publ and d.publ=isnull(@ppublcode,d.publ) and 
        d.edtn=e.edtn and d.edtn=rr.edtn_code and d.edtn=isnull(@pedtncode,d.edtn) and e.main_edtn=isnull(@pmedtncode,e.main_edtn) and
        d.supdate = rr.supdate and d.supdate = @psupdate and d.route_code=r.route_code and r.route_mode=rm.mode_code and (r.route_mode=@proutemode or @proutemode is null) and
        (m.ag_type=@pagtype or @pagtype is null) and (m.ag_class=@pagclass or @pagclass is null)
        group by d.comp_code,d.unit_code,m.agcd,m.dpcd,m.ag_name,m.station_code,m.city_code,
        d.publ,d.edtn,d.billagcd,d.billdpcd,e.main_edtn,e.edtn_name,d.route_code,r.route_name,d.subroute_code,d.subsubroute_code,
        rr.rr_no,rr.rr_date,rr.rr_amt) x
        order by city_name,agency_name,publ,edtn;
    end
     else if @prr_flag='2' --for enter RR No.
        begin
        select d.comp_code as "COMP_CODE" ,d.unit_code as "UNIT_CODE",m.agcd as "AGCD",m.dpcd as "DPCD",m.ag_name as "AGENCY_NAME",
        m.city_code as "CITY_CODE",dbo.cir_get_city(d.comp_code,m.city_code) as "CITY_NAME",
        m.station_code as "DROP_POINT",dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,'1') as "DROP_POINT_NAME",
        d.publ as "PUBL",e.main_edtn as "MAIN_EDTN",dbo.cir_get_edtn_name(d.comp_code,e.main_edtn) as "MAIN_EDTN_NAME", 
        d.edtn as "EDTN" ,e.edtn_name as "EDTN_NAME",d.billagcd as "BILLAGCD",d.billdpcd as "BILLDPCD",d.route_code as "ROUTE_CODE",r.route_name as "ROUTE_NAME",
        d.subroute_code as "SUBROUTE_CODE",(select subrt_name from cir_sub_route_mast where comp_code=d.comp_code and unit=d.unit_code and
        route_code=d.route_code and subrt_code=d.subroute_code) as "SUBRT_NAME", 
        d.subsubroute_code as "SUBSUBROUTE_CODE",(select sub_subrt_name from cir_sub_subroute_mast where comp_code=d.comp_code and unit=d.unit_code and
        route_code=d.route_code and sub_subrt_code=d.subroute_code and sub_subrt_code=d.subsubroute_code) as "SUBSUBRT_NAME", 
        sum(d.sup_copy) as "SUP_COPY",rr.rr_no as "RR_NO",
        case @pdateformat
        WHEN 'mm/dd/yyyy' THEN CONVERT(varchar(10),rr.rr_date,101)
		WHEN 'dd/mm/yyyy' THEN CONVERT(varchar(10),rr.rr_date,103)
		WHEN 'yyyy/mm/dd' THEN CONVERT(varchar(10),rr.rr_date,111)  END as "RR_DATE",
		rr.rr_amt as "RR_AMT"
        from cir_agmast m,cir_dbksup d,cir_edtn_mast e,cir_route_mode_mast rm,cir_route_mast r,cir_rr_detail rr
        where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=r.comp_code and m.comp_code=rm.comp_code and 
        m.comp_code=rr.comp_code and m.comp_code=@pcompcode and 
        m.unit=d.unit_code and m.unit=r.unit and m.unit=rr.unit_code and m.agcd=d.agcd and m.agcd=rr.agcd and m.agcd=isnull(@pagcd,m.agcd) and 
        m.dpcd=d.dpcd and m.dpcd=rr.dpcd and m.dpcd=isnull(@pdpcd,m.dpcd) and
        d.publ=e.publ and d.publ=isnull(@ppublcode,d.publ) and 
        d.edtn=e.edtn and d.edtn=rr.edtn_code and d.edtn=isnull(@pedtncode,d.edtn) and e.main_edtn=isnull(@pmedtncode,e.main_edtn) and
        d.supdate = rr.supdate and d.supdate = @psupdate and d.route_code=r.route_code and r.route_mode=rm.mode_code and (r.route_mode=@proutemode or @proutemode is null) and
        (m.ag_type=@pagtype or @pagtype is null) and (m.ag_class=@pagclass or @pagclass is null)
        group by d.comp_code,d.unit_code,m.agcd,m.dpcd,m.ag_name,m.station_code,m.city_code,
        d.publ,d.edtn,d.billagcd,d.billdpcd,e.main_edtn,e.edtn_name,d.route_code,r.route_name,d.subroute_code,d.subsubroute_code,
        rr.rr_no,rr.rr_date,rr.rr_amt
        order by city_name,agency_name,publ,edtn;
     end
  
    else--for not enter RR No.
	begin
        select d.comp_code as "COMP_CODE" ,d.unit_code as "UNIT_CODE",m.agcd as "AGCD",m.dpcd as "DPCD",m.ag_name as "AGENCY_NAME",
        m.city_code as "CITY_CODE",dbo.cir_get_city(d.comp_code,m.city_code) as "CITY_NAME",
        m.station_code as "DROP_POINT",dbo.cir_get_drop_point_name(d.comp_code,d.unit_code,m.station_code,'1') as "DROP_POINT_NAME",
        d.publ as "PUBL",e.main_edtn as "MAIN_EDTN",dbo.cir_get_edtn_name(d.comp_code,e.main_edtn) as "MAIN_EDTN_NAME", 
        d.edtn as "EDTN" ,e.edtn_name as "EDTN_NAME",d.billagcd as "BILLAGCD",d.billdpcd as "BILLDPCD",d.route_code as "ROUTE_CODE",r.route_name as "ROUTE_NAME",
        d.subroute_code as "SUBROUTE_CODE",(select subrt_name from cir_sub_route_mast where comp_code=d.comp_code and unit=d.unit_code and
        route_code=d.route_code and subrt_code=d.subroute_code) as "SUBRT_NAME", 
        d.subsubroute_code as "SUBSUBROUTE_CODE",(select sub_subrt_name from cir_sub_subroute_mast where comp_code=d.comp_code and unit=d.unit_code and
        route_code=d.route_code and sub_subrt_code=d.subroute_code and sub_subrt_code=d.subsubroute_code) as "SUBSUBRT_NAME", 
        sum(d.sup_copy) as "SUP_COPY",null as "RR_NO",null as "RR_DATE",null as "RR_AMT"
        from cir_agmast m,cir_dbksup d,cir_edtn_mast e,cir_route_mode_mast rm,cir_route_mast r
        where m.comp_code=d.comp_code and m.comp_code=e.comp_code and m.comp_code=r.comp_code and m.comp_code=rm.comp_code and m.comp_code=@pcompcode and 
        m.unit=d.unit_code and m.unit=r.unit and m.agcd=d.agcd and m.agcd=isnull(@pagcd,m.agcd) and m.dpcd=d.dpcd and m.dpcd=isnull(@pdpcd,m.dpcd) and
        d.publ=e.publ and d.publ=isnull(@ppublcode,d.publ) and 
        d.edtn=e.edtn and d.edtn=isnull(@pedtncode,d.edtn) and e.main_edtn=isnull(@pmedtncode,e.main_edtn) and
        d.supdate = @psupdate and d.route_code=r.route_code and r.route_mode=rm.mode_code and (r.route_mode=@proutemode or @proutemode is null) and
        (m.ag_type=@pagtype or @pagtype is null) and (m.ag_class=@pagclass or @pagclass is null) and
        not exists (select 'x' from cir_rr_detail where comp_code=d.comp_code and unit_code=d.unit_code and edtn_code=d.edtn and 
        agcd=d.agcd and dpcd=d.dpcd and supdate=d.supdate)
        group by d.comp_code,d.unit_code,m.agcd,m.dpcd,m.ag_name,m.station_code,m.city_code,
        d.publ,d.edtn,d.billagcd,d.billdpcd,e.main_edtn,e.edtn_name,d.route_code,r.route_name,d.subroute_code,d.subsubroute_code
        order by city_name,agency_name,publ,edtn;    
    end
  
    select GETDATE() as "CUR_DATE"
End
   
 /////////////////////////////////////////////////////////////
CREATE  procedure cir_save_data_for_rr
    @pcompcode      as varchar(30),
    @punitcode      as varchar(30),
    @pedtncode      as varchar(30),
    @pagcd          as varchar(30),
    @pdpcd          as varchar(30),
    @psupdate         as datetime,
    @prrno          as varchar(30),
    @prr_date       as varchar(30),
    @prr_amt        as varchar(30),
    @puserid       as varchar(30),
    @pdateformat    as varchar(30),
    @pextra1       as varchar(30),
    @pextra2       as varchar(30),
    @pextra3        as varchar(30),
    @pextra4         as varchar(30),
    @pextra5        as varchar(30)
   
  As
    

 declare @v_rec_count numeric(10);
Begin
     
    select @v_rec_count=count(*) from cir_rr_detail where comp_code=@pcompcode and unit_code=@punitcode and 
        edtn_code=@pedtncode and agcd=@pagcd and dpcd=@pdpcd and supdate= @psupdate ;
        
    if isnull(@v_rec_count,0)=0 begin
    
        insert into cir_rr_detail(comp_code,unit_code,edtn_code,agcd,dpcd,supdate,rr_no,rr_date,rr_amt,
                            created_by,created_dt)
        values(@pcompcode,@punitcode,@pedtncode,@pagcd,@pdpcd, @psupdate ,@prrno, @psupdate ,@prr_amt,@puserid,GETDATE());

        end
      
        select 'I' as "MSG",GETDATE() as "CUR_DATE"
   
    
    begin

        update cir_rr_detail set rr_no =@prrno,rr_date=@psupdate,rr_amt=@prr_amt,updated_by=@puserid,updated_dt=getdate()
            where comp_code=@pcompcode and unit_code=@punitcode and edtn_code=@pedtncode and agcd=@pagcd and dpcd=@pdpcd and 
            supdate=@psupdate ;
       end
        select 'U' as "MSG",GETDATE() as "CUR_DATE" 
         
   end
        

///////////////////////////////////////end issue num:-4111/////////////////////////////


//////////////////////////////////////////anuj Supply Posting ////////////////////////////////////

USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[CIR_SUPPLY_POST_FOR_NEXT_DAY_cir_supply_posting_p]    Script Date: 06/01/2012 17:42:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


                                                                     
                                                                     
                                                                     
                                             
ALTER PROCEDURE [dbo].[CIR_SUPPLY_POST_FOR_NEXT_DAY_cir_supply_posting_p]
	@pcomp_code			VARCHAR(20) ,
	@punit_code			VARCHAR(20) ,
	@ppubl_code         VARCHAR(20) ,
	@pedtn_code         VARCHAR(20) ,
	@pagcd				VARCHAR(20) ,
	@pdpcd				VARCHAR(20) ,
	@puserid			VARCHAR(20) ,
	@psup_date			varchar(500) ,
	--@psup_date1       VARCHAR(20),
	@psup_ty			VARCHAR(20) ,
	@pdateformat		VARCHAR(20) ,
	@pextra1			VARCHAR(20) ,
	@pextra2			VARCHAR(20), --issue date
	@pper_copy_wt		numeric(15,3)
AS 
DECLARE  @vsup_date   DATETIME
DECLARE  @vh_date1    DATETIME
DECLARE  @vh_name1    VARCHAR(500)

DECLARE cur_holiday cursor  LOCAL FOR 
		select h_date,h_name from cir_holiday_mast
			where comp_code=@pcomp_code and unit=@punit_code and 
				h_publ=@ppubl_code and h_date=@vsup_date and 
				ISNULL(freeze_flag,'N')='N';

DECLARE @vedtn1			VARCHAR(500)
DECLARE @vedtn_name1    VARCHAR(500)

DECLARE	@v_spl_rate    NUMERIC(10,4)
SET @v_spl_rate = 0

   
/*************        DECLARE VARIABLES FOR cur_supply  CURSOR        *****************/

DECLARE  @vunit1				VARCHAR(500)
DECLARE  @vagcd1				VARCHAR(500)
DECLARE  @vdpcd1				VARCHAR(500)
DECLARE  @vpubl1				VARCHAR(500)
DECLARE  @vedtn11				VARCHAR(500)
DECLARE  @vsupply_type_code1	VARCHAR(500)
DECLARE  @vbase_supply1			numeric(7,0)
DECLARE  @vsupply_sun1			numeric(7,0)
DECLARE  @vsupply_mon1			numeric(7,0)
DECLARE  @vsupply_tue1			numeric(7,0)
DECLARE  @vsupply_wed1			numeric(7,0)
DECLARE  @vsupply_thu1			numeric(7,0)
DECLARE  @vsupply_fri1			numeric(7,0)
DECLARE  @vsupply_sat1			numeric(7,0)
DECLARE  @vsupply_spl11			numeric(7,0)
DECLARE  @vsupply_spl21			numeric(7,0)
DECLARE  @vag_type1				VARCHAR(500)
DECLARE  @vsupply_start_dt1		VARCHAR(500)
DECLARE  @vsuspend_date1		VARCHAR(500)
DECLARE  @vpacket_size1			VARCHAR(500)
DECLARE  @vcomm_code1			VARCHAR(500)
DECLARE  @vcomm_flag1			VARCHAR(500)
DECLARE  @vbill_agcd1			VARCHAR(500)
DECLARE  @vroute_code1			VARCHAR(500)
DECLARE  @vsubroute_code1		VARCHAR(500)
DECLARE  @vsub_subroute_code1	VARCHAR(500)
DECLARE  @vsurch_cd1			VARCHAR(500)
DECLARE  @vwaste_catg_code		VARCHAR(500)

/************add by prachi***/
DECLARE  @vsp_supply_mon1 VARCHAR(500)
DECLARE  @vsp_supply_tue1 VARCHAR(500)
DECLARE  @vsp_supply_wed1 VARCHAR(500)
DECLARE  @vsp_supply_thu1 VARCHAR(500)
DECLARE  @vsp_supply_fri1 VARCHAR(500)
DECLARE  @vsp_supply_sat1 VARCHAR(500)
DECLARE  @vsp_supply_sun1 VARCHAR(500)
DECLARE  @vsp_supply_mon2 VARCHAR(500)
DECLARE  @vsp_supply_tue2 VARCHAR(500)
DECLARE  @vsp_supply_wed2 VARCHAR(500)
DECLARE  @vsp_supply_thu2 VARCHAR(500)
DECLARE  @vsp_supply_fri2 VARCHAR(500)
DECLARE  @vsp_supply_sat2 VARCHAR(500)
DECLARE  @vsp_supply_sun2 VARCHAR(500)
/************add by prachi***/
DECLARE  @vbill_dpcd1			VARCHAR(500)
DECLARE @v_supply_copy_dt		varchar(20)
/*****************************************************************************************/

set @psup_date	=dbo.convert_user_date('/',@psup_date,@pdateformat)
set @pextra2	=dbo.convert_user_date('/',@pextra2,@pdateformat)

if @pextra1 is not null begin
	set @v_supply_copy_dt=dbo.convert_user_date('/',@pextra1,@pdateformat)
end


DECLARE cur_surcharge cursor LOCAL FOR 
            select * from cir_surcharge_mast 
            where comp_code  =@pcomp_code and 
                  unit       =@punit_code and
                  publ       =@ppubl_code and
                  edtn       =@vedtn1 and
                  surch_cd   =@vsurch_cd1 and 
                  valid_from = (select max(valid_from) from cir_surcharge_mast 
                                            where comp_code  =@pcomp_code and 
                                                  unit       =@punit_code and
                                                  publ       =@ppubl_code and
                                                  edtn       =@vedtn1 and
                                                  surch_cd   =@vsurch_cd1 and
                                                  valid_from<=@psup_date);
DECLARE	@v_sup_copy			NUMERIC(7)
DECLARE @v_edtn_rate		NUMERIC(10,4)
DECLARE @vreccnt			NUMERIC(5,0)
DECLARE @v_old_sup_copy		NUMERIC(7)

   
/*********************       SEND CONVERTED DATE FROM SQL CLASS     ************/
-- vsup_date:=to_date(psup_date,''''||pdateformat||'''');
SET  @vsup_date = @psup_date

/*******************************************************************************/

open cur_holiday;
fetch NEXT FROM cur_holiday into @vh_date1 , @vh_name1
close cur_holiday
    
if (@vsup_date=@vh_date1) BEGIN
	PRINT('Please Check The  Holiday Today Is  '+' '+   @vh_name1)
	PRINT('Please Check The  Holiday Today Is  '+' '+   @vh_name1)
end 


if ((@vsup_date<>@vh_date1) or @vh_date1 is null) BEGIN

	DECLARE cir_edtn_cur cursor LOCAL FOR 
          select distinct edtn,edtn_name from cir_edtn_mast 
			where comp_code=@pcomp_code and publ = @ppubl_code and
		     ((ISNULL(main_edtn,edtn) = @pedtn_code) or (@pedtn_code is null) or (@pedtn_code='')) and ISNULL(freeze_flag,'N')='N'
  
		open cir_edtn_cur
		fetch NEXT FROM cir_edtn_cur into @vedtn1 , @vedtn_name1
		WHILE @@FETCH_STATUS = 0 BEGIN
              
        delete from cir_dbksup where comp_code=@pcomp_code and unit_code=@punit_code and
			publ=@ppubl_code and edtn=@vedtn1 and supdate=@vsup_date and 
			(agcd=@pagcd or @pagcd is null OR @pagcd='') and (dpcd=@pdpcd or @pdpcd is null OR @pdpcd='')


		/*****************************************************************************************/     
					        
		DECLARE cur_spl_rate cursor LOCAL FOR
			select spl_day_rate from cir_special_rate_mast
			where comp_code=@pcomp_code and unit=@punit_code and
				publ=@ppubl_code and edtn=@vedtn1 and spl_day_date=@vsup_date;


		open cur_spl_rate
			fetch NEXT FROM cur_spl_rate into @v_spl_rate;
		close cur_spl_rate;
        
        deallocate cur_spl_rate
        
  		if (ISNULL(@v_spl_rate,0)=0 )BEGIN

			 DECLARE  @vsun_rate1   FLOAT
			 DECLARE  @vmon_rate1   FLOAT
			 DECLARE  @vtue_rate1   FLOAT
			 DECLARE  @vwed_rate1   FLOAT
			 DECLARE  @vthu_rate1   FLOAT
			 DECLARE  @vfri_rate1   FLOAT
			 DECLARE  @vsat_rate1   FLOAT
					 

			DECLARE cur_rate cursor LOCAL FOR 
				select sun_rate,mon_rate,tue_rate,wed_rate,thu_rate,fri_rate,sat_rate from cir_rate_mast
				where comp_code=@pcomp_code and unit=@punit_code and publ=@ppubl_code and edtn=@vedtn1 and
				valid_from=(select max(valid_from) from cir_rate_mast where comp_code=@pcomp_code and
				unit=@punit_code and publ=@ppubl_code and edtn=@vedtn1 and valid_from<=@vsup_date and 
				ISNULL(freeze_flag,'N')='N');
			
			open cur_rate;
			fetch NEXT FROM cur_rate into @vsun_rate1, @vmon_rate1, @vtue_rate1, @vwed_rate1, @vthu_rate1, @vfri_rate1, @vsat_rate1
			close cur_rate;
					
			deallocate  cur_rate;
                  	
			DECLARE @SUP_DAY11    varchar(20)
			SET @SUP_DAY11 = CONVERT(VARCHAR(20) , DATENAME(WEEKDAY, @psup_date),20)

			if (@SUP_DAY11 = 'Sunday' )begin          
				set  @v_edtn_rate      =    @vsun_rate1 ;
            end

			else if (@SUP_DAY11 = 'Monday') begin
				set  @v_edtn_rate      =    @vmon_rate1;
			end
			else if (@SUP_DAY11 = 'Tuesday')begin 
				set  @v_edtn_rate      =    @vtue_rate1;
			end
			else if (@SUP_DAY11 = 'Wednesday') begin
				set  @v_edtn_rate      =    @vwed_rate1;
            end
			else if (@SUP_DAY11 = 'Thursday')begin
print('prachi')
print(@vthu_rate1)
				set  @v_edtn_rate      =    @vthu_rate1;
			end
			else if (@SUP_DAY11 = 'Friday' )begin
				set  @v_edtn_rate      =    @vfri_rate1;
			end
			else if (@SUP_DAY11 = 'Saturday')begin
				set  @v_edtn_rate      =    @vsat_rate1;
			end
			else begin
				set @v_edtn_rate        =    0
			end 
		end
		else begin
			set @v_edtn_rate  =  @v_spl_rate;
		end 
		
		if (@v_edtn_rate=0)begin
			print('Please Check,The Rate Today Is not Define for '+' '+  @vedtn_name1)
		end 

		DECLARE  cur_supply cursor LOCAL FOR 
		select a.unit unit,a.agcd agcd,a.dpcd dpcd,a.publ publ,a.edtn edtn,a.supply_type_code supply_type_code,a.base_supply base_supply,a.supply_sun supply_sun,
		a.supply_mon supply_mon,a.supply_tue supply_tue,a.supply_wed supply_wed,
		a.supply_thu supply_thu,a.supply_fri supply_fri,a.supply_sat supply_sat,a.supply_spl1 supply_spl1,
		a.supply_spl2 supply_spl2
/************add by prachi***/
, a.sp_supply_mon1 sp_supply_mon1,a.sp_supply_tue1 sp_supply_tue1,a.sp_supply_wed1 sp_supply_wed1,a.sp_supply_thu1 sp_supply_thu1,
a.sp_supply_fri1 sp_supply_fri1,a.sp_supply_sat1 sp_supply_sat1,a.sp_supply_sun1 sp_supply_sun1,a.sp_supply_mon2 sp_supply_mon2,
a.sp_supply_tue2 sp_supply_tue2,a.sp_supply_wed2 sp_supply_wed2,a.sp_supply_thu2 sp_supply_thu2,a.sp_supply_fri2 sp_supply_fri2,
a.sp_supply_sat2 sp_supply_sat2,a.sp_supply_sun2 sp_supply_sun2
/************add by prachi***/


, b.ag_type ag_type,b.supply_start_dt    supply_start_dt,b.suspend_date suspend_date, ISNULL(a.packet_size,0) packet_size,
		a.comm_code comm_code,a.comm_flag comm_flag,b.bill_agcd bill_agcd,b.bill_dpcd bill_dpcd,
		a.route_code route_code,a.subroute_code subroute_code,a.sub_subroute_code sub_subroute_code,
		a.surch_cd surch_cd,a.waste_catg_code waste_catg_code
		from cir_supply a,cir_agmast b
		where a.comp_code=b.comp_code and a.unit=b.unit and 
				  a.agcd=b.agcd and a.dpcd=b.dpcd and (a.agcd=@pagcd or @pagcd is null or @pagcd='') 
				  and (a.dpcd=@pdpcd or @pdpcd is null OR @pdpcd='') and 
				  a.unit=@punit_code and (a.publ=@ppubl_code) and
				  /*ISNULL(base_supply,0)>0 and*/
				  a.edtn=@vedtn1 and
				  ISNULL(a.supply_flag,'N')='Y' and ISNULL(b.suspend,'N')='N'
		order by a.agcd,a.dpcd,a.edtn,a.supply_type_code;


		 open cur_supply 

		 fetch next from cur_supply into @vunit1 ,@vagcd1 ,@vdpcd1 ,@vpubl1 ,@vedtn11 ,@vsupply_type_code1,@vbase_supply1,
		 @vsupply_sun1 ,@vsupply_mon1 ,@vsupply_tue1 ,@vsupply_wed1 ,@vsupply_thu1 ,@vsupply_fri1,@vsupply_sat1 ,@vsupply_spl11,
		 @vsupply_spl21,

/************add by prachi***/
 @vsp_supply_mon1,
 @vsp_supply_tue1,
 @vsp_supply_wed1,
 @vsp_supply_thu1,
 @vsp_supply_fri1,
 @vsp_supply_sat1,
 @vsp_supply_sun1,
 @vsp_supply_mon2,
 @vsp_supply_tue2,
 @vsp_supply_wed2,
 @vsp_supply_thu2,
 @vsp_supply_fri2,
 @vsp_supply_sat2,
 @vsp_supply_sun2,
/************add by prachi***/

@vag_type1 ,@vsupply_start_dt1, @vsuspend_date1 ,@vpacket_size1 ,@vcomm_code1 ,@vcomm_flag1 ,@vbill_agcd1 ,@vbill_dpcd1,
		 @vroute_code1 ,@vsubroute_code1 ,@vsub_subroute_code1 ,@vsurch_cd1 ,@vwaste_catg_code
	       
         
		SET @vsup_date= CONVERT(VARCHAR(10),@vsup_date,10)
                 
		WHILE @@FETCH_STATUS = 0 begin
			
			DECLARE @SUP_DAY112    varchar(20)
 
            SET  @SUP_DAY112 = CONVERT(VARCHAR(20) , DATENAME(WEEKDAY, @vsup_date),20)
			
			if (@vsup_date>=@vsupply_start_dt1 or @vsupply_start_dt1 is null) and (@vsup_date<=@vsuspend_date1 or @vsuspend_date1 is null) begin 
				if (@psup_ty='R' and @SUP_DAY112 = 'Sunday' ) begin   
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_sun1,0)>0  begin
					
						set @v_sup_copy   =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_sun1,0);
													    
                    end
					else begin
						set @v_sup_copy   = 0;
					end 
				end
				else if (@psup_ty='R' and @SUP_DAY112 = 'Monday') begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_mon1,0)>0 begin
					
						set @v_sup_copy    =     ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_mon1,0);
					
					end
					else begin
						set @v_sup_copy    = 0
					end
				end
				else if (@psup_ty='R' and @SUP_DAY112 = 'Tuesday')begin  
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_tue1,0)>0 begin
						set  @v_sup_copy  =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_tue1,0);
					end
					else begin
						set @v_sup_copy       = 0;
                    end 
				end
				else if (@psup_ty='R' and @SUP_DAY112 = 'Wednesday') begin   
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_wed1,0)>0 begin 
						
						set @v_sup_copy =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_wed1,0)
						
	                end
					else begin
						set @v_sup_copy  = 0
					end 
				end 
				else if (@psup_ty='R' and @SUP_DAY112 = 'Thursday')begin   
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_thu1,0)>0 begin
						set @v_sup_copy  = ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_thu1,0)
					end
                    else begin
						set @v_sup_copy  = 0
                    end 
				end   
				else if (@psup_ty='R' and @SUP_DAY112 = 'Friday' )begin   
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_fri1,0)>0 begin
				
						set @v_sup_copy   =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_fri1,0);
                
                    end                
					else
						set @v_sup_copy   = 0
                    end 
				else if (@psup_ty='R' and @SUP_DAY112 = 'Saturday') begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_sat1,0)>0 begin
						set @v_sup_copy   =  ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_sat1,0);
                    end
					else begin
						set @v_sup_copy   = 0
					end
				end 
				else if @psup_ty='S1' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_spl11,0)>0 begin
						
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_spl11,0);
                                                              
					end
					else begin
						set @v_sup_copy   = 0
                                                               													end
					end 
				else if @psup_ty='S2' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_spl21,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsupply_spl21,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
				end
/***********************add by prachi****************************/

else if @psup_ty='SM1' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_mon1,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_mon1,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end
else if @psup_ty='ST1' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_tue1,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_tue1,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end
else if @psup_ty='SW1' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_wed1,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_wed1,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end
else if @psup_ty='STH1' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_thu1,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_thu1,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 

end
else if @psup_ty='SF1' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_fri1,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_fri1,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end
else if @psup_ty='SST1' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_sat1,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_sat1,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end
else if @psup_ty='SSN1' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_sun1,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_sun1,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end
else if @psup_ty='SM2' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_mon2,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_mon2,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end
else if @psup_ty='ST2' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_tue2,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_tue2,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end
else if @psup_ty='SW2' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_wed2,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_wed2,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 

end
else if @psup_ty='STH2' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_thu2,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_thu2,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end
else if @psup_ty='SF2' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_fri2,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_fri2,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 

end
else if @psup_ty='SST2' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_sat2,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_sat2,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 

end
else if @psup_ty='SSN2' begin    
					if ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_sun2,0)>0 begin
					
						set @v_sup_copy   =     ISNULL(@vbase_supply1,0)+ISNULL(@vsp_supply_sun2,0);
                    
                    end
                    else begin
						set @v_sup_copy   = 0
                    end 
end

/*****************add by prachi************************************************/
		
			--------change for supply copy--------
					           
            if @psup_ty='R' and @v_supply_copy_dt is not null begin
                set @v_old_sup_copy=0;
                select @v_old_sup_copy = sum(sup_copy) from cir_dbksup where comp_code=@pcomp_code and unit_code=@punit_code and publ=@ppubl_code and edtn=@vedtn11 and
                    agcd=@vagcd1 and dpcd=@vdpcd1 and supdate=@v_supply_copy_dt and sup_type_code=@vsupply_type_code1;
   
            end

            if isnull(@v_old_sup_copy,0)>0 begin
                set @v_sup_copy=@v_old_sup_copy;
            end
           
            --------change for supply copy--------
					            
			if ISNULL(@v_sup_copy,0)>0 Begin
				print('22tytr')
				print( @v_sup_copy)
				
				insert into cir_dbksup (comp_code,unit_code,publ,edtn,agcd,dpcd,supdate,sup_type_code,sup_copy,agency_ty_code,
										agency_pkt_size,comm_code,comm_fix_auto_spl,sup_rate,billagcd,billdpcd,
										route_code,subroute_code,subsubroute_code,userid,surch_cd,issue_date,per_copy_weight,waste_catg_code)
								values (@pcomp_code,@punit_code,@ppubl_code,@vedtn11,@vagcd1,@vdpcd1,@vsup_date,
									 @vsupply_type_code1,
									 @v_sup_copy,@vag_type1,@vpacket_size1,@vcomm_code1,@vcomm_flag1,
									 @v_edtn_rate,@vbill_agcd1,@vbill_dpcd1,@vroute_code1,
									 @vsubroute_code1,@vsub_subroute_code1,@puserid,@vsurch_cd1,@pextra2,@pper_copy_wt,isnull(@vwaste_catg_code,0));

				select @vreccnt	= count(*)  from cir_dbksup where comp_code=@pcomp_code and unit_code=@punit_code 
				and publ=@ppubl_code and edtn=@vedtn1 and supdate=@vsup_date and (agcd=@pagcd or @pagcd is null) and (dpcd=@pdpcd or @pdpcd is null);
					               
			End;                     
		end 
    

         fetch next from cur_supply into @vunit1 ,@vagcd1 ,@vdpcd1 ,@vpubl1 ,@vedtn11 ,@vsupply_type_code1,@vbase_supply1,
		 @vsupply_sun1 ,@vsupply_mon1 ,@vsupply_tue1 ,@vsupply_wed1 ,@vsupply_thu1 ,@vsupply_fri1,@vsupply_sat1 ,@vsupply_spl11,
		 @vsupply_spl21, 
/************add by prachi***/
 @vsp_supply_mon1,
 @vsp_supply_tue1,
 @vsp_supply_wed1,
 @vsp_supply_thu1,
 @vsp_supply_fri1,
 @vsp_supply_sat1,
 @vsp_supply_sun1,
 @vsp_supply_mon2,
 @vsp_supply_tue2,
 @vsp_supply_wed2,
 @vsp_supply_thu2,
 @vsp_supply_fri2,
 @vsp_supply_sat2,
 @vsp_supply_sun2,
/************add by prachi***/
@vag_type1 ,@vsupply_start_dt1, @vsuspend_date1 ,@vpacket_size1 ,@vcomm_code1 ,@vcomm_flag1 ,@vbill_agcd1 ,@vbill_dpcd1,
		 @vroute_code1 ,@vsubroute_code1 ,@vsub_subroute_code1 ,@vsurch_cd1,@vwaste_catg_code 

	end 
	close cur_supply;
	deallocate cur_supply
	   
	set @v_edtn_rate = 0;
	set @v_spl_rate  =0;
	set @vedtn1=NULL;

fetch NEXT FROM cir_edtn_cur into @vedtn1 , @vedtn_name1
end
close cir_edtn_cur
deallocate  cir_edtn_cur  
end 
  
    select case b.bill_pay
              when 'Y' then 'PAID'
              when 'N' then 'UNPAID'
              else  'UNPAID' 
              end  BILL_PAY,
   sum(a.sup_copy) SUP_COPY
    from cir_dbksup a,cir_supply_type_mast b,CIR_EDTN_MAST e
    where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=e.comp_code and  a.unit_code=@punit_code and 
          a.publ=@ppubl_code and a.publ = e.publ and a.edtn= e.edtn and 
          (ISNULL(e.main_edtn,e.edtn) = @pedtn_code or @pedtn_code is null OR  @pedtn_code='') and 
          a.sup_type_code=b.sup_ty_code and a.supdate=@vsup_date and 
          (a.agcd=@pagcd or @pagcd is null OR @pagcd='') and (a.dpcd=@pdpcd or @pdpcd is null or @pdpcd ='')
    group by b.bill_pay
    order by b.bill_pay desc
  
deallocate cur_holiday
deallocate cur_surcharge 


//////////////////////////////////////////////end//////////////////////////////////////////////////////////////////

///////////////////////add by Deepika 04/06/2012 sent by Ashok sahani sir/////////////////////////////////////////


create PROCEDURE [dbo].[cir_rep_net_monthly_sale_verification]
	@pcomp_code         as varchar(20),
	@punit_code         as varchar(20),
	@ppubl              as varchar(20),
	@pubtype            as varchar(50),-- for publication type @pubtype
	@pmainedtn          as varchar(20),
	@pedtn              as varchar(20),
	@pfromdate          as datetime,
	@ptilldate          as datetime,
	@pagency_type       as varchar(20),
	@pagency_class      as varchar(20),
	@pstatecode         as varchar(20),
	@pdistcode          as varchar(20),
	@ptaluka            as varchar(20),
	@pbranch            as varchar(20),
	@pagcd              as varchar(20),
	@pdpcd              as varchar(20),	
	@pbreak_on          as varchar(20),--Region R/State S/District D/Branch B / ZONE Z/ routewise O/ center C /PUBL  P / EDITION E
	@preturn_based      as varchar(20),--it is use for return date or supply date(R/S)		
	@pdateformat        as varchar(20),
	@pcommper           as numeric(14,2), -- for commper  
	@pcomslab           as varchar(50), -- for commision less than or greater than
	@psuptype           as varchar(50),-- for supply type
	@pcopy_amt          as varchar(10),-- for based on copy or amt / C for Copy and A for AMOUNT	
	@pextra1            as varchar(50),
	@pextra2            as varchar(50),
	@pextra3            as varchar(50),		
	@pextra5            as varchar(50),
	@pextra6            as varchar(50),
	@pextra7            as varchar(50),
	@pextra8            as varchar(50),
	@pextra9            as varchar(50),
	@pextra10            as varchar(50)
AS 
		
	DECLARE @v_hdays	AS	NUMERIC(5) 
	DECLARE @v_avg_sale AS  NUMERIC(10) 
	DECLARE @v_reg_code AS  varchar(200)
	DECLARE @v_zone_code varchar(200);
	DECLARE @v_publ_code varchar(200);
	DECLARE @v_route_code varchar(200);

	DECLARE @v1_comp_code	as varchar(50)
	DECLARE @v1_unit_code			as varchar(50)
    DECLARE @v1_branch_code			as varchar(50)
    DECLARE @v1_branch_name			as varchar(100)
    DECLARE @v1_publ				as varchar(50)
    DECLARE @v1_publ_name			as varchar(100)
    DECLARE @v1_main_edtn			as varchar(50)
    DECLARE @v1_main_edtn_name		as varchar(100)
    DECLARE @v1_edtn				as varchar(50)
    DECLARE @v1_edtn_name			as varchar(100)
    DECLARE @v1_copy_rate			as numeric(12,2)
    DECLARE @v1_agcd				as varchar(50)
    DECLARE @v1_dpcd				as varchar(50)
    DECLARE @v1_agname				as varchar(500)
    DECLARE @v1_agname_oth_lang		as varchar(500)
    DECLARE @v1_state_code			as varchar(50)
    DECLARE @v1_state_name			as varchar(500)
    DECLARE @v1_dist_code			as varchar(50)
    DECLARE @v1_dist_name			as varchar(100)
    DECLARE @v1_city_code			as varchar(50)
    DECLARE @v1_city_name			as varchar(150)
    DECLARE @v1_tehsil_taluka		as varchar(50)
    DECLARE @v1_taluka_name			as varchar(150)
    DECLARE @v1_route_code   		as varchar(50)
    DECLARE @v1_route_name			as varchar(150)
    DECLARE @v1_supply_copy			as int
    DECLARE @v1_return_copy			as int
    DECLARE @v1_net_sale_copy		as int
    DECLARE @v1_no_of_days			as int
    DECLARE @v1_unit_name			as varchar(150)
    DECLARE @v1_COM_CAT  			as varchar(150)
    declare @v1_supdate				as datetime


CREATE TABLE #CIR_DBKSUP_temp
(
	COMP_CODE varchar(8) NOT NULL,
	UNIT_CODE varchar(8) NOT NULL,
	PUBL varchar(3) NOT NULL,
	EDTN varchar(3) NOT NULL,
	AGCD varchar(8) NOT NULL,
	DPCD varchar(8) NOT NULL,
	SUPDATE datetime NOT NULL,
	SUP_TYPE_CODE varchar(5) NOT NULL,
	SUP_COPY numeric(10, 0) NULL,
	AGENCY_TY_CODE varchar(8) NULL,
	AGENCY_PKT_SIZE numeric(7, 0) NULL,
	COMM_CODE varchar(6) NULL,
	COMM_FIX_AUTO_SPL varchar(1) NULL,
	SUP_RATE numeric(10, 4) NULL,
	BILLAGCD varchar(8) NULL,
	BILLDPCD varchar(8) NULL,
	ROUTE_CODE varchar(5) NULL,
	SUBROUTE_CODE varchar(5) NULL,
	SUBSUBROUTE_CODE varchar(5) NULL,
	USERID varchar(10) NULL,
	CREATION_DATE datetime NULL,
	SURCH_CD varchar(5) NULL,
	ISSUE_DATE datetime NULL,
	RETURN_COPY_SALE varchar(1) NULL,
	FINAL_SUPPLY_FLAG varchar(1) NULL,
	UPDATED_BY varchar(30) NULL,
	UPDATED_DT datetime NULL,
	PER_COPY_WEIGHT numeric(15, 3) NULL,
	WASTE_CATG_CODE numeric(5, 0) NULL
)

	
	if @pcomslab ='G' 
	begin
		insert into #CIR_DBKSUP_temp(
		COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE
		)
		select COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE 
		from cir_dbksup b
		where b.comp_code =@pcomp_code 
		and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') 
		and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') 
		and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') 
		and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') 
		and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='')
		and b.supdate >= @pfromdate and b.supdate <=@ptilldate
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='') 
		and ( cast(substring(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar),2,len(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar)) ) as numeric) > cast(@pcommper as numeric) or cast(@pcommper as numeric) is null or cast(@pcommper as numeric) = '0')
	end
	else
	begin
		insert into #CIR_DBKSUP_temp(
		COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE
		)
		select COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE 
		from cir_dbksup b
		where b.comp_code =@pcomp_code 
		and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') 
		and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') 
		and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') 
		and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') 
		and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='')
		and b.supdate >= @pfromdate and b.supdate <=@ptilldate
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='') 
		and ( cast(substring(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar),2,len(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar)) ) as numeric) < cast(@pcommper as numeric) or cast(@pcommper as numeric) is null or cast(@pcommper as numeric) = '0')
	end
	

	
	if @pcopy_amt ='C' begin	
		DECLARE c1 cursor LOCAL FOR 
		select u.comp_code,u.unit_code,
		u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
		u.publ,u.publ_name,u.main_edtn,
		dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
		u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
		u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
		u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,'1',null,null,null) dist_name,
		u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,'1',null,null,null) city_name,
		u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,'1',null,null,null) taluka_name,
		u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
		sum(supply_copy) supply_copy,sum(return_copy) return_copy,
		sum(supply_copy)-sum(return_copy) net_sale_copy,sum(no_of_days) no_of_days
		,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
		,u.MON		
		from (
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang
		,a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
		sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, count(distinct supdate) no_of_days		
		,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3)) as MON
		from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p		
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
		b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
		b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pubtype or @pubtype is null or @pubtype ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,b.route_code,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3))
		union all
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
		0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
		,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3)) as MON
		from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
		b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
		b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
		b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
		(e.main_edtn=@pmainedtn or @pmainedtn is null)
		and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pubtype or @pubtype is null or @pubtype ='')
		and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,d.route_code,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3))) u
		where (u.supply_copy+u.return_copy)>0
		group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
		u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code
		,u.country_code,u.MON; 
	end
	else
	begin
		DECLARE c1 cursor LOCAL FOR 
		select u.comp_code,u.unit_code,
		u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
		u.publ,u.publ_name,u.main_edtn,
		dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
		u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
		u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
		u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,'1',null,null,null) dist_name,
		u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,'1',null,null,null) city_name,
		u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,'1',null,null,null) taluka_name,
		u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
		(sum(supply_copy)* u.copy_rate) supply_copy,(sum(return_copy)* u.copy_rate) return_copy,
		(sum(supply_copy)* u.copy_rate)-(sum(return_copy)* u.copy_rate) net_sale_copy,sum(no_of_days) no_of_days
		,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
		,u.MON as MON
		from (
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
		sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, count(distinct supdate) no_of_days		
		,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3)) as MON
		from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
		b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
		b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pubtype or @pubtype is null or @pubtype ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,b.route_code,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3))
		union all
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
		0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
		,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3)) as MON
		from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
		b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
		b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
		b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
		(e.main_edtn=@pmainedtn or @pmainedtn is null)
		and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pubtype or @pubtype is null or @pubtype ='')
		and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,d.route_code ,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3))) u
		where (u.supply_copy+u.return_copy)>0
		group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
		u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.MON; 
	end
	
	CREATE TABLE #CIR_TEMP_BILL_COLLECTION
	( COMP_CODE        VARCHAR(100),
	  UNIT_CODE        VARCHAR(100),
	  BILLNO           VARCHAR(200),
	  BILLDT           DATETIME,
	  PUBL_CODE        VARCHAR(100),
	  AGCD             VARCHAR(100),
	  DPCD             VARCHAR(100),
	  SUPPLY_COPY      NUMERIC(10)                   DEFAULT 0,
	  GROSS_AMT        NUMERIC(15,2)                 DEFAULT 0,
	  COMM_AMT         NUMERIC(15,2)                 DEFAULT 0,
	  SUR_AMT          NUMERIC(15,2)                 DEFAULT 0,
	  RETURN_COPY      NUMERIC(10)                   DEFAULT 0,
	  RETURN_AMT       NUMERIC(15,2)                 DEFAULT 0,
	  DN_AMT           NUMERIC(15,2)                 DEFAULT 0,
	  CN_AMT           NUMERIC(15,2)                 DEFAULT 0,
	  REC_AMT          NUMERIC(15,2)                 DEFAULT 0,
	  PREV_BAL         NUMERIC(15,2)                 DEFAULT 0,
	  CUR_SESSIONID    NUMERIC,
	  AGNAME           VARCHAR(200),
	  AGNAME_OTH_LANG  VARCHAR(250),
	  CITY_CODE        VARCHAR(200),
	  TALUKA_CODE      VARCHAR(200),
	  DIST_CODE        VARCHAR(200),
	  STATE_CODE       VARCHAR(200),
	  REGION          VARCHAR(500),
	  RET_COMM_AMT     NUMERIC(15,2),
	  BILL_SEC_AMT     NUMERIC(15,2),
	  SEC_OPBAL        NUMERIC(15,2),
	  zone_code        VARCHAR(200),
	  region_code        VARCHAR(200),
	  pro_type        VARCHAR(200),
	  route_code      VARCHAR(200),
	  copy_rate			numeric(14,2),
	  no_of_days		numeric(10),
	  unit_name			varchar(150),
	  COM_CAT           varchar(150),
	  supdate           datetime
	  )
		
		
		OPEN c1 
        fetch NEXT FROM c1 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_no_of_days,@v1_unit_name,@v1_COM_CAT
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN 
		
             
   
			If isnull(@v1_no_of_days,0)>0 Begin
                set @v_avg_sale=round(isnull(@v1_net_sale_copy,0)/(isnull(@v1_no_of_days,0)),0)
            End    
            Else Begin
                set @v_avg_sale=isnull(@v1_net_sale_copy,0)
            End

            select distinct @v_reg_code=region_code,@v_zone_code=zone_code from cir_city_mast where comp_code=@v1_comp_code and city_code=@v1_city_code            
            if(@v_reg_code='')
            begin
				set @v_reg_code=null
            end
           
            if(@v_zone_code='')
            begin
				set @v_zone_code=null
            end
            
            select distinct @v_publ_code=pro_type from cir_publ_mast where comp_code=@v1_comp_code and publ=@v1_publ;
            if(@v_publ_code='')
            begin
				set @v_publ_code=null
            end
            
            select distinct @v1_COM_CAT=COMM_CATG_DESC from CIR_COMM_CATG_MAST where comp_code=@v1_comp_code and COMM_CATG_CODE=@v1_COM_CAT            
            if(@v1_COM_CAT='')
            begin
				set @v1_COM_CAT=null
            end
            
            
            set @v_reg_code=dbo.cir_get_region_name(@v1_comp_code,@v_reg_code)
            set @v_zone_code=dbo.cir_get_zone_name(@v1_comp_code, @v_zone_code); 
			set @v_publ_code=dbo.cir_publ_type(@v1_comp_code,@v_publ_code,null,null);
            
            insert into #cir_temp_bill_collection
				(comp_code, unit_code, billno, publ_code, agcd, dpcd,agname,agname_oth_lang, city_code, 
				taluka_code, dist_code, state_code, REGION,supply_copy, return_copy ,copy_rate,no_of_days,zone_code, region_code,pro_type,route_code
				,unit_name,COM_CAT)
            values(@v1_comp_code,@v1_unit_code,@v1_branch_name,@v1_publ_name,@v1_main_edtn_name,@v1_edtn_name,@v1_agname,@v1_agname_oth_lang,@v1_city_name,
				@v1_taluka_name,@v1_dist_name,@v1_state_name,@v_reg_code,@v1_supply_copy,@v1_return_copy,@v1_copy_rate,@v1_no_of_days,@v_zone_code,@v_reg_code,@v_publ_code,@v1_route_name
				,@v1_unit_name,@v1_COM_CAT)
            
		    fetch NEXT FROM c1 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_no_of_days,@v1_unit_name,@v1_COM_CAT
		
		END 
		close c1
		DEALLOCATE c1

            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE,region AS REGION_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,region
                order by region,COM_CAT

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
				select comp_code AS COMP_CODE,STATE_CODE AS STATE_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,STATE_CODE
                order by STATE_CODE,COM_CAT

                select comp_code AS COMP_CODE,  
                STATE_CODE AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,STATE_CODE order by STATE_CODE         
                
            End    
            Else if @pbreak_on='D' Begin -- district wise
				select comp_code AS COMP_CODE,dist_code AS DIST_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,dist_code
                order by dist_code,COM_CAT

                select comp_code AS COMP_CODE,  
                dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,dist_code order by dist_code 
                
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
				select comp_code AS COMP_CODE,zone_code as ZONE_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,zone_code
                order by zone_code,COM_CAT

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,zone_code order by zone_code
                
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                select comp_code AS COMP_CODE,unit_name as UNIT_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,unit_name
                order by unit_name,COM_CAT

                select comp_code AS COMP_CODE,  
                unit_name as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,unit_name order by unit_name
                
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                select comp_code AS COMP_CODE,publ_code AS PUBL_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,publ_code
                order by publ_code,COM_CAT

                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,publ_code order by publ_code                
                
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
				select comp_code AS COMP_CODE,route_code as ROUTE_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,route_code
                order by route_code,COM_CAT

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,route_code order by route_code 
			    
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise
				
				select comp_code AS COMP_CODE,billno AS BRANCH_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,billno
                order by billno,COM_CAT

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by billno 
                   
             End
             else if @pbreak_on='E' Begin  ---  Edition Wise
				select comp_code AS COMP_CODE,dpcd AS SUB_EDTN
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,dpcd
                order by dpcd,COM_CAT

                select comp_code AS COMP_CODE,  
                dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,dpcd order by dpcd 
               
             End   
        
        select getdate() as CUR_DATE
        select getdate() as CUR_DATE
   drop table #CIR_TEMP_BILL_COLLECTION
   
   drop table #CIR_DBKSUP_temp

 

//////////////////////////next

create PROCEDURE [dbo].[cir_rep_supply_cir_rep_branch_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   



	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print '3'

if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        , B.BRANCH_CODE BRANCH_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,b.BRANCH_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.BRANCH_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE, B.BRANCH_CODE BRANCH_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,b.BRANCH_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.BRANCH_CODE'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
		 SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE, B.BRANCH_CODE BRANCH_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,b.BRANCH_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN,
        b.city_code CITY_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        , B.BRANCH_CODE BRANCH_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),b.BRANCH_CODE
         ,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.BRANCH_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.BRANCH_CODE;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN,B.CITY_CODE
        , B.BRANCH_CODE BRANCH_CODE,B.STATE_CODE STATE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,b.BRANCH_CODE,b.city_code) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE, null EDTN,B.COUNTRY_CODE COUNTRY_CODE
        , B.BRANCH_CODE BRANCH_CODE,b.city_code,b.state_code,b.dist_code,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.dist_code,b.state_code,B.CITY_CODE,B.COUNTRY_CODE,b.BRANCH_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.dist_code,d.state_code,d.CITY_CODE,d.BRANCH_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.dist_code,d.state_code,d.CITY_CODE,d.EDTN,d.BRANCH_CODE'
end
else
begin

	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE", substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
	, ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",
	SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,	 A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN, B.CITY_CODE
	, B.BRANCH_CODE BRANCH_CODE,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,b.BRANCH_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",	    
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE
		, B.BRANCH_CODE BRANCH_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
			 AND A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL(A.SUP_COPY, 0)  > 0
			  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.BRANCH_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		AND	A.SUP_TYPE_CODE  = C.SUP_TY_CODE AND	A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	



//////////////////////next

create PROCEDURE [dbo].[cir_rep_supply_cir_rep_center_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   



	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print '3'
if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        , B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,B.UNIT,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.UNIT,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.CITY_CODE,d.EDTN,d.UNIT;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE, B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,B.UNIT) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.UNIT'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
		 SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE, B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,b.unit,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.UNIT;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN,
        b.city_code CITY_CODE, B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.UNIT,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.UNIT,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.BRANCH_CODE,d.CITY_CODE,d.EDTN,d.UNIT_CODE,d.UNIT;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        , B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),b.unit
         ,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.UNIT,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.UNIT;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN,B.CITY_CODE
        , B.unit UNIT,B.STATE_CODE STATE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,b.unit,b.city_code) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.UNIT;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE, null EDTN,B.COUNTRY_CODE COUNTRY_CODE
        , B.unit UNIT,b.city_code,b.state_code,b.dist_code,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.dist_code,b.state_code,B.CITY_CODE,B.COUNTRY_CODE,b.unit) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.dist_code,d.state_code,d.CITY_CODE,d.UNIT,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.dist_code,d.state_code,d.CITY_CODE,d.EDTN,d.UNIT'
end
else
begin

	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE", substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
    , ISNULL(UNIT ,''NA'') UNIT,isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
	''NA'' "UNIT ONAME",
	SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,	 A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN, B.CITY_CODE
	, B.unit UNIT,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,b.unit) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.UNIT,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(UNIT ,''NA'') UNIT,
		isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
		''NA'' "UNIT ONAME",	    
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE
		, B.unit UNIT,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
			 AND A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL(A.SUP_COPY, 0)  > 0
			  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.unit) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.UNIT'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		AND	A.SUP_TYPE_CODE  = C.SUP_TY_CODE AND	A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	




////////////////////////next





ALTER PROCEDURE [dbo].[CIR_REP_SUPPLY_cir_rep_daybook]
	@pcomp_code      varchar(20),
	@punit_code      varchar(20),
	@ppubl           varchar(20),
	@pedtn           varchar(20),
	@pcitycd         varchar(20),
	@pstatecd        varchar(20),
	@pmonth          varchar(20),
	@pyear           varchar(20),
	@pdateformat     varchar(20),
	@pbranch         varchar(20),
	@pdistcode       varchar(20),
	@ptaluka         varchar(20),
	@pagtype         varchar(20),
	@pagclass        varchar(20),
	@pagcode         varchar(20),
	@pdpcode         varchar(20),
	@pextra1         varchar(200),--it is used for supply type
	@pextra2         varchar(200), -- it is used for Report type Agency(A)/Publication(P)/Center(C)/Branch(B)/Zone(Z)/State(S)/District(D)/Route(R)
	@pextra3         varchar(200),
	@pextra4         varchar(200),
	@pextra5         varchar(200)
AS
BEGIN
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)

PRINT('2')

if(@pmonth = 'jan')
begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb')
begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar')
begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr')
begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may')
begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun')
begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul')
begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug')
begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep')
begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct')
begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov')
begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec')
begin
   set  @pmonth = '12'
end  
else 
begin
   set  @pmonth = '00'
end   

SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
PRINT( @vfrdt) 
SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
PRINT('2') 
set @vtodt=SUBSTRING(@vtodt1,5,2)
print @vtodt1
SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
PRINT @vtodt

if @pextra2='R'		
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE",'''' as "EXTRA"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.ROUTE_CODE;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE",'''' as "EXTRA"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.PUBL;'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",'''' as "EXTRA",'''' as "EXTRA2",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE",'''' as "EXTRA"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
        ,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE",'''' as "EXTRA"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        ,null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')
        ,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",'''' as "EXTRA2"
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , B.DIST_CODE DIST_CODE, null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, B.DIST_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE'
end
else
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
       substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end

	set @pquery1='SELECT COMP_CODE,UNIT_CODE,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
        SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
        isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
        isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
		case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31       
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' OR '''+@PEDTN+''' IS NULL or '''+@PEDTN+'''='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+'''='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND isnull(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE;'

set @pquery2='SELECT COMP_CODE,UNIT_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
        SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
        isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
        isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
		case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' OR '''+@PEDTN+''' IS NULL or '''+@PEDTN+'''='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+'''='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+''' AND isnull(A.SUP_COPY,0)>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE;'

	PRINT @pquery
	PRINT @pquery1
	PRINT @pquery2

	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	
END

///////////////////////////////next

ALTER PROCEDURE [dbo].[cir_rep_supply_cir_rep_dist_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   



	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print ('3')

	
if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE",'''' as "EXTRA",'''' as "EXTRA2"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME"  ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        ,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.DIST_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.CITY_CODE,d.STATE_CODE,d.EDTN,d.ROUTE_CODE;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE",'''' as "EXTRA",'''' as "EXTRA2"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,B.DIST_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.DIST_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.DIST_CODE'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",'''' as "EXTRA",'''' as "EXTRA2",'''' as "EXTRA3",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE,B.DIST_CODE DIST_CODE,b.state_code,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.DIST_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE",'''' as "EXTRA",'''' as "EXTRA2"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
        ,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.DIST_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE,d.STATE_CODE;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE",'''' as "EXTRA",'''' as "EXTRA2"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        ,null EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')
        ,B.STATE_CODE ,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.dist_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.dist_code;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",'''' as "EXTRA2",'''' as "EXTRA3"
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,b.DIST_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.DIST_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",'''' as "EXTRA2",
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" 
       ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , B.DIST_CODE DIST_CODE, null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, B.DIST_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE'
end
else
begin
	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE"
	, substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME"
	,dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
    isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME",
    isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA'') "DISTRICT ONAME",
    STATE_CODE,
	SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,	 A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN, B.CITY_CODE,
	B.DIST_CODE DIST_CODE, B.STATE_CODE STATE_CODE,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,B.DIST_CODE,B.STATE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.DIST_CODE,d.STATE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.DIST_CODE,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end
		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(DIST_CODE, ''NA'') DIST_CODE,
		isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME",
		isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA'') "DISTRICT ONAME",
	    STATE_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE, B.DIST_CODE DIST_CODE, B.STATE_CODE STATE_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
			 AND A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL(A.SUP_COPY, 0)  > 0
			  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.DIST_CODE,B.STATE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.STATE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.DIST_CODE'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		AND	A.SUP_TYPE_CODE  = C.SUP_TY_CODE AND	A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	




//////////////////////////next

create PROCEDURE [dbo].[cir_rep_supply_cir_rep_region_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   



	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print '3'

if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        ,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.REGION_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.CITY_CODE,d.EDTN,d.REGION_CODE;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.REGION_CODE'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,''''as EXTRA,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
		 SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.REGION_CODE;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
		''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
        ,B.CITY_CODE,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.REGION_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE,d.REGION_CODE;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        ,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')
         ,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.REGION_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.REGION_CODE;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,''''as EXTRA
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
		''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN,B.CITY_CODE
        ,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.STATE_CODE STATE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C''),b.city_code) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.REGION_CODE;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE, null EDTN,B.COUNTRY_CODE COUNTRY_CODE
        ,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,b.city_code,b.state_code,b.dist_code,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.dist_code,b.state_code,B.CITY_CODE,B.COUNTRY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.dist_code,d.state_code,d.CITY_CODE,d.region_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.dist_code,d.state_code,d.CITY_CODE,d.EDTN,d.region_code'
end
else
begin

	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE", substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
    , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
	isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",''NA'' "REGION ONAME",
    SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,	 A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN, B.CITY_CODE,
	dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.REGION_CODE,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(REGION_CODE, ''NA'') REGION_CODE,
		isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
		''NA'' "REGION ONAME",	    
		SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"		
		FROM (SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE
		,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,
		case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
			 AND A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL(A.SUP_COPY, 0)  > 0
			  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.REGION_CODE'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		AND	A.SUP_TYPE_CODE  = C.SUP_TY_CODE AND	A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	




//////////////////////next

create PROCEDURE [dbo].[cir_rep_supply_cir_rep_route_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   



	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print '3'
if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(ROUTE_CODE ,''NA'') ROUTE_CODE,
isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA'') "ROUTE NAME",
isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA'') "ROUTE ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.CITY_CODE,d.EDTN;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(ROUTE_CODE ,''NA'') ROUTE_CODE,
isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA'') "ROUTE NAME",
isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA'') "ROUTE ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE, A.ROUTE_CODE ROUTE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,a.ROUTE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.ROUTE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.ROUTE_CODE'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(ROUTE_CODE ,''NA'') ROUTE_CODE,
isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA'') "ROUTE NAME",
isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA'') "ROUTE ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
		 SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE, A.ROUTE_CODE ROUTE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,a.ROUTE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.ROUTE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ROUTE_CODE;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(ROUTE_CODE ,''NA'') ROUTE_CODE,
isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA'') "ROUTE NAME",
isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA'') "ROUTE ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN,
        b.city_code CITY_CODE, A.ROUTE_CODE ROUTE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,a.ROUTE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.ROUTE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.BRANCH_CODE,d.CITY_CODE,d.EDTN,d.UNIT_CODE,d.ROUTE_CODE;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(ROUTE_CODE ,''NA'') ROUTE_CODE,
isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA'') "ROUTE NAME",
isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA'') "ROUTE ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        , A.ROUTE_CODE ROUTE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),a.ROUTE_CODE
         ,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.ROUTE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.ROUTE_CODE;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(ROUTE_CODE ,''NA'') ROUTE_CODE,
isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA'') "ROUTE NAME",
isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA'') "ROUTE ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN,B.CITY_CODE
        , A.ROUTE_CODE ROUTE_CODE,B.STATE_CODE STATE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,a.ROUTE_CODE,b.city_code) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.ROUTE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.ROUTE_CODE;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(ROUTE_CODE ,''NA'') ROUTE_CODE,
isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA'') "ROUTE NAME",
isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA'') "ROUTE ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE, null EDTN,B.COUNTRY_CODE COUNTRY_CODE
        , A.ROUTE_CODE ROUTE_CODE,b.city_code,b.state_code,b.dist_code,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.dist_code,b.state_code,B.CITY_CODE,B.COUNTRY_CODE,a.ROUTE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.dist_code,d.state_code,d.CITY_CODE,d.ROUTE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.dist_code,d.state_code,d.CITY_CODE,d.EDTN,d.ROUTE_CODE'
end
else
begin

	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE", substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
	, ISNULL(ROUTE_CODE ,''NA'') ROUTE_CODE,
isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA'') "ROUTE NAME",
isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA'') "ROUTE ONAME",
	SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,	 A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN, B.CITY_CODE	
	, A.ROUTE_CODE ROUTE_CODE,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,a.ROUTE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
END		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(ROUTE_CODE ,''NA'') ROUTE_CODE,
		isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA'') "ROUTE NAME",
		 isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA'') "ROUTE ONAME",	    
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"		
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE
		, A.ROUTE_CODE ROUTE_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
			 AND A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL(A.SUP_COPY, 0)  > 0
			  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,a.ROUTE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(A.ROUTE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		AND	A.SUP_TYPE_CODE  = C.SUP_TY_CODE AND	A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	





//////////////////////////next

ALTER PROCEDURE [dbo].[cir_rep_supply_cir_rep_taluka_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
    @pdistcode      varchar(20),
    @ptaluka        varchar(20),
    @pagtype        varchar(20),
    @pagclass       varchar(20),
    @pagcode        varchar(20),
    @pdpcode        varchar(20),
    @pextra1        varchar(200),--it is used for supply type
    @pextra2        varchar(200),
    @pextra3        varchar(200),
    @pextra4        varchar(200),
    @pextra5        varchar(200)
	
AS 
	
		
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
    PRINT('2')

if(@pmonth = 'jan')
begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb')
begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar')
begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr')
begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may')
begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun')
begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul')
begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug')
begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep')
begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct')
begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov')
begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec')
begin
   set  @pmonth = '12'
end  
else 
begin
   set  @pmonth = '00'
end   


        SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
		PRINT( @vfrdt) 
		SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
        PRINT('2') 
		set @vtodt=SUBSTRING(@vtodt1,5,2)
		print @vtodt1
	    SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
		PRINT @vtodt




if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE",'''' as "EXTRA"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME"  ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        ,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.COUNTRY_CODE,b.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ROUTE_CODE,d.TEHSIL_TALUKA;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE",'''' as "EXTRA"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.TEHSIL_TALUKA'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",'''' as "EXTRA",'''' as "EXTRA2",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.COUNTRY_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.DIST_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE,d.TEHSIL_TALUKA;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE",'''' as "EXTRA"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
        ,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,b.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE,d.TEHSIL_TALUKA;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE",'''' as "EXTRA"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        ,null EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')
        ,B.STATE_CODE ,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.dist_code,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.dist_code,d.TEHSIL_TALUKA;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",'''' as "EXTRA2"
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,b.DIST_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.DIST_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE,d.TEHSIL_TALUKA;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,,'''' as "EXTRA"
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , B.DIST_CODE DIST_CODE, null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, B.DIST_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE,d.TEHSIL_TALUKA'
end
else
begin
		set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE",
		substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
		 substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
		d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",
        dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
        dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
        isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME",
		STATE_CODE "STATE CODE",
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
		 SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
		FROM (	
		SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,
		A.EDTN EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
	   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
			FROM  CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C 
			WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
			 AND A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
			 AND A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@ppubl+'''
			 AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
             AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
			AND A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND ISNULL(A.SUP_COPY, 0)  > 0
		  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,B.TEHSIL_TALUKA,B.STATE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.TEHSIL_TALUKA,d.STATE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.TEHSIL_TALUKA,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'

end		
		
	
			set @pquery1='SELECT COMP_CODE, UNIT_CODE,isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
    isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME",STATE_CODE "STATE CODE",
			   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
	   SUM(p31) AS "31",
	   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
       isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
       isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
		 case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
			FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
			WHERE A.COMP_CODE  = B.COMP_CODE AND A.COMP_CODE  = C.COMP_CODE AND A.COMP_CODE  = '''+@PCOMP_CODE+'''
			 AND A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
			 AND A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+'''
	     	 AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
             AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND  A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
			AND ISNULL(A.SUP_COPY, 0)  > 0 
			GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.STATE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.TEHSIL_TALUKA,d.STATE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.TEHSIL_TALUKA;'


		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
	   SUM(p31) AS "31",
		  SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
       isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
       isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
		 case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
			FROM  CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C 
			WHERE A.COMP_CODE  = B.COMP_CODE AND A.COMP_CODE  = C.COMP_CODE AND A.COMP_CODE  = '''+@PCOMP_CODE+'''
			 AND A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
			 AND A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+'''
			AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
             AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL(A.SUP_COPY, 0)  > 0
		  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)  d
        GROUP BY d.COMP_CODE,d.UNIT_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE;'
		
PRINT @pquery
exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)





////////////////////next

create PROCEDURE [dbo].[cir_rep_supply_cir_rep_zone_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   



	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print '3'

	
if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
''NA'' "ZONE ONAME"  ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        , DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.zone_code,d.CITY_CODE,d.EDTN,d.ROUTE_CODE;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
''NA'' "ZONE ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.zone_code
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.zone_code'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
		 SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.zone_code
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.zone_code;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
        ,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE,d.zone_code;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')
        ,B.STATE_CODE ,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN,B.CITY_CODE
        , DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.STATE_CODE STATE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),b.city_code) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.zone_code
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.zone_code;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE, null EDTN,b.DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        dbo.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,b.city_code,b.state_code,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
        FROM CIR_DBKSUP A,CIR_AGMAST B,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE=C.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND A.SUP_COPY>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.dist_code,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.dist_code,d.CITY_CODE,d.STATE_CODE,d.zone_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.dist_code,d.STATE_CODE,d.CITY_CODE,d.zone_code,d.EDTN'
end
else
begin
	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE", substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
    ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
    ''NA'' "ZONE ONAME",
	SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN
	, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,b.city_code,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,b.city_code, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.Zone_Code,d.city_code
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.Zone_Code,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,
		isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME",	    
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE
		, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
			 AND A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull(A.SUP_COPY,0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull(A.SUP_COPY,0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull(A.SUP_COPY,0)) else 0 end as p31
		FROM  CIR_DBKSUP A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		AND	A.SUP_TYPE_CODE  = C.SUP_TY_CODE AND	A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL(A.SUP_COPY, 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	


////////////////////////////////////next

create PROCEDURE [dbo].[cir_rep_unslod_cir_rep_center_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   



	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print '3'
	
	declare @pvar as varchar(2000)
if @pextra3 = 'U'
begin
set @pvar='A.UNSOLD'
end
else if @pextra3='S'	--- for short
begin
set @pvar='A.SHORT_RECPT'
end
else if @pextra3='D'	 -- for damaged
begin
set @pvar='A.DAMAGE'
end
else if @pextra3='B'	-- for BNR
begin
set @pvar='A.BNR'
end
else if @pextra3='L'  -- for late 
begin
set @pvar='A.LATE_RECPT'
end
else--if @pextra1='all'  -- for all 
begin
set @pvar='A.UNSOLD'
end
if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        , B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,B.UNIT,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.UNIT,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.CITY_CODE,d.EDTN,d.UNIT;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE, B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,B.UNIT) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.UNIT'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
		 SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE, B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,b.unit,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.UNIT;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN,
        b.city_code CITY_CODE, B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.UNIT,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.UNIT,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.BRANCH_CODE,d.CITY_CODE,d.EDTN,d.UNIT_CODE,d.UNIT;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        , B.unit UNIT,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),b.unit
         ,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.UNIT,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.UNIT;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN,B.CITY_CODE
        , B.unit UNIT,B.STATE_CODE STATE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,b.unit,b.city_code) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.UNIT;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(UNIT ,''NA'') UNIT,
isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
''NA'' "UNIT ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE, null EDTN,B.COUNTRY_CODE COUNTRY_CODE
        , B.unit UNIT,b.city_code,b.state_code,b.dist_code,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.dist_code,b.state_code,B.CITY_CODE,B.COUNTRY_CODE,b.unit) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.dist_code,d.state_code,d.CITY_CODE,d.UNIT,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.dist_code,d.state_code,d.CITY_CODE,d.EDTN,d.UNIT'
end
else
begin

	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE", substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
    , ISNULL(UNIT ,''NA'') UNIT,isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
	''NA'' "UNIT ONAME",
	SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,	 A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN, B.CITY_CODE
	, B.unit UNIT,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL('+ @pvar +', 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,b.unit) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.UNIT,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(UNIT ,''NA'') UNIT,
		isnull(dbo.cir_get_unit_name(COMP_CODE, d.UNIT),''NA'') "UNIT NAME",
		''NA'' "UNIT ONAME",	    
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE
		, B.unit UNIT,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
		A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL('+ @pvar +', 0)  > 0
			  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.unit) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.UNIT
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.UNIT'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(B.unit='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL('+ @pvar +', 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	



///////////////next
create PROCEDURE [dbo].[cir_rep_unsold_cir_rep_branch_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   



	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print '3'

declare @pvar as varchar(2000)
if @pextra3 = 'U'
begin
set @pvar='A.UNSOLD'
end
else if @pextra3='S'	--- for short
begin
set @pvar='A.SHORT_RECPT'
end
else if @pextra3='D'	 -- for damaged
begin
set @pvar='A.DAMAGE'
end
else if @pextra3='B'	-- for BNR
begin
set @pvar='A.BNR'
end
else if @pextra3='L'  -- for late 
begin
set @pvar='A.LATE_RECPT'
end
else--if @pextra1='all'  -- for all 
begin
set @pvar='A.UNSOLD'
end

if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        , B.BRANCH_CODE BRANCH_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,b.BRANCH_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.BRANCH_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE, B.BRANCH_CODE BRANCH_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,b.BRANCH_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.BRANCH_CODE'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
		 SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE, B.BRANCH_CODE BRANCH_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,b.BRANCH_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN,
        b.city_code CITY_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        , B.BRANCH_CODE BRANCH_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),b.BRANCH_CODE
         ,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.BRANCH_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.BRANCH_CODE;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN,B.CITY_CODE
        , B.BRANCH_CODE BRANCH_CODE,B.STATE_CODE STATE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,b.BRANCH_CODE,b.city_code) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE, null EDTN,B.COUNTRY_CODE COUNTRY_CODE
        , B.BRANCH_CODE BRANCH_CODE,b.city_code,b.state_code,b.dist_code,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.dist_code,b.state_code,B.CITY_CODE,B.COUNTRY_CODE,b.BRANCH_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.dist_code,d.state_code,d.CITY_CODE,d.BRANCH_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.dist_code,d.state_code,d.CITY_CODE,d.EDTN,d.BRANCH_CODE'
end
else
begin

	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE", substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
	, ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",
	SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,	 A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN, B.CITY_CODE
	, B.BRANCH_CODE BRANCH_CODE,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL('+ @pvar +', 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,b.BRANCH_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(BRANCH_CODE, ''NA'') BRANCH_CODE,
		isnull(dbo.cir_get_branch(COMP_CODE, BRANCH_CODE),''NA'') "BRANCH NAME",
		''NA'' "BRANCH ONAME",	    
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE
		, B.BRANCH_CODE BRANCH_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
		A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL('+ @pvar +', 0)  > 0
			  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.BRANCH_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(B.BRANCH_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		--A.SUP_TYPE_CODE  = C.SUP_TY_CODE AND	A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		ISNULL('+ @pvar +', 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	



///////////////////next

create PROCEDURE [dbo].[CIR_REP_unsold_cir_rep_daybook]
	@pcomp_code      varchar(20),
	@punit_code      varchar(20),
	@ppubl           varchar(20),
	@pedtn           varchar(20),
	@pcitycd         varchar(20),
	@pstatecd        varchar(20),
	@pmonth          varchar(20),
	@pyear           varchar(20),
	@pdateformat     varchar(20),
	@pbranch         varchar(20),
	@pdistcode       varchar(20),
	@ptaluka         varchar(20),
	@pagtype         varchar(20),
	@pagclass        varchar(20),
	@pagcode         varchar(20),
	@pdpcode         varchar(20),
	@pextra1         varchar(200),--it is used for supply type
	@pextra2         varchar(200), -- it is used for Report type Agency(A)/Publication(P)/Center(C)/Branch(B)/Zone(Z)/State(S)/District(D)/Route(R)
	@pextra3         varchar(200),-- it is used for unsold type -  short S/late L/unsold U/damaged D/BNR B
	@pextra4         varchar(200),
	@pextra5         varchar(200)
AS
BEGIN
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(max)
	DECLAre @pquery_         varchar(max)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)

PRINT('2')

if(@pmonth = 'jan')
begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb')
begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar')
begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr')
begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may')
begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun')
begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul')
begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug')
begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep')
begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct')
begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov')
begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec')
begin
   set  @pmonth = '12'
end  
else 
begin
   set  @pmonth = '00'
end   

SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
PRINT( @vfrdt) 
SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
PRINT('2') 
set @vtodt=SUBSTRING(@vtodt1,5,2)
print @vtodt1
SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
PRINT @vtodt
declare @pvar as varchar(2000)
if @pextra3 = 'U'
begin
set @pvar='A.UNSOLD'
end
else if @pextra3='S'	--- for short
begin
set @pvar='A.SHORT_RECPT'
end
else if @pextra3='D'	 -- for damaged
begin
set @pvar='A.DAMAGE'
end
else if @pextra3='B'	-- for BNR
begin
set @pvar='A.BNR'
end
else if @pextra3='L'  -- for late 
begin
set @pvar='A.LATE_RECPT'
end
else--if @pextra1='all'  -- for all 
begin
set @pvar='A.UNSOLD'
end

	if @pextra2='R'		
	begin
		set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE",'''' as "EXTRA"
		,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
		   substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
		   d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		   CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
		   dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
		   isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
		   SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
		   SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
		   SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
		   SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
		   SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
			SUM(p31) AS "31",
		   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
				isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
				isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (
			SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
	--        A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (C.SUP_TY_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.ROUTE_CODE;'
	--print @pquery	
	end
	 else if @pextra2='P'
	begin
		set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE",'''' as "EXTRA"
		,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
		   substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
		   d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		   CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
		   dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
		   isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
		   SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
		   SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
		   SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
		   SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
		   SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
			SUM(p31) AS "31",
		   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
				isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
				isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (
			SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
			,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.PUBL;'
	end
	else if @pextra2='C'
	begin
		set @pquery='SELECT COMP_CODE,UNIT_CODE,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",'''' as "EXTRA",'''' as "EXTRA2",
		   ''NA'' "UNIT ONAME",
		   d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		   CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
		   dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
		   isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
		   SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
		   SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
		   SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
		   SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
		   SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
			SUM(p31) AS "31",
		   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
				isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
				isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (
			SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
			,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN;'
	end
	else if @pextra2='B'
	begin
		set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE",'''' as "EXTRA"
		,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
		   ''NA'' "BRANCH ONAME",
		   d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		   CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
		   dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
		   isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
		   SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
		   SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
		   SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
		   SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
		   SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
			SUM(p31) AS "31",
		   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
				isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
				isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (
			SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
			,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE;'
	end
	else if @pextra2='Z'
	begin
		set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE",'''' as "EXTRA"
		,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
		   ''NA'' "ZONE ONAME",
		   d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		   CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
		   dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
		   isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
		   SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
		   SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
		   SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
		   SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
		   SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
			SUM(p31) AS "31",
		   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
				isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
				isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (
			SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
			, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
			,null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')
			,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE;'
	end
	else if @pextra2='S'
	begin
		set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",'''' as "EXTRA2"
			,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
		   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		   CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
		   dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
		   isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
		   SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
		   SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
		   SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
		   SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
		   SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
			SUM(p31) AS "31",
		   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
				isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
				isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (
			SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
			,null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN;'
	end
	else if @pextra2='D'
	begin
		set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",
		ISNULL(DIST_CODE, ''NA'') DIST_CODE
		,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
		   substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
		   d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		   CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
		   dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
		   isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
		   SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
		   SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
		   SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
		   SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
		   SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
			SUM(p31) AS "31",
		   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
				isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
				isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (
			SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
			, B.DIST_CODE DIST_CODE, null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE, B.DIST_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE'
	end
	else
	begin
		set @pquery='SELECT COMP_CODE,UNIT_CODE,AGCD "AGENCY CODE",DPCD "AGENCY SUBCODE",substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
		   substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
		   d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		   CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
		   dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
		   isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
		   SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
		   SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
		   SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
		   SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
		   SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
			SUM(p31) AS "31",
		   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
				isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
				isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
	end

		set @pquery1='SELECT COMP_CODE,UNIT_CODE,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME",COUNTRY_CODE,
			SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
			SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
			SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
			SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
			SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
			SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
			SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
			isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
			isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31       
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' OR '''+@PEDTN+''' IS NULL or '''+@PEDTN+'''='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+'''='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+'''='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND isnull('+ @pvar +',0)>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.STATE_CODE,B.COUNTRY_CODE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.COUNTRY_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE;'

	set @pquery2='SELECT COMP_CODE,UNIT_CODE,SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
			SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
			SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
			SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
			SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
			SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
			SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
			isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
			isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
			FROM (SELECT     A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
			case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
			case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
			case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
			case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
			case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
			case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
			case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
			case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
			case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
			case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
			case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
			case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
			case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
			case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
			case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
			case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
			case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
			case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
			case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
			case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
			case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
			case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
			case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
			case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
			case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
			case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
			case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
			case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
			case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
			case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
			case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM cir_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
			WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
			A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' OR '''+@PEDTN+''' IS NULL or '''+@PEDTN+'''='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+'''='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+''' AND isnull('+ @pvar +',0)>0
			GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
			GROUP BY d.COMP_CODE,d.UNIT_CODE
			ORDER BY d.COMP_CODE,d.UNIT_CODE;'


	
	print(@pquery)
	PRINT @pquery1
	PRINT @pquery2

	
	exec(@pquery)
	exec(@pquery1) 
	exec(@pquery2)
	
	
END

///////////////////////////next

create PROCEDURE [dbo].[cir_rep_unsold_cir_rep_dist_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   

	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print ('3')

declare @pvar as varchar(2000)
if @pextra3 = 'U'
begin
set @pvar='A.UNSOLD'
end
else if @pextra3='S'	--- for short
begin
set @pvar='A.SHORT_RECPT'
end
else if @pextra3='D'	 -- for damaged
begin
set @pvar='A.DAMAGE'
end
else if @pextra3='B'	-- for BNR
begin
set @pvar='A.BNR'
end
else if @pextra3='L'  -- for late 
begin
set @pvar='A.LATE_RECPT'
end
else--if @pextra1='all'  -- for all 
begin
set @pvar='A.UNSOLD'
end


	
if @pextra2='T'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE",'''' as "EXTRA",'''' as "EXTRA2"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME"  ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        ,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.DIST_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.CITY_CODE,d.STATE_CODE,d.EDTN,d.ROUTE_CODE;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE",'''' as "EXTRA",'''' as "EXTRA2"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,B.DIST_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.DIST_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.DIST_CODE'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",'''' as "EXTRA",'''' as "EXTRA2",'''' as "EXTRA3",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE,B.DIST_CODE DIST_CODE,b.state_code,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.DIST_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE",'''' as "EXTRA",'''' as "EXTRA2"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
        ,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.DIST_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE,d.STATE_CODE;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE",'''' as "EXTRA",'''' as "EXTRA2"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        ,null EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')
        ,B.STATE_CODE ,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.dist_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.dist_code;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",'''' as "EXTRA2",'''' as "EXTRA3"
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,b.DIST_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.DIST_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",'''' as "EXTRA2",
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME" 
       ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , B.DIST_CODE DIST_CODE, null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, B.DIST_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE'
end
else
begin
	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE"
	, substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME"
	,dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
    isnull(DIST_CODE,''NA'') "DIST CODE",isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME",
    isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA'') "DISTRICT ONAME",
    STATE_CODE,
	SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,	 A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN, B.CITY_CODE,
	B.DIST_CODE DIST_CODE, B.STATE_CODE STATE_CODE,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL('+ @pvar +', 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,B.DIST_CODE,B.STATE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.DIST_CODE,d.STATE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.DIST_CODE,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end
		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(DIST_CODE, ''NA'') DIST_CODE,
		isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA'') "DISTRICT NAME",
		isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA'') "DISTRICT ONAME",
	    STATE_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE, B.DIST_CODE DIST_CODE, B.STATE_CODE STATE_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  AND 
			 A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL('+ @pvar +', 0)  > 0
			  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.DIST_CODE,B.STATE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.STATE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.DIST_CODE'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  	AND	
		A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL('+ @pvar +', 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	



/////////////////////////next

create PROCEDURE [dbo].[cir_rep_unsold_cir_rep_region_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   



	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print '3'

declare @pvar as varchar(2000)
if @pextra3 = 'U'
begin
set @pvar='A.UNSOLD'
end
else if @pextra3='S'	--- for short
begin
set @pvar='A.SHORT_RECPT'
end
else if @pextra3='D'	 -- for damaged
begin
set @pvar='A.DAMAGE'
end
else if @pextra3='B'	-- for BNR
begin
set @pvar='A.BNR'
end
else if @pextra3='L'  -- for late 
begin
set @pvar='A.LATE_RECPT'
end
else--if @pextra1='all'  -- for all 
begin
set @pvar='A.UNSOLD'
end

if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        ,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl  A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.REGION_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.CITY_CODE,d.EDTN,d.REGION_CODE;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl  A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.REGION_CODE'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,''''as EXTRA,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
		 SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl  A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.REGION_CODE;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
		''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
        ,B.CITY_CODE,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl  A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.REGION_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE,d.REGION_CODE;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        ,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl  A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')
         ,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.REGION_CODE,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.REGION_CODE;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,''''as EXTRA
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
		''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN,B.CITY_CODE
        ,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,B.STATE_CODE STATE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl  A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C''),b.city_code) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.REGION_CODE;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE, null EDTN,B.COUNTRY_CODE COUNTRY_CODE
        ,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,b.city_code,b.state_code,b.dist_code,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl  A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.dist_code,b.state_code,B.CITY_CODE,B.COUNTRY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.dist_code,d.state_code,d.CITY_CODE,d.region_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.dist_code,d.state_code,d.CITY_CODE,d.EDTN,d.region_code'
end
else
begin

	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE", substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
    , ISNULL(REGION_CODE, ''NA'') REGION_CODE,
	isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",''NA'' "REGION ONAME",
    SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,	 A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN, B.CITY_CODE,
	dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl  A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL('+ @pvar +', 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.REGION_CODE,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(REGION_CODE, ''NA'') REGION_CODE,
		isnull(dbo.cir_get_region_name(COMP_CODE, REGION_CODE),''NA'') "REGION NAME",
		''NA'' "REGION ONAME",	    
		SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"		
		FROM (SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE
		,dbo.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'') REGION_CODE,
		case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0)) else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0)) else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0)) else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl  A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
		A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL('+ @pvar +', 0)  > 0
			  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.REGION_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.REGION_CODE'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl  A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(DBO.cir_get_region_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		--A.SUP_TYPE_CODE  = C.SUP_TY_CODE 
		A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL('+ @pvar +', 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	



/////////////////////////////next

create PROCEDURE [dbo].[cir_rep_unsold_cir_rep_taluka_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
    @pdistcode      varchar(20),
    @ptaluka        varchar(20),
    @pagtype        varchar(20),
    @pagclass       varchar(20),
    @pagcode        varchar(20),
    @pdpcode        varchar(20),
    @pextra1        varchar(200),--it is used for supply type
    @pextra2        varchar(200),
    @pextra3        varchar(200),
    @pextra4        varchar(200),
    @pextra5        varchar(200)
	
AS 
	
		
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
    PRINT('2')

if(@pmonth = 'jan')
begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb')
begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar')
begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr')
begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may')
begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun')
begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul')
begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug')
begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep')
begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct')
begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov')
begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec')
begin
   set  @pmonth = '12'
end  
else 
begin
   set  @pmonth = '00'
end   


        SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
		PRINT( @vfrdt) 
		SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
        PRINT('2') 
		set @vtodt=SUBSTRING(@vtodt1,5,2)
		print @vtodt1
	    SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
		PRINT @vtodt
declare @pvar as varchar(2000)
if @pextra3 = 'U'
begin
set @pvar='A.UNSOLD'
end
else if @pextra3='S'	--- for short
begin
set @pvar='A.SHORT_RECPT'
end
else if @pextra3='D'	 -- for damaged
begin
set @pvar='A.DAMAGE'
end
else if @pextra3='B'	-- for BNR
begin
set @pvar='A.BNR'
end
else if @pextra3='L'  -- for late 
begin
set @pvar='A.LATE_RECPT'
end
else--if @pextra1='all'  -- for all 
begin
set @pvar='A.UNSOLD'
end


if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE",'''' as "EXTRA"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME"  ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        ,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE and A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.COUNTRY_CODE,b.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ROUTE_CODE,d.TEHSIL_TALUKA;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE",'''' as "EXTRA"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0)) else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0)) else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE and A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.TEHSIL_TALUKA'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",'''' as "EXTRA",'''' as "EXTRA2",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE and A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.DIST_CODE,B.COUNTRY_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.DIST_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE,d.TEHSIL_TALUKA;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE",'''' as "EXTRA"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
        ,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE and A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE,b.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE,d.TEHSIL_TALUKA;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE",'''' as "EXTRA"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        ,null EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE and A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')
        ,B.STATE_CODE ,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.DIST_CODE,B.COUNTRY_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.dist_code,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE,d.dist_code,d.TEHSIL_TALUKA;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",'''' as "EXTRA2"
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE,B.DIST_CODE DIST_CODE,B.STATE_CODE STATE_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE and A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,b.DIST_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.DIST_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE,d.TEHSIL_TALUKA;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as "EXTRA",
	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
       isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        , B.DIST_CODE DIST_CODE, null EDTN,B.CITY_CODE,B.STATE_CODE STATE_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE and A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, B.DIST_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,B.TEHSIL_TALUKA) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.DIST_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.TEHSIL_TALUKA
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.DIST_CODE,d.TEHSIL_TALUKA'
end
else
begin
		set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE",
		substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
		 substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
		d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",
        dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
		CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
        dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME",
        isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
	    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
		isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME",
		STATE_CODE "STATE CODE",
		   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
		 SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
		FROM (	
		SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.AGCD AGCD,A.DPCD DPCD,
		A.EDTN EDTN,B.CITY_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
	   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM  CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C 
			WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
			 AND A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
			 AND A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@ppubl+'''
			 AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
             AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  			
			A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND ISNULL('+ @pvar +', 0)  > 0
		  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,B.CITY_CODE,B.TEHSIL_TALUKA,B.STATE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.CITY_CODE,d.TEHSIL_TALUKA,d.STATE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.TEHSIL_TALUKA,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'

end		
		
	
			set @pquery1='SELECT COMP_CODE, UNIT_CODE,isnull(TEHSIL_TALUKA,''NA'') "TALUKA CODE",
    isnull(dbo.cir_get_taluka(COMP_CODE, TEHSIL_TALUKA),''NA'') "TALUKA NAME",
    isnull( dbo.cir_get_name_cir_taluka(COMP_CODE,TEHSIL_TALUKA,2,'''','''',''''),''NA'') "TALUKA ONAME",STATE_CODE "STATE CODE",
			   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
	   SUM(p31) AS "31",
	   SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
       isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
       isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.TEHSIL_TALUKA TEHSIL_TALUKA,B.STATE_CODE STATE_CODE,
		 case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
			WHERE A.COMP_CODE  = B.COMP_CODE AND A.COMP_CODE  = '''+@PCOMP_CODE+'''
			 AND A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
			 AND A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+'''
	     	 AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
             AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND  A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
			ISNULL('+ @pvar +', 0)  > 0 
			GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.TEHSIL_TALUKA,B.STATE_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.TEHSIL_TALUKA,d.STATE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.TEHSIL_TALUKA;'


		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
	   SUM(p31) AS "31",
		  SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
       isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
       isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,
		 case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
			FROM  CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C 
			WHERE A.COMP_CODE  = B.COMP_CODE AND A.COMP_CODE  = '''+@PCOMP_CODE+'''
			 AND A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
			 AND A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
			A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+'''
			AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
             AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
			(B.STATE_CODE='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
			(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
			(B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
			--A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
			A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL('+ @pvar +', 0)  > 0
		  GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE)  d
        GROUP BY d.COMP_CODE,d.UNIT_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE;'
		
PRINT @pquery
exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)




//////////////////////////////////

create PROCEDURE [dbo].[cir_rep_unsold_cir_rep_zone_daybook]
	@pcomp_code		VARCHAR(20) ,
	@punit_code     VARCHAR(20) ,
	@ppubl          VARCHAR(20) ,
	@pedtn          VARCHAR(20) ,
	@pcitycd        VARCHAR(20) ,
	@pstatecd       VARCHAR(20) ,
	@pmonth         VARCHAR(20) ,
	@pyear          VARCHAR(20) ,
	@pdateformat    VARCHAR(20) ,
	@pbranch        varchar(20),
	@pdistcode      varchar(20),
	@ptaluka        varchar(20),
	@pagtype        varchar(20),
	@pagclass       varchar(20),
	@pagcode        varchar(20),
	@pdpcode        varchar(20),
	@pextra1        varchar(200),
	@pextra2        varchar(200),
	@pextra3        varchar(200),
	@pextra4        varchar(200),
	@pextra5        varchar(200)
AS 
	DECLARE @vfrdt         VARCHAR(20)
	DECLARE @vtodt         VARCHAR(20)
	DECLARE @vtodt1         VARCHAR(20)
	DECLAre @pquery         varchar(8000)
	DECLAre @pquery1         varchar(8000)
	DECLAre @pquery2         varchar(8000)
	PRINT('2')


if(@pmonth = 'jan') begin
   set  @pmonth = '01'
end  
else if(@pmonth = 'feb') begin
   set  @pmonth = '02'
end  
else if(@pmonth = 'mar') begin
   set  @pmonth = '03'
end  
else if(@pmonth = 'apr') begin
   set  @pmonth = '04'
end  
else if(@pmonth = 'may') begin
   set  @pmonth = '05'
end  
else if(@pmonth = 'jun') begin
   set  @pmonth = '06'
end  
else if(@pmonth = 'jul') begin
   set  @pmonth = '07'
end  
else if(@pmonth = 'aug') begin
   set  @pmonth = '08'
end  
else if(@pmonth = 'sep') begin
   set  @pmonth = '09'
end  
else if(@pmonth = 'oct') begin
   set  @pmonth = '10'
end 
else if(@pmonth = 'nov') begin
   set  @pmonth = '11'
end 
else if(@pmonth = 'dec') begin
   set  @pmonth = '12'
end  
else begin
   set	@pmonth = '00'
end   

	SET @vfrdt=(@pmonth+'/'+'01/'+@pyear) 
	PRINT( @vfrdt) 
	SET @vtodt1=([dbo].[GetLastDayOfMonth](@vfrdt))
	PRINT('2') 
	set @vtodt=SUBSTRING(@vtodt1,5,2)
	print @vtodt1
	SET @vtodt=(@pmonth+'/'+@vtodt+'/'+@pyear) 
	PRINT @vtodt
	print '3'

	declare @pvar as varchar(2000)
	if @pextra3 = 'U'
	begin
	set @pvar='A.UNSOLD'
	end
	else if @pextra3='S'	--- for short
	begin
	set @pvar='A.SHORT_RECPT'
	end
	else if @pextra3='D'	 -- for damaged
	begin
	set @pvar='A.DAMAGE'
	end
	else if @pextra3='B'	-- for BNR
	begin
	set @pvar='A.BNR'
	end
	else if @pextra3='L'  -- for late 
	begin
	set @pvar='A.LATE_RECPT'
	end
	else--if @pextra1='all'  -- for all 
	begin
	set @pvar='A.UNSOLD'
	end
	
if @pextra2='R'		
	begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(ROUTE_CODE ,''NA'') "ROUTE CODE"
	,substrING(isnull(dbo.cir_get_route_name(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE),''NA''),1,50) "ROUTE NAME",
       substring(isnull(dbo.cir_get_route(d.COMP_CODE,d.UNIT_CODE, d.ROUTE_CODE) ,''NA''),1,50) "ROUTE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
''NA'' "ZONE ONAME"  ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.ROUTE_CODE ROUTE_CODE,null EDTN,B.CITY_CODE
        , DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.ROUTE_CODE,A.SUPDATE,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ROUTE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.zone_code,d.CITY_CODE,d.EDTN,d.ROUTE_CODE;'
--print @pquery	
end
else if @pextra2='P'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,PUBL "PUBL CODE"
	,substrING(dbo.cir_get_publ_name(d.comp_code,d.PUBL),1,50) "PUBL NAME",
       substring(dbo.cir_get_publ_name_other(d.comp_code,d.PUBL,2,''dd/mm/yyyy'','''',''''),1,50) "PUBL ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
''NA'' "ZONE ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,A.PUBL PUBL,null EDTN
        ,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.PUBL,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.PUBL,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.zone_code
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.PUBL,d.zone_code'
end
else if @pextra2='C'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA,substrING(dbo.cir_get_unit_name(d.comp_code,d.UNIT_CODE),1,50) "UNIT NAME",
       ''NA'' "UNIT ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
		 SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN
        ,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.COUNTRY_CODE,d.zone_code
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.zone_code;'
end
else if @pextra2='B'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,BRANCH_CODE "BRANCH CODE"
	,substrING(dbo.cir_get_branch(d.comp_code,d.BRANCH_CODE),1,50) "BRANCH NAME",
       ''NA'' "BRANCH ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,B.BRANCH_CODE BRANCH_CODE,null EDTN
        ,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,B.BRANCH_CODE,A.SUPDATE,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.BRANCH_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.BRANCH_CODE,d.zone_code;'
end
else if @pextra2='Z'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,ISNULL(d.ZONE_CODE, ''NA'') "ZONE CODE"
	,substrING(isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA''),1,50) "ZONE NAME",
       ''NA'' "ZONE ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE
        ,null EDTN,B.CITY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')
        ,B.STATE_CODE ,A.SUPDATE,B.CITY_CODE,B.COUNTRY_CODE) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE,d.EDTN,d.CITY_CODE,d.zone_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.CITY_CODE,d.EDTN,d.ZONE_CODE;'
end
else if @pextra2='S'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,'''' as EXTRA
		,isnull(STATE_CODE,''NA'') "STATE CODE",isnull(dbo.CIR_GET_STATE(COMP_CODE,COUNTRY_CODE,STATE_CODE),''NA'') "STATE NAME"
	   ,d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME" ,COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,null EDTN,B.CITY_CODE
        , DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,B.STATE_CODE STATE_CODE
        ,B.COUNTRY_CODE COUNTRY_CODE,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C''),b.city_code) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.CITY_CODE,d.STATE_CODE,d.COUNTRY_CODE,d.zone_code
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.STATE_CODE,d.CITY_CODE,d.EDTN,d.zone_code;'
end
else if @pextra2='D'
begin
	set @pquery='SELECT COMP_CODE,UNIT_CODE,	ISNULL(DIST_CODE, ''NA'') DIST_CODE
	,substrING(isnull(dbo.cir_get_dist(COMP_CODE,STATE_CODE, DIST_CODE),''NA''),1,50) "DIST NAME",
       substring(isnull( dbo.cir_get_name_cir_district(COMP_CODE,DIST_CODE,2,'''','''',''''),''NA''),1,50) "DIST ONAME",
       d.EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
       CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",
       dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
       ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "REGION ONAME",COUNTRY_CODE,
	   SUM(p01) as  "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
       SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
       SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
       SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
       SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
       SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",
		SUM(p31) AS "31",
       SUM(isnull(p01,0)+isnull(p02,0)+isnull(p03,0)+isnull(p04,0)+isnull(p05,0)+isnull(p06,0)+isnull(p07,0)+isnull(p08,0)+isnull(p09,0)+isnull(p10,0)+
            isnull(p11,0)+isnull(p12,0)+isnull(p13,0)+isnull(p14,0)+isnull(p15,0)+isnull(p16,0)+isnull(p17,0)+isnull(p18,0)+isnull(p19,0)+isnull(p20,0)+
            isnull(p21,0)+isnull(p22,0)+isnull(p23,0)+isnull(p24,0)+isnull(p25,0)+isnull(p26,0)+isnull(p27,0)+isnull(p28,0)+isnull(p29,0)+isnull(p30,0)+isnull(p31,0)) AS "TOTAL"
        FROM (
        SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE, null EDTN,b.DIST_CODE,B.COUNTRY_CODE COUNTRY_CODE,
        dbo.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,b.city_code,b.state_code,
        case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
        FROM CIR_unsold_dtl A,CIR_AGMAST B--,CIR_SUPPLY_TYPE_MAST C
        WHERE A.COMP_CODE=B.COMP_CODE AND  A.COMP_CODE='''+@PCOMP_CODE+''' AND A.UNIT_CODE=B.UNIT AND A.UNIT_CODE='''+@PUNIT_CODE+''' AND
        A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL='''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL or '''+@PSTATECD+''' ='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE BETWEEN '''+@VFRDT+''' AND '''+@VTODT+'''    AND '+ @pvar +'>0
        GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,b.dist_code,B.CITY_CODE,B.STATE_CODE,B.COUNTRY_CODE,DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.EDTN,d.dist_code,d.CITY_CODE,d.STATE_CODE,d.zone_code,d.COUNTRY_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.dist_code,d.STATE_CODE,d.CITY_CODE,d.zone_code,d.EDTN'
end
else
begin
	set @pquery='SELECT COMP_CODE, UNIT_CODE, AGCD "AGENCY CODE", DPCD "AGENCY SUBCODE", substrING(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,1,'''','''',''''),1,50) "AGENCY NAME",
	substring(dbo.cir_get_name_cir_agname(comp_code,unit_code,agcd,dpcd,2,'''','''',''''),1,50) "AGENCY ONAME",
    EDTN,dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION NAME",dbo.cir_get_edtn_name(COMP_CODE,d.EDTN) "EDITION ONAME",
	CITY_CODE "CITY CODE",dbo.cir_get_city(COMP_CODE,CITY_CODE) "CITY NAME",dbo.cir_get_name_cir_city(COMP_CODE,CITY_CODE,2,'''','''','''') "CITY ONAME"
    ,ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
    ''NA'' "ZONE ONAME",
	SUM(p01) AS "01", SUM(p02) AS "02", SUM(p03) AS "03", SUM(p04) AS "04", SUM(p05) AS "05", SUM(p06) AS "06", SUM(p07) AS "07",
	SUM(p08) AS "08", SUM(p09) AS "09", SUM(p10) AS "10", SUM(p11) AS "11", SUM(p12) AS "12", SUM(p13) AS "13", SUM(p14) AS "14",
    SUM(p15) AS "15", SUM(p16) AS "16", SUM(p17) AS "17", SUM(p18) AS "18", SUM(p19) AS "19", SUM(p20) AS "20", SUM(p21) AS "21",
	SUM(p22) AS "22", SUM(p23) AS "23", SUM(p24) AS "24", SUM(p25) AS "25", SUM(p26) AS "26", SUM(p27) AS "27", SUM(p28) AS "28",
	SUM(p29) AS "29", SUM(p30) AS "30", SUM(p31) AS "31",
	SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
    ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
    ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
    ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
	FROM (	SELECT A.COMP_CODE COMP_CODE,A.UNIT_CODE UNIT_CODE,	 A.AGCD AGCD, A.DPCD DPCD, A.EDTN EDTN
	, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,b.city_code,
	    case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+''' AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND 
		A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''') AND A.PUBL  = '''+@PPUBL+''' 
        AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
        AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
        (DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
        (B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') AND 
        A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+''' AND	ISNULL('+ @pvar +', 0)  > 0
		GROUP BY  A.COMP_CODE,A.UNIT_CODE,A.AGCD,A.DPCD,A.SUPDATE,A.EDTN,b.city_code, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.AGCD,d.DPCD,d.EDTN,d.Zone_Code,d.city_code
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.Zone_Code,d.CITY_CODE,d.EDTN,d.AGCD,d.DPCD;'
end		
	print @pquery	
	
		set @pquery1='SELECT COMP_CODE, UNIT_CODE, ISNULL(ZONE_CODE, ''NA'') ZONE_CODE,
		isnull(dbo.cir_get_zone_name(COMP_CODE, ZONE_CODE),''NA'') "ZONE NAME",
		''NA'' "ZONE ONAME",	    
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE
		, DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'') ZONE_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''') AND A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') and
		(DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''') 
		A.SUPDATE  BETWEEN '''+@VFRDT +''' AND  '''+@VTODT+'''
			 AND ISNULL('+ @pvar +', 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE,DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')) d
        GROUP BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE
        ORDER BY d.COMP_CODE,d.UNIT_CODE,d.ZONE_CODE'

	print (@pquery1)
		
		set @pquery2='SELECT COMP_CODE, UNIT_CODE,
		  SUM(p01) AS "01",SUM(p02) AS "02",SUM(p03) AS "03",SUM(p04) AS "04",SUM(p05) AS "05",
        SUM(p06) AS "06",SUM(p07) AS "07",SUM(p08) AS "08",SUM(p09) AS "09",SUM(p10) AS "10",
        SUM(p11) AS "11",SUM(p12) AS "12",SUM(p13) AS "13",SUM(p14) AS "14",SUM(p15) AS "15",
        SUM(p16) AS "16",SUM(p17) AS "17",SUM(p18) AS "18",SUM(p19) AS "19",SUM(p20) AS "20",
        SUM(p21) AS "21",SUM(p22) AS "22",SUM(p23) AS "23",SUM(p24) AS "24",SUM(p25) AS "25",
        SUM(p26) AS "26",SUM(p27) AS "27",SUM(p28) AS "28",SUM(p29) AS "29",SUM(p30) AS "30",SUM(p31) AS "31",
		SUM(ISNULL(p01, 0) + ISNULL(p02, 0) + ISNULL(p03, 0) + ISNULL(p04, 0) + ISNULL(p05, 0) + ISNULL(p06, 0) + ISNULL(p07, 0) + ISNULL(p08, 0) + 
		ISNULL(p09, 0) + ISNULL(p10, 0) + ISNULL(p11, 0) + ISNULL(p12, 0) + ISNULL(p13, 0) + ISNULL(p14, 0) + ISNULL(p15, 0) + ISNULL(p16, 0) + ISNULL(p17, 0) +
		ISNULL(p18, 0) + ISNULL(p19, 0) + ISNULL(p20, 0) + ISNULL(p21, 0) + ISNULL(p22, 0) + ISNULL(p23, 0) + ISNULL(p24, 0) + ISNULL(p25, 0) + ISNULL(p26, 0) + 
		ISNULL(p27, 0) + ISNULL(p28, 0) + ISNULL(p29, 0) + ISNULL(p30, 0) + ISNULL(p31, 0)) AS "TOTAL"
		FROM (	SELECT A.COMP_CODE COMP_CODE, A.UNIT_CODE UNIT_CODE,
		   case (select(day(A.SUPDATE))) when  ''1'' then SUM(isnull('+ @pvar +',0))  else 0 end as p01,
		case (select(day(A.SUPDATE))) when  ''02'' then SUM(isnull('+ @pvar +',0))else 0 end as p02,
        case (select(day(A.SUPDATE))) when  ''03'' then SUM(isnull('+ @pvar +',0))  else 0 end as p03,
		case (select(day(A.SUPDATE))) when  ''04'' then SUM(isnull('+ @pvar +',0)) else 0 end as p04,
        case (select(day(A.SUPDATE))) when  ''05'' then SUM(isnull('+ @pvar +',0)) else 0 end as p05,
        case (select(day(A.SUPDATE))) when  ''06'' then SUM(isnull('+ @pvar +',0)) else 0 end as p06,
        case (select(day(A.SUPDATE))) when  ''07'' then SUM(isnull('+ @pvar +',0)) else 0 end as p07,
        case (select(day(A.SUPDATE))) when  ''08'' then SUM(isnull('+ @pvar +',0)) else 0 end as p08,
        case (select(day(A.SUPDATE))) when  ''09'' then SUM(isnull('+ @pvar +',0)) else 0 end as p09,
        case (select(day(A.SUPDATE))) when  ''10'' then SUM(isnull('+ @pvar +',0)) else 0 end as p10,
        case (select(day(A.SUPDATE))) when  ''11'' then SUM(isnull('+ @pvar +',0)) else 0 end as p11,
        case (select(day(A.SUPDATE))) when  ''12'' then SUM(isnull('+ @pvar +',0)) else 0 end as p12,
        case (select(day(A.SUPDATE))) when  ''13'' then SUM(isnull('+ @pvar +',0)) else 0 end as p13,
        case (select(day(A.SUPDATE))) when  ''14'' then SUM(isnull('+ @pvar +',0)) else 0 end as p14,
        case (select(day(A.SUPDATE))) when  ''15'' then SUM(isnull('+ @pvar +',0)) else 0 end as p15,
        case (select(day(A.SUPDATE))) when  ''16'' then SUM(isnull('+ @pvar +',0)) else 0 end as p16,
        case (select(day(A.SUPDATE))) when  ''17'' then SUM(isnull('+ @pvar +',0)) else 0 end as p17,
        case (select(day(A.SUPDATE))) when  ''18'' then SUM(isnull('+ @pvar +',0)) else 0 end as p18,
		case (select(day(A.SUPDATE))) when  ''19'' then SUM(isnull('+ @pvar +',0)) else 0 end as p19,
		case (select(day(A.SUPDATE))) when  ''20'' then SUM(isnull('+ @pvar +',0)) else 0 end as p20,
		case (select(day(A.SUPDATE))) when  ''21'' then SUM(isnull('+ @pvar +',0)) else 0 end as p21,
		case (select(day(A.SUPDATE))) when  ''22'' then SUM(isnull('+ @pvar +',0)) else 0 end as p22,
		case (select(day(A.SUPDATE))) when  ''23'' then SUM(isnull('+ @pvar +',0)) else 0 end as p23,
		case (select(day(A.SUPDATE))) when  ''24'' then SUM(isnull('+ @pvar +',0)) else 0 end as p24,
		case (select(day(A.SUPDATE))) when  ''25'' then SUM(isnull('+ @pvar +',0)) else 0 end as p25,
		case (select(day(A.SUPDATE))) when  ''26'' then SUM(isnull('+ @pvar +',0)) else 0 end as p26,
		case (select(day(A.SUPDATE))) when  ''27'' then SUM(isnull('+ @pvar +',0)) else 0 end as p27,
		case (select(day(A.SUPDATE))) when  ''28'' then SUM(isnull('+ @pvar +',0)) else 0 end as p28,
		case (select(day(A.SUPDATE))) when  ''29'' then SUM(isnull('+ @pvar +',0)) else 0 end as p29,
		case (select(day(A.SUPDATE))) when  ''30'' then SUM(isnull('+ @pvar +',0)) else 0 end as p30,
		case (select(day(A.SUPDATE))) when  ''31'' then SUM(isnull('+ @pvar +',0)) else 0 end as p31
		FROM  CIR_unsold_dtl A, CIR_AGMAST B, CIR_SUPPLY_TYPE_MAST C 
		WHERE	 A.COMP_CODE  = B.COMP_CODE AND	A.COMP_CODE  = C.COMP_CODE AND	A.COMP_CODE  = '''+@PCOMP_CODE+'''
		AND	A.UNIT_CODE  = B.UNIT AND	A.UNIT_CODE  = '''+@PUNIT_CODE+'''
		AND	A.AGCD  = B.AGCD AND (A.AGCD='+''''+@PAGCODE+''''+' OR '+''''+@PAGCODE+'''='''')
		AND	A.DPCD  = B.DPCD AND (A.DPCD='+''''+@PDPCODE+''''+' OR '+''''+@PDPCODE+'''='''')
		AND	A.PUBL  = '''+@PPUBL+''' AND (A.EDTN='''+@PEDTN+''' or '''+@PEDTN+''' IS NULL OR '''+@PEDTN+''' ='''') 
		AND (B.CITY_CODE='''+@PCITYCD+''' OR '''+@PCITYCD+''' IS NULL or '''+@PCITYCD+''' ='''') AND
		(DBO.cir_get_zone_by_city(B.COMP_CODE,B.city_code,''C'')='''+@PSTATECD+''' OR '''+@PSTATECD+''' IS NULL OR '''+@PSTATECD+'''='''') AND 
		(B.DIST_CODE='''+@PDISTCODE+''' OR '''+@PDISTCODE+''' IS NULL or '''+@PDISTCODE+''' ='''') AND (B.TEHSIL_TALUKA='''+@PTALUKA+''' OR '''+@PTALUKA+''' IS NULL or '''+@PTALUKA+''' ='''') AND 
        (B.BRANCH_CODE='''+@PBRANCH+''' OR '''+@PBRANCH+''' IS NULL or '''+@PBRANCH+''' ='''') AND (B.AG_TYPE='''+@PAGTYPE+''' OR '''+@PAGTYPE+''' IS NULL or '''+@PAGTYPE+''' ='''') AND (B.AG_CLASS='''+@PAGCLASS+''' OR '''+@PAGCLASS+''' IS NULL or '''+@PAGCLASS+''' ='''') AND
        --A.SUP_TYPE_CODE=C.SUP_TY_CODE AND (--A.SUP_TYPE_CODE='''+@PEXTRA1+''' OR '''+@PEXTRA1+''' IS NULL or '''+@PEXTRA1+''' ='''')  
		A.SUPDATE  BETWEEN '''+@VFRDT+'''  AND  '''+@VTODT+'''
		AND	ISNULL('+ @pvar +', 0)  > 0
		GROUP BY A.COMP_CODE,A.UNIT_CODE,A.SUPDATE) d
        GROUP BY d.COMP_CODE, d.UNIT_CODE
        ORDER BY  d.COMP_CODE, d.UNIT_CODE;'
		print (@pquery2)
	exec(@pquery)
	exec(@pquery1)
	exec(@pquery2)
	



/////////////////////////next



ALTER PROCEDURE [dbo].[cir_rep_unsold_supply_cir_monthly_net_paid_sale]
	@pcomp_code         as varchar(20),
	@punit_code         as varchar(20),
	@ppubl              as varchar(20),
	@pmainedtn          as varchar(20),
	@pedtn              as varchar(20),
	@pfromdate          as datetime,
	@ptilldate          as datetime,
	@pagency_type       as varchar(20),
	@pagency_class      as varchar(20),
	@pstatecode         as varchar(20),
	@pdistcode          as varchar(20),
	@ptaluka            as varchar(20),
	@pbranch            as varchar(20),
	@pagcd              as varchar(20),
	@pdpcd              as varchar(20),
	@preptype           as int,--1 for Agency Wise,2 for Main Edition wise,3 for District Taluka wise--4 for publication wise,5 for comm category wise, 6 for state wise,7 for branch wise,8 for zone wise,9 for route wise,10 for region wise
							   --11 route wise detailed,12 for main edition wise detailed
	@pbreak_on          as varchar(20),--Region R/State S/District D/Branch B / ZONE Z/ routewise O/ center C /PUBL  P / EDITION E
	@preturn_based      as varchar(20),--it is use for return date or supply date(R/S)	
	@plangtype          as varchar(20),
	@pdateformat        as varchar(20),
	@pextra1            as varchar(50),--for zone
	@pextra2            as varchar(50),-- for region
	@pextra3            as varchar(50),--for commission
	@pextra4            as varchar(50),-- for publication type		
	@pcommper           as numeric(14,2), -- for commper 
	@pcomslab           as varchar(50), -- for commision less than or greater than  
	@psuptype           as varchar(50),-- for supply type
	@pcopy_amt          as varchar(10),-- for based on copy or amt / C for Copy and A for AMOUNT
		
	@pextra5            as varchar(50),
	@pextra6            as varchar(50),
	@pextra7            as varchar(50),
	@pextra8            as varchar(50),
	@pextra9            as varchar(50),
	@pextra10            as varchar(50)
AS 
		
	DECLARE @v_hdays	AS	NUMERIC(5) 
	DECLARE @v_avg_sale AS  NUMERIC(10) 
	DECLARE @v_reg_code AS  varchar(200)
	DECLARE @v_zone_code varchar(200);
	DECLARE @v_publ_code varchar(200);
	DECLARE @v_route_code varchar(200);

	DECLARE @v1_comp_code	as varchar(50)
	DECLARE @v1_unit_code			as varchar(50)
    DECLARE @v1_branch_code			as varchar(50)
    DECLARE @v1_branch_name			as varchar(100)
    DECLARE @v1_publ				as varchar(50)
    DECLARE @v1_publ_name			as varchar(100)
    DECLARE @v1_main_edtn			as varchar(50)
    DECLARE @v1_main_edtn_name		as varchar(100)
    DECLARE @v1_edtn				as varchar(50)
    DECLARE @v1_edtn_name			as varchar(100)
    DECLARE @v1_copy_rate			as numeric(12,2)
    DECLARE @v1_agcd				as varchar(50)
    DECLARE @v1_dpcd				as varchar(50)
    DECLARE @v1_agname				as varchar(500)
    DECLARE @v1_agname_oth_lang		as varchar(500)
    DECLARE @v1_state_code			as varchar(50)
    DECLARE @v1_state_name			as varchar(500)
    DECLARE @v1_dist_code			as varchar(50)
    DECLARE @v1_dist_name			as varchar(100)
    DECLARE @v1_city_code			as varchar(50)
    DECLARE @v1_city_name			as varchar(150)
    DECLARE @v1_tehsil_taluka		as varchar(50)
    DECLARE @v1_taluka_name			as varchar(150)
    DECLARE @v1_route_code   		as varchar(50)
    DECLARE @v1_route_name			as varchar(150)
    DECLARE @v1_supply_copy			as int
    DECLARE @v1_return_copy			as int
    DECLARE @v1_net_sale_copy		as int
    DECLARE @v1_no_of_days			as int
    DECLARE @v1_unit_name			as varchar(150)
    DECLARE @v1_COM_CAT  			as varchar(150)
    declare @v1_supdate				as datetime


CREATE TABLE #CIR_DBKSUP_temp
(
	COMP_CODE varchar(8) NOT NULL,
	UNIT_CODE varchar(8) NOT NULL,
	PUBL varchar(3) NOT NULL,
	EDTN varchar(3) NOT NULL,
	AGCD varchar(8) NOT NULL,
	DPCD varchar(8) NOT NULL,
	SUPDATE datetime NOT NULL,
	SUP_TYPE_CODE varchar(5) NOT NULL,
	SUP_COPY numeric(10, 0) NULL,
	AGENCY_TY_CODE varchar(8) NULL,
	AGENCY_PKT_SIZE numeric(7, 0) NULL,
	COMM_CODE varchar(6) NULL,
	COMM_FIX_AUTO_SPL varchar(1) NULL,
	SUP_RATE numeric(10, 4) NULL,
	BILLAGCD varchar(8) NULL,
	BILLDPCD varchar(8) NULL,
	ROUTE_CODE varchar(5) NULL,
	SUBROUTE_CODE varchar(5) NULL,
	SUBSUBROUTE_CODE varchar(5) NULL,
	USERID varchar(10) NULL,
	CREATION_DATE datetime NULL,
	SURCH_CD varchar(5) NULL,
	ISSUE_DATE datetime NULL,
	RETURN_COPY_SALE varchar(1) NULL,
	FINAL_SUPPLY_FLAG varchar(1) NULL,
	UPDATED_BY varchar(30) NULL,
	UPDATED_DT datetime NULL,
	PER_COPY_WEIGHT numeric(15, 3) NULL,
	WASTE_CATG_CODE numeric(5, 0) NULL
)

	
	if @pcomslab ='G' 
	begin
		insert into #CIR_DBKSUP_temp(
		COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE
		)
		select COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE 
		from cir_dbksup b
		where b.comp_code =@pcomp_code 
		and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') 
		and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') 
		and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') 
		and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') 
		and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='')
		and b.supdate >= @pfromdate and b.supdate <=@ptilldate
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='') 
		and ( cast(substring(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar),2,len(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar)) ) as numeric) > cast(@pcommper as numeric) or cast(@pcommper as numeric) is null or cast(@pcommper as numeric) = '0')
	end
	else
	begin
		insert into #CIR_DBKSUP_temp(
		COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE
		)
		select COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE 
		from cir_dbksup b
		where b.comp_code =@pcomp_code 
		and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') 
		and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') 
		and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') 
		and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') 
		and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='')
		and b.supdate >= @pfromdate and b.supdate <=@ptilldate
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='') 
		and ( cast(substring(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar),2,len(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar)) ) as numeric) < cast(@pcommper as numeric) or cast(@pcommper as numeric) is null or cast(@pcommper as numeric) = '0')
	end
	

	
	if @pcopy_amt ='C' begin	
		DECLARE c1 cursor LOCAL FOR 
		select u.comp_code,u.unit_code,
		u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
		u.publ,u.publ_name,u.main_edtn,
		dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
		u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
		u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
		u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
		u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
		u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
		u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
		sum(supply_copy) supply_copy,sum(return_copy) return_copy,
		sum(supply_copy)-sum(return_copy) net_sale_copy,sum(no_of_days) no_of_days
		,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
		,u.comm_cat as COM_CAT
		from (
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
		sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, count(distinct supdate) no_of_days
		,b.comm_code comm_cat
		--from cir_agmast a,cir_dbksup b,cir_edtn_mast e,cir_publ_mast p
		from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p		
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
		b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
		b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,b.route_code,b.comm_code
		union all
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
		0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
		,d.comm_code comm_cat
		from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
		b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
		b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
		b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
		(e.main_edtn=@pmainedtn or @pmainedtn is null)
		and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
		and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
		where (u.supply_copy+u.return_copy)>0
		group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
		u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat; 
	end
	else
	begin
		DECLARE c1 cursor LOCAL FOR 
		select u.comp_code,u.unit_code,
		u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
		u.publ,u.publ_name,u.main_edtn,
		dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
		u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
		u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
		u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
		u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
		u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
		u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
		(sum(supply_copy)* u.copy_rate) supply_copy,(sum(return_copy)* u.copy_rate) return_copy,
		(sum(supply_copy)* u.copy_rate)-(sum(return_copy)* u.copy_rate) net_sale_copy,sum(no_of_days) no_of_days
		,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
		,u.comm_cat as COM_CAT
		from (
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
		sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, count(distinct supdate) no_of_days
		,b.comm_code comm_cat
		--from cir_agmast a,cir_dbksup b,cir_edtn_mast e,cir_publ_mast p
		from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
		b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
		b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,b.route_code,b.comm_code
		union all
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
		0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
		,d.comm_code comm_cat
		from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
		b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
		b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
		b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
		(e.main_edtn=@pmainedtn or @pmainedtn is null)
		and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
		and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
		where (u.supply_copy+u.return_copy)>0
		group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
		u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat; 
	end
	
	CREATE TABLE #CIR_TEMP_BILL_COLLECTION
	( COMP_CODE        VARCHAR(100),
	  UNIT_CODE        VARCHAR(100),
	  BILLNO           VARCHAR(200),
	  BILLDT           DATETIME,
	  PUBL_CODE        VARCHAR(100),
	  AGCD             VARCHAR(100),
	  DPCD             VARCHAR(100),
	  SUPPLY_COPY      NUMERIC(10)                   DEFAULT 0,
	  GROSS_AMT        NUMERIC(15,2)                 DEFAULT 0,
	  COMM_AMT         NUMERIC(15,2)                 DEFAULT 0,
	  SUR_AMT          NUMERIC(15,2)                 DEFAULT 0,
	  RETURN_COPY      NUMERIC(10)                   DEFAULT 0,
	  RETURN_AMT       NUMERIC(15,2)                 DEFAULT 0,
	  DN_AMT           NUMERIC(15,2)                 DEFAULT 0,
	  CN_AMT           NUMERIC(15,2)                 DEFAULT 0,
	  REC_AMT          NUMERIC(15,2)                 DEFAULT 0,
	  PREV_BAL         NUMERIC(15,2)                 DEFAULT 0,
	  CUR_SESSIONID    NUMERIC,
	  AGNAME           VARCHAR(200),
	  AGNAME_OTH_LANG  VARCHAR(250),
	  CITY_CODE        VARCHAR(200),
	  TALUKA_CODE      VARCHAR(200),
	  DIST_CODE        VARCHAR(200),
	  STATE_CODE       VARCHAR(200),
	  REGION          VARCHAR(500),
	  RET_COMM_AMT     NUMERIC(15,2),
	  BILL_SEC_AMT     NUMERIC(15,2),
	  SEC_OPBAL        NUMERIC(15,2),
	  zone_code        VARCHAR(200),
	  region_code        VARCHAR(200),
	  pro_type        VARCHAR(200),
	  route_code      VARCHAR(200),
	  copy_rate			numeric(14,2),
	  no_of_days		numeric(10),
	  unit_name			varchar(150),
	  COM_CAT           varchar(150),
	  supdate           datetime
	  )
		
		
		OPEN c1 
        fetch NEXT FROM c1 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_no_of_days,@v1_unit_name,@v1_COM_CAT
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN 
		
             
   
			If isnull(@v1_no_of_days,0)>0 Begin
                set @v_avg_sale=round(isnull(@v1_net_sale_copy,0)/(isnull(@v1_no_of_days,0)),0)
            End    
            Else Begin
                set @v_avg_sale=isnull(@v1_net_sale_copy,0)
            End

            select distinct @v_reg_code=region_code,@v_zone_code=zone_code from cir_city_mast where comp_code=@v1_comp_code and city_code=@v1_city_code            
            if(@v_reg_code='')
            begin
				set @v_reg_code=null
            end
           
            if(@v_zone_code='')
            begin
				set @v_zone_code=null
            end
            
            select distinct @v_publ_code=pro_type from cir_publ_mast where comp_code=@v1_comp_code and publ=@v1_publ;
            if(@v_publ_code='')
            begin
				set @v_publ_code=null
            end
            
            select distinct @v1_COM_CAT=COMM_CATG_DESC from CIR_COMM_CATG_MAST where comp_code=@v1_comp_code and COMM_CATG_CODE=@v1_COM_CAT            
            if(@v1_COM_CAT='')
            begin
				set @v1_COM_CAT=null
            end
            
            
            set @v_reg_code=dbo.cir_get_region_name(@v1_comp_code,@v_reg_code)
            set @v_zone_code=dbo.cir_get_zone_name(@v1_comp_code, @v_zone_code); 
			set @v_publ_code=dbo.cir_publ_type(@v1_comp_code,@v_publ_code,null,null);
            
            insert into #cir_temp_bill_collection
				(comp_code, unit_code, billno, publ_code, agcd, dpcd,agname,agname_oth_lang, city_code, 
				taluka_code, dist_code, state_code, REGION,supply_copy, return_copy ,copy_rate,no_of_days,zone_code, region_code,pro_type,route_code
				,unit_name,COM_CAT)
            values(@v1_comp_code,@v1_unit_code,@v1_branch_name,@v1_publ_name,@v1_main_edtn_name,@v1_edtn_name,@v1_agname,@v1_agname_oth_lang,@v1_city_name,
				@v1_taluka_name,@v1_dist_name,@v1_state_name,@v_reg_code,@v1_supply_copy,@v1_return_copy,@v1_copy_rate,@v1_no_of_days,@v_zone_code,@v_reg_code,@v_publ_code,@v1_route_name
				,@v1_unit_name,@v1_COM_CAT)
            
		    fetch NEXT FROM c1 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_no_of_days,@v1_unit_name,@v1_COM_CAT
		
		END 
		close c1
		DEALLOCATE c1
--------------  start for report type 1 AGENCY WISE 		
        if @preptype=1 Begin
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,agname,city_name,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by state_name,dist_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,agname,city_name,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,agname,city_name,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End   
            End
-------------------   end here for agency wise -------------------------
        Else if @preptype=2 Begin--for edition wise
             if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME, 
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,publ_code,agcd,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME, 
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_name,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by state_name,dist_code,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by unit_name,publ_code,agcd,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_code,agcd,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                order by route_name,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME, 
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,publ_code,copy_rate;

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End  
		End                
         Else if @preptype=3 Begin--for district taluka wise
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT
                ,state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT
                ,state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by unit_name,dist_code,taluka_code,copy_rate
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_code,dist_code,taluka_code,copy_rate
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                order by route_name,dist_code,taluka_code,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=4 Begin--for publication wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT
                ,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT
                ,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_code,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                 unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by unit_name,publ_code,agcd,dpcd,copy_rate
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_code,agcd,dpcd,copy_rate
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                order by route_name,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,publ_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=5 Begin--for comm category wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,COM_CAT,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,COM_CAT,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,COM_CAT,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,COM_CAT,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=6 Begin--for State wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,state_code AS STATE_NAME ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,state_code,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_name,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,state_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,state_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,state_code AS STATE_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,state_code AS STATE_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,state_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End  
        End
        Else if @preptype=7 Begin--for Branch wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT, billno AS BRANCH_NAME ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,billno,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,BILLNO,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_code,BILLNO,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,BILLNO,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,BILLNO,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by BILLNO,publ_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT, billno AS BRANCH_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by BILLNO,dist_code,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by BILLNO,dist_code,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,billno,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=8 Begin--for zone wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,zone_code,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,zone_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,dist_code,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,zone_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,zone_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT, zone_code as ZONE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,zone_code,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,zone_code,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,zone_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End  
        End
        Else if @preptype=9 Begin--for Route wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,route_code,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,route_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,route_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,route_code,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,route_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,route_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,route_code,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,route_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=10 Begin--for region wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,region,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,region,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=11 Begin--for edition date wise detailed            
			if @pcopy_amt ='C' begin	
				DECLARE c2 cursor LOCAL FOR 
				select u.comp_code,u.unit_code,
				u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
				u.publ,u.publ_name,u.main_edtn,
				dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
				u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
				u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
				u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
				u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
				u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
				u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
				sum(supply_copy) supply_copy,sum(return_copy) return_copy,
				sum(supply_copy)-sum(return_copy) net_sale_copy, supdate supdate
				,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
				,u.comm_cat as COM_CAT,count (distinct u.supdate) as no_of_days
				from (
				select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
				b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
				a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
				sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, supdate supdate
				,b.comm_code comm_cat
				from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
				where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
				b.comp_code =@pcomp_code and 
				b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
				b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
				a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
				b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
				(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
				(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
				(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
				(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
				and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
				and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
				and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
				and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
				and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
				group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
				b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
				a.country_code,a.tehsil_taluka,b.route_code,b.comm_code,b.supdate
				union all
				select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
				b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
				a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
				0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
				,d.comm_code comm_cat
				from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
				where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
				b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
				b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
				b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
				b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
				a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
				(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
				(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
				(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
				(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
				(e.main_edtn=@pmainedtn or @pmainedtn is null)
				and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
				and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
				and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
				and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
				and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
				group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
				b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
				a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
				where (u.supply_copy+u.return_copy)>0
				group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
				u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat,u.supdate; 
		end
		else
		begin
			DECLARE c2 cursor LOCAL FOR 
			select u.comp_code,u.unit_code,
			u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
			u.publ,u.publ_name,u.main_edtn,
			dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
			u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
			u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
			u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
			u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
			u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
			u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
			(sum(supply_copy)* u.copy_rate) supply_copy,(sum(return_copy)* u.copy_rate) return_copy,
			(sum(supply_copy)* u.copy_rate)-(sum(return_copy)* u.copy_rate) net_sale_copy, supdate supdate
			,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
			,u.comm_cat as COM_CAT,count (distinct u.supdate) as no_of_days
			from (
			select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
			b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
			a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
			sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, supdate supdate
			,b.comm_code comm_cat
			from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
			where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
			b.comp_code =@pcomp_code and 
			b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
			b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
			a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
			b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
			(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
			(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
			(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
			(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
			and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
			and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
			and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
			and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
			and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
			group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
			b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
			a.country_code,a.tehsil_taluka,b.route_code,b.comm_code,b.supdate
			union all
			select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
			b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
			a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
			0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
			,d.comm_code comm_cat
			from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
			where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
			b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
			b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
			b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
			b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
			a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
			(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
			(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
			(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
			(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
			(e.main_edtn=@pmainedtn or @pmainedtn is null)
			and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
			and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
			and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
			and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
			and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
			group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
			b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
			a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
			where (u.supply_copy+u.return_copy)>0
			group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
			u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat,u.supdate; 
		end
            
        delete from #cir_temp_bill_collection    
        OPEN c2 
        fetch NEXT FROM c2 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_supdate,@v1_unit_name,@v1_COM_CAT,@v1_no_of_days
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN 
   
			If isnull(@v1_no_of_days,0)>0 Begin
                set @v_avg_sale=round(isnull(@v1_net_sale_copy,0)/(isnull(@v1_no_of_days,0)),0)
            End    
            Else Begin
                set @v_avg_sale=isnull(@v1_net_sale_copy,0)
            End

            select distinct @v_reg_code=region_code,@v_zone_code=zone_code from cir_city_mast where comp_code=@v1_comp_code and city_code=@v1_city_code            
            if(@v_reg_code='')
            begin
				set @v_reg_code=null
            end
           
            if(@v_zone_code='')
            begin
				set @v_zone_code=null
            end
            
            select distinct @v_publ_code=pro_type from cir_publ_mast where comp_code=@v1_comp_code and publ=@v1_publ;
            if(@v_publ_code='')
            begin
				set @v_publ_code=null
            end
            
            select distinct @v1_COM_CAT=COMM_CATG_DESC from CIR_COMM_CATG_MAST where comp_code=@v1_comp_code and COMM_CATG_CODE=@v1_COM_CAT            
            if(@v1_COM_CAT='')
            begin
				set @v1_COM_CAT=null
            end
            
            
            set @v_reg_code=dbo.cir_get_region_name(@v1_comp_code,@v_reg_code)
            set @v_zone_code=dbo.cir_get_zone_name(@v1_comp_code, @v_zone_code); 
			set @v_publ_code=dbo.cir_publ_type(@v1_comp_code,@v_publ_code,null,null);
            
            insert into #cir_temp_bill_collection
				(comp_code, unit_code, billno, publ_code, agcd, dpcd,agname,agname_oth_lang, city_code, 
				taluka_code, dist_code, state_code, REGION,supply_copy, return_copy ,copy_rate,no_of_days,zone_code, region_code,pro_type,route_code
				,unit_name,COM_CAT,supdate)
            values(@v1_comp_code,@v1_unit_code,@v1_branch_name,@v1_publ_name,@v1_main_edtn_name,@v1_edtn_name,@v1_agname,@v1_agname_oth_lang,@v1_city_name,
				@v1_taluka_name,@v1_dist_name,@v1_state_name,@v_reg_code,@v1_supply_copy,@v1_return_copy,@v1_copy_rate,@v1_no_of_days,@v_zone_code,@v_reg_code,@v_publ_code,@v1_route_name
				,@v1_unit_name,@v1_COM_CAT,@v1_supdate)
            
		    fetch NEXT FROM c2 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_supdate,@v1_unit_name,@v1_COM_CAT,@v1_no_of_days
		
		END 
		close c2
		DEALLOCATE c2 
            
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,region,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,supdate,
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,region,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=12 Begin--for Route date wise detailed            
			if @pcopy_amt ='C' begin	
				DECLARE c2 cursor LOCAL FOR 
				select u.comp_code,u.unit_code,
				u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
				u.publ,u.publ_name,u.main_edtn,
				dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
				u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
				u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
				u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
				u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
				u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
				u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
				sum(supply_copy) supply_copy,sum(return_copy) return_copy,
				sum(supply_copy)-sum(return_copy) net_sale_copy, supdate supdate
				,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
				,u.comm_cat as COM_CAT,count (distinct u.supdate) as no_of_days
				from (
				select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
				b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
				a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
				sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, supdate supdate
				,b.comm_code comm_cat
				from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
				where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
				b.comp_code =@pcomp_code and 
				b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
				b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
				a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
				b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
				(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
				(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
				(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
				(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
				and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
				and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
				and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
				and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
				and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
				group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
				b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
				a.country_code,a.tehsil_taluka,b.route_code,b.comm_code,b.supdate
				union all
				select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
				b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
				a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
				0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
				,d.comm_code comm_cat
				from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
				where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
				b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
				b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
				b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
				b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
				a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
				(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
				(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
				(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
				(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
				(e.main_edtn=@pmainedtn or @pmainedtn is null)
				and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
				and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
				and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
				and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
				and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
				group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
				b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
				a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
				where (u.supply_copy+u.return_copy)>0
				group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
				u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat,u.supdate; 
		end
		else
		begin
			DECLARE c2 cursor LOCAL FOR 
			select u.comp_code,u.unit_code,
			u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
			u.publ,u.publ_name,u.main_edtn,
			dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
			u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
			u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
			u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
			u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
			u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
			u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
			(sum(supply_copy)* u.copy_rate) supply_copy,(sum(return_copy)* u.copy_rate) return_copy,
			(sum(supply_copy)* u.copy_rate)-(sum(return_copy)* u.copy_rate) net_sale_copy, supdate supdate
			,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
			,u.comm_cat as COM_CAT,count (distinct u.supdate) as no_of_days
			from (
			select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
			b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
			a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
			sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, supdate supdate
			,b.comm_code comm_cat
			from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
			where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
			b.comp_code =@pcomp_code and 
			b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
			b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
			a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
			b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
			(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
			(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
			(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
			(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
			and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
			and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
			and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
			and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
			and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
			group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
			b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
			a.country_code,a.tehsil_taluka,b.route_code,b.comm_code,b.supdate
			union all
			select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
			b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
			a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
			0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
			,d.comm_code comm_cat
			from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
			where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
			b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
			b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
			b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
			b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
			a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
			(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
			(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
			(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
			(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
			(e.main_edtn=@pmainedtn or @pmainedtn is null)
			and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
			and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
			and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
			and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
			and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
			group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
			b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
			a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
			where (u.supply_copy+u.return_copy)>0
			group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
			u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat,u.supdate; 
		end
            
        delete from #cir_temp_bill_collection    
        OPEN c2 
        fetch NEXT FROM c2 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_supdate,@v1_unit_name,@v1_COM_CAT,@v1_no_of_days
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN 
   
			If isnull(@v1_no_of_days,0)>0 Begin
                set @v_avg_sale=round(isnull(@v1_net_sale_copy,0)/(isnull(@v1_no_of_days,0)),0)
            End    
            Else Begin
                set @v_avg_sale=isnull(@v1_net_sale_copy,0)
            End

            select distinct @v_reg_code=region_code,@v_zone_code=zone_code from cir_city_mast where comp_code=@v1_comp_code and city_code=@v1_city_code            
            if(@v_reg_code='')
            begin
				set @v_reg_code=null
            end
           
            if(@v_zone_code='')
            begin
				set @v_zone_code=null
            end
            
            select distinct @v_publ_code=pro_type from cir_publ_mast where comp_code=@v1_comp_code and publ=@v1_publ;
            if(@v_publ_code='')
            begin
				set @v_publ_code=null
            end
            
            select distinct @v1_COM_CAT=COMM_CATG_DESC from CIR_COMM_CATG_MAST where comp_code=@v1_comp_code and COMM_CATG_CODE=@v1_COM_CAT            
            if(@v1_COM_CAT='')
            begin
				set @v1_COM_CAT=null
            end
            
            
            set @v_reg_code=dbo.cir_get_region_name(@v1_comp_code,@v_reg_code)
            set @v_zone_code=dbo.cir_get_zone_name(@v1_comp_code, @v_zone_code); 
			set @v_publ_code=dbo.cir_publ_type(@v1_comp_code,@v_publ_code,null,null);
            
            insert into #cir_temp_bill_collection
				(comp_code, unit_code, billno, publ_code, agcd, dpcd,agname,agname_oth_lang, city_code, 
				taluka_code, dist_code, state_code, REGION,supply_copy, return_copy ,copy_rate,no_of_days,zone_code, region_code,pro_type,route_code
				,unit_name,COM_CAT,supdate)
            values(@v1_comp_code,@v1_unit_code,@v1_branch_name,@v1_publ_name,@v1_main_edtn_name,@v1_edtn_name,@v1_agname,@v1_agname_oth_lang,@v1_city_name,
				@v1_taluka_name,@v1_dist_name,@v1_state_name,@v_reg_code,@v1_supply_copy,@v1_return_copy,@v1_copy_rate,@v1_no_of_days,@v_zone_code,@v_reg_code,@v_publ_code,@v1_route_name
				,@v1_unit_name,@v1_COM_CAT,@v1_supdate)
            
		    fetch NEXT FROM c2 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_supdate,@v1_unit_name,@v1_COM_CAT,@v1_no_of_days
		
		END 
		close c2
		DEALLOCATE c2 
            
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE,route_code as ROUTE_NAME ,supdate,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_code,region,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME  ,supdate,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,region,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        
        select getdate() as CUR_DATE
        select getdate() as CUR_DATE
   drop table #CIR_TEMP_BILL_COLLECTION
   
   drop table #CIR_DBKSUP_temp

 

/////////////////////////////////next

ALTER PROCEDURE [dbo].[cir_unsold_credit_note_cir_unsold_supply_p]
	@pcomp_code			as varchar(40),
	@punit_code			as varchar(40),
	@ppubl_code			as varchar(40),
	@pedtn_code			as varchar(40),
	@psup_fromdate		as datetime,
	@psup_todate        as datetime,
	@pagcd_code			as varchar(20),
	@pdpcd_code			as varchar(20),
	@pdateformat        as varchar(20),
	@preceiptdt         as datetime,
	@pextra1            as varchar(20),--it is use for datewise or ratewise
	@pextra2            as varchar(20)
As
Begin
	if upper(@pextra2)='D' Begin
	PRINT 'A'
 
		select z.comp_code AS "COMP_CODE",z.unit_code AS "UNIT_CODE",z.publ AS "PUBL",z.publ_name AS "PUBL_NAME",z.edtn AS "EDTN" , z.edtn_name AS "EDTN_NAME",
		z.supply_date AS "SUPPLY_DATE", z.supply_date AS "SUPPLY_DATEMON",z.copy_rate AS "COPY_RATE",z.comm_fix_auto_spl AS "COMM_FIX_AUTO_SPL" ,z.comm_code AS "COMM_CODE",z.waste_rate AS "WASTE_RATE",
        substring(z.comm_rate,1,1) AS "COMM_CATEG_TYPE",substring(z.comm_rate,2,len(z.comm_rate)-1) AS "COMM_RATE",z.supply_copy AS "SUPPLY_COPY",z.rate_supply AS "RATE_SUPPLY", 
        z.RETURNABLE as "RETURNABLE",z.per_copy_weight per_copy_weight 
        ,z.RETURNABLEper
            as "RETURNABLEper" from--P30,C0.5
        (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,p.publ_name publ_name,
        d.edtn edtn,edition_nick edtn_name,d.supdate supply_date,
        d.sup_rate copy_rate,d.comm_fix_auto_spl comm_fix_auto_spl,d.comm_code comm_code,
		dbo.cir_get_waste_rate_catg(d.comp_code,d.unit_code,d.edtn,supdate,''''+@pdateformat+'''',d.waste_catg_code,null,null) waste_rate,
        dbo.cir_get_commission(d.comp_code,d.unit_code,d.publ,d.edtn,d.comm_fix_auto_spl ,d.comm_code,d.supdate,''''+@pdateformat+'''',sum(d.sup_copy),'','') comm_rate,
		'P' comm_catg_type, sum(d.sup_copy) supply_copy,sum(d.sup_copy) rate_supply,
		d.per_copy_weight per_copy_weight,d.waste_catg_code waste_catg_code
		,dbo.cir_get_unsold_returnable(d.comp_code,d.publ,sum(d.sup_copy),'A01',@pagcd_code,@pdpcd_code,'Q','','')  as "RETURNABLE" 
		,dbo.cir_get_unsold_returnable(d.comp_code,d.publ,sum(d.sup_copy),'A01',@pagcd_code,@pdpcd_code,'P','','')   as "RETURNABLEper"
        from cir_dbksup_dis d,cir_publ_mast p,cir_edtn_mast e
        where d.comp_code=@pcomp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and
              d.unit_code=@punit_code and d.publ=p.publ and d.publ=e.publ and
              (d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='') and
              d.edtn=e.edtn and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') and
            d.supdate between @psup_fromdate and @psup_todate and
            d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code and upper(isnull(@pextra1,'D'))='D'
            group by d.comp_code,d.unit_code,d.publ,p.publ_name,e.edition_nick,d.edtn,d.supdate,d.sup_rate,d.comm_fix_auto_spl,d.comm_code,d.per_copy_weight,d.waste_catg_code)z
     union
        select distinct z.comp_code AS "COMP_CODE",z.unit_code AS "UNIT_CODE",z.publ AS "PUBL",z.publ_name AS "PUBL_NAME",z.edtn AS "EDTN",z.edtn_name AS "EDTN_NAME",
		MAX(z.supply_date) AS "SUPPLY_DATE",dbo.GetLastDayOfMonth(z.supply_date) AS "SUPPLY_DATEMON",
        z.copy_rate AS "COPY_RATE",z.comm_fix_auto_spl AS "COMM_FIX_AUTO_SPL",z.comm_code AS "COMM_CODE",z.waste_rate AS "WASTE_RATE",
        z.comm_catg_type AS "COMM_CATEG_TYPE",z.comm_rate AS "COMM_RATE",sum(z.supply_copy) AS "SUPPLY_COPY",sum(z.supply_copy) rate_supply,
        dbo.cir_get_unsold_returnable(z.comp_code,z.publ,sum(z.supply_copy),'A01',@pagcd_code,@pdpcd_code,'Q','','')  RETURNABLE,
        max(z.per_copy_weight) per_copy_weight 
        ,dbo.cir_get_unsold_returnable(z.comp_code,z.publ,sum(z.supply_copy),'A01',@pagcd_code,@pdpcd_code,'P','','') as "RETURNABLEper"  
        from (select distinct y.comp_code,y.unit_code,y.publ,y.publ_name,y.edtn,y.edtn_name,y.supply_date,y.copy_rate,y.comm_fix_auto_spl,y.comm_code,y.waste_rate,
        substring(y.comm_rate,1,1) comm_catg_type,substring(y.comm_rate,2,len(y.comm_rate)-1) comm_rate,y.supply_copy,y.rate_supply ,
        y.per_copy_weight per_copy_weight from--P30,C0.5
        (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,p.publ_name publ_name,
        d.edtn edtn,edition_nick edtn_name,d.supdate supply_date,
        d.sup_rate copy_rate,d.comm_fix_auto_spl comm_fix_auto_spl,d.comm_code comm_code,
		dbo.cir_get_waste_rate_catg(d.comp_code,d.unit_code,d.edtn,d.supdate,''''+@pdateformat+'''',d.waste_catg_code,null,null) waste_rate,
        dbo.cir_get_commission(d.comp_code,d.unit_code,d.publ,d.edtn,d.comm_fix_auto_spl ,d.comm_code,d.supdate,''''+@pdateformat+'''',sum(d.sup_copy),'','') comm_rate,'P' comm_catg_type, 
		sum(d.sup_copy) supply_copy,
        (select sum(u.sup_copy) from cir_dbksup_dis u where u.comp_code=d.comp_code and u.unit_code=d.unit_code and 
        (u.publ=d.publ) and u.edtn=d.edtn and u.supdate between @psup_fromdate and @psup_todate and 
        u.billagcd=@pagcd_code and u.billdpcd=@pdpcd_code and u.sup_rate=d.sup_rate) rate_supply,
        d.per_copy_weight per_copy_weight,d.waste_catg_code waste_catg_code
        from cir_dbksup_dis d,cir_publ_mast p,cir_edtn_mast e
        where d.comp_code=@pcomp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and
              d.unit_code=@punit_code and d.publ=p.publ and d.publ=e.publ and
              (d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='') and
              d.edtn=e.edtn and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') and
            d.supdate between @psup_fromdate and @psup_todate and
            d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code and upper(isnull(@pextra1,'D'))='R'
            group by d.comp_code,d.unit_code,d.publ,p.publ_name,e.edition_nick,d.edtn,d.supdate,d.sup_rate,d.comm_fix_auto_spl,d.comm_code,d.per_copy_weight,d.waste_catg_code)y) z
            group by z.comp_code,z.unit_code,z.publ,z.publ_name,z.edtn,z.edtn_name,dbo.GetLastDayOfMonth(z.supply_date),
                z.copy_rate,z.comm_fix_auto_spl,z.comm_code,z.waste_rate,z.comm_catg_type,z.comm_rate
			order by publ_name,edtn,supply_date
	End
	Else Begin
	PRINT 'B'
            select z.comp_code AS "COMP_CODE",z.unit_code AS "UNIT_CODE",z.publ AS "PUBL",z.publ_name AS "PUBL_NAME",z.edtn AS "EDTN",z.edtn_name AS "EDTN_NAME",
			z.supply_date AS "SUPPLY_DATE",z.supply_date AS "SUPPLY_DATEMON",
            z.copy_rate AS "COPY_RATE",z.comm_fix_auto_spl AS "COMM_FIX_AUTO_SPL",z.comm_code AS "COMM_CODE",z.waste_rate AS "WASTE_RATE",
            substring(z.comm_rate,1,1) AS "COMM_CATEG_TYPE",substring(z.comm_rate,2,len(z.comm_rate)-1) AS "COMM_RATE",z.supply_copy AS "SUPPLY_COPY",z.rate_supply AS "RATE_SUPPLY",
           z.RETURNABLE
            as "RETURNABLE" ,z.per_copy_weight per_copy_weight 
            ,z.RETURNABLEper
            as "RETURNABLEper"  from--P30,C0.5
            (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,p.publ_name publ_name,
            d.edtn edtn,edition_nick edtn_name,d.supdate supply_date,
            d.sup_rate copy_rate,d.comm_fix_auto_spl comm_fix_auto_spl,d.comm_code comm_code,
			dbo.cir_get_waste_rate_catg(d.comp_code,d.unit_code,d.edtn,supdate,''''+@pdateformat+'''',d.waste_catg_code,null,null) waste_rate,
            dbo.cir_get_commission(d.comp_code,d.unit_code,d.publ,d.edtn,d.comm_fix_auto_spl ,d.comm_code,d.supdate,''''+@pdateformat+'''',sum(d.sup_copy),'','') comm_rate,
			'P' comm_catg_type, sum(d.sup_copy) supply_copy,sum(d.sup_copy) rate_supply,
			d.per_copy_weight per_copy_weight,d.waste_catg_code waste_catg_code,
			dbo.cir_get_unsold_returnable(d.comp_code,d.publ,sum(d.sup_copy),'A01',@pagcd_code,@pdpcd_code,'Q','','')  
            as "RETURNABLE"
            ,dbo.cir_get_unsold_returnable(d.comp_code,d.publ,sum(d.sup_copy),'A01',@pagcd_code,@pdpcd_code,'P','','')   as "RETURNABLEper"
            from cir_dbksup d,cir_publ_mast p,cir_edtn_mast e
            where d.comp_code=@pcomp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and
                d.unit_code=@punit_code and d.publ=p.publ and d.publ=e.publ and
                  (d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='') and
                  d.edtn=e.edtn and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') and
                d.supdate between @psup_fromdate and @psup_todate and
                d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code and upper(isnull(@pextra1,'D'))='D'
                group by d.comp_code,d.unit_code,d.publ,p.publ_name,e.edition_nick,d.edtn,d.supdate,d.sup_rate,d.comm_fix_auto_spl,d.comm_code,d.per_copy_weight,d.waste_catg_code) z
            union
            select distinct z.comp_code AS "COMP_CODE",z.unit_code AS "UNIT_CODE",z.publ AS "PUBL",z.publ_name AS "PUBL_NAME",z.edtn AS "EDTN",z.edtn_name AS "EDTN_NAME",
			MAX(z.supply_date) AS "SUPPLY_DATE",dbo.GetLastDayOfMonth(z.supply_date) AS "SUPPLY_DATEMON",
            z.copy_rate AS "COPY_RATE",z.comm_fix_auto_spl AS "COMM_FIX_AUTO_SPL",z.comm_code AS "COMM_CODE",z.waste_rate AS "WASTE_RATE",
            z.comm_catg_type AS "COMM_CATEG_TYPE",z.comm_rate AS "COMM_RATE",sum(z.supply_copy) AS "SUPPLY_COPY",sum(z.supply_copy) AS "RATE_SUPPLY" ,
            dbo.cir_get_unsold_returnable(z.comp_code,z.publ,sum(z.supply_copy),'A01',@pagcd_code,@pdpcd_code,'Q','','') 
            as "RETURNABLE",max(z.per_copy_weight) per_copy_weight 
            ,dbo.cir_get_unsold_returnable(z.comp_code,z.publ,sum(z.supply_copy),'A01',@pagcd_code,@pdpcd_code,'P','','') as "RETURNABLEper" from
            (select distinct y.comp_code,y.unit_code,y.publ,y.publ_name,y.edtn,y.edtn_name,y.supply_date,y.copy_rate,y.comm_fix_auto_spl,y.comm_code,y.waste_rate,
            substring(y.comm_rate,1,1) comm_catg_type,substring(y.comm_rate,2,len(y.comm_rate)-1) comm_rate,y.supply_copy,y.rate_supply,
            y.per_copy_weight per_copy_weight from--P30,C0.5
            (select d.comp_code comp_code,d.unit_code unit_code,d.publ publ,p.publ_name publ_name,d.edtn edtn,edition_nick edtn_name,d.supdate supply_date,
            d.sup_rate copy_rate,d.comm_fix_auto_spl comm_fix_auto_spl,d.comm_code comm_code,
			dbo.cir_get_waste_rate_catg(d.comp_code,d.unit_code,d.edtn,d.supdate,''''+@pdateformat+'''',d.waste_catg_code,null,null) waste_rate,
            dbo.cir_get_commission(d.comp_code,d.unit_code,d.publ,d.edtn,d.comm_fix_auto_spl ,d.comm_code,d.supdate,''''+@pdateformat+'''',sum(d.sup_copy),'','') comm_rate,
			'P' comm_catg_type, sum(d.sup_copy) supply_copy,
            (select sum(u.sup_copy) from cir_dbksup u where u.comp_code=d.comp_code and u.unit_code=d.unit_code and 
            (u.publ=d.publ) and u.edtn=d.edtn and u.supdate between @psup_fromdate and @psup_todate and 
            u.billagcd=@pagcd_code and u.billdpcd=@pdpcd_code and u.sup_rate=d.sup_rate) rate_supply,
            d.per_copy_weight per_copy_weight,d.waste_catg_code waste_catg_code
            from cir_dbksup d,cir_publ_mast p,cir_edtn_mast e
            where d.comp_code=@pcomp_code and d.comp_code=p.comp_code and d.comp_code=e.comp_code and
                  d.unit_code=@punit_code and d.publ=p.publ and d.publ=e.publ and
                  (d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='') and
                  d.edtn=e.edtn and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') and
                d.supdate between @psup_fromdate and @psup_todate and
                d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code and upper(isnull(@pextra1,'D'))='R'
                group by d.comp_code,d.unit_code,d.publ,p.publ_name,e.edition_nick,d.edtn,d.supdate,d.sup_rate,d.comm_fix_auto_spl,d.comm_code,d.per_copy_weight,d.waste_catg_code) y) z
                group by z.comp_code,z.unit_code,z.publ,z.publ_name,z.edtn,z.edtn_name,dbo.GetLastDayOfMonth(z.supply_date),
                    z.copy_rate,z.comm_fix_auto_spl,z.comm_code,z.waste_rate,z.comm_catg_type,z.comm_rate
                order by publ_name,edtn,supply_date
	End
	
	--  this table for permissable days---------
	
	select top 1 ISNULL(z.output,'OK') as OUTPUT from(	
	select distinct dbo.cir_get_unsold_permissable_days
	(@pcomp_code,isnull(@ppubl_code,d.PUBL),'A01',@pagcd_code,@pdpcd_code,'D',@preceiptdt,@psup_fromdate,'','') as output
	,publ from cir_dbksup d 
	where d.comp_code=@pcomp_code and
	d.unit_code=@punit_code and
	(d.publ=@ppubl_code or @ppubl_code is null or @ppubl_code='')  
	and (d.edtn = @pedtn_code or @pedtn_code is null or @pedtn_code='') 
	and d.supdate between @psup_fromdate and @psup_todate and
	d.billagcd=@pagcd_code and d.billdpcd=@pdpcd_code
	group by d.PUBL) z where z.output not like 'OK%'
	
End



///////////////////////////next

alter PROCEDURE [dbo].[cir_rep_net_monthly_sale_verification]
	@pcomp_code         as varchar(20),
	@punit_code         as varchar(20),
	@ppubl              as varchar(20),
	@pubtype            as varchar(50),-- for publication type @pubtype
	@pmainedtn          as varchar(20),
	@pedtn              as varchar(20),
	@pfromdate          as datetime,
	@ptilldate          as datetime,
	@pagency_type       as varchar(20),
	@pagency_class      as varchar(20),
	@pstatecode         as varchar(20),
	@pdistcode          as varchar(20),
	@ptaluka            as varchar(20),
	@pbranch            as varchar(20),
	@pagcd              as varchar(20),
	@pdpcd              as varchar(20),	
	@pbreak_on          as varchar(20),--Region R/State S/District D/Branch B / ZONE Z/ routewise O/ center C /PUBL  P / EDITION E
	@preturn_based      as varchar(20),--it is use for return date or supply date(R/S)		
	@pdateformat        as varchar(20),
	@pcommper           as numeric(14,2), -- for commper  
	@pcomslab           as varchar(50), -- for commision less than or greater than
	@psuptype           as varchar(50),-- for supply type
	@pcopy_amt          as varchar(10),-- for based on copy or amt / C for Copy and A for AMOUNT	
	@pextra1            as varchar(50),
	@pextra2            as varchar(50),
	@pextra3            as varchar(50),		
	@pextra5            as varchar(50),
	@pextra6            as varchar(50),
	@pextra7            as varchar(50),
	@pextra8            as varchar(50),
	@pextra9            as varchar(50),
	@pextra10            as varchar(50)
AS 
		
	DECLARE @v_hdays	AS	NUMERIC(5) 
	DECLARE @v_avg_sale AS  NUMERIC(10) 
	DECLARE @v_reg_code AS  varchar(200)
	DECLARE @v_zone_code varchar(200);
	DECLARE @v_publ_code varchar(200);
	DECLARE @v_route_code varchar(200);

	DECLARE @v1_comp_code	as varchar(50)
	DECLARE @v1_unit_code			as varchar(50)
    DECLARE @v1_branch_code			as varchar(50)
    DECLARE @v1_branch_name			as varchar(100)
    DECLARE @v1_publ				as varchar(50)
    DECLARE @v1_publ_name			as varchar(100)
    DECLARE @v1_main_edtn			as varchar(50)
    DECLARE @v1_main_edtn_name		as varchar(100)
    DECLARE @v1_edtn				as varchar(50)
    DECLARE @v1_edtn_name			as varchar(100)
    DECLARE @v1_copy_rate			as numeric(12,2)
    DECLARE @v1_agcd				as varchar(50)
    DECLARE @v1_dpcd				as varchar(50)
    DECLARE @v1_agname				as varchar(500)
    DECLARE @v1_agname_oth_lang		as varchar(500)
    DECLARE @v1_state_code			as varchar(50)
    DECLARE @v1_state_name			as varchar(500)
    DECLARE @v1_dist_code			as varchar(50)
    DECLARE @v1_dist_name			as varchar(100)
    DECLARE @v1_city_code			as varchar(50)
    DECLARE @v1_city_name			as varchar(150)
    DECLARE @v1_tehsil_taluka		as varchar(50)
    DECLARE @v1_taluka_name			as varchar(150)
    DECLARE @v1_route_code   		as varchar(50)
    DECLARE @v1_route_name			as varchar(150)
    DECLARE @v1_supply_copy			as int
    DECLARE @v1_return_copy			as int
    DECLARE @v1_net_sale_copy		as int
    DECLARE @v1_no_of_days			as int
    DECLARE @v1_unit_name			as varchar(150)
    DECLARE @v1_COM_CAT  			as varchar(150)
    declare @v1_supdate				as datetime


CREATE TABLE #CIR_DBKSUP_temp
(
	COMP_CODE varchar(8) NOT NULL,
	UNIT_CODE varchar(8) NOT NULL,
	PUBL varchar(3) NOT NULL,
	EDTN varchar(3) NOT NULL,
	AGCD varchar(8) NOT NULL,
	DPCD varchar(8) NOT NULL,
	SUPDATE datetime NOT NULL,
	SUP_TYPE_CODE varchar(5) NOT NULL,
	SUP_COPY numeric(10, 0) NULL,
	AGENCY_TY_CODE varchar(8) NULL,
	AGENCY_PKT_SIZE numeric(7, 0) NULL,
	COMM_CODE varchar(6) NULL,
	COMM_FIX_AUTO_SPL varchar(1) NULL,
	SUP_RATE numeric(10, 4) NULL,
	BILLAGCD varchar(8) NULL,
	BILLDPCD varchar(8) NULL,
	ROUTE_CODE varchar(5) NULL,
	SUBROUTE_CODE varchar(5) NULL,
	SUBSUBROUTE_CODE varchar(5) NULL,
	USERID varchar(10) NULL,
	CREATION_DATE datetime NULL,
	SURCH_CD varchar(5) NULL,
	ISSUE_DATE datetime NULL,
	RETURN_COPY_SALE varchar(1) NULL,
	FINAL_SUPPLY_FLAG varchar(1) NULL,
	UPDATED_BY varchar(30) NULL,
	UPDATED_DT datetime NULL,
	PER_COPY_WEIGHT numeric(15, 3) NULL,
	WASTE_CATG_CODE numeric(5, 0) NULL
)

	
	if @pcomslab ='G' 
	begin
		insert into #CIR_DBKSUP_temp(
		COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE
		)
		select COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE 
		from cir_dbksup b
		where b.comp_code =@pcomp_code 
		and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') 
		and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') 
		and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') 
		and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') 
		and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='')
		and b.supdate >= @pfromdate and b.supdate <=@ptilldate
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='') 
		and ( cast(substring(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar),2,len(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar)) ) as numeric) > cast(@pcommper as numeric) or cast(@pcommper as numeric) is null or cast(@pcommper as numeric) = '0')
	end
	else
	begin
		insert into #CIR_DBKSUP_temp(
		COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE
		)
		select COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE 
		from cir_dbksup b
		where b.comp_code =@pcomp_code 
		and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') 
		and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') 
		and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') 
		and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') 
		and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='')
		and b.supdate >= @pfromdate and b.supdate <=@ptilldate
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='') 
		and ( cast(substring(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar),2,len(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar)) ) as numeric) < cast(@pcommper as numeric) or cast(@pcommper as numeric) is null or cast(@pcommper as numeric) = '0')
	end
	

	
	if @pcopy_amt ='C' begin	
		DECLARE c1 cursor LOCAL FOR 
		select u.comp_code,u.unit_code,
		u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
		u.publ,u.publ_name,u.main_edtn,
		dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
		u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
		u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
		u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,'1',null,null,null) dist_name,
		u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,'1',null,null,null) city_name,
		u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,'1',null,null,null) taluka_name,
		u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
		sum(supply_copy) supply_copy,sum(return_copy) return_copy,
		sum(supply_copy)-sum(return_copy) net_sale_copy,sum(no_of_days) no_of_days
		,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
		,u.MON		
		from (
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang
		,a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
		sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, count(distinct supdate) no_of_days		
		,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3)) as MON
		from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p		
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
		b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
		b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pubtype or @pubtype is null or @pubtype ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,b.route_code,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3))
		union all
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
		0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
		,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3)) as MON
		from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
		b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
		b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
		b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
		(e.main_edtn=@pmainedtn or @pmainedtn is null)
		and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pubtype or @pubtype is null or @pubtype ='')
		and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,d.route_code,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3))) u
		where (u.supply_copy+u.return_copy)>0
		group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
		u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code
		,u.country_code,u.MON; 
	end
	else
	begin
		DECLARE c1 cursor LOCAL FOR 
		select u.comp_code,u.unit_code,
		u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
		u.publ,u.publ_name,u.main_edtn,
		dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
		u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
		u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
		u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,'1',null,null,null) dist_name,
		u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,'1',null,null,null) city_name,
		u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,'1',null,null,null) taluka_name,
		u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
		(sum(supply_copy)* u.copy_rate) supply_copy,(sum(return_copy)* u.copy_rate) return_copy,
		(sum(supply_copy)* u.copy_rate)-(sum(return_copy)* u.copy_rate) net_sale_copy,sum(no_of_days) no_of_days
		,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
		,u.MON as MON
		from (
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
		sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, count(distinct supdate) no_of_days		
		,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3)) as MON
		from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
		b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
		b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pubtype or @pubtype is null or @pubtype ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,b.route_code,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3))
		union all
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
		0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
		,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3)) as MON
		from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
		b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
		b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
		b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
		(e.main_edtn=@pmainedtn or @pmainedtn is null)
		and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pubtype or @pubtype is null or @pubtype ='')
		and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,d.route_code ,upper(SUBSTRING(CONVERT(VARCHAR(11), b.supdate, 113), 4, 3))) u
		where (u.supply_copy+u.return_copy)>0
		group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
		u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.MON; 
	end
	
	CREATE TABLE #CIR_TEMP_BILL_COLLECTION
	( COMP_CODE        VARCHAR(100),
	  UNIT_CODE        VARCHAR(100),
	  BILLNO           VARCHAR(200),
	  BILLDT           DATETIME,
	  PUBL_CODE        VARCHAR(100),
	  AGCD             VARCHAR(100),
	  DPCD             VARCHAR(100),
	  SUPPLY_COPY      NUMERIC(10)                   DEFAULT 0,
	  GROSS_AMT        NUMERIC(15,2)                 DEFAULT 0,
	  COMM_AMT         NUMERIC(15,2)                 DEFAULT 0,
	  SUR_AMT          NUMERIC(15,2)                 DEFAULT 0,
	  RETURN_COPY      NUMERIC(10)                   DEFAULT 0,
	  RETURN_AMT       NUMERIC(15,2)                 DEFAULT 0,
	  DN_AMT           NUMERIC(15,2)                 DEFAULT 0,
	  CN_AMT           NUMERIC(15,2)                 DEFAULT 0,
	  REC_AMT          NUMERIC(15,2)                 DEFAULT 0,
	  PREV_BAL         NUMERIC(15,2)                 DEFAULT 0,
	  CUR_SESSIONID    NUMERIC,
	  AGNAME           VARCHAR(200),
	  AGNAME_OTH_LANG  VARCHAR(250),
	  CITY_CODE        VARCHAR(200),
	  TALUKA_CODE      VARCHAR(200),
	  DIST_CODE        VARCHAR(200),
	  STATE_CODE       VARCHAR(200),
	  REGION          VARCHAR(500),
	  RET_COMM_AMT     NUMERIC(15,2),
	  BILL_SEC_AMT     NUMERIC(15,2),
	  SEC_OPBAL        NUMERIC(15,2),
	  zone_code        VARCHAR(200),
	  region_code        VARCHAR(200),
	  pro_type        VARCHAR(200),
	  route_code      VARCHAR(200),
	  copy_rate			numeric(14,2),
	  no_of_days		numeric(10),
	  unit_name			varchar(150),
	  COM_CAT           varchar(150),
	  supdate           datetime
	  )
		
		
		OPEN c1 
        fetch NEXT FROM c1 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_no_of_days,@v1_unit_name,@v1_COM_CAT
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN 
		
             
   
			If isnull(@v1_no_of_days,0)>0 Begin
                set @v_avg_sale=round(isnull(@v1_net_sale_copy,0)/(isnull(@v1_no_of_days,0)),0)
            End    
            Else Begin
                set @v_avg_sale=isnull(@v1_net_sale_copy,0)
            End

            select distinct @v_reg_code=region_code,@v_zone_code=zone_code from cir_city_mast where comp_code=@v1_comp_code and city_code=@v1_city_code            
            if(@v_reg_code='')
            begin
				set @v_reg_code=null
            end
           
            if(@v_zone_code='')
            begin
				set @v_zone_code=null
            end
            
            select distinct @v_publ_code=pro_type from cir_publ_mast where comp_code=@v1_comp_code and publ=@v1_publ;
            if(@v_publ_code='')
            begin
				set @v_publ_code=null
            end
            
            select distinct @v1_COM_CAT=COMM_CATG_DESC from CIR_COMM_CATG_MAST where comp_code=@v1_comp_code and COMM_CATG_CODE=@v1_COM_CAT            
            if(@v1_COM_CAT='')
            begin
				set @v1_COM_CAT=null
            end
            
            
            set @v_reg_code=dbo.cir_get_region_name(@v1_comp_code,@v_reg_code)
            set @v_zone_code=dbo.cir_get_zone_name(@v1_comp_code, @v_zone_code); 
			set @v_publ_code=dbo.cir_publ_type(@v1_comp_code,@v_publ_code,null,null);
            
            insert into #cir_temp_bill_collection
				(comp_code, unit_code, billno, publ_code, agcd, dpcd,agname,agname_oth_lang, city_code, 
				taluka_code, dist_code, state_code, REGION,supply_copy, return_copy ,copy_rate,no_of_days,zone_code, region_code,pro_type,route_code
				,unit_name,COM_CAT)
            values(@v1_comp_code,@v1_unit_code,@v1_branch_name,@v1_publ_name,@v1_main_edtn_name,@v1_edtn_name,@v1_agname,@v1_agname_oth_lang,@v1_city_name,
				@v1_taluka_name,@v1_dist_name,@v1_state_name,@v_reg_code,@v1_supply_copy,@v1_return_copy,@v1_copy_rate,@v1_no_of_days,@v_zone_code,@v_reg_code,@v_publ_code,@v1_route_name
				,@v1_unit_name,@v1_COM_CAT)
            
		    fetch NEXT FROM c1 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_no_of_days,@v1_unit_name,@v1_COM_CAT
		
		END 
		close c1
		DEALLOCATE c1

            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE,region AS REGION_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,region
                order by region,COM_CAT

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
				select comp_code AS COMP_CODE,STATE_CODE AS STATE_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,STATE_CODE
                order by STATE_CODE,COM_CAT

                select comp_code AS COMP_CODE,  
                STATE_CODE AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,STATE_CODE order by STATE_CODE         
                
            End    
            Else if @pbreak_on='D' Begin -- district wise
				select comp_code AS COMP_CODE,dist_code AS DIST_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,dist_code
                order by dist_code,COM_CAT

                select comp_code AS COMP_CODE,  
                dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,dist_code order by dist_code 
                
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
				select comp_code AS COMP_CODE,zone_code as ZONE_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,zone_code
                order by zone_code,COM_CAT

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,zone_code order by zone_code
                
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                select comp_code AS COMP_CODE,unit_name as UNIT_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,unit_name
                order by unit_name,COM_CAT

                select comp_code AS COMP_CODE,  
                unit_name as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,unit_name order by unit_name
                
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                select comp_code AS COMP_CODE,publ_code AS PUBL_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,publ_code
                order by publ_code,COM_CAT

                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,publ_code order by publ_code                
                
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
				select comp_code AS COMP_CODE,route_code as ROUTE_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,route_code
                order by route_code,COM_CAT

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,route_code order by route_code 
			    
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise
				
				select comp_code AS COMP_CODE,billno AS BRANCH_NAME
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,billno
                order by billno,COM_CAT

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by billno 
                   
             End
             else if @pbreak_on='E' Begin  ---  Edition Wise
				select comp_code AS COMP_CODE,dpcd AS SUB_EDTN
                ,COM_CAT AS MON,  sum(no_of_days) AS NO_OF_DAYS               
                ,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,(sum(supply_copy)-sum(return_copy)) AS NET_SALE,
                case when isnull(sum(no_of_days),0)>0 then round((sum(supply_copy)-sum(return_copy))/sum(no_of_days),0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,COM_CAT,dpcd
                order by dpcd,COM_CAT

                select comp_code AS COMP_CODE,  
                dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,dpcd order by dpcd 
               
             End   
        
        select getdate() as CUR_DATE
        select getdate() as CUR_DATE
   drop table #CIR_TEMP_BILL_COLLECTION
   
   drop table #CIR_DBKSUP_temp

 

//////////////////////////////next


ALTER PROCEDURE [dbo].[cir_rep_unsold_supply_cir_monthly_net_paid_sale]
	@pcomp_code         as varchar(20),
	@punit_code         as varchar(20),
	@ppubl              as varchar(20),
	@pmainedtn          as varchar(20),
	@pedtn              as varchar(20),
	@pfromdate          as datetime,
	@ptilldate          as datetime,
	@pagency_type       as varchar(20),
	@pagency_class      as varchar(20),
	@pstatecode         as varchar(20),
	@pdistcode          as varchar(20),
	@ptaluka            as varchar(20),
	@pbranch            as varchar(20),
	@pagcd              as varchar(20),
	@pdpcd              as varchar(20),
	@preptype           as int,--1 for Agency Wise,2 for Main Edition wise,3 for District Taluka wise--4 for publication wise,5 for comm category wise, 6 for state wise,7 for branch wise,8 for zone wise,9 for route wise,10 for region wise
							   --11 route wise detailed,12 for main edition wise detailed
	@pbreak_on          as varchar(20),--Region R/State S/District D/Branch B / ZONE Z/ routewise O/ center C /PUBL  P / EDITION E
	@preturn_based      as varchar(20),--it is use for return date or supply date(R/S)	
	@plangtype          as varchar(20),
	@pdateformat        as varchar(20),
	@pextra1            as varchar(50),--for zone
	@pextra2            as varchar(50),-- for region
	@pextra3            as varchar(50),--for commission
	@pextra4            as varchar(50),-- for publication type		
	@pcommper           as numeric(14,2), -- for commper 
	@pcomslab           as varchar(50), -- for commision less than or greater than  
	@psuptype           as varchar(50),-- for supply type
	@pcopy_amt          as varchar(10),-- for based on copy or amt / C for Copy and A for AMOUNT
		
	@pextra5            as varchar(50),
	@pextra6            as varchar(50),
	@pextra7            as varchar(50),
	@pextra8            as varchar(50),
	@pextra9            as varchar(50),
	@pextra10            as varchar(50)
AS 
		
	DECLARE @v_hdays	AS	NUMERIC(5) 
	DECLARE @v_avg_sale AS  NUMERIC(10) 
	DECLARE @v_reg_code AS  varchar(200)
	DECLARE @v_zone_code varchar(200);
	DECLARE @v_publ_code varchar(200);
	DECLARE @v_route_code varchar(200);

	DECLARE @v1_comp_code	as varchar(50)
	DECLARE @v1_unit_code			as varchar(50)
    DECLARE @v1_branch_code			as varchar(50)
    DECLARE @v1_branch_name			as varchar(100)
    DECLARE @v1_publ				as varchar(50)
    DECLARE @v1_publ_name			as varchar(100)
    DECLARE @v1_main_edtn			as varchar(50)
    DECLARE @v1_main_edtn_name		as varchar(100)
    DECLARE @v1_edtn				as varchar(50)
    DECLARE @v1_edtn_name			as varchar(100)
    DECLARE @v1_copy_rate			as numeric(12,2)
    DECLARE @v1_agcd				as varchar(50)
    DECLARE @v1_dpcd				as varchar(50)
    DECLARE @v1_agname				as varchar(500)
    DECLARE @v1_agname_oth_lang		as varchar(500)
    DECLARE @v1_state_code			as varchar(50)
    DECLARE @v1_state_name			as varchar(500)
    DECLARE @v1_dist_code			as varchar(50)
    DECLARE @v1_dist_name			as varchar(100)
    DECLARE @v1_city_code			as varchar(50)
    DECLARE @v1_city_name			as varchar(150)
    DECLARE @v1_tehsil_taluka		as varchar(50)
    DECLARE @v1_taluka_name			as varchar(150)
    DECLARE @v1_route_code   		as varchar(50)
    DECLARE @v1_route_name			as varchar(150)
    DECLARE @v1_supply_copy			as int
    DECLARE @v1_return_copy			as int
    DECLARE @v1_net_sale_copy		as int
    DECLARE @v1_no_of_days			as int
    DECLARE @v1_unit_name			as varchar(150)
    DECLARE @v1_COM_CAT  			as varchar(150)
    declare @v1_supdate				as datetime


CREATE TABLE #CIR_DBKSUP_temp
(
	COMP_CODE varchar(8) NOT NULL,
	UNIT_CODE varchar(8) NOT NULL,
	PUBL varchar(3) NOT NULL,
	EDTN varchar(3) NOT NULL,
	AGCD varchar(8) NOT NULL,
	DPCD varchar(8) NOT NULL,
	SUPDATE datetime NOT NULL,
	SUP_TYPE_CODE varchar(5) NOT NULL,
	SUP_COPY numeric(10, 0) NULL,
	AGENCY_TY_CODE varchar(8) NULL,
	AGENCY_PKT_SIZE numeric(7, 0) NULL,
	COMM_CODE varchar(6) NULL,
	COMM_FIX_AUTO_SPL varchar(1) NULL,
	SUP_RATE numeric(10, 4) NULL,
	BILLAGCD varchar(8) NULL,
	BILLDPCD varchar(8) NULL,
	ROUTE_CODE varchar(5) NULL,
	SUBROUTE_CODE varchar(5) NULL,
	SUBSUBROUTE_CODE varchar(5) NULL,
	USERID varchar(10) NULL,
	CREATION_DATE datetime NULL,
	SURCH_CD varchar(5) NULL,
	ISSUE_DATE datetime NULL,
	RETURN_COPY_SALE varchar(1) NULL,
	FINAL_SUPPLY_FLAG varchar(1) NULL,
	UPDATED_BY varchar(30) NULL,
	UPDATED_DT datetime NULL,
	PER_COPY_WEIGHT numeric(15, 3) NULL,
	WASTE_CATG_CODE numeric(5, 0) NULL
)

	
	if @pcomslab ='G' 
	begin
		insert into #CIR_DBKSUP_temp(
		COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE
		)
		select COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE 
		from cir_dbksup b
		where b.comp_code =@pcomp_code 
		and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') 
		and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') 
		and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') 
		and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') 
		and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='')
		and b.supdate >= @pfromdate and b.supdate <=@ptilldate
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='') 
		and ( cast(substring(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar),2,len(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar)) ) as numeric) > cast(@pcommper as numeric) or cast(@pcommper as numeric) is null or cast(@pcommper as numeric) = '0')
	end
	else
	begin
		insert into #CIR_DBKSUP_temp(
		COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE
		)
		select COMP_CODE,UNIT_CODE,PUBL,EDTN,AGCD,DPCD,SUPDATE,SUP_TYPE_CODE,SUP_COPY,AGENCY_TY_CODE,AGENCY_PKT_SIZE,
		COMM_CODE,COMM_FIX_AUTO_SPL,SUP_RATE,BILLAGCD,BILLDPCD,ROUTE_CODE,SUBROUTE_CODE,SUBSUBROUTE_CODE,
		USERID,CREATION_DATE,SURCH_CD,ISSUE_DATE,RETURN_COPY_SALE,FINAL_SUPPLY_FLAG,UPDATED_BY,UPDATED_DT,
		PER_COPY_WEIGHT,WASTE_CATG_CODE 
		from cir_dbksup b
		where b.comp_code =@pcomp_code 
		and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') 
		and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') 
		and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') 
		and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') 
		and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='')
		and b.supdate >= @pfromdate and b.supdate <=@ptilldate
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='') 
		and ( cast(substring(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar),2,len(cast(dbo.cir_get_commission(b.comp_code,b.unit_code,b.publ,b.edtn,b.COMM_FIX_AUTO_SPL,b.COMM_CODE,b.SUPDATE,@pdateformat,b.SUP_COPY,'','' ) as varchar)) ) as numeric) < cast(@pcommper as numeric) or cast(@pcommper as numeric) is null or cast(@pcommper as numeric) = '0')
	end
	

	
	if @pcopy_amt ='C' begin	
		DECLARE c1 cursor LOCAL FOR 
		select u.comp_code,u.unit_code,
		u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
		u.publ,u.publ_name,u.main_edtn,
		dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
		u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
		u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
		u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
		u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
		u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
		u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
		sum(supply_copy) supply_copy,sum(return_copy) return_copy,
		sum(supply_copy)-sum(return_copy) net_sale_copy,sum(no_of_days) no_of_days
		,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
		,u.comm_cat as COM_CAT
		from (
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
		sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, count(distinct supdate) no_of_days
		,b.comm_code comm_cat
		--from cir_agmast a,cir_dbksup b,cir_edtn_mast e,cir_publ_mast p
		from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p		
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
		b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
		b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,b.route_code,b.comm_code
		union all
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
		0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
		,d.comm_code comm_cat
		from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
		b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
		b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
		b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
		(e.main_edtn=@pmainedtn or @pmainedtn is null)
		and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
		and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
		where (u.supply_copy+u.return_copy)>0
		group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
		u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat; 
	end
	else
	begin
		DECLARE c1 cursor LOCAL FOR 
		select u.comp_code,u.unit_code,
		u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
		u.publ,u.publ_name,u.main_edtn,
		dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
		u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
		u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
		u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
		u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
		u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
		u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
		(sum(supply_copy)* u.copy_rate) supply_copy,(sum(return_copy)* u.copy_rate) return_copy,
		(sum(supply_copy)* u.copy_rate)-(sum(return_copy)* u.copy_rate) net_sale_copy,sum(no_of_days) no_of_days
		,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
		,u.comm_cat as COM_CAT
		from (
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
		sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, count(distinct supdate) no_of_days
		,b.comm_code comm_cat
		--from cir_agmast a,cir_dbksup b,cir_edtn_mast e,cir_publ_mast p
		from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
		b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
		b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
		and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
		and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,b.route_code,b.comm_code
		union all
		select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
		a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
		0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
		,d.comm_code comm_cat
		from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
		where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
		b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
		b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
		b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
		b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
		a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
		(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
		(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
		(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
		(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
		(e.main_edtn=@pmainedtn or @pmainedtn is null)
		and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
		and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
		and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
		and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
		and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
		group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
		b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
		a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
		where (u.supply_copy+u.return_copy)>0
		group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
		u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat; 
	end
	
	CREATE TABLE #CIR_TEMP_BILL_COLLECTION
	( COMP_CODE        VARCHAR(100),
	  UNIT_CODE        VARCHAR(100),
	  BILLNO           VARCHAR(200),
	  BILLDT           DATETIME,
	  PUBL_CODE        VARCHAR(100),
	  AGCD             VARCHAR(100),
	  DPCD             VARCHAR(100),
	  SUPPLY_COPY      NUMERIC(10)                   DEFAULT 0,
	  GROSS_AMT        NUMERIC(15,2)                 DEFAULT 0,
	  COMM_AMT         NUMERIC(15,2)                 DEFAULT 0,
	  SUR_AMT          NUMERIC(15,2)                 DEFAULT 0,
	  RETURN_COPY      NUMERIC(10)                   DEFAULT 0,
	  RETURN_AMT       NUMERIC(15,2)                 DEFAULT 0,
	  DN_AMT           NUMERIC(15,2)                 DEFAULT 0,
	  CN_AMT           NUMERIC(15,2)                 DEFAULT 0,
	  REC_AMT          NUMERIC(15,2)                 DEFAULT 0,
	  PREV_BAL         NUMERIC(15,2)                 DEFAULT 0,
	  CUR_SESSIONID    NUMERIC,
	  AGNAME           VARCHAR(200),
	  AGNAME_OTH_LANG  VARCHAR(250),
	  CITY_CODE        VARCHAR(200),
	  TALUKA_CODE      VARCHAR(200),
	  DIST_CODE        VARCHAR(200),
	  STATE_CODE       VARCHAR(200),
	  REGION          VARCHAR(500),
	  RET_COMM_AMT     NUMERIC(15,2),
	  BILL_SEC_AMT     NUMERIC(15,2),
	  SEC_OPBAL        NUMERIC(15,2),
	  zone_code        VARCHAR(200),
	  region_code        VARCHAR(200),
	  pro_type        VARCHAR(200),
	  route_code      VARCHAR(200),
	  copy_rate			numeric(14,2),
	  no_of_days		numeric(10),
	  unit_name			varchar(150),
	  COM_CAT           varchar(150),
	  supdate           datetime
	  )
		
		
		OPEN c1 
        fetch NEXT FROM c1 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_no_of_days,@v1_unit_name,@v1_COM_CAT
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN 
		
             
   
			If isnull(@v1_no_of_days,0)>0 Begin
                set @v_avg_sale=round(isnull(@v1_net_sale_copy,0)/(isnull(@v1_no_of_days,0)),0)
            End    
            Else Begin
                set @v_avg_sale=isnull(@v1_net_sale_copy,0)
            End

            select distinct @v_reg_code=region_code,@v_zone_code=zone_code from cir_city_mast where comp_code=@v1_comp_code and city_code=@v1_city_code            
            if(@v_reg_code='')
            begin
				set @v_reg_code=null
            end
           
            if(@v_zone_code='')
            begin
				set @v_zone_code=null
            end
            
            select distinct @v_publ_code=pro_type from cir_publ_mast where comp_code=@v1_comp_code and publ=@v1_publ;
            if(@v_publ_code='')
            begin
				set @v_publ_code=null
            end
            
            select distinct @v1_COM_CAT=COMM_CATG_DESC from CIR_COMM_CATG_MAST where comp_code=@v1_comp_code and COMM_CATG_CODE=@v1_COM_CAT            
            if(@v1_COM_CAT='')
            begin
				set @v1_COM_CAT=null
            end
            
            
            set @v_reg_code=dbo.cir_get_region_name(@v1_comp_code,@v_reg_code)
            set @v_zone_code=dbo.cir_get_zone_name(@v1_comp_code, @v_zone_code); 
			set @v_publ_code=dbo.cir_publ_type(@v1_comp_code,@v_publ_code,null,null);
            
            insert into #cir_temp_bill_collection
				(comp_code, unit_code, billno, publ_code, agcd, dpcd,agname,agname_oth_lang, city_code, 
				taluka_code, dist_code, state_code, REGION,supply_copy, return_copy ,copy_rate,no_of_days,zone_code, region_code,pro_type,route_code
				,unit_name,COM_CAT)
            values(@v1_comp_code,@v1_unit_code,@v1_branch_name,@v1_publ_name,@v1_main_edtn_name,@v1_edtn_name,@v1_agname,@v1_agname_oth_lang,@v1_city_name,
				@v1_taluka_name,@v1_dist_name,@v1_state_name,@v_reg_code,@v1_supply_copy,@v1_return_copy,@v1_copy_rate,@v1_no_of_days,@v_zone_code,@v_reg_code,@v_publ_code,@v1_route_name
				,@v1_unit_name,@v1_COM_CAT)
            
		    fetch NEXT FROM c1 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_no_of_days,@v1_unit_name,@v1_COM_CAT
		
		END 
		close c1
		DEALLOCATE c1
--------------  start for report type 1 AGENCY WISE 		
        if @preptype=1 Begin
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,agname,city_name,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by state_name,dist_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,agname,city_name,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,agname,city_name,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,agname AS AGNAME,agname_oth_lang AS AGNAME_OTH_LANG,city_code as CITY_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,agname,city_name,copy_rate;

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End   
            End
-------------------   end here for agency wise -------------------------
        Else if @preptype=2 Begin--for edition wise
             if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME, 
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,publ_code,agcd,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME, 
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_name,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by state_name,dist_code,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by unit_name,publ_code,agcd,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_code,agcd,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                order by route_name,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME, 
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,publ_code,agcd,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,publ_code,copy_rate;

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End  
		End                
         Else if @preptype=3 Begin--for district taluka wise
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT
                ,state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT
                ,state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by unit_name,dist_code,taluka_code,copy_rate
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_code,dist_code,taluka_code,copy_rate
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                order by route_name,dist_code,taluka_code,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,state_code AS STATE_NAME,dist_code AS DIST_NAME,taluka_code AS TALUKA_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,dist_code,taluka_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=4 Begin--for publication wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT
                ,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT
                ,publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_code,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                 unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by unit_name,publ_code,agcd,dpcd,copy_rate
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_code,agcd,dpcd,copy_rate
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                order by route_name,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,
                publ_code AS PUBL_NAME,agcd AS MAIN_EDTN_NAME,dpcd AS EDTN_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,publ_code,agcd,dpcd,copy_rate

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,publ_code AS PUBL_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,publ_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=5 Begin--for comm category wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,COM_CAT,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,COM_CAT,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,COM_CAT,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,COM_CAT,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,COM_CAT,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=6 Begin--for State wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,state_code AS STATE_NAME ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,state_code,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,COM_CAT AS COM_CAT, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_name,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,state_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,state_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,state_code AS STATE_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,state_code AS STATE_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,state_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End  
        End
        Else if @preptype=7 Begin--for Branch wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT, billno AS BRANCH_NAME ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,billno,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,BILLNO,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by dist_code,BILLNO,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,BILLNO,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,BILLNO,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by BILLNO,publ_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT, billno AS BRANCH_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by BILLNO,dist_code,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by BILLNO,dist_code,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,billno AS BRANCH_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,billno,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=8 Begin--for zone wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,zone_code,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,zone_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,state_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,dist_code,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,zone_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,zone_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT, zone_code as ZONE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,zone_code,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,zone_code,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,zone_code as ZONE_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,zone_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End  
        End
        Else if @preptype=9 Begin--for Route wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,route_code,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,route_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME, 
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,route_code,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,route_code,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,route_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,route_code,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,route_code,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,route_code,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=10 Begin--for region wise
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE, unit_code AS UNIT ,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,region,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,region AS REGION_NAME, 
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,region,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=11 Begin--for edition date wise detailed            
			if @pcopy_amt ='C' begin	
				DECLARE c2 cursor LOCAL FOR 
				select u.comp_code,u.unit_code,
				u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
				u.publ,u.publ_name,u.main_edtn,
				dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
				u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
				u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
				u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
				u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
				u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
				u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
				sum(supply_copy) supply_copy,sum(return_copy) return_copy,
				sum(supply_copy)-sum(return_copy) net_sale_copy, supdate supdate
				,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
				,u.comm_cat as COM_CAT,count (distinct u.supdate) as no_of_days
				from (
				select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
				b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
				a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
				sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, supdate supdate
				,b.comm_code comm_cat
				from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
				where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
				b.comp_code =@pcomp_code and 
				b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
				b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
				a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
				b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
				(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
				(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
				(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
				(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
				and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
				and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
				and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
				and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
				and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
				group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
				b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
				a.country_code,a.tehsil_taluka,b.route_code,b.comm_code,b.supdate
				union all
				select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
				b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
				a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
				0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
				,d.comm_code comm_cat
				from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
				where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
				b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
				b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
				b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
				b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
				a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
				(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
				(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
				(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
				(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
				(e.main_edtn=@pmainedtn or @pmainedtn is null)
				and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
				and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
				and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
				and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
				and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
				group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
				b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
				a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
				where (u.supply_copy+u.return_copy)>0
				group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
				u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat,u.supdate; 
		end
		else
		begin
			DECLARE c2 cursor LOCAL FOR 
			select u.comp_code,u.unit_code,
			u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
			u.publ,u.publ_name,u.main_edtn,
			dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
			u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
			u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
			u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
			u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
			u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
			u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
			(sum(supply_copy)* u.copy_rate) supply_copy,(sum(return_copy)* u.copy_rate) return_copy,
			(sum(supply_copy)* u.copy_rate)-(sum(return_copy)* u.copy_rate) net_sale_copy, supdate supdate
			,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
			,u.comm_cat as COM_CAT,count (distinct u.supdate) as no_of_days
			from (
			select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
			b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
			a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
			sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, supdate supdate
			,b.comm_code comm_cat
			from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
			where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
			b.comp_code =@pcomp_code and 
			b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
			b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
			a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
			b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
			(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
			(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
			(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
			(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
			and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
			and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
			and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
			and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
			and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
			group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
			b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
			a.country_code,a.tehsil_taluka,b.route_code,b.comm_code,b.supdate
			union all
			select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
			b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
			a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
			0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
			,d.comm_code comm_cat
			from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
			where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
			b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
			b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
			b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
			b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
			a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
			(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
			(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
			(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
			(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
			(e.main_edtn=@pmainedtn or @pmainedtn is null)
			and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
			and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
			and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
			and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
			and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
			group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
			b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
			a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
			where (u.supply_copy+u.return_copy)>0
			group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
			u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat,u.supdate; 
		end
            
        delete from #cir_temp_bill_collection    
        OPEN c2 
        fetch NEXT FROM c2 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_supdate,@v1_unit_name,@v1_COM_CAT,@v1_no_of_days
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN 
   
			If isnull(@v1_no_of_days,0)>0 Begin
                set @v_avg_sale=round(isnull(@v1_net_sale_copy,0)/(isnull(@v1_no_of_days,0)),0)
            End    
            Else Begin
                set @v_avg_sale=isnull(@v1_net_sale_copy,0)
            End

            select distinct @v_reg_code=region_code,@v_zone_code=zone_code from cir_city_mast where comp_code=@v1_comp_code and city_code=@v1_city_code            
            if(@v_reg_code='')
            begin
				set @v_reg_code=null
            end
           
            if(@v_zone_code='')
            begin
				set @v_zone_code=null
            end
            
            select distinct @v_publ_code=pro_type from cir_publ_mast where comp_code=@v1_comp_code and publ=@v1_publ;
            if(@v_publ_code='')
            begin
				set @v_publ_code=null
            end
            
            select distinct @v1_COM_CAT=COMM_CATG_DESC from CIR_COMM_CATG_MAST where comp_code=@v1_comp_code and COMM_CATG_CODE=@v1_COM_CAT            
            if(@v1_COM_CAT='')
            begin
				set @v1_COM_CAT=null
            end
            
            
            set @v_reg_code=dbo.cir_get_region_name(@v1_comp_code,@v_reg_code)
            set @v_zone_code=dbo.cir_get_zone_name(@v1_comp_code, @v_zone_code); 
			set @v_publ_code=dbo.cir_publ_type(@v1_comp_code,@v_publ_code,null,null);
            
            insert into #cir_temp_bill_collection
				(comp_code, unit_code, billno, publ_code, agcd, dpcd,agname,agname_oth_lang, city_code, 
				taluka_code, dist_code, state_code, REGION,supply_copy, return_copy ,copy_rate,no_of_days,zone_code, region_code,pro_type,route_code
				,unit_name,COM_CAT,supdate)
            values(@v1_comp_code,@v1_unit_code,@v1_branch_name,@v1_publ_name,@v1_main_edtn_name,@v1_edtn_name,@v1_agname,@v1_agname_oth_lang,@v1_city_name,
				@v1_taluka_name,@v1_dist_name,@v1_state_name,@v_reg_code,@v1_supply_copy,@v1_return_copy,@v1_copy_rate,@v1_no_of_days,@v_zone_code,@v_reg_code,@v_publ_code,@v1_route_name
				,@v1_unit_name,@v1_COM_CAT,@v1_supdate)
            
		    fetch NEXT FROM c2 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_supdate,@v1_unit_name,@v1_COM_CAT,@v1_no_of_days
		
		END 
		close c2
		DEALLOCATE c2 
            
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_name,region,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,agcd AS MAIN_EDTN,dpcd AS SUB_EDTN ,supdate,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,supdate,
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,region,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        Else if @preptype=12 Begin--for Route date wise detailed            
			if @pcopy_amt ='C' begin	
				DECLARE c2 cursor LOCAL FOR 
				select u.comp_code,u.unit_code,
				u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
				u.publ,u.publ_name,u.main_edtn,
				dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
				u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
				u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
				u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
				u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
				u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
				u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
				sum(supply_copy) supply_copy,sum(return_copy) return_copy,
				sum(supply_copy)-sum(return_copy) net_sale_copy, supdate supdate
				,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
				,u.comm_cat as COM_CAT,count (distinct u.supdate) as no_of_days
				from (
				select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
				b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
				a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
				sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, supdate supdate
				,b.comm_code comm_cat
				from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
				where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
				b.comp_code =@pcomp_code and 
				b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
				b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
				a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
				b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
				(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
				(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
				(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
				(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
				and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
				and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
				and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
				and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
				and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
				group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
				b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
				a.country_code,a.tehsil_taluka,b.route_code,b.comm_code,b.supdate
				union all
				select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
				b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
				a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
				0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
				,d.comm_code comm_cat
				from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
				where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
				b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
				b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
				b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
				b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
				a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
				(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
				(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
				(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
				(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
				(e.main_edtn=@pmainedtn or @pmainedtn is null)
				and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
				and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
				and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
				and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
				and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
				group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
				b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
				a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
				where (u.supply_copy+u.return_copy)>0
				group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
				u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat,u.supdate; 
		end
		else
		begin
			DECLARE c2 cursor LOCAL FOR 
			select u.comp_code,u.unit_code,
			u.branch_code branch_code,(select distinct Branch_Name from branch_mst where Branch_Code=u.branch_code) branch_name,
			u.publ,u.publ_name,u.main_edtn,
			dbo.cir_get_edtn_name(u.comp_code,u.main_edtn) main_edtn_name,u.edtn edtn,u.edtn_name,u.copy_rate,
			u.agcd agcd,u.dpcd dpcd,u.agname agname,u.agname_oth_lang agname_oth_lang,
			u.state_code,dbo.cir_get_state(u.comp_code,u.country_code,u.state_code) state_name,
			u.dist_code ,dbo.cir_get_name_cir_district(u.comp_code,u.dist_code,@plangtype,null,null,null) dist_name,
			u.city_code city_code,dbo.cir_get_name_cir_city(u.comp_code,u.city_code,@plangtype,null,null,null) city_name,
			u.tehsil_taluka,dbo.cir_get_name_cir_taluka(u.comp_code,u.tehsil_taluka,@plangtype,null,null,null) taluka_name,
			u.route_code,dbo.cir_get_route_name(u.comp_code,u.unit_code,u.route_code ) route_name,
			(sum(supply_copy)* u.copy_rate) supply_copy,(sum(return_copy)* u.copy_rate) return_copy,
			(sum(supply_copy)* u.copy_rate)-(sum(return_copy)* u.copy_rate) net_sale_copy, supdate supdate
			,dbo.cir_get_unit_name(u.comp_code,u.unit_code) as UNIT_NAME
			,u.comm_cat as COM_CAT,count (distinct u.supdate) as no_of_days
			from (
			select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate copy_rate,
			b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
			a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka, b.route_code, 
			sum(isnull(b.sup_copy,0)) supply_copy,0 return_copy, supdate supdate
			,b.comm_code comm_cat
			from cir_agmast a,#CIR_DBKSUP_temp b,cir_edtn_mast e,cir_publ_mast p
			where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and 
			b.comp_code =@pcomp_code and 
			b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and 
			b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and
			a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
			b.supdate >= @pfromdate and b.supdate <=@ptilldate and 
			(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
			(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
			(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
			(e.main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')
			and (b.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
			and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
			and (b.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')    
			and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
			and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
			group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.sup_rate,
			b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
			a.country_code,a.tehsil_taluka,b.route_code,b.comm_code,b.supdate
			union all
			select b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
			b.agcd,b.dpcd,a.ag_name agname,a.ag_name_oth_lang agname_oth_lang,
			a.branch_code,a.city_code,a.dist_code, a.state_code,a.country_code,a.tehsil_taluka,d.route_code,  
			0 supply_copy,sum(isnull(b.apr_short_recpt,0)+isnull(b.apr_late_recpt,0)+isnull(b.apr_bnr,0)+isnull(b.apr_unsold,0)) return_copy,0 no_of_days
			,d.comm_code comm_cat
			from cir_agmast a,cir_unsold_dtl b,cir_edtn_mast e,cir_publ_mast p,cir_dbksup d
			where b.comp_code =a.comp_code and b.comp_code=e.comp_code and b.comp_code=p.comp_code and b.comp_code =@pcomp_code and 
			b.unit_code=a.unit and (b.unit_code=@punit_code or @punit_code is null or @punit_code ='') and  
			b.doctype='UCN' and ((b.recptdt >= @pfromdate and b.recptdt <=@ptilldate and isnull(@preturn_based,'R') ='R') or (b.supdate >= @pfromdate and b.supdate <=@ptilldate and isnull(@preturn_based,'R') ='S')) and 
			b.publ=d.publ and b.edtn=d.edtn and a.agcd=d.agcd and a.dpcd=d.dpcd and
			b.publ=e.publ and b.publ=p.publ and (b.publ=isnull(@ppubl,b.publ) or @ppubl='') and b.edtn=e.edtn and (b.edtn=isnull(@pedtn,b.edtn) or @pedtn='') and 
			a.agcd=b.agcd and (b.agcd=isnull(@pagcd,b.agcd) or @pagcd='') and a.dpcd=b.dpcd and (b.dpcd=isnull(@pdpcd,b.dpcd) or @pdpcd='') and
			(a.ag_type=@pagency_type or @pagency_type is null or @pagency_type='') and(a.ag_class=@pagency_class or @pagency_class is null or @pagency_class='') and
			(a.branch_code=@pbranch or @pbranch is null or @pbranch='') and (a.state_code=@pstatecode or @pstatecode is null or @pstatecode='') and
			(a.dist_code=@pdistcode or @pdistcode is null or @pdistcode='') and (a.tehsil_taluka=@ptaluka or @ptaluka is null or @ptaluka='') and
			(isnull(apr_short_recpt,0)+isnull(apr_late_recpt,0)+isnull(apr_bnr,0)+isnull(apr_unsold,0))>0 and
			(e.main_edtn=@pmainedtn or @pmainedtn is null)
			and (d.comm_code=@pextra3 or @pextra3 is null or @pextra3 ='')
			and (p.pro_type=@pextra4 or @pextra4 is null or @pextra4 ='')
			and (d.sup_type_code=@psuptype or @psuptype is null or @psuptype ='')
			and (dbo.cir_get_zone_by_city(a.comp_code,a.city_code,'C')=@pextra1 or @pextra1 is null or @pextra1 ='')
			and (dbo.cir_get_region_by_city(a.comp_code,a.city_code,'C')=@pextra2 or @pextra2 is null or @pextra2 ='')
			group by b.comp_code,b.unit_code,b.publ,p.publ_name,e.main_edtn,b.edtn,e.edtn_name,b.copy_rate,
			b.agcd,b.dpcd,a.ag_name,a.ag_name_oth_lang,a.branch_code,a.city_code,a.dist_code, a.state_code,
			a.country_code,a.tehsil_taluka,d.route_code ,d.comm_code) u
			where (u.supply_copy+u.return_copy)>0
			group by u.comp_code,u.unit_code,u.branch_code,u.publ,u.publ_name,u.main_edtn,u.edtn,u.edtn_name,u.copy_rate,
			u.agcd,u.dpcd,u.agname,u.agname_oth_lang,u.state_code,u.dist_code ,u.city_code,u.tehsil_taluka,u.route_code,u.country_code,u.comm_cat,u.supdate; 
		end
            
        delete from #cir_temp_bill_collection    
        OPEN c2 
        fetch NEXT FROM c2 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_supdate,@v1_unit_name,@v1_COM_CAT,@v1_no_of_days
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN 
   
			If isnull(@v1_no_of_days,0)>0 Begin
                set @v_avg_sale=round(isnull(@v1_net_sale_copy,0)/(isnull(@v1_no_of_days,0)),0)
            End    
            Else Begin
                set @v_avg_sale=isnull(@v1_net_sale_copy,0)
            End

            select distinct @v_reg_code=region_code,@v_zone_code=zone_code from cir_city_mast where comp_code=@v1_comp_code and city_code=@v1_city_code            
            if(@v_reg_code='')
            begin
				set @v_reg_code=null
            end
           
            if(@v_zone_code='')
            begin
				set @v_zone_code=null
            end
            
            select distinct @v_publ_code=pro_type from cir_publ_mast where comp_code=@v1_comp_code and publ=@v1_publ;
            if(@v_publ_code='')
            begin
				set @v_publ_code=null
            end
            
            select distinct @v1_COM_CAT=COMM_CATG_DESC from CIR_COMM_CATG_MAST where comp_code=@v1_comp_code and COMM_CATG_CODE=@v1_COM_CAT            
            if(@v1_COM_CAT='')
            begin
				set @v1_COM_CAT=null
            end
            
            
            set @v_reg_code=dbo.cir_get_region_name(@v1_comp_code,@v_reg_code)
            set @v_zone_code=dbo.cir_get_zone_name(@v1_comp_code, @v_zone_code); 
			set @v_publ_code=dbo.cir_publ_type(@v1_comp_code,@v_publ_code,null,null);
            
            insert into #cir_temp_bill_collection
				(comp_code, unit_code, billno, publ_code, agcd, dpcd,agname,agname_oth_lang, city_code, 
				taluka_code, dist_code, state_code, REGION,supply_copy, return_copy ,copy_rate,no_of_days,zone_code, region_code,pro_type,route_code
				,unit_name,COM_CAT,supdate)
            values(@v1_comp_code,@v1_unit_code,@v1_branch_name,@v1_publ_name,@v1_main_edtn_name,@v1_edtn_name,@v1_agname,@v1_agname_oth_lang,@v1_city_name,
				@v1_taluka_name,@v1_dist_name,@v1_state_name,@v_reg_code,@v1_supply_copy,@v1_return_copy,@v1_copy_rate,@v1_no_of_days,@v_zone_code,@v_reg_code,@v_publ_code,@v1_route_name
				,@v1_unit_name,@v1_COM_CAT,@v1_supdate)
            
		    fetch NEXT FROM c2 INTO @v1_comp_code,@v1_unit_code, @v1_branch_code, @v1_branch_name,@v1_publ, @v1_publ_name,@v1_main_edtn,@v1_main_edtn_name,@v1_edtn,@v1_edtn_name,@v1_copy_rate, @v1_agcd, @v1_dpcd,@v1_agname,@v1_agname_oth_lang,@v1_state_code,@v1_state_name,@v1_dist_code,@v1_dist_name,@v1_city_code,@v1_city_name, @v1_tehsil_taluka,@v1_taluka_name,@v1_route_code,@v1_route_name,@v1_supply_copy,@v1_return_copy,@v1_net_sale_copy, @v1_supdate,@v1_unit_name,@v1_COM_CAT,@v1_no_of_days
		
		END 
		close c2
		DEALLOCATE c2 
            
            
            if @pbreak_on='R' Begin -- region wise
                select comp_code AS COMP_CODE,route_code as ROUTE_NAME ,supdate,
                region AS REGION_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection order by region,copy_rate

                select comp_code AS COMP_CODE,  
                region AS REGION_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                group by comp_code,region order by region_name
			End       
            else if @pbreak_on='S' Begin  -- state wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE 
                from #cir_temp_bill_collection
                order by state_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE
                from #cir_temp_bill_collection 
                group by comp_code,state_code order by state_name
            End    
            Else if @pbreak_on='D' Begin -- district wise
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round((return_copy/supply_copy)*100,2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round((supply_copy-return_copy)/no_of_days,0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_code,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                state_code AS STATE_NAME,dist_code AS DIST_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,state_code,dist_code order by state_name,dist_name;
            End             
            else if @pbreak_on='Z' begin  ---ZONE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,zone_code as ZONE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 
                then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,
                case when isnull(no_of_days,0)>0 
                then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by zone_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                zone_code as ZONE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round((sum(return_copy)/sum(supply_copy))*100,2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,zone_code order by zone_name
            end
            else if @pbreak_on='C' begin  ---CENTER WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME
                ,unit_name as UNIT_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by UNIT_NAME,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                UNIT_NAME as UNIT_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,UNIT_NAME order by UNIT_NAME;
			end
			else if @pbreak_on='P' begin  ---PUBLICATION WISE
                
                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,publ_code AS PUBL_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection  order by publ_name,REGION,copy_rate;
                
                select comp_code AS COMP_CODE,  
                publ_code AS PUBL_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,publ_code order by publ_name;
            end
			else if @pbreak_on='O' begin  --- ROUTE WISE
                select comp_code AS COMP_CODE, unit_code AS UNIT ,supdate,
                state_code AS STATE_NAME,dist_code AS DIST_NAME,route_code as ROUTE_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection --order by state_name,dist_name,agname,city_name,copy_rate,route_name;
                order by route_code,region,copy_rate;

                select comp_code AS COMP_CODE,  
                route_code as ROUTE_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER, 
                0 AS NO_OF_DAYS,0 AS AVG_NET_SALE 
                from #cir_temp_bill_collection 
                group by comp_code,route_code order by route_name ;
             end
            else if @pbreak_on='B' Begin  ---  Branch Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME  ,supdate,
                billno AS BRANCH_NAME,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by branch_name,REGION,copy_rate;

                select comp_code AS COMP_CODE,  
                billno AS BRANCH_NAME,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,billno order by branch_name;   
             End 
             else if @pbreak_on='E' Begin  ---  Edition Wise

                select comp_code AS COMP_CODE, unit_code AS UNIT,route_code as ROUTE_NAME ,supdate,
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,copy_rate as COPY_RATE,supply_copy AS SUPPLY_COPY, return_copy AS RETURN_COPY ,(supply_copy-return_copy) AS NET_SALE,
                case when isnull(supply_copy,0)>0 then round(((return_copy/supply_copy)*100),2) else 0 end as NET_PER,
                no_of_days AS NO_OF_DAYS,case when isnull(no_of_days,0)>0 then round(((supply_copy-return_copy)/no_of_days),0) else 0 end AS AVG_NET_SALE
                from #cir_temp_bill_collection order by AGCD,dpcd,region,copy_rate

                select comp_code AS COMP_CODE,  
                agcd AS MAIN_EDTN,dpcd AS SUB_EDTN,sum(supply_copy) AS SUPPLY_COPY, sum(return_copy) AS RETURN_COPY ,sum(supply_copy-return_copy) AS NET_SALE,
                case when isnull(sum(supply_copy),0)>0 then round(((sum(return_copy)/sum(supply_copy))*100),2) else 0 end as NET_PER,
                0 AS NO_OF_DAYS, 0 AS AVG_NET_SALE
                from #cir_temp_bill_collection
                group by comp_code,agcd,dpcd order by agcd,dpcd;   
             End 
        End
        
        select getdate() as CUR_DATE
        select getdate() as CUR_DATE
   drop table #CIR_TEMP_BILL_COLLECTION
   
   drop table #CIR_DBKSUP_temp

 ////////////////////next

ALTER procedure [dbo].[agency_reason_close_p] (
    @pcompcode    varchar(8),
    @pdateformat  varchar(20),
    @pextra1      varchar(20),
    @pextra2      varchar(20)
   )
       
   

AS
   declare @vno varchar(50)
	declare @vtype_code 	varchar(15)
	declare @v_sess_id numeric(18,0) 
declare @ptype_code varchar(200)
select @v_sess_id=@@spid
 select  @vno=max(substring(REASON_CODE,3,5))+1  from cir_ag_close_reason where comp_code=@pcompcode
If ISNULL(@vno,0)=0 
begin

  	set @vtype_code='CR'+'001'
end
 	Else
begin
declare @vlen int
set @vlen=len(@vno)
if(@vlen=1)
begin
set @vno='00'+@vno
end
if(@vlen=2)
begin
set @vno='0'+@vno
end

    set @vtype_code='CR'+@vno
 	End
create table #package1 (var_code varchar (100),vsessionid varchar (100))
 delete from #package1 where vsessionid=@v_sess_id
  insert into #package1(var_code,vsessionid) values(@vtype_code,@v_sess_id)
 select var_code as "VAR_CODE",vsessionid  from #package1  where vsessionid=@v_sess_id



/////////////////////next

ALTER PROCEDURE [dbo].[cir_rep_supply_cir_route_supply_variance_multiple_p]
	@pcomp_code                               VARCHAR(20) ,
	@punit_code                               VARCHAR(20) ,
	@ppublication                             VARCHAR(20) ,
	@pmainedtn                                VARCHAR(20) ,
	@pedtn                                    VARCHAR(20) ,
	@proute                                   VARCHAR(20) ,
	@pfirstdate                               VARCHAR(20) ,
	@pseconddate                              VARCHAR(20) ,
	@pthirddate                               VARCHAR(20) ,
	@pdateformat                              VARCHAR(20) ,
	@pextra1                                  VARCHAR(200),--it is use for finalised or unfinalised
	@pextra2                                  VARCHAR(200),--it is used for supply type 
	@pextra3             as varchar(200),--agency type
	@pextra4             as varchar(200),-- agency class
	@pextra5             as varchar(200),--final.unfinal
	@pextra6             as varchar(200),
	@pextra7             as varchar(200),
	@pextra8             as varchar(200),
	@pextra9             as varchar(200),
	@pextra10            as varchar(200)
AS 

	DECLARE @vfirstdate                               DATETIME 
	DECLARE @vseconddate                              DATETIME 
	DECLARE @vthirddate                               DATETIME 
Begin		
	SET @vfirstdate  =  dbo.convert_user_date('/',@pfirstdate,@pdateformat)
	SET @vseconddate  = dbo.convert_user_date('/',@pseconddate,@pdateformat)
	SET @vthirddate  = dbo.convert_user_date('/',@pthirddate,@pdateformat)
	print(@vfirstdate)
	print(@vseconddate)
	print(@vthirddate)

	If upper(@pextra1)='U' Begin
         select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
         dbo.cir_get_city(x.comp_code,x.city_code) "CITY NAME",
         x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG"
         ,sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",sum(x.third_sup) "THIRD SUPPLY",
         -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C",
		
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
         dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and                           
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                           order by comp_code,route_code,ag_name
		End
        else	Begin
				select x.comp_code "COMP CODE",x.agcd "AGENCY CODE",x.dpcd "AGENCY SUB CODE",x.ag_name "AGENCY NAME",x.ag_name_oth_lang "AGENCY OTHER LANG",
				x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
				sum(x.third_sup) "THIRD SUPPLY",
           -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,1) "DROP POINT NAME",
                 dbo.cir_get_drop_point_name(x.comp_code,x.unit_code,x.station_code,2) "DROP POINT NAME OTHER LANG",x.branch_code "BRANCH NAME" from
                                (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code =     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd      =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code=   b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn      =   a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and 
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                             (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
								   and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
								   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
								   )x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.unit_code,x.agcd,x.dpcd,x.ag_name,x.ag_name_oth_lang,x.city_code,x.route_code,
									x.route_name,x.route_name_oth_lang,x.station_code,x.branch_code
                                   order by comp_code,route_code,ag_name
        End
        
        If upper(@pextra1)='U' Begin
				---route wise total
        select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY"
		,sum(x.third_sup) "THIRD SUPPLY",
          -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C" from
                        (select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
                (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='' ) and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null  or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null  or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                     (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                 publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null  or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null  or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                           and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code,x.unit_code,x.route_code,x.route_name,x.route_name_oth_lang
                           order by comp_code,route_code
		End
        else	Begin
				----route wise total
                 select x.comp_code "COMP CODE",x.route_code "ROUTE CODE",x.route_name "ROUTE NAME",x.route_name_oth_lang "ROUTE NAME OTHER LANG",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
                 sum(x.third_sup) "THIRD SUPPLY",
           -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C"
		 from
                (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                        (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                         publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                         supdate                  =   @vfirstdate and cir_dbksup.comp_code=     b.comp_code and
                                         cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =   a.agcd and
                                         cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                         cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =      a.edtn and
                                         (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                         (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
										(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                              (select isnull(sum(sup_copy),0) from cir_dbksup
                                   where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                         publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                         supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                         cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                         cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                         (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                         cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
										(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                         (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                             from cir_dbksup a,cir_route_mast b,cir_agmast c
                             where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                   a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                   (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                                   a.agcd=c.agcd and a.dpcd=c.dpcd and
                                   (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                   and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
									and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                   and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                   ) x
                             where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                   group by x.comp_code,x.route_code,x.route_name,x.route_name_oth_lang
                                   order by comp_code,route_code
        End
        
        If upper(@pextra1)='U' Begin
				----comp wise total
        select x.comp_code "COMP CODE",
		sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
		sum(x.third_sup) "THIRD SUPPLY",
          -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C"		,
		(select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
        d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null) and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
        (m.dist_code = @proute or @proute is null or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
        where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
        (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
		(select distinct a.comp_code comp_code,a.unit_code unit_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,c.station_code station_code,c.branch_code branch_code,
          (select isnull(sum(base_supply),0) from cir_supply
                           where cir_supply.comp_code     =   @pcomp_code and unit =   @punit_code and
                                 cir_supply.publ          =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                 isnull(cir_supply.supply_flag,'N') =   'Y' and cir_supply.comp_code = b.comp_code and
                                 cir_supply.unit          =   b.unit and cir_supply.agcd          = a.agcd and
                                 cir_supply.dpcd          =   a.dpcd and cir_supply.route_code    = b.route_code and
                                 cir_supply.publ          =   a.publ and cir_supply.edtn          = a.edtn and
                                 (cir_supply.route_code   =   @proute or @proute is null or @proute='') and
                                 cir_supply.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                 (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_supply.supply_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                      (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code		 = @pcomp_code and unit_code =    @punit_code and
                                 publ			 = @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                     (select isnull(sum(sup_copy),0) from cir_dbksup
                           where comp_code		 = @pcomp_code and unit_code =    @punit_code and
                                 publ			 = @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                 supdate         = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                 cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                 cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                 (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                 cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and 
								(main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                 (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup            
                     from cir_dbksup a,cir_route_mast b,cir_agmast c
                     where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                           a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                           (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                           a.agcd=c.agcd and a.dpcd=c.dpcd and
                           (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
							and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
                           and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                           and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                           ) x
                     where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                           group by x.comp_code
                           order by comp_code
			End
        else	Begin
        ----comp wise total
                     select x.comp_code "COMP CODE",sum(x.first_sup) "FIRST SUPPLY",sum(x.second_sup) "SECOND SUPPLY",
					sum(x.third_sup) "THIRD SUPPLY",
           -ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.second_sup),0) as "VARIANCE_A-B",
         - ISNULL(sum(x.first_sup),0) + ISNULL(sum(x.third_sup),0) as "VARIANCE_A-C",
        
        CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.second_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.second_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.second_sup)END, 2) 
		END "PERCENT_VARIANCE_A-B",		
		
		CASE SUM(x.first_sup) WHEN 0 THEN 100 
		ELSE ROUND(((ISNULL(SUM(x.third_sup), 0) - ISNULL(SUM(x.first_sup), 0)) * 100) / CASE sign(SUM(x.third_sup) - SUM(x.first_sup)) WHEN - 1 THEN SUM(x.first_sup)ELSE SUM(x.third_sup)END, 2) 
		END "PERCENT_VARIANCE_A-C"	,
                     (select isnull(sum(d.sup_copy),0) from cir_dbksup d,cir_agmast m  where d.comp_code = m.comp_code and d.comp_code = @pcomp_code and d.unit_code = m.unit and d.unit_code = @punit_code and
                            d.publ = @ppublication and (d.edtn = @pedtn or @pedtn is null or @pedtn='') and d.agcd=m.agcd and d.dpcd=m.dpcd and d.supdate = @vfirstdate and
                            (m.dist_code = @proute or @proute is null  or @proute='') and d.edtn in(select distinct edtn from cir_edtn_mast
                            where comp_code=d.comp_code and edtn = d.edtn and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                            (d.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_total_supply from
                    (select distinct a.comp_code comp_code,a.agcd,a.dpcd,a.publ,a.edtn,c.ag_name,c.ag_name_oth_lang,c.city_code,a.route_code,b.route_name,b.route_name_oth_lang,
                            (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code                =   @pcomp_code and unit_code =   @punit_code and
                                             publ                     =   @ppublication and (edtn   =   @pedtn or @pedtn is null or @pedtn='') and
                                             supdate                  =   @vfirstdate and cir_dbksup.comp_code =    b.comp_code and
                                             cir_dbksup.unit_code     =   b.unit and cir_dbksup.agcd          =     a.agcd and
                                             cir_dbksup.dpcd          =   a.dpcd and cir_dbksup.route_code    =     b.route_code and
                                             cir_dbksup.publ          =   a.publ and cir_dbksup.edtn          =     a.edtn and
                                             (cir_dbksup.route_code   =   @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and
                                             (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) first_sup,
                                  (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                             publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                             supdate      = @vseconddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) second_sup,
                                (select isnull(sum(sup_copy),0) from cir_dbksup
                                       where comp_code    =    @pcomp_code and unit_code =    @punit_code and
                                             publ         =    @ppublication and (edtn   =    @pedtn or @pedtn is null or @pedtn='') and
                                             supdate      = @vthirddate and cir_dbksup.agcd =    a.agcd and
                                             cir_dbksup.dpcd = a.dpcd and cir_dbksup.route_code =  a.route_code and
                                             cir_dbksup.publ = a.publ and cir_dbksup.edtn =  a.edtn and
                                             (cir_dbksup.route_code= @proute or @proute is null or @proute='') and
                                             cir_dbksup.edtn in(select distinct edtn from cir_edtn_mast where comp_code=@pcomp_code and (edtn = @pedtn or @pedtn is null or @pedtn='') and (main_edtn=@pmainedtn or @pmainedtn is null or @pmainedtn='')) and
                                             (cir_dbksup.sup_type_code = @pextra2 or @pextra2 is null or @pextra2='')) third_sup
                                 from cir_dbksup a,cir_route_mast b,cir_agmast c
                                 where a.comp_code=@pcomp_code and a.comp_code=b.comp_code and a.comp_code=c.comp_code and
                                       a.unit_code=@punit_code and a.unit_code=b.unit and a.unit_code=c.unit and
                                       (a.supdate = @vfirstdate or a.supdate = @vseconddate or a.supdate = @vthirddate ) and
                                       a.agcd=c.agcd and a.dpcd=c.dpcd and
                                       (a.route_code=@proute or @proute is null or @proute='') and a.route_code=b.route_code 
                                       and (a.AGENCY_TY_CODE=@pextra3 or @pextra3 is null or @pextra3='')
										and (c.AG_CLASS=@pextra4 or @pextra4 is null or @pextra4='')
                                       and (isnull(final_supply_flag,'N') = @pextra5  or @pextra5 is null or @pextra5='')  
                                       )x
                                 where isnull(x.second_sup,0)-isnull(x.first_sup,0)<>0
                                       group by comp_code
                                       order by comp_code
        End
		 
End





//////////////////////////////////////////////////end of procedures 04/06/2012///////////////////////////////////////////////////

///////////////////////////////////add by vivek issue no 6824 04/06/2012//////////////////////////////////////////////

USE [abhi]
GO
/****** Object:  StoredProcedure [dbo].[cir_expenses_cn_process_p]    Script Date: 06/04/2012 12:03:52 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER procedure [dbo].[cir_expenses_cn_process_p]
    @pcompcode       as varchar(20),
    @punitcode       as varchar(20),
    @ppublcode       as varchar(20),
    @pagcode         as varchar(20),
    @pdepocode       as varchar(20),
    @pdatefrom       as datetime,
    @pdatetill       as datetime,
    @pdoctype        as varchar(20),
    @precptdt        as datetime,
    @precptno        as varchar(50),
    @preason         as varchar(50),
    @pexp_type_code  as varchar(50),
    @ptot_supply     as numeric(6),
    @premark         as varchar(500),
    @puserid         as varchar(20),
    @pdateformat     as varchar(20),
    @pextra1         as varchar(50),
    @pextra2         as varchar(50),
    @pextra3         as varchar(50),
    @pextra4         as varchar(50),
    @pextra5         as varchar(50)
  As
    declare @v_doctype		varchar(10)
    declare @v_dt			datetime
    declare @v_sess_id		varchar(30)
    declare @v2_comp_code	varchar(50)
    declare @v2_unit_code	varchar(50)
    declare @v2_publ_code	varchar(50)
    declare @v2_doctype		varchar(50)
    declare @v2_tot_supply  numeric(10)
    declare @v2_recptdt		datetime
    declare @v2_recptno		varchar(50)
    declare @v2_amount		numeric(15,2)
    declare @v2_bilagcd		varchar(50)
    declare @v2_bildpcd		varchar(50)
    declare @v2_exp_type_code	varchar(50)
    declare @v2_valid_days	numeric(10)
    declare @v2_cn_through	varchar(50)
    declare c2 cursor for
        select s.comp_code,s.unit_code,s.publ_code,s.doctype,s.exp_type_code exp_type_code,sum(s.tot_supply) tot_supply,s.recptdt,s.recptno,sum(s.amount) amount,
        s.bilagcd,s.bildpcd ,s.from_supply valid_days,s.cn_through cn_through 
        from cir_inct_process_det s,cir_agmast m 
        where s.comp_code=m.comp_code and s.comp_code=@pcompcode and s.unit_code=m.unit and s.unit_code=@punitcode and 
        s.bilagcd=m.agcd and (s.bilagcd=@pagcode or @pagcode is null or @pagcode='') and s.bildpcd=m.dpcd and (s.bildpcd= @pdepocode or @pdepocode is null or @pdepocode='') and
        s.recptno=@precptno and s.recptdt=@precptdt and s.exp_type_code=@pexp_type_code and s.tran_type='EXP'
        group by s.comp_code,s.unit_code,s.doctype,s.exp_type_code,s.recptdt,s.recptno,s.bilagcd,s.bildpcd,s.publ_code,s.from_supply,s.cn_through
        having sum(s.amount)>0
        order by s.comp_code,s.unit_code,s.bilagcd,s.bildpcd
    
    declare @v_amt			numeric(15,2)
    declare @v_remark		varchar(500);
    declare @v_recptno		varchar(50);
    declare @v_dsign		numeric(5);
    
    declare @v_bran_code	varchar(20);
    declare @v_rec_no		numeric(10);  
    declare @v_unsold_copy	numeric(10);
    declare @vdistcode		varchar(4000);
    declare @vtalukacode	varchar(4000);

  Begin
    insert into cir_inct_process_det
        (comp_code, unit_code, publ_code, edtn_code,sup_type_code, from_pdate,till_pdate, agcd, dpcd, tot_supply, inct_rate,calc_type, doctype, recptdt, recptno, amount, bilagcd, bildpcd, created_by, created_date, updated_by, updated_date, 
        exp_type_code,reason,tran_type,from_supply,cn_through)
        select comp_code, unit_code, publ_code, edtn_code,sup_type_code, from_pdate,till_pdate, agcd, dpcd, @ptot_supply tot_supply, inct_rate,calc_type, doctype, recptdt, recptno, case when calc_type='P' then round(isnull(@ptot_supply,0)*isnull(inct_rate,0),2) else isnull(inct_rate,0) end amount, 
        bilagcd, bildpcd, created_by, created_date, updated_by, updated_date,
        exp_type_code,reason,tran_type,from_supply,cn_through
        from cir_inct_process_det_temp where comp_code=@pcompcode and unit_code=@punitcode and 
            bilagcd=@pagcode and bildpcd= @pdepocode and recptno=@precptno and recptdt=@precptdt and exp_type_code=@pexp_type_code and publ_code=@ppublcode and tran_type='EXP' and @ptot_supply>0
            
    If @pdoctype is null or @pdoctype='' Begin
        set @v_doctype='CN'
    End    
    Else Begin
        set @v_doctype=@pdoctype
    End
        
   set @v_amt=0

   open c2
		fetch NEXT FROM c2 INTO @v2_comp_code,@v2_unit_code,@v2_publ_code,@v2_doctype,@v2_exp_type_code,@v2_tot_supply,@v2_recptdt,@v2_recptno,@v2_amount,@v2_bilagcd,@v2_bildpcd,@v2_valid_days,@v2_cn_through 
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN
        select @v_bran_code=branch_code from cir_agmast 
            where comp_code=@v2_comp_code and unit=@v2_unit_code and agcd=@v2_bilagcd and dpcd=@v2_bildpcd;
        
        select @v_dsign=Dsign from cir_docmst where Comp_code=@pcompcode AND doc_type=@v_doctype

        If(@v_dsign=-1) Begin
            set @v_amt=@v2_amount*@v_dsign
        End    
        Else Begin
            set @v_amt=@v2_amount*@v_dsign
        End
        
        If @premark is null or @premark='' Begin
            set @v_remark='Being amount auto credited against Expenses charges'
        End    
        Else Begin
            set @v_remark=@premark
        End
		
		If @v2_cn_through='D' Begin
			SELECT @v_rec_no  =  CAST( MAX(SUBSTRING(recptno, 5, 8))AS NUMERIC) + 1 FROM  cir_rcphdr 
			WHERE comp_code  = @pcompcode AND doctype  = @pdoctype
			AND CONVERT(VARCHAR(23), recptdt) = CONVERT(VARCHAR(23), @v2_recptdt) AND branch_code  = @v_bran_code
			
			IF ISNULL(@v_rec_no, 0)= 0 BEGIN 
				SET @v_recptno  = @v_bran_code + '-' + REPLACE(CONVERT(VARCHAR(5), GETDATE(), 2), '.', '')+ '0001' 
			END
			ELSE BEGIN 
				SET @v_recptno  = @v_bran_code + '-' + dbo.fnPadLeft('0',8,@v_rec_no) 
			END
	    
			  insert into cir_rcphdr(comp_code,unit_code,agcd,dpcd,doctype,
									 recptno,recptdt,amount,reason,remark,
									 achd,voucherno,voucherdt,userid,creation_date,branch_code)
							  values(@v2_comp_code, @v2_unit_code,@v2_bilagcd, @v2_bildpcd,@v2_doctype,
									 @v_recptno,@v2_recptdt,@v_amt,isnull(@preason,'EXPENSES CHARGES'),@v_remark,
									 'NM',@v_recptno,@v2_recptdt,@puserid,getdate(),@v_bran_code)
			  insert into cir_rcpdet(comp_code,unit_code,agcd,dpcd,doctyp,publ,
									 recptno,recptdt,payfor,achd,amount,
									 reason,remark,voucherno,voucherdt,usrid,
									 creation_date,branch_code)
							  values(@v2_comp_code, @v2_unit_code,@v2_bilagcd, @v2_bildpcd,@v2_doctype,@v2_publ_code,
									 @v_recptno,@v2_recptdt,@v2_unit_code,'NM',@v_amt,
									 isnull(@preason,'EXPENSES CHARGES'),@v_remark,@v_recptno,@v2_recptdt,@puserid,
									 getdate(),@v_bran_code);
			  insert into cir_outmast(comp_code,unit_code,agcd,dpcd,doctyp,publ,
									  recptno,recptdt,achd,amount,reason,
									  remark,voucherno,voucherdt,usrid,creation_date,branch_code)
							   values(@v2_comp_code, @v2_unit_code,@v2_bilagcd, @v2_bildpcd,@v2_doctype,@v2_publ_code,
									  @v_recptno,@v2_recptdt,'NM',@v_amt,isnull(@preason,'EXPENSES CHARGES'),
									  @v_remark,@v_recptno,@v2_recptdt,@puserid,getdate(),@v_bran_code)                               
			End
			Else Begin
				SELECT @v_rec_no  =  CAST( MAX(SUBSTRING(recptno, 5, 8))AS NUMERIC) + 1
				FROM  cir_rcphdr_prov
				WHERE comp_code  = @pcompcode AND doctype  = @pdoctype
				AND CONVERT(VARCHAR(23), recptdt) = CONVERT(VARCHAR(23), @v2_recptdt) AND branch_code  = @v_bran_code
				
				IF ISNULL(@v_rec_no, 0)= 0 BEGIN 
					SET @v_recptno  = @v_bran_code + '-P' + REPLACE(CONVERT(VARCHAR(5), GETDATE(), 2), '.', '')+ '0001' 
				END
				ELSE BEGIN 
					SET @v_recptno  = @v_bran_code + '-P' + dbo.fnPadLeft('0',8,@v_rec_no) 
				END
		    
				  insert into cir_rcphdr_prov(comp_code,unit_code,agcd,dpcd,doctype,
										 recptno,recptdt,amount,reason,remark,
										 achd,userid,creation_date,branch_code,ocds)
								  values(@v2_comp_code, @v2_unit_code,@v2_bilagcd, @v2_bildpcd,@v2_doctype,
										 @v_recptno,@v2_recptdt,@v_amt,isnull(@preason,'EXPENSES CHARGES'),@v_remark,
										 'NM',@puserid,getdate(),@v_bran_code,cast(@v2_valid_days as numeric))			
			End
			
			update cir_inct_process_det set recptno=@v_recptno
				where comp_code=@v2_comp_code and unit_code=@v2_unit_code and doctype=@v2_doctype and recptno=@precptno and 
                  recptdt=@v2_recptdt and from_pdate = @pdatefrom and till_pdate = @pdatetill and bilagcd = @v2_bilagcd and bildpcd = @v2_bildpcd and publ_code=@v2_publ_code and exp_type_code=@v2_exp_type_code and tran_type='EXP';
    
	        delete from cir_inct_process_det_temp        
		        where comp_code=@v2_comp_code and unit_code=@v2_unit_code and doctype=@v2_doctype and recptno=@precptno and 
			          recptdt=@v2_recptdt and from_pdate = @pdatefrom and till_pdate = @pdatetill and bilagcd = @v2_bilagcd and bildpcd = @v2_bildpcd and publ_code=@v2_publ_code and exp_type_code=@v2_exp_type_code and tran_type='EXP';
                  
       fetch NEXT FROM c2 INTO @v2_comp_code,@v2_unit_code,@v2_publ_code,@v2_doctype,@v2_exp_type_code,@v2_tot_supply,@v2_recptdt,@v2_recptno,@v2_amount,@v2_bilagcd,@v2_bildpcd,@v2_valid_days,@v2_cn_through
   End
   close c2;
	deallocate c2
   delete from cir_inct_process_det_temp where comp_code=@pcompcode and unit_code=@punitcode and 
            bilagcd=@pagcode and bildpcd= @pdepocode and recptno=@precptno and recptdt=@precptdt and publ_code=@ppublcode and exp_type_code=@pexp_type_code and tran_type='EXP';
            
   select getdate() as "CUR_DATE" 
   
End
//////////////////////////end of procedure//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



////////////add by Deepika for Issue no. 7535, 6821, 7005////////////////////////////////////////////////////



/////////////////////////////////////////////////////////////

 
ALTER procedure [dbo].[CIR_RECEIPT_DATA_MOVE]
    @pcompcode       as varchar(200),
    @punitcode       as varchar(200),
    @pdoctype        as varchar(200),
    @precptdt        as varchar(200),
    @precptno        as varchar(200),
    @pdateformate    as varchar(200),
    @puserid         as varchar(200),
    @prectype        as varchar(200),--it is for agency receipt or distraibution receipt
    @pextra1         as varchar(200),
    @pextra2         as varchar(200),
    @pextra3         as varchar(200),
    @pextra4         as varchar(200),
    @pextra5         as varchar(200)
as
declare @v_recno numeric(10)
declare @v_dt    datetime
begin
    set @v_dt=dbo.convert_user_date('/', @precptdt,@pdateformate)
    
    if upper(@prectype)='D' Begin
        insert into cir_rcphdr_dis(comp_code,unit_code,doctype,agcd,dpcd,recptno,
            recptdt,chno,chdt,chbank,amount,oth_amount,ccdp,ccds,rcdp,rcds,ocdp,ocds,reason,
            remark,achd,voucherno,voucherdt,vchtype,publ,received_from,tdsrate,tdsamt,staxrate,
              staxamt,status,ref_recptno,ref_recptdt,ref_amount,ref_doctype,cancel_user,cancel_datetime,
              cancel_remark,userid,creation_datetime,branch_code,prov_rec_no,prov_rec_dt,remark_oth,MANNUALRECPTNO)
          select comp_code,unit_code,doctype,agcd,dpcd,recptno,
          recptdt,chno,
          CASE chdt WHEN '1900-01-01 00:00:00.000' THEN NULL else chdt END chdt,
          chbank,amount,oth_amount,ccdp,ccds,rcdp,rcds,ocdp,ocds,reason,
          remark,achd,voucherno,voucherdt,vchtype,publ,received_from,tdsrate,tdsamt,staxrate,
          staxamt,status,ref_recptno,
          CASE ref_recptdt WHEN '1900-01-01 00:00:00.000' THEN NULL else ref_recptdt END ref_recptdt,
          ref_amount,ref_doctype,cancel_user,cancel_date,
          cancel_remark,userid,creation_date,branch_code,prov_rec_no,
          CASE prov_rec_dt WHEN '1900-01-01 00:00:00.000' THEN NULL else prov_rec_dt END prov_rec_dt,
          remark_oth,MANNUALRECPTNO from cir_rcphdr_dis_temp
            where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
                    recptno=@precptno and recptdt=@v_dt
      
          insert into cir_rcpdet_dis(comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, recptno, recptdt, 
                            payfor, achd, publ, chno, chbnk, chdt, amount, reason, remark, voucherno, voucherdt, 
                            tds, stax, status, usrid, creation_datetime, branch_code)
          select comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, recptno, recptdt, 
                            payfor, achd, publ, chno, chbnk, 
                            CASE chdt WHEN '1900-01-01 00:00:00.000' THEN NULL else chdt END chdt, 
                            amount, reason, remark, voucherno, voucherdt, 
                            tds, stax, status, usrid, creation_date, branch_code from cir_rcpdet_dis_temp
            where comp_code=@pcompcode and unit_code=@punitcode and doctyp=@pdoctype and 
                    recptno=@precptno and recptdt=@v_dt

        insert into cir_outmast_dis (comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, recptno, recptdt, 
                        achd, publ, chno, chbnk, chdt, amount, reason, remark, voucherno, voucherdt, balance, 
                        tds, stax, status, cancel_userid, cancel_dt, cancel_remark, usrid, creation_datetime, bill_sec_amt, branch_code)
        select comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, recptno, recptdt, 
                        achd, publ, chno, chbnk, 
                        CASE chdt WHEN '1900-01-01 00:00:00.000' THEN NULL else chdt END chdt, 
                        amount, reason, remark, voucherno, voucherdt, balance, 
                        tds, stax, status, cancel_userid, cancel_dt, cancel_remark, usrid, creation_date, bill_sec_amt, branch_code from cir_outmast_dis_temp
             where comp_code=@pcompcode and unit_code=@punitcode and doctyp=@pdoctype and 
                    recptno=@precptno and recptdt=@v_dt
		
			select @v_recno=count(*) from cir_rcpt_document_dis_temp
			where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
						recptno=@precptno and recptdt=@v_dt
			If @v_recno>0 Begin		                    
				insert into cir_rcpt_document_dis(comp_code, unit_code, doctype, recptno, recptdt, filename, created_by, created_dt)
				select comp_code, unit_code, doctype, recptno, recptdt, filename, created_by, created_dt from cir_rcpt_document_dis_temp
				where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
							recptno=@precptno and recptdt=@v_dt
			End

			select @v_recno=count(*) from cir_rcp_unadj_dis_temp
			where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
						recptno=@precptno and recptdt=@v_dt

			If @v_recno>0 Begin		                    
				insert into cir_rcp_unadj_dis(comp_code,unit_code,agcd,dpcd,doctyp,recptno,recptdt,publ,amount,created_by,created_date,updated_by,updated_date)
				select comp_code,unit_code,agcd,dpcd,doctyp,recptno,recptdt,publ,amount,created_by,created_date,updated_by,updated_date from cir_rcp_unadj_temp_dis
				where comp_code=@pcompcode and unit_code=@punitcode and doctyp=@pdoctype and recptno=@precptno
			End				
		End
    else Begin
        insert into cir_rcphdr(comp_code,unit_code,doctype,agcd,dpcd,recptno,
            recptdt,chno,chdt,chbank,amount,oth_amount,ccdp,ccds,rcdp,rcds,ocdp,ocds,reason,
            remark,achd,voucherno,voucherdt,vchtype,publ,received_from,tdsrate,tdsamt,staxrate,
              staxamt,status,ref_recptno,
              ref_recptdt,
              ref_amount,ref_doctype,cancel_user,cancel_date,
              cancel_remark,userid,creation_date,branch_code,prov_rec_no,prov_rec_dt,remark_oth,MANNUALRECPTNO)
          select comp_code,unit_code,doctype,agcd,dpcd,recptno,
          recptdt,chno,
          CASE chdt WHEN '1900-01-01 00:00:00.000' THEN NULL else chdt END chdt,
          chbank,amount,oth_amount,ccdp,ccds,rcdp,rcds,ocdp,ocds,reason,
          remark,achd,voucherno,voucherdt,vchtype,publ,received_from,tdsrate,tdsamt,staxrate,
          staxamt,status,ref_recptno,
          CASE ref_recptdt WHEN '1900-01-01 00:00:00.000' THEN NULL else ref_recptdt END  ref_recptdt,
          ref_amount,ref_doctype,cancel_user,cancel_date,
          cancel_remark,userid,creation_date,branch_code,prov_rec_no,
          CASE prov_rec_dt WHEN '1900-01-01 00:00:00.000' THEN NULL else prov_rec_dt END prov_rec_dt,remark_oth,MANNUALRECPTNO from cir_rcphdr_temp
            where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
                    recptno=@precptno and recptdt=@v_dt
      
          insert into cir_rcpdet(comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, recptno, recptdt, 
                            payfor, achd, publ, chno, chbnk, chdt, amount, reason, remark, voucherno, voucherdt, 
                            tds, stax, status, usrid, creation_date, branch_code)
          select comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, recptno, recptdt, 
                            payfor, achd, publ, chno, chbnk, 
                            CASE chdt WHEN '1900-01-01 00:00:00.000' THEN NULL else chdt END chdt, 
                            amount, reason, remark, voucherno, voucherdt, 
                            tds, stax, status, usrid, creation_date, branch_code from cir_rcpdet_temp
            where comp_code=@pcompcode and unit_code=@punitcode and doctyp=@pdoctype and 
                    recptno=@precptno and recptdt=@v_dt

        insert into cir_outmast (comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, recptno, recptdt, 
                        achd, publ, chno, chbnk, chdt, amount, reason, remark, voucherno, voucherdt, balance, 
                        tds, stax, status, cancel_userid, cancel_dt, cancel_remark, usrid, creation_date, bill_sec_amt, branch_code)
        select comp_code, unit_code, agcd, dpcd, doctyp, billno, billdt, recptno, recptdt, 
                        achd, publ, chno, chbnk, 
                        CASE chdt WHEN '1900-01-01 00:00:00.000' THEN NULL else chdt END chdt, 
                        amount, reason, remark, voucherno, voucherdt, balance, 
                        tds, stax, status, cancel_userid, cancel_dt, cancel_remark, usrid, creation_date, bill_sec_amt, branch_code from cir_outmast_temp
             where comp_code=@pcompcode and unit_code=@punitcode and doctyp=@pdoctype and 
                    recptno=@precptno and recptdt=@v_dt
		
		select @v_recno=count(*) from cir_rcpt_document_temp
        where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
                    recptno=@precptno and recptdt=@v_dt
        If @v_recno>0 Begin            		
			insert into cir_rcpt_document(comp_code, unit_code, doctype, recptno, recptdt, filename, created_by, created_dt)
			select comp_code, unit_code, doctype, recptno, recptdt, filename, created_by, created_dt from cir_rcpt_document_temp
			where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
						recptno=@precptno and recptdt=@v_dt
		End
			select @v_recno=count(*) from cir_rcp_unadj_temp
			where comp_code=@pcompcode and unit_code=@punitcode and doctyp=@pdoctype and 
						recptno=@precptno and recptdt=@v_dt

			If @v_recno>0 Begin		                    
				insert into cir_rcp_unadj(comp_code,unit_code,agcd,dpcd,doctyp,recptno,recptdt,publ,amount,created_by,created_date,updated_by,updated_date)
				select comp_code,unit_code,agcd,dpcd,doctyp,recptno,recptdt,publ,amount,created_by,created_date,updated_by,updated_date from cir_rcp_unadj_temp
				where comp_code=@pcompcode and unit_code=@punitcode and doctyp=@pdoctype and recptno=@precptno
			End		
    end           
    
    if upper(@prectype)='D' Begin
        select @v_recno=count(*) from cir_rcphdr_dis 
            where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
                recptno=@precptno
		End
    else Begin
        select @v_recno=count(*) from cir_rcphdr 
            where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
                recptno=@precptno 
    End

    if isnull(@v_recno,0)>0 Begin
		if upper(@prectype)='D' Begin
			delete from cir_rcphdr_dis_temp 
				where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
					recptno=@precptno
			End
		else Begin
			delete from cir_rcphdr_temp 
				where comp_code=@pcompcode and unit_code=@punitcode and doctype=@pdoctype and 
					recptno=@precptno 
		End
        select @v_recno as "RECNO"
		End
     else Begin
        select 0 as "RECNO"
     End

end

////////////////////////////////////////////////////////////////



create procedure [dbo].[cir_chk_duplicacy_recptentrychno]

    @pcompcode   as varchar(20),
    @punitcode   as varchar(20),
    @pagcd        as varchar(200),
    @pdpcd        as varchar(200),
    @pdoctyp      as varchar(200),
    @pachd        as varchar(200),
    @pbank        as varchar(200),
    @pchno        as varchar(200),
    @pextra1      as varchar(200),
    @pextra2      as varchar(200)
    
    
    as
    
   declare @cnt int
   select @cnt=count(*) from cir_rcphdr    
   where comp_code=@pcompcode and unit_code=@punitcode and 
       agcd=@pagcd and dpcd=@pdpcd and doctype=@pdoctyp and achd=@pachd
        and chbank=@pbank and chno=@pchno 
        if(@cnt>0) BEGIN
        select 'DUPLICATE RECORD'
        END
        ELSE BEGIN 
          select 'True'
        END
 



/////////////////////////////////





ALTER procedure [dbo].[cir_update_flag_provreceipt]

    @pcompcode   as varchar(20),
    @punitcode   as varchar(20),
    @precptno     as varchar(200),
    @precptdt     as varchar(200),
    @pdoctyp      as varchar(200),
    @pflag       as varchar(200),
    @pextra1     as varchar(200),
    @pextra2     as varchar(200)
as
  
  
begin 

 
   UPDATE CIR_RCPHDR_PROV set  FLAG=@pflag 
    where comp_code=@pcompcode and unit_code=isnull(@punitcode,unit_code) and 
        recptno=@precptno and recptdt=@precptdt and doctype=@pdoctyp 
        
       
end 




/////////////////////////// for bill tag



ALTER procedure [dbo].[cir_get_prorecipt_detail]
    @pcompcode   as varchar(20),
    @punitcode   as varchar(20),
    @prorecno    as varchar(20),
    @prorecdate  as varchar(20),
    @pdroctyp    as varchar(20),
    @pdateformat as varchar(20),
    @pextra1     as varchar(200),
    @pextra2     as varchar(200),
    @pextra3     as varchar(200),
    @pextra4     as varchar(200),
    @pextra5     as varchar(200)
as
   
begin 
    select * from CIR_OUTMAST_PROV
    where comp_code=@pcompcode and unit_code=isnull(@punitcode,unit_code) and 
        recptno=@prorecno and recptdt=@prorecdate and doctyp=@pdroctyp 
end 





/////////////////////////////////////////end/////////////////////////////////////////////////////////////////////////



































